function db(e,t){for(var n=0;n<t.length;n++){const r=t[n];if(typeof r!="string"&&!Array.isArray(r)){for(const a in r)if(a!=="default"&&!(a in e)){const i=Object.getOwnPropertyDescriptor(r,a);i&&Object.defineProperty(e,a,i.get?i:{enumerable:!0,get:()=>r[a]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}const hb="modulepreload",fb=function(e){return"/"+e},ah={},$n=function(t,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(n.map(c=>{if(c=fb(c),c in ah)return;ah[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const m=document.createElement("link");if(m.rel=u?"stylesheet":hb,u||(m.as="script"),m.crossOrigin="",m.href=c,l&&m.setAttribute("nonce",l),document.head.appendChild(m),u)return new Promise((h,b)=>{m.addEventListener("load",h),m.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return a.then(o=>{for(const l of o||[])l.status==="rejected"&&i(l.reason);return t().catch(i)})},vc="lifeGoalApp:debug",mb=new Date().toISOString(),Ca=(()=>{try{return window.localStorage}catch(e){return console.warn("Local storage is not available:",e),null}})(),Vm=new URLSearchParams(window.location.search),ih=Vm.get("debug"),Gm=ih==="1"||ih==="true"||Vm.has("debug"),wc=()=>{if(!Ca)return!1;try{return Ca.getItem(vc)==="1"}catch{return!1}},Km=e=>{if(Ca)try{e?Ca.setItem(vc,"1"):Ca.removeItem(vc)}catch(t){console.warn("Unable to persist debugger preference.",t)}},pb=Gm||wc(),Jm=e=>{if(e==null)return"";if(typeof e=="string")return e;if(e instanceof Error)return`${e.message}
${e.stack??""}`.trim();try{return JSON.stringify(e,null,2)}catch{return String(e)}},gb=()=>{const e=[];let t=null,n=null,r=null;const a=()=>{if(t)return;t=document.createElement("aside"),t.id="lifegoal-debugger",t.style.cssText=["position:fixed","bottom:16px","right:16px","width:min(420px,92vw)","max-height:70vh","display:none","flex-direction:column","background:rgba(15,23,42,0.94)","color:#f8fafc","border-radius:16px","box-shadow:0 24px 48px rgba(15,23,42,0.45)","font-family:SFMono-Regular,ui-monospace,Menlo,Consolas,'Liberation Mono',monospace","z-index:2147483647","border:1px solid rgba(148,163,184,0.35)","overflow:hidden"].join(";");const h=document.createElement("header");h.style.cssText=["display:flex","align-items:center","justify-content:space-between","gap:0.5rem","padding:0.75rem 1rem","background:rgba(15,23,42,0.85)","border-bottom:1px solid rgba(148,163,184,0.35)"].join(";");const b=document.createElement("strong");b.textContent="LifeGoal debugger",b.style.fontSize="0.95rem";const y=document.createElement("div");y.style.cssText="display:flex;align-items:center;gap:0.5rem;";const g=document.createElement("button");g.type="button",g.textContent="Close",g.style.cssText=["background:transparent","border:1px solid rgba(148,163,184,0.45)","color:#f8fafc","border-radius:999px","padding:0.2rem 0.75rem","font-size:0.75rem","cursor:pointer"].join(";"),g.addEventListener("click",()=>u()),r=document.createElement("button"),r.type="button",r.style.cssText=["background:rgba(59,130,246,0.22)","border:1px solid rgba(148,163,184,0.45)","color:#bfdbfe","border-radius:999px","padding:0.2rem 0.75rem","font-size:0.75rem","cursor:pointer"].join(";"),r.addEventListener("click",()=>{const w=!wc();Km(w),i()}),y.appendChild(r),y.appendChild(g),h.appendChild(b),h.appendChild(y),n=document.createElement("div"),n.style.cssText=["padding:0.75rem 1rem","overflow:auto","display:flex","flex-direction:column","gap:0.5rem","font-size:0.8rem","line-height:1.45"].join(";"),t.appendChild(h),t.appendChild(n)},i=()=>{if(!r)return;const h=wc();r.textContent=h?"Persisted":"Persist",r.style.background=h?"rgba(16,185,129,0.35)":"rgba(59,130,246,0.22)",r.style.color=h?"#bbf7d0":"#bfdbfe"},o=()=>{const h=n;h&&(h.innerHTML="",e.slice(-100).forEach(b=>{const y=document.createElement("div");y.style.cssText=["display:grid","gap:0.25rem","background:rgba(148,163,184,0.12)","border-radius:10px","padding:0.55rem 0.65rem"].join(";");const g=document.createElement("div");if(g.textContent=`[${b.time}] ${b.level.toUpperCase()} • ${b.message}`,g.style.fontWeight="600",y.appendChild(g),b.detailText){const w=document.createElement("pre");w.textContent=b.detailText,w.style.cssText=["margin:0","white-space:pre-wrap","word-break:break-word","background:rgba(15,23,42,0.6)","border-radius:6px","padding:0.45rem 0.5rem"].join(";"),y.appendChild(w)}h.appendChild(y)}))},l=(h,b,y)=>{e.push({time:new Date().toLocaleTimeString(),level:h,message:b,detailText:Jm(y)}),e.length>200&&e.shift(),o()},c=()=>{a(),t&&(t.isConnected||(document.body.appendChild(t),i()),t.style.display="flex")},u=()=>{t&&(t.style.display="none")},d=()=>{a(),t&&(t.style.display==="none"||t.style.display===""?c():u())},m=()=>{e.length=0,o()};return a(),o(),{show:c,hide:u,toggle:d,clear:m,push:l,updatePersistButton:i}},hn=gb(),Ym={show:()=>hn.show(),hide:()=>hn.hide(),toggle:()=>hn.toggle(),clear:()=>hn.clear(),log:(e,t)=>hn.push("info",e,t),warn:(e,t)=>hn.push("warn",e,t),error:(e,t)=>hn.push("error",e,t),persist:e=>{Km(!!e),hn.updatePersistButton()},info:{bootStartedAt:mb,userAgent:navigator.userAgent,location:window.location.href}};window.__LifeGoalAppDebugger=Ym;hn.push("info","Debugger initialized.",Ym.info);pb&&(hn.show(),hn.push("info","Debugger auto-opened.",{reason:Gm?"query":"stored preference"}));window.addEventListener("error",e=>{var t;(t=window.__LifeGoalAppDebugger)==null||t.error("Unhandled error captured.",{message:e.message,source:e.filename,line:e.lineno,column:e.colno})});window.addEventListener("unhandledrejection",e=>{var t;(t=window.__LifeGoalAppDebugger)==null||t.error("Unhandled promise rejection.",{reason:Jm(e.reason)})});const _b=e=>{const t=document.getElementById("root");if(!t)return;const n=document.createElement("section");n.setAttribute("role","alert"),n.style.cssText=["font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif","max-width:560px","margin:4rem auto","padding:1.75rem","border-radius:18px","background:rgba(15,23,42,0.05)","color:#0f172a","text-align:center","border:1px solid rgba(148,163,184,0.3)","box-shadow:0 24px 45px rgba(15,23,42,0.12)"].join(";");const r=document.createElement("h1");r.textContent="We hit a snag starting LifeGoalApp",r.style.cssText="margin:0 0 0.75rem;font-size:1.5rem;";const a=document.createElement("p");a.textContent="Your browser couldn't load the app bundle. If you're developing locally, run npm run build and serve the dist folder. For production, make sure the compiled assets are deployed.",a.style.cssText="margin:0 0 0.75rem;line-height:1.6;";const i=document.createElement("p");i.textContent=e instanceof Error?e.message:String(e),i.style.cssText="margin:0;color:#b91c1c;font-weight:600;",n.appendChild(r),n.appendChild(a),n.appendChild(i),t.innerHTML="",t.appendChild(n)},yb=async()=>{var t,n,r;const e=performance.now();(t=window.__LifeGoalAppDebugger)==null||t.log("Loading application entry…",{module:"./main.tsx"});try{await $n(()=>Promise.resolve().then(()=>tC),void 0);const a=Number((performance.now()-e).toFixed(2));(n=window.__LifeGoalAppDebugger)==null||n.log("Application entry resolved.",{durationMs:a})}catch(a){window.dispatchEvent(new CustomEvent("LifeGoalApp:bootstrap-failed",{detail:{message:a instanceof Error?a.message:String(a)}})),(r=window.__LifeGoalAppDebugger)==null||r.error("Failed to load application entry module.",{message:a instanceof Error?a.message:String(a),stack:a instanceof Error?a.stack:void 0}),hn.show(),_b(a)}};yb();function bb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Qm(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var a=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return e[r]}})}),n}var Xm={exports:{}},sl={},Zm={exports:{}},Me={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hi=Symbol.for("react.element"),vb=Symbol.for("react.portal"),wb=Symbol.for("react.fragment"),xb=Symbol.for("react.strict_mode"),jb=Symbol.for("react.profiler"),kb=Symbol.for("react.provider"),Sb=Symbol.for("react.context"),Nb=Symbol.for("react.forward_ref"),Eb=Symbol.for("react.suspense"),Cb=Symbol.for("react.memo"),Tb=Symbol.for("react.lazy"),oh=Symbol.iterator;function Db(e){return e===null||typeof e!="object"?null:(e=oh&&e[oh]||e["@@iterator"],typeof e=="function"?e:null)}var ep={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},tp=Object.assign,np={};function ea(e,t,n){this.props=e,this.context=t,this.refs=np,this.updater=n||ep}ea.prototype.isReactComponent={};ea.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};ea.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function rp(){}rp.prototype=ea.prototype;function qu(e,t,n){this.props=e,this.context=t,this.refs=np,this.updater=n||ep}var Hu=qu.prototype=new rp;Hu.constructor=qu;tp(Hu,ea.prototype);Hu.isPureReactComponent=!0;var lh=Array.isArray,sp=Object.prototype.hasOwnProperty,Wu={current:null},ap={key:!0,ref:!0,__self:!0,__source:!0};function ip(e,t,n){var r,a={},i=null,o=null;if(t!=null)for(r in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)sp.call(t,r)&&!ap.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(l===1)a.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(r in l=e.defaultProps,l)a[r]===void 0&&(a[r]=l[r]);return{$$typeof:hi,type:e,key:i,ref:o,props:a,_owner:Wu.current}}function Ab(e,t){return{$$typeof:hi,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function Vu(e){return typeof e=="object"&&e!==null&&e.$$typeof===hi}function Ib(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var ch=/\/+/g;function Nl(e,t){return typeof e=="object"&&e!==null&&e.key!=null?Ib(""+e.key):t.toString(36)}function so(e,t,n,r,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case hi:case vb:o=!0}}if(o)return o=e,a=a(o),e=r===""?"."+Nl(o,0):r,lh(a)?(n="",e!=null&&(n=e.replace(ch,"$&/")+"/"),so(a,t,n,"",function(u){return u})):a!=null&&(Vu(a)&&(a=Ab(a,n+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(ch,"$&/")+"/")+e)),t.push(a)),1;if(o=0,r=r===""?".":r+":",lh(e))for(var l=0;l<e.length;l++){i=e[l];var c=r+Nl(i,l);o+=so(i,t,n,c,a)}else if(c=Db(e),typeof c=="function")for(e=c.call(e),l=0;!(i=e.next()).done;)i=i.value,c=r+Nl(i,l++),o+=so(i,t,n,c,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function xi(e,t,n){if(e==null)return e;var r=[],a=0;return so(e,r,"","",function(i){return t.call(n,i,a++)}),r}function Pb(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var qt={current:null},ao={transition:null},Rb={ReactCurrentDispatcher:qt,ReactCurrentBatchConfig:ao,ReactCurrentOwner:Wu};function op(){throw Error("act(...) is not supported in production builds of React.")}Me.Children={map:xi,forEach:function(e,t,n){xi(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return xi(e,function(){t++}),t},toArray:function(e){return xi(e,function(t){return t})||[]},only:function(e){if(!Vu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};Me.Component=ea;Me.Fragment=wb;Me.Profiler=jb;Me.PureComponent=qu;Me.StrictMode=xb;Me.Suspense=Eb;Me.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Rb;Me.act=op;Me.cloneElement=function(e,t,n){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var r=tp({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Wu.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)sp.call(t,c)&&!ap.hasOwnProperty(c)&&(r[c]=t[c]===void 0&&l!==void 0?l[c]:t[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];r.children=l}return{$$typeof:hi,type:e.type,key:a,ref:i,props:r,_owner:o}};Me.createContext=function(e){return e={$$typeof:Sb,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:kb,_context:e},e.Consumer=e};Me.createElement=ip;Me.createFactory=function(e){var t=ip.bind(null,e);return t.type=e,t};Me.createRef=function(){return{current:null}};Me.forwardRef=function(e){return{$$typeof:Nb,render:e}};Me.isValidElement=Vu;Me.lazy=function(e){return{$$typeof:Tb,_payload:{_status:-1,_result:e},_init:Pb}};Me.memo=function(e,t){return{$$typeof:Cb,type:e,compare:t===void 0?null:t}};Me.startTransition=function(e){var t=ao.transition;ao.transition={};try{e()}finally{ao.transition=t}};Me.unstable_act=op;Me.useCallback=function(e,t){return qt.current.useCallback(e,t)};Me.useContext=function(e){return qt.current.useContext(e)};Me.useDebugValue=function(){};Me.useDeferredValue=function(e){return qt.current.useDeferredValue(e)};Me.useEffect=function(e,t){return qt.current.useEffect(e,t)};Me.useId=function(){return qt.current.useId()};Me.useImperativeHandle=function(e,t,n){return qt.current.useImperativeHandle(e,t,n)};Me.useInsertionEffect=function(e,t){return qt.current.useInsertionEffect(e,t)};Me.useLayoutEffect=function(e,t){return qt.current.useLayoutEffect(e,t)};Me.useMemo=function(e,t){return qt.current.useMemo(e,t)};Me.useReducer=function(e,t,n){return qt.current.useReducer(e,t,n)};Me.useRef=function(e){return qt.current.useRef(e)};Me.useState=function(e){return qt.current.useState(e)};Me.useSyncExternalStore=function(e,t,n){return qt.current.useSyncExternalStore(e,t,n)};Me.useTransition=function(){return qt.current.useTransition()};Me.version="18.3.1";Zm.exports=Me;var f=Zm.exports;const Ob=bb(f);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lb=f,$b=Symbol.for("react.element"),Mb=Symbol.for("react.fragment"),Ub=Object.prototype.hasOwnProperty,Fb=Lb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,zb={key:!0,ref:!0,__self:!0,__source:!0};function lp(e,t,n){var r,a={},i=null,o=null;n!==void 0&&(i=""+n),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(r in t)Ub.call(t,r)&&!zb.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:$b,type:e,key:i,ref:o,props:a,_owner:Fb.current}}sl.Fragment=Mb;sl.jsx=lp;sl.jsxs=lp;Xm.exports=sl;var s=Xm.exports,xc={},cp={exports:{}},ln={},up={exports:{}},dp={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(C,L){var K=C.length;C.push(L);e:for(;0<K;){var ue=K-1>>>1,de=C[ue];if(0<a(de,L))C[ue]=L,C[K]=de,K=ue;else break e}}function n(C){return C.length===0?null:C[0]}function r(C){if(C.length===0)return null;var L=C[0],K=C.pop();if(K!==L){C[0]=K;e:for(var ue=0,de=C.length,De=de>>>1;ue<De;){var fe=2*(ue+1)-1,H=C[fe],we=fe+1,B=C[we];if(0>a(H,K))we<de&&0>a(B,H)?(C[ue]=B,C[we]=K,ue=we):(C[ue]=H,C[fe]=K,ue=fe);else if(we<de&&0>a(B,K))C[ue]=B,C[we]=K,ue=we;else break e}}return L}function a(C,L){var K=C.sortIndex-L.sortIndex;return K!==0?K:C.id-L.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,l=o.now();e.unstable_now=function(){return o.now()-l}}var c=[],u=[],d=1,m=null,h=3,b=!1,y=!1,g=!1,w=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(C){for(var L=n(u);L!==null;){if(L.callback===null)r(u);else if(L.startTime<=C)r(u),L.sortIndex=L.expirationTime,t(c,L);else break;L=n(u)}}function x(C){if(g=!1,v(C),!y)if(n(c)!==null)y=!0,Z(j);else{var L=n(u);L!==null&&I(x,L.startTime-C)}}function j(C,L){y=!1,g&&(g=!1,p(A),A=-1),b=!0;var K=h;try{for(v(L),m=n(c);m!==null&&(!(m.expirationTime>L)||C&&!q());){var ue=m.callback;if(typeof ue=="function"){m.callback=null,h=m.priorityLevel;var de=ue(m.expirationTime<=L);L=e.unstable_now(),typeof de=="function"?m.callback=de:m===n(c)&&r(c),v(L)}else r(c);m=n(c)}if(m!==null)var De=!0;else{var fe=n(u);fe!==null&&I(x,fe.startTime-L),De=!1}return De}finally{m=null,h=K,b=!1}}var k=!1,S=null,A=-1,P=5,R=-1;function q(){return!(e.unstable_now()-R<P)}function O(){if(S!==null){var C=e.unstable_now();R=C;var L=!0;try{L=S(!0,C)}finally{L?oe():(k=!1,S=null)}}else k=!1}var oe;if(typeof _=="function")oe=function(){_(O)};else if(typeof MessageChannel<"u"){var z=new MessageChannel,ne=z.port2;z.port1.onmessage=O,oe=function(){ne.postMessage(null)}}else oe=function(){w(O,0)};function Z(C){S=C,k||(k=!0,oe())}function I(C,L){A=w(function(){C(e.unstable_now())},L)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(C){C.callback=null},e.unstable_continueExecution=function(){y||b||(y=!0,Z(j))},e.unstable_forceFrameRate=function(C){0>C||125<C?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<C?Math.floor(1e3/C):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return n(c)},e.unstable_next=function(C){switch(h){case 1:case 2:case 3:var L=3;break;default:L=h}var K=h;h=L;try{return C()}finally{h=K}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(C,L){switch(C){case 1:case 2:case 3:case 4:case 5:break;default:C=3}var K=h;h=C;try{return L()}finally{h=K}},e.unstable_scheduleCallback=function(C,L,K){var ue=e.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?ue+K:ue):K=ue,C){case 1:var de=-1;break;case 2:de=250;break;case 5:de=1073741823;break;case 4:de=1e4;break;default:de=5e3}return de=K+de,C={id:d++,callback:L,priorityLevel:C,startTime:K,expirationTime:de,sortIndex:-1},K>ue?(C.sortIndex=K,t(u,C),n(c)===null&&C===n(u)&&(g?(p(A),A=-1):g=!0,I(x,K-ue))):(C.sortIndex=de,t(c,C),y||b||(y=!0,Z(j))),C},e.unstable_shouldYield=q,e.unstable_wrapCallback=function(C){var L=h;return function(){var K=h;h=L;try{return C.apply(this,arguments)}finally{h=K}}}})(dp);up.exports=dp;var Bb=up.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qb=f,on=Bb;function V(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var hp=new Set,za={};function os(e,t){qs(e,t),qs(e+"Capture",t)}function qs(e,t){for(za[e]=t,e=0;e<t.length;e++)hp.add(t[e])}var Jn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jc=Object.prototype.hasOwnProperty,Hb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,uh={},dh={};function Wb(e){return jc.call(dh,e)?!0:jc.call(uh,e)?!1:Hb.test(e)?dh[e]=!0:(uh[e]=!0,!1)}function Vb(e,t,n,r){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function Gb(e,t,n,r){if(t===null||typeof t>"u"||Vb(e,t,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Ht(e,t,n,r,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var At={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){At[e]=new Ht(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];At[t]=new Ht(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){At[e]=new Ht(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){At[e]=new Ht(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){At[e]=new Ht(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){At[e]=new Ht(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){At[e]=new Ht(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){At[e]=new Ht(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){At[e]=new Ht(e,5,!1,e.toLowerCase(),null,!1,!1)});var Gu=/[\-:]([a-z])/g;function Ku(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Gu,Ku);At[t]=new Ht(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Gu,Ku);At[t]=new Ht(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Gu,Ku);At[t]=new Ht(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){At[e]=new Ht(e,1,!1,e.toLowerCase(),null,!1,!1)});At.xlinkHref=new Ht("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){At[e]=new Ht(e,1,!1,e.toLowerCase(),null,!0,!0)});function Ju(e,t,n,r){var a=At.hasOwnProperty(t)?At[t]:null;(a!==null?a.type!==0:r||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(Gb(t,n,a,r)&&(n=null),r||a===null?Wb(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=n===null?a.type===3?!1:"":n:(t=a.attributeName,r=a.attributeNamespace,n===null?e.removeAttribute(t):(a=a.type,n=a===3||a===4&&n===!0?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}var Zn=qb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ji=Symbol.for("react.element"),xs=Symbol.for("react.portal"),js=Symbol.for("react.fragment"),Yu=Symbol.for("react.strict_mode"),kc=Symbol.for("react.profiler"),fp=Symbol.for("react.provider"),mp=Symbol.for("react.context"),Qu=Symbol.for("react.forward_ref"),Sc=Symbol.for("react.suspense"),Nc=Symbol.for("react.suspense_list"),Xu=Symbol.for("react.memo"),cr=Symbol.for("react.lazy"),pp=Symbol.for("react.offscreen"),hh=Symbol.iterator;function da(e){return e===null||typeof e!="object"?null:(e=hh&&e[hh]||e["@@iterator"],typeof e=="function"?e:null)}var mt=Object.assign,El;function wa(e){if(El===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);El=t&&t[1]||""}return`
`+El+e}var Cl=!1;function Tl(e,t){if(!e||Cl)return"";Cl=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var r=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){r=u}e.call(t.prototype)}else{try{throw Error()}catch(u){r=u}e()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),i=r.stack.split(`
`),o=a.length-1,l=i.length-1;1<=o&&0<=l&&a[o]!==i[l];)l--;for(;1<=o&&0<=l;o--,l--)if(a[o]!==i[l]){if(o!==1||l!==1)do if(o--,l--,0>l||a[o]!==i[l]){var c=`
`+a[o].replace(" at new "," at ");return e.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",e.displayName)),c}while(1<=o&&0<=l);break}}}finally{Cl=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?wa(e):""}function Kb(e){switch(e.tag){case 5:return wa(e.type);case 16:return wa("Lazy");case 13:return wa("Suspense");case 19:return wa("SuspenseList");case 0:case 2:case 15:return e=Tl(e.type,!1),e;case 11:return e=Tl(e.type.render,!1),e;case 1:return e=Tl(e.type,!0),e;default:return""}}function Ec(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case js:return"Fragment";case xs:return"Portal";case kc:return"Profiler";case Yu:return"StrictMode";case Sc:return"Suspense";case Nc:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case mp:return(e.displayName||"Context")+".Consumer";case fp:return(e._context.displayName||"Context")+".Provider";case Qu:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Xu:return t=e.displayName||null,t!==null?t:Ec(e.type)||"Memo";case cr:t=e._payload,e=e._init;try{return Ec(e(t))}catch{}}return null}function Jb(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ec(t);case 8:return t===Yu?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Sr(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function gp(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Yb(e){var t=gp(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function ki(e){e._valueTracker||(e._valueTracker=Yb(e))}function _p(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=gp(e)?e.checked?"true":"false":e.value),e=r,e!==n?(t.setValue(e),!0):!1}function xo(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Cc(e,t){var n=t.checked;return mt({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function fh(e,t){var n=t.defaultValue==null?"":t.defaultValue,r=t.checked!=null?t.checked:t.defaultChecked;n=Sr(t.value!=null?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function yp(e,t){t=t.checked,t!=null&&Ju(e,"checked",t,!1)}function Tc(e,t){yp(e,t);var n=Sr(t.value),r=t.type;if(n!=null)r==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(r==="submit"||r==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Dc(e,t.type,n):t.hasOwnProperty("defaultValue")&&Dc(e,t.type,Sr(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function mh(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!(r!=="submit"&&r!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Dc(e,t,n){(t!=="number"||xo(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var xa=Array.isArray;function Os(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Sr(n),t=null,a=0;a<e.length;a++){if(e[a].value===n){e[a].selected=!0,r&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Ac(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(V(91));return mt({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ph(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(V(92));if(xa(n)){if(1<n.length)throw Error(V(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:Sr(n)}}function bp(e,t){var n=Sr(t.value),r=Sr(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),r!=null&&(e.defaultValue=""+r)}function gh(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function vp(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ic(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?vp(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Si,wp=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,r,a){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(Si=Si||document.createElement("div"),Si.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Si.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Ba(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var Ta={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qb=["Webkit","ms","Moz","O"];Object.keys(Ta).forEach(function(e){Qb.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ta[t]=Ta[e]})});function xp(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||Ta.hasOwnProperty(e)&&Ta[e]?(""+t).trim():t+"px"}function jp(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var r=n.indexOf("--")===0,a=xp(n,t[n],r);n==="float"&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}var Xb=mt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Pc(e,t){if(t){if(Xb[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(V(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(V(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(V(61))}if(t.style!=null&&typeof t.style!="object")throw Error(V(62))}}function Rc(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Oc=null;function Zu(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Lc=null,Ls=null,$s=null;function _h(e){if(e=pi(e)){if(typeof Lc!="function")throw Error(V(280));var t=e.stateNode;t&&(t=cl(t),Lc(e.stateNode,e.type,t))}}function kp(e){Ls?$s?$s.push(e):$s=[e]:Ls=e}function Sp(){if(Ls){var e=Ls,t=$s;if($s=Ls=null,_h(e),t)for(e=0;e<t.length;e++)_h(t[e])}}function Np(e,t){return e(t)}function Ep(){}var Dl=!1;function Cp(e,t,n){if(Dl)return e(t,n);Dl=!0;try{return Np(e,t,n)}finally{Dl=!1,(Ls!==null||$s!==null)&&(Ep(),Sp())}}function qa(e,t){var n=e.stateNode;if(n===null)return null;var r=cl(n);if(r===null)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(e=e.type,r=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!r;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(V(231,t,typeof n));return n}var $c=!1;if(Jn)try{var ha={};Object.defineProperty(ha,"passive",{get:function(){$c=!0}}),window.addEventListener("test",ha,ha),window.removeEventListener("test",ha,ha)}catch{$c=!1}function Zb(e,t,n,r,a,i,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(d){this.onError(d)}}var Da=!1,jo=null,ko=!1,Mc=null,ev={onError:function(e){Da=!0,jo=e}};function tv(e,t,n,r,a,i,o,l,c){Da=!1,jo=null,Zb.apply(ev,arguments)}function nv(e,t,n,r,a,i,o,l,c){if(tv.apply(this,arguments),Da){if(Da){var u=jo;Da=!1,jo=null}else throw Error(V(198));ko||(ko=!0,Mc=u)}}function ls(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Tp(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function yh(e){if(ls(e)!==e)throw Error(V(188))}function rv(e){var t=e.alternate;if(!t){if(t=ls(e),t===null)throw Error(V(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(a===null)break;var i=a.alternate;if(i===null){if(r=a.return,r!==null){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return yh(a),e;if(i===r)return yh(a),t;i=i.sibling}throw Error(V(188))}if(n.return!==r.return)n=a,r=i;else{for(var o=!1,l=a.child;l;){if(l===n){o=!0,n=a,r=i;break}if(l===r){o=!0,r=a,n=i;break}l=l.sibling}if(!o){for(l=i.child;l;){if(l===n){o=!0,n=i,r=a;break}if(l===r){o=!0,r=i,n=a;break}l=l.sibling}if(!o)throw Error(V(189))}}if(n.alternate!==r)throw Error(V(190))}if(n.tag!==3)throw Error(V(188));return n.stateNode.current===n?e:t}function Dp(e){return e=rv(e),e!==null?Ap(e):null}function Ap(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Ap(e);if(t!==null)return t;e=e.sibling}return null}var Ip=on.unstable_scheduleCallback,bh=on.unstable_cancelCallback,sv=on.unstable_shouldYield,av=on.unstable_requestPaint,_t=on.unstable_now,iv=on.unstable_getCurrentPriorityLevel,ed=on.unstable_ImmediatePriority,Pp=on.unstable_UserBlockingPriority,So=on.unstable_NormalPriority,ov=on.unstable_LowPriority,Rp=on.unstable_IdlePriority,al=null,Mn=null;function lv(e){if(Mn&&typeof Mn.onCommitFiberRoot=="function")try{Mn.onCommitFiberRoot(al,e,void 0,(e.current.flags&128)===128)}catch{}}var Dn=Math.clz32?Math.clz32:dv,cv=Math.log,uv=Math.LN2;function dv(e){return e>>>=0,e===0?32:31-(cv(e)/uv|0)|0}var Ni=64,Ei=4194304;function ja(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function No(e,t){var n=e.pendingLanes;if(n===0)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=n&268435455;if(o!==0){var l=o&~a;l!==0?r=ja(l):(i&=o,i!==0&&(r=ja(i)))}else o=n&~a,o!==0?r=ja(o):i!==0&&(r=ja(i));if(r===0)return 0;if(t!==0&&t!==r&&!(t&a)&&(a=r&-r,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(r&4&&(r|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=r;0<t;)n=31-Dn(t),a=1<<n,r|=e[n],t&=~a;return r}function hv(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fv(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-Dn(i),l=1<<o,c=a[o];c===-1?(!(l&n)||l&r)&&(a[o]=hv(l,t)):c<=t&&(e.expiredLanes|=l),i&=~l}}function Uc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Op(){var e=Ni;return Ni<<=1,!(Ni&4194240)&&(Ni=64),e}function Al(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function fi(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Dn(t),e[t]=n}function mv(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-Dn(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}function td(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-Dn(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Qe=0;function Lp(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var $p,nd,Mp,Up,Fp,Fc=!1,Ci=[],_r=null,yr=null,br=null,Ha=new Map,Wa=new Map,dr=[],pv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vh(e,t){switch(e){case"focusin":case"focusout":_r=null;break;case"dragenter":case"dragleave":yr=null;break;case"mouseover":case"mouseout":br=null;break;case"pointerover":case"pointerout":Ha.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Wa.delete(t.pointerId)}}function fa(e,t,n,r,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},t!==null&&(t=pi(t),t!==null&&nd(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function gv(e,t,n,r,a){switch(t){case"focusin":return _r=fa(_r,e,t,n,r,a),!0;case"dragenter":return yr=fa(yr,e,t,n,r,a),!0;case"mouseover":return br=fa(br,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Ha.set(i,fa(Ha.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Wa.set(i,fa(Wa.get(i)||null,e,t,n,r,a)),!0}return!1}function zp(e){var t=Gr(e.target);if(t!==null){var n=ls(t);if(n!==null){if(t=n.tag,t===13){if(t=Tp(n),t!==null){e.blockedOn=t,Fp(e.priority,function(){Mp(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function io(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=zc(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var r=new n.constructor(n.type,n);Oc=r,n.target.dispatchEvent(r),Oc=null}else return t=pi(n),t!==null&&nd(t),e.blockedOn=n,!1;t.shift()}return!0}function wh(e,t,n){io(e)&&n.delete(t)}function _v(){Fc=!1,_r!==null&&io(_r)&&(_r=null),yr!==null&&io(yr)&&(yr=null),br!==null&&io(br)&&(br=null),Ha.forEach(wh),Wa.forEach(wh)}function ma(e,t){e.blockedOn===t&&(e.blockedOn=null,Fc||(Fc=!0,on.unstable_scheduleCallback(on.unstable_NormalPriority,_v)))}function Va(e){function t(a){return ma(a,e)}if(0<Ci.length){ma(Ci[0],e);for(var n=1;n<Ci.length;n++){var r=Ci[n];r.blockedOn===e&&(r.blockedOn=null)}}for(_r!==null&&ma(_r,e),yr!==null&&ma(yr,e),br!==null&&ma(br,e),Ha.forEach(t),Wa.forEach(t),n=0;n<dr.length;n++)r=dr[n],r.blockedOn===e&&(r.blockedOn=null);for(;0<dr.length&&(n=dr[0],n.blockedOn===null);)zp(n),n.blockedOn===null&&dr.shift()}var Ms=Zn.ReactCurrentBatchConfig,Eo=!0;function yv(e,t,n,r){var a=Qe,i=Ms.transition;Ms.transition=null;try{Qe=1,rd(e,t,n,r)}finally{Qe=a,Ms.transition=i}}function bv(e,t,n,r){var a=Qe,i=Ms.transition;Ms.transition=null;try{Qe=4,rd(e,t,n,r)}finally{Qe=a,Ms.transition=i}}function rd(e,t,n,r){if(Eo){var a=zc(e,t,n,r);if(a===null)zl(e,t,r,Co,n),vh(e,r);else if(gv(a,e,t,n,r))r.stopPropagation();else if(vh(e,r),t&4&&-1<pv.indexOf(e)){for(;a!==null;){var i=pi(a);if(i!==null&&$p(i),i=zc(e,t,n,r),i===null&&zl(e,t,r,Co,n),i===a)break;a=i}a!==null&&r.stopPropagation()}else zl(e,t,r,null,n)}}var Co=null;function zc(e,t,n,r){if(Co=null,e=Zu(r),e=Gr(e),e!==null)if(t=ls(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Tp(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Co=e,null}function Bp(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(iv()){case ed:return 1;case Pp:return 4;case So:case ov:return 16;case Rp:return 536870912;default:return 16}default:return 16}}var mr=null,sd=null,oo=null;function qp(){if(oo)return oo;var e,t=sd,n=t.length,r,a="value"in mr?mr.value:mr.textContent,i=a.length;for(e=0;e<n&&t[e]===a[e];e++);var o=n-e;for(r=1;r<=o&&t[n-r]===a[i-r];r++);return oo=a.slice(e,1<r?1-r:void 0)}function lo(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function Ti(){return!0}function xh(){return!1}function cn(e){function t(n,r,a,i,o){this._reactName=n,this._targetInst=a,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var l in e)e.hasOwnProperty(l)&&(n=e[l],this[l]=n?n(i):i[l]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?Ti:xh,this.isPropagationStopped=xh,this}return mt(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Ti)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Ti)},persist:function(){},isPersistent:Ti}),t}var ta={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ad=cn(ta),mi=mt({},ta,{view:0,detail:0}),vv=cn(mi),Il,Pl,pa,il=mt({},mi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:id,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==pa&&(pa&&e.type==="mousemove"?(Il=e.screenX-pa.screenX,Pl=e.screenY-pa.screenY):Pl=Il=0,pa=e),Il)},movementY:function(e){return"movementY"in e?e.movementY:Pl}}),jh=cn(il),wv=mt({},il,{dataTransfer:0}),xv=cn(wv),jv=mt({},mi,{relatedTarget:0}),Rl=cn(jv),kv=mt({},ta,{animationName:0,elapsedTime:0,pseudoElement:0}),Sv=cn(kv),Nv=mt({},ta,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Ev=cn(Nv),Cv=mt({},ta,{data:0}),kh=cn(Cv),Tv={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Dv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Av={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Iv(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Av[e])?!!t[e]:!1}function id(){return Iv}var Pv=mt({},mi,{key:function(e){if(e.key){var t=Tv[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=lo(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Dv[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:id,charCode:function(e){return e.type==="keypress"?lo(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?lo(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rv=cn(Pv),Ov=mt({},il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sh=cn(Ov),Lv=mt({},mi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:id}),$v=cn(Lv),Mv=mt({},ta,{propertyName:0,elapsedTime:0,pseudoElement:0}),Uv=cn(Mv),Fv=mt({},il,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),zv=cn(Fv),Bv=[9,13,27,32],od=Jn&&"CompositionEvent"in window,Aa=null;Jn&&"documentMode"in document&&(Aa=document.documentMode);var qv=Jn&&"TextEvent"in window&&!Aa,Hp=Jn&&(!od||Aa&&8<Aa&&11>=Aa),Nh=" ",Eh=!1;function Wp(e,t){switch(e){case"keyup":return Bv.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vp(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ks=!1;function Hv(e,t){switch(e){case"compositionend":return Vp(t);case"keypress":return t.which!==32?null:(Eh=!0,Nh);case"textInput":return e=t.data,e===Nh&&Eh?null:e;default:return null}}function Wv(e,t){if(ks)return e==="compositionend"||!od&&Wp(e,t)?(e=qp(),oo=sd=mr=null,ks=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Hp&&t.locale!=="ko"?null:t.data;default:return null}}var Vv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ch(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Vv[e.type]:t==="textarea"}function Gp(e,t,n,r){kp(r),t=To(t,"onChange"),0<t.length&&(n=new ad("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Ia=null,Ga=null;function Gv(e){sg(e,0)}function ol(e){var t=Es(e);if(_p(t))return e}function Kv(e,t){if(e==="change")return t}var Kp=!1;if(Jn){var Ol;if(Jn){var Ll="oninput"in document;if(!Ll){var Th=document.createElement("div");Th.setAttribute("oninput","return;"),Ll=typeof Th.oninput=="function"}Ol=Ll}else Ol=!1;Kp=Ol&&(!document.documentMode||9<document.documentMode)}function Dh(){Ia&&(Ia.detachEvent("onpropertychange",Jp),Ga=Ia=null)}function Jp(e){if(e.propertyName==="value"&&ol(Ga)){var t=[];Gp(t,Ga,e,Zu(e)),Cp(Gv,t)}}function Jv(e,t,n){e==="focusin"?(Dh(),Ia=t,Ga=n,Ia.attachEvent("onpropertychange",Jp)):e==="focusout"&&Dh()}function Yv(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ol(Ga)}function Qv(e,t){if(e==="click")return ol(t)}function Xv(e,t){if(e==="input"||e==="change")return ol(t)}function Zv(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var In=typeof Object.is=="function"?Object.is:Zv;function Ka(e,t){if(In(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!jc.call(t,a)||!In(e[a],t[a]))return!1}return!0}function Ah(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ih(e,t){var n=Ah(e);e=0;for(var r;n;){if(n.nodeType===3){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Ah(n)}}function Yp(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Yp(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Qp(){for(var e=window,t=xo();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=xo(e.document)}return t}function ld(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function ew(e){var t=Qp(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Yp(n.ownerDocument.documentElement,n)){if(r!==null&&ld(n)){if(t=r.start,e=r.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=r.end===void 0?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=Ih(n,i);var o=Ih(n,r);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var tw=Jn&&"documentMode"in document&&11>=document.documentMode,Ss=null,Bc=null,Pa=null,qc=!1;function Ph(e,t,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;qc||Ss==null||Ss!==xo(r)||(r=Ss,"selectionStart"in r&&ld(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Pa&&Ka(Pa,r)||(Pa=r,r=To(Bc,"onSelect"),0<r.length&&(t=new ad("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=Ss)))}function Di(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ns={animationend:Di("Animation","AnimationEnd"),animationiteration:Di("Animation","AnimationIteration"),animationstart:Di("Animation","AnimationStart"),transitionend:Di("Transition","TransitionEnd")},$l={},Xp={};Jn&&(Xp=document.createElement("div").style,"AnimationEvent"in window||(delete Ns.animationend.animation,delete Ns.animationiteration.animation,delete Ns.animationstart.animation),"TransitionEvent"in window||delete Ns.transitionend.transition);function ll(e){if($l[e])return $l[e];if(!Ns[e])return e;var t=Ns[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Xp)return $l[e]=t[n];return e}var Zp=ll("animationend"),eg=ll("animationiteration"),tg=ll("animationstart"),ng=ll("transitionend"),rg=new Map,Rh="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Er(e,t){rg.set(e,t),os(t,[e])}for(var Ml=0;Ml<Rh.length;Ml++){var Ul=Rh[Ml],nw=Ul.toLowerCase(),rw=Ul[0].toUpperCase()+Ul.slice(1);Er(nw,"on"+rw)}Er(Zp,"onAnimationEnd");Er(eg,"onAnimationIteration");Er(tg,"onAnimationStart");Er("dblclick","onDoubleClick");Er("focusin","onFocus");Er("focusout","onBlur");Er(ng,"onTransitionEnd");qs("onMouseEnter",["mouseout","mouseover"]);qs("onMouseLeave",["mouseout","mouseover"]);qs("onPointerEnter",["pointerout","pointerover"]);qs("onPointerLeave",["pointerout","pointerover"]);os("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));os("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));os("onBeforeInput",["compositionend","keypress","textInput","paste"]);os("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));os("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));os("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ka="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sw=new Set("cancel close invalid load scroll toggle".split(" ").concat(ka));function Oh(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,nv(r,t,void 0,e),e.currentTarget=null}function sg(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var l=r[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==i&&a.isPropagationStopped())break e;Oh(a,l,u),i=c}else for(o=0;o<r.length;o++){if(l=r[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==i&&a.isPropagationStopped())break e;Oh(a,l,u),i=c}}}if(ko)throw e=Mc,ko=!1,Mc=null,e}function nt(e,t){var n=t[Kc];n===void 0&&(n=t[Kc]=new Set);var r=e+"__bubble";n.has(r)||(ag(t,e,2,!1),n.add(r))}function Fl(e,t,n){var r=0;t&&(r|=4),ag(n,e,r,t)}var Ai="_reactListening"+Math.random().toString(36).slice(2);function Ja(e){if(!e[Ai]){e[Ai]=!0,hp.forEach(function(n){n!=="selectionchange"&&(sw.has(n)||Fl(n,!1,e),Fl(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[Ai]||(t[Ai]=!0,Fl("selectionchange",!1,t))}}function ag(e,t,n,r){switch(Bp(t)){case 1:var a=yv;break;case 4:a=bv;break;default:a=rd}n=a.bind(null,t,n,e),a=void 0,!$c||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),r?a!==void 0?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):a!==void 0?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function zl(e,t,n,r,a){var i=r;if(!(t&1)&&!(t&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var l=r.stateNode.containerInfo;if(l===a||l.nodeType===8&&l.parentNode===a)break;if(o===4)for(o=r.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===a||c.nodeType===8&&c.parentNode===a))return;o=o.return}for(;l!==null;){if(o=Gr(l),o===null)return;if(c=o.tag,c===5||c===6){r=i=o;continue e}l=l.parentNode}}r=r.return}Cp(function(){var u=i,d=Zu(n),m=[];e:{var h=rg.get(e);if(h!==void 0){var b=ad,y=e;switch(e){case"keypress":if(lo(n)===0)break e;case"keydown":case"keyup":b=Rv;break;case"focusin":y="focus",b=Rl;break;case"focusout":y="blur",b=Rl;break;case"beforeblur":case"afterblur":b=Rl;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=jh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=xv;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=$v;break;case Zp:case eg:case tg:b=Sv;break;case ng:b=Uv;break;case"scroll":b=vv;break;case"wheel":b=zv;break;case"copy":case"cut":case"paste":b=Ev;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=Sh}var g=(t&4)!==0,w=!g&&e==="scroll",p=g?h!==null?h+"Capture":null:h;g=[];for(var _=u,v;_!==null;){v=_;var x=v.stateNode;if(v.tag===5&&x!==null&&(v=x,p!==null&&(x=qa(_,p),x!=null&&g.push(Ya(_,x,v)))),w)break;_=_.return}0<g.length&&(h=new b(h,y,null,n,d),m.push({event:h,listeners:g}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",b=e==="mouseout"||e==="pointerout",h&&n!==Oc&&(y=n.relatedTarget||n.fromElement)&&(Gr(y)||y[Yn]))break e;if((b||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,b?(y=n.relatedTarget||n.toElement,b=u,y=y?Gr(y):null,y!==null&&(w=ls(y),y!==w||y.tag!==5&&y.tag!==6)&&(y=null)):(b=null,y=u),b!==y)){if(g=jh,x="onMouseLeave",p="onMouseEnter",_="mouse",(e==="pointerout"||e==="pointerover")&&(g=Sh,x="onPointerLeave",p="onPointerEnter",_="pointer"),w=b==null?h:Es(b),v=y==null?h:Es(y),h=new g(x,_+"leave",b,n,d),h.target=w,h.relatedTarget=v,x=null,Gr(d)===u&&(g=new g(p,_+"enter",y,n,d),g.target=v,g.relatedTarget=w,x=g),w=x,b&&y)t:{for(g=b,p=y,_=0,v=g;v;v=ds(v))_++;for(v=0,x=p;x;x=ds(x))v++;for(;0<_-v;)g=ds(g),_--;for(;0<v-_;)p=ds(p),v--;for(;_--;){if(g===p||p!==null&&g===p.alternate)break t;g=ds(g),p=ds(p)}g=null}else g=null;b!==null&&Lh(m,h,b,g,!1),y!==null&&w!==null&&Lh(m,w,y,g,!0)}}e:{if(h=u?Es(u):window,b=h.nodeName&&h.nodeName.toLowerCase(),b==="select"||b==="input"&&h.type==="file")var j=Kv;else if(Ch(h))if(Kp)j=Xv;else{j=Yv;var k=Jv}else(b=h.nodeName)&&b.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(j=Qv);if(j&&(j=j(e,u))){Gp(m,j,n,d);break e}k&&k(e,h,u),e==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&Dc(h,"number",h.value)}switch(k=u?Es(u):window,e){case"focusin":(Ch(k)||k.contentEditable==="true")&&(Ss=k,Bc=u,Pa=null);break;case"focusout":Pa=Bc=Ss=null;break;case"mousedown":qc=!0;break;case"contextmenu":case"mouseup":case"dragend":qc=!1,Ph(m,n,d);break;case"selectionchange":if(tw)break;case"keydown":case"keyup":Ph(m,n,d)}var S;if(od)e:{switch(e){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else ks?Wp(e,n)&&(A="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(A="onCompositionStart");A&&(Hp&&n.locale!=="ko"&&(ks||A!=="onCompositionStart"?A==="onCompositionEnd"&&ks&&(S=qp()):(mr=d,sd="value"in mr?mr.value:mr.textContent,ks=!0)),k=To(u,A),0<k.length&&(A=new kh(A,e,null,n,d),m.push({event:A,listeners:k}),S?A.data=S:(S=Vp(n),S!==null&&(A.data=S)))),(S=qv?Hv(e,n):Wv(e,n))&&(u=To(u,"onBeforeInput"),0<u.length&&(d=new kh("onBeforeInput","beforeinput",null,n,d),m.push({event:d,listeners:u}),d.data=S))}sg(m,t)})}function Ya(e,t,n){return{instance:e,listener:t,currentTarget:n}}function To(e,t){for(var n=t+"Capture",r=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=qa(e,n),i!=null&&r.unshift(Ya(e,i,a)),i=qa(e,t),i!=null&&r.push(Ya(e,i,a))),e=e.return}return r}function ds(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Lh(e,t,n,r,a){for(var i=t._reactName,o=[];n!==null&&n!==r;){var l=n,c=l.alternate,u=l.stateNode;if(c!==null&&c===r)break;l.tag===5&&u!==null&&(l=u,a?(c=qa(n,i),c!=null&&o.unshift(Ya(n,c,l))):a||(c=qa(n,i),c!=null&&o.push(Ya(n,c,l)))),n=n.return}o.length!==0&&e.push({event:t,listeners:o})}var aw=/\r\n?/g,iw=/\u0000|\uFFFD/g;function $h(e){return(typeof e=="string"?e:""+e).replace(aw,`
`).replace(iw,"")}function Ii(e,t,n){if(t=$h(t),$h(e)!==t&&n)throw Error(V(425))}function Do(){}var Hc=null,Wc=null;function Vc(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Gc=typeof setTimeout=="function"?setTimeout:void 0,ow=typeof clearTimeout=="function"?clearTimeout:void 0,Mh=typeof Promise=="function"?Promise:void 0,lw=typeof queueMicrotask=="function"?queueMicrotask:typeof Mh<"u"?function(e){return Mh.resolve(null).then(e).catch(cw)}:Gc;function cw(e){setTimeout(function(){throw e})}function Bl(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&a.nodeType===8)if(n=a.data,n==="/$"){if(r===0){e.removeChild(a),Va(t);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=a}while(n);Va(t)}function vr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Uh(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var na=Math.random().toString(36).slice(2),Ln="__reactFiber$"+na,Qa="__reactProps$"+na,Yn="__reactContainer$"+na,Kc="__reactEvents$"+na,uw="__reactListeners$"+na,dw="__reactHandles$"+na;function Gr(e){var t=e[Ln];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Yn]||n[Ln]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Uh(e);e!==null;){if(n=e[Ln])return n;e=Uh(e)}return t}e=n,n=e.parentNode}return null}function pi(e){return e=e[Ln]||e[Yn],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Es(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(V(33))}function cl(e){return e[Qa]||null}var Jc=[],Cs=-1;function Cr(e){return{current:e}}function at(e){0>Cs||(e.current=Jc[Cs],Jc[Cs]=null,Cs--)}function et(e,t){Cs++,Jc[Cs]=e.current,e.current=t}var Nr={},Ot=Cr(Nr),Kt=Cr(!1),ts=Nr;function Hs(e,t){var n=e.type.contextTypes;if(!n)return Nr;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in n)a[i]=t[i];return r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Jt(e){return e=e.childContextTypes,e!=null}function Ao(){at(Kt),at(Ot)}function Fh(e,t,n){if(Ot.current!==Nr)throw Error(V(168));et(Ot,t),et(Kt,n)}function ig(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var a in r)if(!(a in t))throw Error(V(108,Jb(e)||"Unknown",a));return mt({},n,r)}function Io(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Nr,ts=Ot.current,et(Ot,e),et(Kt,Kt.current),!0}function zh(e,t,n){var r=e.stateNode;if(!r)throw Error(V(169));n?(e=ig(e,t,ts),r.__reactInternalMemoizedMergedChildContext=e,at(Kt),at(Ot),et(Ot,e)):at(Kt),et(Kt,n)}var Wn=null,ul=!1,ql=!1;function og(e){Wn===null?Wn=[e]:Wn.push(e)}function hw(e){ul=!0,og(e)}function Tr(){if(!ql&&Wn!==null){ql=!0;var e=0,t=Qe;try{var n=Wn;for(Qe=1;e<n.length;e++){var r=n[e];do r=r(!0);while(r!==null)}Wn=null,ul=!1}catch(a){throw Wn!==null&&(Wn=Wn.slice(e+1)),Ip(ed,Tr),a}finally{Qe=t,ql=!1}}return null}var Ts=[],Ds=0,Po=null,Ro=0,fn=[],mn=0,ns=null,Vn=1,Gn="";function zr(e,t){Ts[Ds++]=Ro,Ts[Ds++]=Po,Po=e,Ro=t}function lg(e,t,n){fn[mn++]=Vn,fn[mn++]=Gn,fn[mn++]=ns,ns=e;var r=Vn;e=Gn;var a=32-Dn(r)-1;r&=~(1<<a),n+=1;var i=32-Dn(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Vn=1<<32-Dn(t)+a|n<<a|r,Gn=i+e}else Vn=1<<i|n<<a|r,Gn=e}function cd(e){e.return!==null&&(zr(e,1),lg(e,1,0))}function ud(e){for(;e===Po;)Po=Ts[--Ds],Ts[Ds]=null,Ro=Ts[--Ds],Ts[Ds]=null;for(;e===ns;)ns=fn[--mn],fn[mn]=null,Gn=fn[--mn],fn[mn]=null,Vn=fn[--mn],fn[mn]=null}var an=null,sn=null,ot=!1,Tn=null;function cg(e,t){var n=pn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function Bh(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,an=e,sn=vr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,an=e,sn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=ns!==null?{id:Vn,overflow:Gn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=pn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,an=e,sn=null,!0):!1;default:return!1}}function Yc(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Qc(e){if(ot){var t=sn;if(t){var n=t;if(!Bh(e,t)){if(Yc(e))throw Error(V(418));t=vr(n.nextSibling);var r=an;t&&Bh(e,t)?cg(r,n):(e.flags=e.flags&-4097|2,ot=!1,an=e)}}else{if(Yc(e))throw Error(V(418));e.flags=e.flags&-4097|2,ot=!1,an=e}}}function qh(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;an=e}function Pi(e){if(e!==an)return!1;if(!ot)return qh(e),ot=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Vc(e.type,e.memoizedProps)),t&&(t=sn)){if(Yc(e))throw ug(),Error(V(418));for(;t;)cg(e,t),t=vr(t.nextSibling)}if(qh(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(V(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){sn=vr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}sn=null}}else sn=an?vr(e.stateNode.nextSibling):null;return!0}function ug(){for(var e=sn;e;)e=vr(e.nextSibling)}function Ws(){sn=an=null,ot=!1}function dd(e){Tn===null?Tn=[e]:Tn.push(e)}var fw=Zn.ReactCurrentBatchConfig;function ga(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(V(309));var r=n.stateNode}if(!r)throw Error(V(147,e));var a=r,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var l=a.refs;o===null?delete l[i]:l[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(V(284));if(!n._owner)throw Error(V(290,e))}return e}function Ri(e,t){throw e=Object.prototype.toString.call(t),Error(V(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Hh(e){var t=e._init;return t(e._payload)}function dg(e){function t(p,_){if(e){var v=p.deletions;v===null?(p.deletions=[_],p.flags|=16):v.push(_)}}function n(p,_){if(!e)return null;for(;_!==null;)t(p,_),_=_.sibling;return null}function r(p,_){for(p=new Map;_!==null;)_.key!==null?p.set(_.key,_):p.set(_.index,_),_=_.sibling;return p}function a(p,_){return p=kr(p,_),p.index=0,p.sibling=null,p}function i(p,_,v){return p.index=v,e?(v=p.alternate,v!==null?(v=v.index,v<_?(p.flags|=2,_):v):(p.flags|=2,_)):(p.flags|=1048576,_)}function o(p){return e&&p.alternate===null&&(p.flags|=2),p}function l(p,_,v,x){return _===null||_.tag!==6?(_=Yl(v,p.mode,x),_.return=p,_):(_=a(_,v),_.return=p,_)}function c(p,_,v,x){var j=v.type;return j===js?d(p,_,v.props.children,x,v.key):_!==null&&(_.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===cr&&Hh(j)===_.type)?(x=a(_,v.props),x.ref=ga(p,_,v),x.return=p,x):(x=go(v.type,v.key,v.props,null,p.mode,x),x.ref=ga(p,_,v),x.return=p,x)}function u(p,_,v,x){return _===null||_.tag!==4||_.stateNode.containerInfo!==v.containerInfo||_.stateNode.implementation!==v.implementation?(_=Ql(v,p.mode,x),_.return=p,_):(_=a(_,v.children||[]),_.return=p,_)}function d(p,_,v,x,j){return _===null||_.tag!==7?(_=Zr(v,p.mode,x,j),_.return=p,_):(_=a(_,v),_.return=p,_)}function m(p,_,v){if(typeof _=="string"&&_!==""||typeof _=="number")return _=Yl(""+_,p.mode,v),_.return=p,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case ji:return v=go(_.type,_.key,_.props,null,p.mode,v),v.ref=ga(p,null,_),v.return=p,v;case xs:return _=Ql(_,p.mode,v),_.return=p,_;case cr:var x=_._init;return m(p,x(_._payload),v)}if(xa(_)||da(_))return _=Zr(_,p.mode,v,null),_.return=p,_;Ri(p,_)}return null}function h(p,_,v,x){var j=_!==null?_.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return j!==null?null:l(p,_,""+v,x);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ji:return v.key===j?c(p,_,v,x):null;case xs:return v.key===j?u(p,_,v,x):null;case cr:return j=v._init,h(p,_,j(v._payload),x)}if(xa(v)||da(v))return j!==null?null:d(p,_,v,x,null);Ri(p,v)}return null}function b(p,_,v,x,j){if(typeof x=="string"&&x!==""||typeof x=="number")return p=p.get(v)||null,l(_,p,""+x,j);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ji:return p=p.get(x.key===null?v:x.key)||null,c(_,p,x,j);case xs:return p=p.get(x.key===null?v:x.key)||null,u(_,p,x,j);case cr:var k=x._init;return b(p,_,v,k(x._payload),j)}if(xa(x)||da(x))return p=p.get(v)||null,d(_,p,x,j,null);Ri(_,x)}return null}function y(p,_,v,x){for(var j=null,k=null,S=_,A=_=0,P=null;S!==null&&A<v.length;A++){S.index>A?(P=S,S=null):P=S.sibling;var R=h(p,S,v[A],x);if(R===null){S===null&&(S=P);break}e&&S&&R.alternate===null&&t(p,S),_=i(R,_,A),k===null?j=R:k.sibling=R,k=R,S=P}if(A===v.length)return n(p,S),ot&&zr(p,A),j;if(S===null){for(;A<v.length;A++)S=m(p,v[A],x),S!==null&&(_=i(S,_,A),k===null?j=S:k.sibling=S,k=S);return ot&&zr(p,A),j}for(S=r(p,S);A<v.length;A++)P=b(S,p,A,v[A],x),P!==null&&(e&&P.alternate!==null&&S.delete(P.key===null?A:P.key),_=i(P,_,A),k===null?j=P:k.sibling=P,k=P);return e&&S.forEach(function(q){return t(p,q)}),ot&&zr(p,A),j}function g(p,_,v,x){var j=da(v);if(typeof j!="function")throw Error(V(150));if(v=j.call(v),v==null)throw Error(V(151));for(var k=j=null,S=_,A=_=0,P=null,R=v.next();S!==null&&!R.done;A++,R=v.next()){S.index>A?(P=S,S=null):P=S.sibling;var q=h(p,S,R.value,x);if(q===null){S===null&&(S=P);break}e&&S&&q.alternate===null&&t(p,S),_=i(q,_,A),k===null?j=q:k.sibling=q,k=q,S=P}if(R.done)return n(p,S),ot&&zr(p,A),j;if(S===null){for(;!R.done;A++,R=v.next())R=m(p,R.value,x),R!==null&&(_=i(R,_,A),k===null?j=R:k.sibling=R,k=R);return ot&&zr(p,A),j}for(S=r(p,S);!R.done;A++,R=v.next())R=b(S,p,A,R.value,x),R!==null&&(e&&R.alternate!==null&&S.delete(R.key===null?A:R.key),_=i(R,_,A),k===null?j=R:k.sibling=R,k=R);return e&&S.forEach(function(O){return t(p,O)}),ot&&zr(p,A),j}function w(p,_,v,x){if(typeof v=="object"&&v!==null&&v.type===js&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case ji:e:{for(var j=v.key,k=_;k!==null;){if(k.key===j){if(j=v.type,j===js){if(k.tag===7){n(p,k.sibling),_=a(k,v.props.children),_.return=p,p=_;break e}}else if(k.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===cr&&Hh(j)===k.type){n(p,k.sibling),_=a(k,v.props),_.ref=ga(p,k,v),_.return=p,p=_;break e}n(p,k);break}else t(p,k);k=k.sibling}v.type===js?(_=Zr(v.props.children,p.mode,x,v.key),_.return=p,p=_):(x=go(v.type,v.key,v.props,null,p.mode,x),x.ref=ga(p,_,v),x.return=p,p=x)}return o(p);case xs:e:{for(k=v.key;_!==null;){if(_.key===k)if(_.tag===4&&_.stateNode.containerInfo===v.containerInfo&&_.stateNode.implementation===v.implementation){n(p,_.sibling),_=a(_,v.children||[]),_.return=p,p=_;break e}else{n(p,_);break}else t(p,_);_=_.sibling}_=Ql(v,p.mode,x),_.return=p,p=_}return o(p);case cr:return k=v._init,w(p,_,k(v._payload),x)}if(xa(v))return y(p,_,v,x);if(da(v))return g(p,_,v,x);Ri(p,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,_!==null&&_.tag===6?(n(p,_.sibling),_=a(_,v),_.return=p,p=_):(n(p,_),_=Yl(v,p.mode,x),_.return=p,p=_),o(p)):n(p,_)}return w}var Vs=dg(!0),hg=dg(!1),Oo=Cr(null),Lo=null,As=null,hd=null;function fd(){hd=As=Lo=null}function md(e){var t=Oo.current;at(Oo),e._currentValue=t}function Xc(e,t,n){for(;e!==null;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,r!==null&&(r.childLanes|=t)):r!==null&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Us(e,t){Lo=e,hd=As=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Gt=!0),e.firstContext=null)}function _n(e){var t=e._currentValue;if(hd!==e)if(e={context:e,memoizedValue:t,next:null},As===null){if(Lo===null)throw Error(V(308));As=e,Lo.dependencies={lanes:0,firstContext:e}}else As=As.next=e;return t}var Kr=null;function pd(e){Kr===null?Kr=[e]:Kr.push(e)}function fg(e,t,n,r){var a=t.interleaved;return a===null?(n.next=n,pd(t)):(n.next=a.next,a.next=n),t.interleaved=n,Qn(e,r)}function Qn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var ur=!1;function gd(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function mg(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Kn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function wr(e,t,n){var r=e.updateQueue;if(r===null)return null;if(r=r.shared,Ge&2){var a=r.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Qn(e,n)}return a=r.interleaved,a===null?(t.next=t,pd(r)):(t.next=a.next,a.next=t),r.interleaved=t,Qn(e,n)}function co(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,td(e,n)}}function Wh(e,t){var n=e.updateQueue,r=e.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var a=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?a=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?a=i=t:i=i.next=t}else a=i=t;n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function $o(e,t,n,r){var a=e.updateQueue;ur=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,l=a.shared.pending;if(l!==null){a.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?i=u:o.next=u,o=c;var d=e.alternate;d!==null&&(d=d.updateQueue,l=d.lastBaseUpdate,l!==o&&(l===null?d.firstBaseUpdate=u:l.next=u,d.lastBaseUpdate=c))}if(i!==null){var m=a.baseState;o=0,d=u=c=null,l=i;do{var h=l.lane,b=l.eventTime;if((r&h)===h){d!==null&&(d=d.next={eventTime:b,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=e,g=l;switch(h=t,b=n,g.tag){case 1:if(y=g.payload,typeof y=="function"){m=y.call(b,m,h);break e}m=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=g.payload,h=typeof y=="function"?y.call(b,m,h):y,h==null)break e;m=mt({},m,h);break e;case 2:ur=!0}}l.callback!==null&&l.lane!==0&&(e.flags|=64,h=a.effects,h===null?a.effects=[l]:h.push(l))}else b={eventTime:b,lane:h,tag:l.tag,payload:l.payload,callback:l.callback,next:null},d===null?(u=d=b,c=m):d=d.next=b,o|=h;if(l=l.next,l===null){if(l=a.shared.pending,l===null)break;h=l,l=h.next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}while(!0);if(d===null&&(c=m),a.baseState=c,a.firstBaseUpdate=u,a.lastBaseUpdate=d,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);ss|=o,e.lanes=o,e.memoizedState=m}}function Vh(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(a!==null){if(r.callback=null,r=n,typeof a!="function")throw Error(V(191,a));a.call(r)}}}var gi={},Un=Cr(gi),Xa=Cr(gi),Za=Cr(gi);function Jr(e){if(e===gi)throw Error(V(174));return e}function _d(e,t){switch(et(Za,t),et(Xa,e),et(Un,gi),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Ic(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Ic(t,e)}at(Un),et(Un,t)}function Gs(){at(Un),at(Xa),at(Za)}function pg(e){Jr(Za.current);var t=Jr(Un.current),n=Ic(t,e.type);t!==n&&(et(Xa,e),et(Un,n))}function yd(e){Xa.current===e&&(at(Un),at(Xa))}var ht=Cr(0);function Mo(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Hl=[];function bd(){for(var e=0;e<Hl.length;e++)Hl[e]._workInProgressVersionPrimary=null;Hl.length=0}var uo=Zn.ReactCurrentDispatcher,Wl=Zn.ReactCurrentBatchConfig,rs=0,ft=null,jt=null,St=null,Uo=!1,Ra=!1,ei=0,mw=0;function It(){throw Error(V(321))}function vd(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!In(e[n],t[n]))return!1;return!0}function wd(e,t,n,r,a,i){if(rs=i,ft=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,uo.current=e===null||e.memoizedState===null?yw:bw,e=n(r,a),Ra){i=0;do{if(Ra=!1,ei=0,25<=i)throw Error(V(301));i+=1,St=jt=null,t.updateQueue=null,uo.current=vw,e=n(r,a)}while(Ra)}if(uo.current=Fo,t=jt!==null&&jt.next!==null,rs=0,St=jt=ft=null,Uo=!1,t)throw Error(V(300));return e}function xd(){var e=ei!==0;return ei=0,e}function On(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return St===null?ft.memoizedState=St=e:St=St.next=e,St}function yn(){if(jt===null){var e=ft.alternate;e=e!==null?e.memoizedState:null}else e=jt.next;var t=St===null?ft.memoizedState:St.next;if(t!==null)St=t,jt=e;else{if(e===null)throw Error(V(310));jt=e,e={memoizedState:jt.memoizedState,baseState:jt.baseState,baseQueue:jt.baseQueue,queue:jt.queue,next:null},St===null?ft.memoizedState=St=e:St=St.next=e}return St}function ti(e,t){return typeof t=="function"?t(e):t}function Vl(e){var t=yn(),n=t.queue;if(n===null)throw Error(V(311));n.lastRenderedReducer=e;var r=jt,a=r.baseQueue,i=n.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}r.baseQueue=a=i,n.pending=null}if(a!==null){i=a.next,r=r.baseState;var l=o=null,c=null,u=i;do{var d=u.lane;if((rs&d)===d)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var m={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=m,o=r):c=c.next=m,ft.lanes|=d,ss|=d}u=u.next}while(u!==null&&u!==i);c===null?o=r:c.next=l,In(r,t.memoizedState)||(Gt=!0),t.memoizedState=r,t.baseState=o,t.baseQueue=c,n.lastRenderedState=r}if(e=n.interleaved,e!==null){a=e;do i=a.lane,ft.lanes|=i,ss|=i,a=a.next;while(a!==e)}else a===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Gl(e){var t=yn(),n=t.queue;if(n===null)throw Error(V(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(a!==null){n.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);In(i,t.memoizedState)||(Gt=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function gg(){}function _g(e,t){var n=ft,r=yn(),a=t(),i=!In(r.memoizedState,a);if(i&&(r.memoizedState=a,Gt=!0),r=r.queue,jd(vg.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||St!==null&&St.memoizedState.tag&1){if(n.flags|=2048,ni(9,bg.bind(null,n,r,a,t),void 0,null),Nt===null)throw Error(V(349));rs&30||yg(n,t,a)}return a}function yg(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=ft.updateQueue,t===null?(t={lastEffect:null,stores:null},ft.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function bg(e,t,n,r){t.value=n,t.getSnapshot=r,wg(t)&&xg(e)}function vg(e,t,n){return n(function(){wg(t)&&xg(e)})}function wg(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!In(e,n)}catch{return!0}}function xg(e){var t=Qn(e,1);t!==null&&An(t,e,1,-1)}function Gh(e){var t=On();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ti,lastRenderedState:e},t.queue=e,e=e.dispatch=_w.bind(null,ft,e),[t.memoizedState,e]}function ni(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},t=ft.updateQueue,t===null?(t={lastEffect:null,stores:null},ft.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e)),e}function jg(){return yn().memoizedState}function ho(e,t,n,r){var a=On();ft.flags|=e,a.memoizedState=ni(1|t,n,void 0,r===void 0?null:r)}function dl(e,t,n,r){var a=yn();r=r===void 0?null:r;var i=void 0;if(jt!==null){var o=jt.memoizedState;if(i=o.destroy,r!==null&&vd(r,o.deps)){a.memoizedState=ni(t,n,i,r);return}}ft.flags|=e,a.memoizedState=ni(1|t,n,i,r)}function Kh(e,t){return ho(8390656,8,e,t)}function jd(e,t){return dl(2048,8,e,t)}function kg(e,t){return dl(4,2,e,t)}function Sg(e,t){return dl(4,4,e,t)}function Ng(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Eg(e,t,n){return n=n!=null?n.concat([e]):null,dl(4,4,Ng.bind(null,t,e),n)}function kd(){}function Cg(e,t){var n=yn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&vd(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Tg(e,t){var n=yn();t=t===void 0?null:t;var r=n.memoizedState;return r!==null&&t!==null&&vd(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Dg(e,t,n){return rs&21?(In(n,t)||(n=Op(),ft.lanes|=n,ss|=n,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Gt=!0),e.memoizedState=n)}function pw(e,t){var n=Qe;Qe=n!==0&&4>n?n:4,e(!0);var r=Wl.transition;Wl.transition={};try{e(!1),t()}finally{Qe=n,Wl.transition=r}}function Ag(){return yn().memoizedState}function gw(e,t,n){var r=jr(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Ig(e))Pg(t,n);else if(n=fg(e,t,n,r),n!==null){var a=Bt();An(n,e,r,a),Rg(n,t,r)}}function _w(e,t,n){var r=jr(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Ig(e))Pg(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,l=i(o,n);if(a.hasEagerState=!0,a.eagerState=l,In(l,o)){var c=t.interleaved;c===null?(a.next=a,pd(t)):(a.next=c.next,c.next=a),t.interleaved=a;return}}catch{}finally{}n=fg(e,t,a,r),n!==null&&(a=Bt(),An(n,e,r,a),Rg(n,t,r))}}function Ig(e){var t=e.alternate;return e===ft||t!==null&&t===ft}function Pg(e,t){Ra=Uo=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Rg(e,t,n){if(n&4194240){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,td(e,n)}}var Fo={readContext:_n,useCallback:It,useContext:It,useEffect:It,useImperativeHandle:It,useInsertionEffect:It,useLayoutEffect:It,useMemo:It,useReducer:It,useRef:It,useState:It,useDebugValue:It,useDeferredValue:It,useTransition:It,useMutableSource:It,useSyncExternalStore:It,useId:It,unstable_isNewReconciler:!1},yw={readContext:_n,useCallback:function(e,t){return On().memoizedState=[e,t===void 0?null:t],e},useContext:_n,useEffect:Kh,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,ho(4194308,4,Ng.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ho(4194308,4,e,t)},useInsertionEffect:function(e,t){return ho(4,2,e,t)},useMemo:function(e,t){var n=On();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=On();return t=n!==void 0?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=gw.bind(null,ft,e),[r.memoizedState,e]},useRef:function(e){var t=On();return e={current:e},t.memoizedState=e},useState:Gh,useDebugValue:kd,useDeferredValue:function(e){return On().memoizedState=e},useTransition:function(){var e=Gh(!1),t=e[0];return e=pw.bind(null,e[1]),On().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=ft,a=On();if(ot){if(n===void 0)throw Error(V(407));n=n()}else{if(n=t(),Nt===null)throw Error(V(349));rs&30||yg(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,Kh(vg.bind(null,r,i,e),[e]),r.flags|=2048,ni(9,bg.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=On(),t=Nt.identifierPrefix;if(ot){var n=Gn,r=Vn;n=(r&~(1<<32-Dn(r)-1)).toString(32)+n,t=":"+t+"R"+n,n=ei++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=mw++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},bw={readContext:_n,useCallback:Cg,useContext:_n,useEffect:jd,useImperativeHandle:Eg,useInsertionEffect:kg,useLayoutEffect:Sg,useMemo:Tg,useReducer:Vl,useRef:jg,useState:function(){return Vl(ti)},useDebugValue:kd,useDeferredValue:function(e){var t=yn();return Dg(t,jt.memoizedState,e)},useTransition:function(){var e=Vl(ti)[0],t=yn().memoizedState;return[e,t]},useMutableSource:gg,useSyncExternalStore:_g,useId:Ag,unstable_isNewReconciler:!1},vw={readContext:_n,useCallback:Cg,useContext:_n,useEffect:jd,useImperativeHandle:Eg,useInsertionEffect:kg,useLayoutEffect:Sg,useMemo:Tg,useReducer:Gl,useRef:jg,useState:function(){return Gl(ti)},useDebugValue:kd,useDeferredValue:function(e){var t=yn();return jt===null?t.memoizedState=e:Dg(t,jt.memoizedState,e)},useTransition:function(){var e=Gl(ti)[0],t=yn().memoizedState;return[e,t]},useMutableSource:gg,useSyncExternalStore:_g,useId:Ag,unstable_isNewReconciler:!1};function Sn(e,t){if(e&&e.defaultProps){t=mt({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function Zc(e,t,n,r){t=e.memoizedState,n=n(r,t),n=n==null?t:mt({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var hl={isMounted:function(e){return(e=e._reactInternals)?ls(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=Bt(),a=jr(e),i=Kn(r,a);i.payload=t,n!=null&&(i.callback=n),t=wr(e,i,a),t!==null&&(An(t,e,a,r),co(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=Bt(),a=jr(e),i=Kn(r,a);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=wr(e,i,a),t!==null&&(An(t,e,a,r),co(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Bt(),r=jr(e),a=Kn(n,r);a.tag=2,t!=null&&(a.callback=t),t=wr(e,a,r),t!==null&&(An(t,e,r,n),co(t,e,r))}};function Jh(e,t,n,r,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(r,i,o):t.prototype&&t.prototype.isPureReactComponent?!Ka(n,r)||!Ka(a,i):!0}function Og(e,t,n){var r=!1,a=Nr,i=t.contextType;return typeof i=="object"&&i!==null?i=_n(i):(a=Jt(t)?ts:Ot.current,r=t.contextTypes,i=(r=r!=null)?Hs(e,a):Nr),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=hl,e.stateNode=t,t._reactInternals=e,r&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Yh(e,t,n,r){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,r),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&hl.enqueueReplaceState(t,t.state,null)}function eu(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs={},gd(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=_n(i):(i=Jt(t)?ts:Ot.current,a.context=Hs(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Zc(e,t,i,n),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&hl.enqueueReplaceState(a,a.state,null),$o(e,n,a,r),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Ks(e,t){try{var n="",r=t;do n+=Kb(r),r=r.return;while(r);var a=n}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function Kl(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function tu(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var ww=typeof WeakMap=="function"?WeakMap:Map;function Lg(e,t,n){n=Kn(-1,n),n.tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Bo||(Bo=!0,du=r),tu(e,t)},n}function $g(e,t,n){n=Kn(-1,n),n.tag=3;var r=e.type.getDerivedStateFromError;if(typeof r=="function"){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){tu(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){tu(e,t),typeof r!="function"&&(xr===null?xr=new Set([this]):xr.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),n}function Qh(e,t,n){var r=e.pingCache;if(r===null){r=e.pingCache=new ww;var a=new Set;r.set(t,a)}else a=r.get(t),a===void 0&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Ow.bind(null,e,t,n),t.then(e,e))}function Xh(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Zh(e,t,n,r,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Kn(-1,1),t.tag=2,wr(n,t,1))),n.lanes|=1),e)}var xw=Zn.ReactCurrentOwner,Gt=!1;function Ut(e,t,n,r){t.child=e===null?hg(t,null,n,r):Vs(t,e.child,n,r)}function ef(e,t,n,r,a){n=n.render;var i=t.ref;return Us(t,a),r=wd(e,t,n,r,i,a),n=xd(),e!==null&&!Gt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Xn(e,t,a)):(ot&&n&&cd(t),t.flags|=1,Ut(e,t,r,a),t.child)}function tf(e,t,n,r,a){if(e===null){var i=n.type;return typeof i=="function"&&!Id(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Mg(e,t,i,r,a)):(e=go(n.type,null,r,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Ka,n(o,r)&&e.ref===t.ref)return Xn(e,t,a)}return t.flags|=1,e=kr(i,r),e.ref=t.ref,e.return=t,t.child=e}function Mg(e,t,n,r,a){if(e!==null){var i=e.memoizedProps;if(Ka(i,r)&&e.ref===t.ref)if(Gt=!1,t.pendingProps=r=i,(e.lanes&a)!==0)e.flags&131072&&(Gt=!0);else return t.lanes=e.lanes,Xn(e,t,a)}return nu(e,t,n,r,a)}function Ug(e,t,n){var r=t.pendingProps,a=r.children,i=e!==null?e.memoizedState:null;if(r.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},et(Ps,tn),tn|=n;else{if(!(n&1073741824))return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,et(Ps,tn),tn|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,et(Ps,tn),tn|=r}else i!==null?(r=i.baseLanes|n,t.memoizedState=null):r=n,et(Ps,tn),tn|=r;return Ut(e,t,a,n),t.child}function Fg(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function nu(e,t,n,r,a){var i=Jt(n)?ts:Ot.current;return i=Hs(t,i),Us(t,a),n=wd(e,t,n,r,i,a),r=xd(),e!==null&&!Gt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Xn(e,t,a)):(ot&&r&&cd(t),t.flags|=1,Ut(e,t,n,a),t.child)}function nf(e,t,n,r,a){if(Jt(n)){var i=!0;Io(t)}else i=!1;if(Us(t,a),t.stateNode===null)fo(e,t),Og(t,n,r),eu(t,n,r,a),r=!0;else if(e===null){var o=t.stateNode,l=t.memoizedProps;o.props=l;var c=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=_n(u):(u=Jt(n)?ts:Ot.current,u=Hs(t,u));var d=n.getDerivedStateFromProps,m=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";m||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==r||c!==u)&&Yh(t,o,r,u),ur=!1;var h=t.memoizedState;o.state=h,$o(t,r,o,a),c=t.memoizedState,l!==r||h!==c||Kt.current||ur?(typeof d=="function"&&(Zc(t,n,d,r),c=t.memoizedState),(l=ur||Jh(t,n,l,r,h,c,u))?(m||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=u,r=l):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,mg(e,t),l=t.memoizedProps,u=t.type===t.elementType?l:Sn(t.type,l),o.props=u,m=t.pendingProps,h=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=_n(c):(c=Jt(n)?ts:Ot.current,c=Hs(t,c));var b=n.getDerivedStateFromProps;(d=typeof b=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==m||h!==c)&&Yh(t,o,r,c),ur=!1,h=t.memoizedState,o.state=h,$o(t,r,o,a);var y=t.memoizedState;l!==m||h!==y||Kt.current||ur?(typeof b=="function"&&(Zc(t,n,b,r),y=t.memoizedState),(u=ur||Jh(t,n,u,r,h,y,c)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,y,c)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=y),o.props=r,o.state=y,o.context=c,r=u):(typeof o.componentDidUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return ru(e,t,n,r,i,a)}function ru(e,t,n,r,a,i){Fg(e,t);var o=(t.flags&128)!==0;if(!r&&!o)return a&&zh(t,n,!1),Xn(e,t,i);r=t.stateNode,xw.current=t;var l=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return t.flags|=1,e!==null&&o?(t.child=Vs(t,e.child,null,i),t.child=Vs(t,null,l,i)):Ut(e,t,l,i),t.memoizedState=r.state,a&&zh(t,n,!0),t.child}function zg(e){var t=e.stateNode;t.pendingContext?Fh(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Fh(e,t.context,!1),_d(e,t.containerInfo)}function rf(e,t,n,r,a){return Ws(),dd(a),t.flags|=256,Ut(e,t,n,r),t.child}var su={dehydrated:null,treeContext:null,retryLane:0};function au(e){return{baseLanes:e,cachePool:null,transitions:null}}function Bg(e,t,n){var r=t.pendingProps,a=ht.current,i=!1,o=(t.flags&128)!==0,l;if((l=o)||(l=e!==null&&e.memoizedState===null?!1:(a&2)!==0),l?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),et(ht,a&1),e===null)return Qc(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=r.children,e=r.fallback,i?(r=t.mode,i=t.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=pl(o,r,0,null),e=Zr(e,r,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=au(n),t.memoizedState=su,e):Sd(t,o));if(a=e.memoizedState,a!==null&&(l=a.dehydrated,l!==null))return jw(e,t,o,r,l,a,n);if(i){i=r.fallback,o=t.mode,a=e.child,l=a.sibling;var c={mode:"hidden",children:r.children};return!(o&1)&&t.child!==a?(r=t.child,r.childLanes=0,r.pendingProps=c,t.deletions=null):(r=kr(a,c),r.subtreeFlags=a.subtreeFlags&14680064),l!==null?i=kr(l,i):(i=Zr(i,o,n,null),i.flags|=2),i.return=t,r.return=t,r.sibling=i,t.child=r,r=i,i=t.child,o=e.child.memoizedState,o=o===null?au(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~n,t.memoizedState=su,r}return i=e.child,e=i.sibling,r=kr(i,{mode:"visible",children:r.children}),!(t.mode&1)&&(r.lanes=n),r.return=t,r.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r}function Sd(e,t){return t=pl({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Oi(e,t,n,r){return r!==null&&dd(r),Vs(t,e.child,null,n),e=Sd(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function jw(e,t,n,r,a,i,o){if(n)return t.flags&256?(t.flags&=-257,r=Kl(Error(V(422))),Oi(e,t,o,r)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=r.fallback,a=t.mode,r=pl({mode:"visible",children:r.children},a,0,null),i=Zr(i,a,o,null),i.flags|=2,r.return=t,i.return=t,r.sibling=i,t.child=r,t.mode&1&&Vs(t,e.child,null,o),t.child.memoizedState=au(o),t.memoizedState=su,i);if(!(t.mode&1))return Oi(e,t,o,null);if(a.data==="$!"){if(r=a.nextSibling&&a.nextSibling.dataset,r)var l=r.dgst;return r=l,i=Error(V(419)),r=Kl(i,r,void 0),Oi(e,t,o,r)}if(l=(o&e.childLanes)!==0,Gt||l){if(r=Nt,r!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(r.suspendedLanes|o)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Qn(e,a),An(r,e,a,-1))}return Ad(),r=Kl(Error(V(421))),Oi(e,t,o,r)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=Lw.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,sn=vr(a.nextSibling),an=t,ot=!0,Tn=null,e!==null&&(fn[mn++]=Vn,fn[mn++]=Gn,fn[mn++]=ns,Vn=e.id,Gn=e.overflow,ns=t),t=Sd(t,r.children),t.flags|=4096,t)}function sf(e,t,n){e.lanes|=t;var r=e.alternate;r!==null&&(r.lanes|=t),Xc(e.return,t,n)}function Jl(e,t,n,r,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function qg(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Ut(e,t,r.children,n),r=ht.current,r&2)r=r&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&sf(e,n,t);else if(e.tag===19)sf(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(et(ht,r),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;n!==null;)e=n.alternate,e!==null&&Mo(e)===null&&(a=n),n=n.sibling;n=a,n===null?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Jl(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Mo(e)===null){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Jl(t,!0,n,null,i);break;case"together":Jl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function fo(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Xn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),ss|=t.lanes,!(n&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(V(153));if(t.child!==null){for(e=t.child,n=kr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=kr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function kw(e,t,n){switch(t.tag){case 3:zg(t),Ws();break;case 5:pg(t);break;case 1:Jt(t.type)&&Io(t);break;case 4:_d(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;et(Oo,r._currentValue),r._currentValue=a;break;case 13:if(r=t.memoizedState,r!==null)return r.dehydrated!==null?(et(ht,ht.current&1),t.flags|=128,null):n&t.child.childLanes?Bg(e,t,n):(et(ht,ht.current&1),e=Xn(e,t,n),e!==null?e.sibling:null);et(ht,ht.current&1);break;case 19:if(r=(n&t.childLanes)!==0,e.flags&128){if(r)return qg(e,t,n);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),et(ht,ht.current),r)break;return null;case 22:case 23:return t.lanes=0,Ug(e,t,n)}return Xn(e,t,n)}var Hg,iu,Wg,Vg;Hg=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};iu=function(){};Wg=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Jr(Un.current);var i=null;switch(n){case"input":a=Cc(e,a),r=Cc(e,r),i=[];break;case"select":a=mt({},a,{value:void 0}),r=mt({},r,{value:void 0}),i=[];break;case"textarea":a=Ac(e,a),r=Ac(e,r),i=[];break;default:typeof a.onClick!="function"&&typeof r.onClick=="function"&&(e.onclick=Do)}Pc(n,r);var o;n=null;for(u in a)if(!r.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var l=a[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(za.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(l=a!=null?a[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(za.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&nt("scroll",e),i||l===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};Vg=function(e,t,n,r){n!==r&&(t.flags|=4)};function _a(e,t){if(!ot)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Pt(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags&14680064,r|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Sw(e,t,n){var r=t.pendingProps;switch(ud(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pt(t),null;case 1:return Jt(t.type)&&Ao(),Pt(t),null;case 3:return r=t.stateNode,Gs(),at(Kt),at(Ot),bd(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(e===null||e.child===null)&&(Pi(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Tn!==null&&(mu(Tn),Tn=null))),iu(e,t),Pt(t),null;case 5:yd(t);var a=Jr(Za.current);if(n=t.type,e!==null&&t.stateNode!=null)Wg(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(t.stateNode===null)throw Error(V(166));return Pt(t),null}if(e=Jr(Un.current),Pi(t)){r=t.stateNode,n=t.type;var i=t.memoizedProps;switch(r[Ln]=t,r[Qa]=i,e=(t.mode&1)!==0,n){case"dialog":nt("cancel",r),nt("close",r);break;case"iframe":case"object":case"embed":nt("load",r);break;case"video":case"audio":for(a=0;a<ka.length;a++)nt(ka[a],r);break;case"source":nt("error",r);break;case"img":case"image":case"link":nt("error",r),nt("load",r);break;case"details":nt("toggle",r);break;case"input":fh(r,i),nt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},nt("invalid",r);break;case"textarea":ph(r,i),nt("invalid",r)}Pc(n,i),a=null;for(var o in i)if(i.hasOwnProperty(o)){var l=i[o];o==="children"?typeof l=="string"?r.textContent!==l&&(i.suppressHydrationWarning!==!0&&Ii(r.textContent,l,e),a=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(i.suppressHydrationWarning!==!0&&Ii(r.textContent,l,e),a=["children",""+l]):za.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&nt("scroll",r)}switch(n){case"input":ki(r),mh(r,i,!0);break;case"textarea":ki(r),gh(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Do)}r=a,t.updateQueue=r,r!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=vp(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof r.is=="string"?e=o.createElement(n,{is:r.is}):(e=o.createElement(n),n==="select"&&(o=e,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):e=o.createElementNS(e,n),e[Ln]=t,e[Qa]=r,Hg(e,t,!1,!1),t.stateNode=e;e:{switch(o=Rc(n,r),n){case"dialog":nt("cancel",e),nt("close",e),a=r;break;case"iframe":case"object":case"embed":nt("load",e),a=r;break;case"video":case"audio":for(a=0;a<ka.length;a++)nt(ka[a],e);a=r;break;case"source":nt("error",e),a=r;break;case"img":case"image":case"link":nt("error",e),nt("load",e),a=r;break;case"details":nt("toggle",e),a=r;break;case"input":fh(e,r),a=Cc(e,r),nt("invalid",e);break;case"option":a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=mt({},r,{value:void 0}),nt("invalid",e);break;case"textarea":ph(e,r),a=Ac(e,r),nt("invalid",e);break;default:a=r}Pc(n,a),l=a;for(i in l)if(l.hasOwnProperty(i)){var c=l[i];i==="style"?jp(e,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&wp(e,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Ba(e,c):typeof c=="number"&&Ba(e,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(za.hasOwnProperty(i)?c!=null&&i==="onScroll"&&nt("scroll",e):c!=null&&Ju(e,i,c,o))}switch(n){case"input":ki(e),mh(e,r,!1);break;case"textarea":ki(e),gh(e);break;case"option":r.value!=null&&e.setAttribute("value",""+Sr(r.value));break;case"select":e.multiple=!!r.multiple,i=r.value,i!=null?Os(e,!!r.multiple,i,!1):r.defaultValue!=null&&Os(e,!!r.multiple,r.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Do)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return Pt(t),null;case 6:if(e&&t.stateNode!=null)Vg(e,t,e.memoizedProps,r);else{if(typeof r!="string"&&t.stateNode===null)throw Error(V(166));if(n=Jr(Za.current),Jr(Un.current),Pi(t)){if(r=t.stateNode,n=t.memoizedProps,r[Ln]=t,(i=r.nodeValue!==n)&&(e=an,e!==null))switch(e.tag){case 3:Ii(r.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Ii(r.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Ln]=t,t.stateNode=r}return Pt(t),null;case 13:if(at(ht),r=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ot&&sn!==null&&t.mode&1&&!(t.flags&128))ug(),Ws(),t.flags|=98560,i=!1;else if(i=Pi(t),r!==null&&r.dehydrated!==null){if(e===null){if(!i)throw Error(V(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(V(317));i[Ln]=t}else Ws(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;Pt(t),i=!1}else Tn!==null&&(mu(Tn),Tn=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=n,t):(r=r!==null,r!==(e!==null&&e.memoizedState!==null)&&r&&(t.child.flags|=8192,t.mode&1&&(e===null||ht.current&1?kt===0&&(kt=3):Ad())),t.updateQueue!==null&&(t.flags|=4),Pt(t),null);case 4:return Gs(),iu(e,t),e===null&&Ja(t.stateNode.containerInfo),Pt(t),null;case 10:return md(t.type._context),Pt(t),null;case 17:return Jt(t.type)&&Ao(),Pt(t),null;case 19:if(at(ht),i=t.memoizedState,i===null)return Pt(t),null;if(r=(t.flags&128)!==0,o=i.rendering,o===null)if(r)_a(i,!1);else{if(kt!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Mo(e),o!==null){for(t.flags|=128,_a(i,!1),r=o.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;n!==null;)i=n,e=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return et(ht,ht.current&1|2),t.child}e=e.sibling}i.tail!==null&&_t()>Js&&(t.flags|=128,r=!0,_a(i,!1),t.lanes=4194304)}else{if(!r)if(e=Mo(o),e!==null){if(t.flags|=128,r=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),_a(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!ot)return Pt(t),null}else 2*_t()-i.renderingStartTime>Js&&n!==1073741824&&(t.flags|=128,r=!0,_a(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(n=i.last,n!==null?n.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=_t(),t.sibling=null,n=ht.current,et(ht,r?n&1|2:n&1),t):(Pt(t),null);case 22:case 23:return Dd(),r=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==r&&(t.flags|=8192),r&&t.mode&1?tn&1073741824&&(Pt(t),t.subtreeFlags&6&&(t.flags|=8192)):Pt(t),null;case 24:return null;case 25:return null}throw Error(V(156,t.tag))}function Nw(e,t){switch(ud(t),t.tag){case 1:return Jt(t.type)&&Ao(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Gs(),at(Kt),at(Ot),bd(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return yd(t),null;case 13:if(at(ht),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(V(340));Ws()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return at(ht),null;case 4:return Gs(),null;case 10:return md(t.type._context),null;case 22:case 23:return Dd(),null;case 24:return null;default:return null}}var Li=!1,Rt=!1,Ew=typeof WeakSet=="function"?WeakSet:Set,he=null;function Is(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){gt(e,t,r)}else n.current=null}function ou(e,t,n){try{n()}catch(r){gt(e,t,r)}}var af=!1;function Cw(e,t){if(Hc=Eo,e=Qp(),ld(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var a=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,u=0,d=0,m=e,h=null;t:for(;;){for(var b;m!==n||a!==0&&m.nodeType!==3||(l=o+a),m!==i||r!==0&&m.nodeType!==3||(c=o+r),m.nodeType===3&&(o+=m.nodeValue.length),(b=m.firstChild)!==null;)h=m,m=b;for(;;){if(m===e)break t;if(h===n&&++u===a&&(l=o),h===i&&++d===r&&(c=o),(b=m.nextSibling)!==null)break;m=h,h=m.parentNode}m=b}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(Wc={focusedElem:e,selectionRange:n},Eo=!1,he=t;he!==null;)if(t=he,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,he=e;else for(;he!==null;){t=he;try{var y=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var g=y.memoizedProps,w=y.memoizedState,p=t.stateNode,_=p.getSnapshotBeforeUpdate(t.elementType===t.type?g:Sn(t.type,g),w);p.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var v=t.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(V(163))}}catch(x){gt(t,t.return,x)}if(e=t.sibling,e!==null){e.return=t.return,he=e;break}he=t.return}return y=af,af=!1,y}function Oa(e,t,n){var r=t.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&ou(t,n,i)}a=a.next}while(a!==r)}}function fl(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function lu(e){var t=e.ref;if(t!==null){var n=e.stateNode;switch(e.tag){case 5:e=n;break;default:e=n}typeof t=="function"?t(e):t.current=e}}function Gg(e){var t=e.alternate;t!==null&&(e.alternate=null,Gg(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Ln],delete t[Qa],delete t[Kc],delete t[uw],delete t[dw])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Kg(e){return e.tag===5||e.tag===3||e.tag===4}function of(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Kg(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function cu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=Do));else if(r!==4&&(e=e.child,e!==null))for(cu(e,t,n),e=e.sibling;e!==null;)cu(e,t,n),e=e.sibling}function uu(e,t,n){var r=e.tag;if(r===5||r===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(r!==4&&(e=e.child,e!==null))for(uu(e,t,n),e=e.sibling;e!==null;)uu(e,t,n),e=e.sibling}var Tt=null,En=!1;function ar(e,t,n){for(n=n.child;n!==null;)Jg(e,t,n),n=n.sibling}function Jg(e,t,n){if(Mn&&typeof Mn.onCommitFiberUnmount=="function")try{Mn.onCommitFiberUnmount(al,n)}catch{}switch(n.tag){case 5:Rt||Is(n,t);case 6:var r=Tt,a=En;Tt=null,ar(e,t,n),Tt=r,En=a,Tt!==null&&(En?(e=Tt,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Tt.removeChild(n.stateNode));break;case 18:Tt!==null&&(En?(e=Tt,n=n.stateNode,e.nodeType===8?Bl(e.parentNode,n):e.nodeType===1&&Bl(e,n),Va(e)):Bl(Tt,n.stateNode));break;case 4:r=Tt,a=En,Tt=n.stateNode.containerInfo,En=!0,ar(e,t,n),Tt=r,En=a;break;case 0:case 11:case 14:case 15:if(!Rt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&ou(n,t,o),a=a.next}while(a!==r)}ar(e,t,n);break;case 1:if(!Rt&&(Is(n,t),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){gt(n,t,l)}ar(e,t,n);break;case 21:ar(e,t,n);break;case 22:n.mode&1?(Rt=(r=Rt)||n.memoizedState!==null,ar(e,t,n),Rt=r):ar(e,t,n);break;default:ar(e,t,n)}}function lf(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Ew),t.forEach(function(r){var a=$w.bind(null,e,r);n.has(r)||(n.add(r),r.then(a,a))})}}function xn(e,t){var n=t.deletions;if(n!==null)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e,o=t,l=o;e:for(;l!==null;){switch(l.tag){case 5:Tt=l.stateNode,En=!1;break e;case 3:Tt=l.stateNode.containerInfo,En=!0;break e;case 4:Tt=l.stateNode.containerInfo,En=!0;break e}l=l.return}if(Tt===null)throw Error(V(160));Jg(i,o,a),Tt=null,En=!1;var c=a.alternate;c!==null&&(c.return=null),a.return=null}catch(u){gt(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)Yg(t,e),t=t.sibling}function Yg(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(xn(t,e),Rn(e),r&4){try{Oa(3,e,e.return),fl(3,e)}catch(g){gt(e,e.return,g)}try{Oa(5,e,e.return)}catch(g){gt(e,e.return,g)}}break;case 1:xn(t,e),Rn(e),r&512&&n!==null&&Is(n,n.return);break;case 5:if(xn(t,e),Rn(e),r&512&&n!==null&&Is(n,n.return),e.flags&32){var a=e.stateNode;try{Ba(a,"")}catch(g){gt(e,e.return,g)}}if(r&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,o=n!==null?n.memoizedProps:i,l=e.type,c=e.updateQueue;if(e.updateQueue=null,c!==null)try{l==="input"&&i.type==="radio"&&i.name!=null&&yp(a,i),Rc(l,o);var u=Rc(l,i);for(o=0;o<c.length;o+=2){var d=c[o],m=c[o+1];d==="style"?jp(a,m):d==="dangerouslySetInnerHTML"?wp(a,m):d==="children"?Ba(a,m):Ju(a,d,m,u)}switch(l){case"input":Tc(a,i);break;case"textarea":bp(a,i);break;case"select":var h=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var b=i.value;b!=null?Os(a,!!i.multiple,b,!1):h!==!!i.multiple&&(i.defaultValue!=null?Os(a,!!i.multiple,i.defaultValue,!0):Os(a,!!i.multiple,i.multiple?[]:"",!1))}a[Qa]=i}catch(g){gt(e,e.return,g)}}break;case 6:if(xn(t,e),Rn(e),r&4){if(e.stateNode===null)throw Error(V(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(g){gt(e,e.return,g)}}break;case 3:if(xn(t,e),Rn(e),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Va(t.containerInfo)}catch(g){gt(e,e.return,g)}break;case 4:xn(t,e),Rn(e);break;case 13:xn(t,e),Rn(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(Cd=_t())),r&4&&lf(e);break;case 22:if(d=n!==null&&n.memoizedState!==null,e.mode&1?(Rt=(u=Rt)||d,xn(t,e),Rt=u):xn(t,e),Rn(e),r&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(he=e,d=e.child;d!==null;){for(m=he=d;he!==null;){switch(h=he,b=h.child,h.tag){case 0:case 11:case 14:case 15:Oa(4,h,h.return);break;case 1:Is(h,h.return);var y=h.stateNode;if(typeof y.componentWillUnmount=="function"){r=h,n=h.return;try{t=r,y.props=t.memoizedProps,y.state=t.memoizedState,y.componentWillUnmount()}catch(g){gt(r,n,g)}}break;case 5:Is(h,h.return);break;case 22:if(h.memoizedState!==null){uf(m);continue}}b!==null?(b.return=h,he=b):uf(m)}d=d.sibling}e:for(d=null,m=e;;){if(m.tag===5){if(d===null){d=m;try{a=m.stateNode,u?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(l=m.stateNode,c=m.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=xp("display",o))}catch(g){gt(e,e.return,g)}}}else if(m.tag===6){if(d===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(g){gt(e,e.return,g)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===e)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===e)break e;for(;m.sibling===null;){if(m.return===null||m.return===e)break e;d===m&&(d=null),m=m.return}d===m&&(d=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:xn(t,e),Rn(e),r&4&&lf(e);break;case 21:break;default:xn(t,e),Rn(e)}}function Rn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(Kg(n)){var r=n;break e}n=n.return}throw Error(V(160))}switch(r.tag){case 5:var a=r.stateNode;r.flags&32&&(Ba(a,""),r.flags&=-33);var i=of(e);uu(e,i,a);break;case 3:case 4:var o=r.stateNode.containerInfo,l=of(e);cu(e,l,o);break;default:throw Error(V(161))}}catch(c){gt(e,e.return,c)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Tw(e,t,n){he=e,Qg(e)}function Qg(e,t,n){for(var r=(e.mode&1)!==0;he!==null;){var a=he,i=a.child;if(a.tag===22&&r){var o=a.memoizedState!==null||Li;if(!o){var l=a.alternate,c=l!==null&&l.memoizedState!==null||Rt;l=Li;var u=Rt;if(Li=o,(Rt=c)&&!u)for(he=a;he!==null;)o=he,c=o.child,o.tag===22&&o.memoizedState!==null?df(a):c!==null?(c.return=o,he=c):df(a);for(;i!==null;)he=i,Qg(i),i=i.sibling;he=a,Li=l,Rt=u}cf(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,he=i):cf(e)}}function cf(e){for(;he!==null;){var t=he;if(t.flags&8772){var n=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:Rt||fl(5,t);break;case 1:var r=t.stateNode;if(t.flags&4&&!Rt)if(n===null)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:Sn(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Vh(t,i,r);break;case 3:var o=t.updateQueue;if(o!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}Vh(t,o,n)}break;case 5:var l=t.stateNode;if(n===null&&t.flags&4){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var m=d.dehydrated;m!==null&&Va(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(V(163))}Rt||t.flags&512&&lu(t)}catch(h){gt(t,t.return,h)}}if(t===e){he=null;break}if(n=t.sibling,n!==null){n.return=t.return,he=n;break}he=t.return}}function uf(e){for(;he!==null;){var t=he;if(t===e){he=null;break}var n=t.sibling;if(n!==null){n.return=t.return,he=n;break}he=t.return}}function df(e){for(;he!==null;){var t=he;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{fl(4,t)}catch(c){gt(t,n,c)}break;case 1:var r=t.stateNode;if(typeof r.componentDidMount=="function"){var a=t.return;try{r.componentDidMount()}catch(c){gt(t,a,c)}}var i=t.return;try{lu(t)}catch(c){gt(t,i,c)}break;case 5:var o=t.return;try{lu(t)}catch(c){gt(t,o,c)}}}catch(c){gt(t,t.return,c)}if(t===e){he=null;break}var l=t.sibling;if(l!==null){l.return=t.return,he=l;break}he=t.return}}var Dw=Math.ceil,zo=Zn.ReactCurrentDispatcher,Nd=Zn.ReactCurrentOwner,gn=Zn.ReactCurrentBatchConfig,Ge=0,Nt=null,bt=null,Dt=0,tn=0,Ps=Cr(0),kt=0,ri=null,ss=0,ml=0,Ed=0,La=null,Vt=null,Cd=0,Js=1/0,qn=null,Bo=!1,du=null,xr=null,$i=!1,pr=null,qo=0,$a=0,hu=null,mo=-1,po=0;function Bt(){return Ge&6?_t():mo!==-1?mo:mo=_t()}function jr(e){return e.mode&1?Ge&2&&Dt!==0?Dt&-Dt:fw.transition!==null?(po===0&&(po=Op()),po):(e=Qe,e!==0||(e=window.event,e=e===void 0?16:Bp(e.type)),e):1}function An(e,t,n,r){if(50<$a)throw $a=0,hu=null,Error(V(185));fi(e,n,r),(!(Ge&2)||e!==Nt)&&(e===Nt&&(!(Ge&2)&&(ml|=n),kt===4&&hr(e,Dt)),Yt(e,r),n===1&&Ge===0&&!(t.mode&1)&&(Js=_t()+500,ul&&Tr()))}function Yt(e,t){var n=e.callbackNode;fv(e,t);var r=No(e,e===Nt?Dt:0);if(r===0)n!==null&&bh(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(n!=null&&bh(n),t===1)e.tag===0?hw(hf.bind(null,e)):og(hf.bind(null,e)),lw(function(){!(Ge&6)&&Tr()}),n=null;else{switch(Lp(r)){case 1:n=ed;break;case 4:n=Pp;break;case 16:n=So;break;case 536870912:n=Rp;break;default:n=So}n=a_(n,Xg.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function Xg(e,t){if(mo=-1,po=0,Ge&6)throw Error(V(327));var n=e.callbackNode;if(Fs()&&e.callbackNode!==n)return null;var r=No(e,e===Nt?Dt:0);if(r===0)return null;if(r&30||r&e.expiredLanes||t)t=Ho(e,r);else{t=r;var a=Ge;Ge|=2;var i=e_();(Nt!==e||Dt!==t)&&(qn=null,Js=_t()+500,Xr(e,t));do try{Pw();break}catch(l){Zg(e,l)}while(!0);fd(),zo.current=i,Ge=a,bt!==null?t=0:(Nt=null,Dt=0,t=kt)}if(t!==0){if(t===2&&(a=Uc(e),a!==0&&(r=a,t=fu(e,a))),t===1)throw n=ri,Xr(e,0),hr(e,r),Yt(e,_t()),n;if(t===6)hr(e,r);else{if(a=e.current.alternate,!(r&30)&&!Aw(a)&&(t=Ho(e,r),t===2&&(i=Uc(e),i!==0&&(r=i,t=fu(e,i))),t===1))throw n=ri,Xr(e,0),hr(e,r),Yt(e,_t()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(V(345));case 2:Br(e,Vt,qn);break;case 3:if(hr(e,r),(r&130023424)===r&&(t=Cd+500-_t(),10<t)){if(No(e,0)!==0)break;if(a=e.suspendedLanes,(a&r)!==r){Bt(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Gc(Br.bind(null,e,Vt,qn),t);break}Br(e,Vt,qn);break;case 4:if(hr(e,r),(r&4194240)===r)break;for(t=e.eventTimes,a=-1;0<r;){var o=31-Dn(r);i=1<<o,o=t[o],o>a&&(a=o),r&=~i}if(r=a,r=_t()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Dw(r/1960))-r,10<r){e.timeoutHandle=Gc(Br.bind(null,e,Vt,qn),r);break}Br(e,Vt,qn);break;case 5:Br(e,Vt,qn);break;default:throw Error(V(329))}}}return Yt(e,_t()),e.callbackNode===n?Xg.bind(null,e):null}function fu(e,t){var n=La;return e.current.memoizedState.isDehydrated&&(Xr(e,t).flags|=256),e=Ho(e,t),e!==2&&(t=Vt,Vt=n,t!==null&&mu(t)),e}function mu(e){Vt===null?Vt=e:Vt.push.apply(Vt,e)}function Aw(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!In(i(),a))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function hr(e,t){for(t&=~Ed,t&=~ml,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Dn(t),r=1<<n;e[n]=-1,t&=~r}}function hf(e){if(Ge&6)throw Error(V(327));Fs();var t=No(e,0);if(!(t&1))return Yt(e,_t()),null;var n=Ho(e,t);if(e.tag!==0&&n===2){var r=Uc(e);r!==0&&(t=r,n=fu(e,r))}if(n===1)throw n=ri,Xr(e,0),hr(e,t),Yt(e,_t()),n;if(n===6)throw Error(V(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Br(e,Vt,qn),Yt(e,_t()),null}function Td(e,t){var n=Ge;Ge|=1;try{return e(t)}finally{Ge=n,Ge===0&&(Js=_t()+500,ul&&Tr())}}function as(e){pr!==null&&pr.tag===0&&!(Ge&6)&&Fs();var t=Ge;Ge|=1;var n=gn.transition,r=Qe;try{if(gn.transition=null,Qe=1,e)return e()}finally{Qe=r,gn.transition=n,Ge=t,!(Ge&6)&&Tr()}}function Dd(){tn=Ps.current,at(Ps)}function Xr(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,ow(n)),bt!==null)for(n=bt.return;n!==null;){var r=n;switch(ud(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ao();break;case 3:Gs(),at(Kt),at(Ot),bd();break;case 5:yd(r);break;case 4:Gs();break;case 13:at(ht);break;case 19:at(ht);break;case 10:md(r.type._context);break;case 22:case 23:Dd()}n=n.return}if(Nt=e,bt=e=kr(e.current,null),Dt=tn=t,kt=0,ri=null,Ed=ml=ss=0,Vt=La=null,Kr!==null){for(t=0;t<Kr.length;t++)if(n=Kr[t],r=n.interleaved,r!==null){n.interleaved=null;var a=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=a,r.next=o}n.pending=r}Kr=null}return e}function Zg(e,t){do{var n=bt;try{if(fd(),uo.current=Fo,Uo){for(var r=ft.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Uo=!1}if(rs=0,St=jt=ft=null,Ra=!1,ei=0,Nd.current=null,n===null||n.return===null){kt=1,ri=t,bt=null;break}e:{var i=e,o=n.return,l=n,c=t;if(t=Dt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,d=l,m=d.tag;if(!(d.mode&1)&&(m===0||m===11||m===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var b=Xh(o);if(b!==null){b.flags&=-257,Zh(b,o,l,i,t),b.mode&1&&Qh(i,u,t),t=b,c=u;var y=t.updateQueue;if(y===null){var g=new Set;g.add(c),t.updateQueue=g}else y.add(c);break e}else{if(!(t&1)){Qh(i,u,t),Ad();break e}c=Error(V(426))}}else if(ot&&l.mode&1){var w=Xh(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),Zh(w,o,l,i,t),dd(Ks(c,l));break e}}i=c=Ks(c,l),kt!==4&&(kt=2),La===null?La=[i]:La.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var p=Lg(i,c,t);Wh(i,p);break e;case 1:l=c;var _=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(xr===null||!xr.has(v)))){i.flags|=65536,t&=-t,i.lanes|=t;var x=$g(i,l,t);Wh(i,x);break e}}i=i.return}while(i!==null)}n_(n)}catch(j){t=j,bt===n&&n!==null&&(bt=n=n.return);continue}break}while(!0)}function e_(){var e=zo.current;return zo.current=Fo,e===null?Fo:e}function Ad(){(kt===0||kt===3||kt===2)&&(kt=4),Nt===null||!(ss&268435455)&&!(ml&268435455)||hr(Nt,Dt)}function Ho(e,t){var n=Ge;Ge|=2;var r=e_();(Nt!==e||Dt!==t)&&(qn=null,Xr(e,t));do try{Iw();break}catch(a){Zg(e,a)}while(!0);if(fd(),Ge=n,zo.current=r,bt!==null)throw Error(V(261));return Nt=null,Dt=0,kt}function Iw(){for(;bt!==null;)t_(bt)}function Pw(){for(;bt!==null&&!sv();)t_(bt)}function t_(e){var t=s_(e.alternate,e,tn);e.memoizedProps=e.pendingProps,t===null?n_(e):bt=t,Nd.current=null}function n_(e){var t=e;do{var n=t.alternate;if(e=t.return,t.flags&32768){if(n=Nw(n,t),n!==null){n.flags&=32767,bt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{kt=6,bt=null;return}}else if(n=Sw(n,t,tn),n!==null){bt=n;return}if(t=t.sibling,t!==null){bt=t;return}bt=t=e}while(t!==null);kt===0&&(kt=5)}function Br(e,t,n){var r=Qe,a=gn.transition;try{gn.transition=null,Qe=1,Rw(e,t,n,r)}finally{gn.transition=a,Qe=r}return null}function Rw(e,t,n,r){do Fs();while(pr!==null);if(Ge&6)throw Error(V(327));n=e.finishedWork;var a=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(V(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(mv(e,i),e===Nt&&(bt=Nt=null,Dt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||$i||($i=!0,a_(So,function(){return Fs(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=gn.transition,gn.transition=null;var o=Qe;Qe=1;var l=Ge;Ge|=4,Nd.current=null,Cw(e,n),Yg(n,e),ew(Wc),Eo=!!Hc,Wc=Hc=null,e.current=n,Tw(n),av(),Ge=l,Qe=o,gn.transition=i}else e.current=n;if($i&&($i=!1,pr=e,qo=a),i=e.pendingLanes,i===0&&(xr=null),lv(n.stateNode),Yt(e,_t()),t!==null)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Bo)throw Bo=!1,e=du,du=null,e;return qo&1&&e.tag!==0&&Fs(),i=e.pendingLanes,i&1?e===hu?$a++:($a=0,hu=e):$a=0,Tr(),null}function Fs(){if(pr!==null){var e=Lp(qo),t=gn.transition,n=Qe;try{if(gn.transition=null,Qe=16>e?16:e,pr===null)var r=!1;else{if(e=pr,pr=null,qo=0,Ge&6)throw Error(V(331));var a=Ge;for(Ge|=4,he=e.current;he!==null;){var i=he,o=i.child;if(he.flags&16){var l=i.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(he=u;he!==null;){var d=he;switch(d.tag){case 0:case 11:case 15:Oa(8,d,i)}var m=d.child;if(m!==null)m.return=d,he=m;else for(;he!==null;){d=he;var h=d.sibling,b=d.return;if(Gg(d),d===u){he=null;break}if(h!==null){h.return=b,he=h;break}he=b}}}var y=i.alternate;if(y!==null){var g=y.child;if(g!==null){y.child=null;do{var w=g.sibling;g.sibling=null,g=w}while(g!==null)}}he=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,he=o;else e:for(;he!==null;){if(i=he,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Oa(9,i,i.return)}var p=i.sibling;if(p!==null){p.return=i.return,he=p;break e}he=i.return}}var _=e.current;for(he=_;he!==null;){o=he;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,he=v;else e:for(o=_;he!==null;){if(l=he,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:fl(9,l)}}catch(j){gt(l,l.return,j)}if(l===o){he=null;break e}var x=l.sibling;if(x!==null){x.return=l.return,he=x;break e}he=l.return}}if(Ge=a,Tr(),Mn&&typeof Mn.onPostCommitFiberRoot=="function")try{Mn.onPostCommitFiberRoot(al,e)}catch{}r=!0}return r}finally{Qe=n,gn.transition=t}}return!1}function ff(e,t,n){t=Ks(n,t),t=Lg(e,t,1),e=wr(e,t,1),t=Bt(),e!==null&&(fi(e,1,t),Yt(e,t))}function gt(e,t,n){if(e.tag===3)ff(e,e,n);else for(;t!==null;){if(t.tag===3){ff(t,e,n);break}else if(t.tag===1){var r=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(xr===null||!xr.has(r))){e=Ks(n,e),e=$g(t,e,1),t=wr(t,e,1),e=Bt(),t!==null&&(fi(t,1,e),Yt(t,e));break}}t=t.return}}function Ow(e,t,n){var r=e.pingCache;r!==null&&r.delete(t),t=Bt(),e.pingedLanes|=e.suspendedLanes&n,Nt===e&&(Dt&n)===n&&(kt===4||kt===3&&(Dt&130023424)===Dt&&500>_t()-Cd?Xr(e,0):Ed|=n),Yt(e,t)}function r_(e,t){t===0&&(e.mode&1?(t=Ei,Ei<<=1,!(Ei&130023424)&&(Ei=4194304)):t=1);var n=Bt();e=Qn(e,t),e!==null&&(fi(e,t,n),Yt(e,n))}function Lw(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),r_(e,n)}function $w(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;a!==null&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(V(314))}r!==null&&r.delete(t),r_(e,n)}var s_;s_=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Kt.current)Gt=!0;else{if(!(e.lanes&n)&&!(t.flags&128))return Gt=!1,kw(e,t,n);Gt=!!(e.flags&131072)}else Gt=!1,ot&&t.flags&1048576&&lg(t,Ro,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;fo(e,t),e=t.pendingProps;var a=Hs(t,Ot.current);Us(t,n),a=wd(null,t,r,e,a,n);var i=xd();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Jt(r)?(i=!0,Io(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,gd(t),a.updater=hl,t.stateNode=a,a._reactInternals=t,eu(t,r,e,n),t=ru(null,t,r,!0,i,n)):(t.tag=0,ot&&i&&cd(t),Ut(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(fo(e,t),e=t.pendingProps,a=r._init,r=a(r._payload),t.type=r,a=t.tag=Uw(r),e=Sn(r,e),a){case 0:t=nu(null,t,r,e,n);break e;case 1:t=nf(null,t,r,e,n);break e;case 11:t=ef(null,t,r,e,n);break e;case 14:t=tf(null,t,r,Sn(r.type,e),n);break e}throw Error(V(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Sn(r,a),nu(e,t,r,a,n);case 1:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Sn(r,a),nf(e,t,r,a,n);case 3:e:{if(zg(t),e===null)throw Error(V(387));r=t.pendingProps,i=t.memoizedState,a=i.element,mg(e,t),$o(t,r,null,n);var o=t.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=Ks(Error(V(423)),t),t=rf(e,t,r,n,a);break e}else if(r!==a){a=Ks(Error(V(424)),t),t=rf(e,t,r,n,a);break e}else for(sn=vr(t.stateNode.containerInfo.firstChild),an=t,ot=!0,Tn=null,n=hg(t,null,r,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ws(),r===a){t=Xn(e,t,n);break e}Ut(e,t,r,n)}t=t.child}return t;case 5:return pg(t),e===null&&Qc(t),r=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,Vc(r,a)?o=null:i!==null&&Vc(r,i)&&(t.flags|=32),Fg(e,t),Ut(e,t,o,n),t.child;case 6:return e===null&&Qc(t),null;case 13:return Bg(e,t,n);case 4:return _d(t,t.stateNode.containerInfo),r=t.pendingProps,e===null?t.child=Vs(t,null,r,n):Ut(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Sn(r,a),ef(e,t,r,a,n);case 7:return Ut(e,t,t.pendingProps,n),t.child;case 8:return Ut(e,t,t.pendingProps.children,n),t.child;case 12:return Ut(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,et(Oo,r._currentValue),r._currentValue=o,i!==null)if(In(i.value,o)){if(i.children===a.children&&!Kt.current){t=Xn(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var l=i.dependencies;if(l!==null){o=i.child;for(var c=l.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Kn(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),Xc(i.return,n,t),l.lanes|=n;break}c=c.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(V(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),Xc(o,n,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Ut(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Us(t,n),a=_n(a),r=r(a),t.flags|=1,Ut(e,t,r,n),t.child;case 14:return r=t.type,a=Sn(r,t.pendingProps),a=Sn(r.type,a),tf(e,t,r,a,n);case 15:return Mg(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:Sn(r,a),fo(e,t),t.tag=1,Jt(r)?(e=!0,Io(t)):e=!1,Us(t,n),Og(t,r,a),eu(t,r,a,n),ru(null,t,r,!0,e,n);case 19:return qg(e,t,n);case 22:return Ug(e,t,n)}throw Error(V(156,t.tag))};function a_(e,t){return Ip(e,t)}function Mw(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pn(e,t,n,r){return new Mw(e,t,n,r)}function Id(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Uw(e){if(typeof e=="function")return Id(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Qu)return 11;if(e===Xu)return 14}return 2}function kr(e,t){var n=e.alternate;return n===null?(n=pn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function go(e,t,n,r,a,i){var o=2;if(r=e,typeof e=="function")Id(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case js:return Zr(n.children,a,i,t);case Yu:o=8,a|=8;break;case kc:return e=pn(12,n,t,a|2),e.elementType=kc,e.lanes=i,e;case Sc:return e=pn(13,n,t,a),e.elementType=Sc,e.lanes=i,e;case Nc:return e=pn(19,n,t,a),e.elementType=Nc,e.lanes=i,e;case pp:return pl(n,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case fp:o=10;break e;case mp:o=9;break e;case Qu:o=11;break e;case Xu:o=14;break e;case cr:o=16,r=null;break e}throw Error(V(130,e==null?e:typeof e,""))}return t=pn(o,n,t,a),t.elementType=e,t.type=r,t.lanes=i,t}function Zr(e,t,n,r){return e=pn(7,e,r,t),e.lanes=n,e}function pl(e,t,n,r){return e=pn(22,e,r,t),e.elementType=pp,e.lanes=n,e.stateNode={isHidden:!1},e}function Yl(e,t,n){return e=pn(6,e,null,t),e.lanes=n,e}function Ql(e,t,n){return t=pn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Fw(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Al(0),this.expirationTimes=Al(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Al(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Pd(e,t,n,r,a,i,o,l,c){return e=new Fw(e,t,n,l,c),t===1?(t=1,i===!0&&(t|=8)):t=0,i=pn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},gd(i),e}function zw(e,t,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:xs,key:r==null?null:""+r,children:e,containerInfo:t,implementation:n}}function i_(e){if(!e)return Nr;e=e._reactInternals;e:{if(ls(e)!==e||e.tag!==1)throw Error(V(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Jt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(V(171))}if(e.tag===1){var n=e.type;if(Jt(n))return ig(e,n,t)}return t}function o_(e,t,n,r,a,i,o,l,c){return e=Pd(n,r,!0,e,a,i,o,l,c),e.context=i_(null),n=e.current,r=Bt(),a=jr(n),i=Kn(r,a),i.callback=t??null,wr(n,i,a),e.current.lanes=a,fi(e,a,r),Yt(e,r),e}function gl(e,t,n,r){var a=t.current,i=Bt(),o=jr(a);return n=i_(n),t.context===null?t.context=n:t.pendingContext=n,t=Kn(i,o),t.payload={element:e},r=r===void 0?null:r,r!==null&&(t.callback=r),e=wr(a,t,o),e!==null&&(An(e,a,o,i),co(e,a,o)),o}function Wo(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function mf(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function Rd(e,t){mf(e,t),(e=e.alternate)&&mf(e,t)}function Bw(){return null}var l_=typeof reportError=="function"?reportError:function(e){console.error(e)};function Od(e){this._internalRoot=e}_l.prototype.render=Od.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(V(409));gl(e,t,null,null)};_l.prototype.unmount=Od.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;as(function(){gl(null,e,null,null)}),t[Yn]=null}};function _l(e){this._internalRoot=e}_l.prototype.unstable_scheduleHydration=function(e){if(e){var t=Up();e={blockedOn:null,target:e,priority:t};for(var n=0;n<dr.length&&t!==0&&t<dr[n].priority;n++);dr.splice(n,0,e),n===0&&zp(e)}};function Ld(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function yl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pf(){}function qw(e,t,n,r,a){if(a){if(typeof r=="function"){var i=r;r=function(){var u=Wo(o);i.call(u)}}var o=o_(t,r,e,0,null,!1,!1,"",pf);return e._reactRootContainer=o,e[Yn]=o.current,Ja(e.nodeType===8?e.parentNode:e),as(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof r=="function"){var l=r;r=function(){var u=Wo(c);l.call(u)}}var c=Pd(e,0,!1,null,null,!1,!1,"",pf);return e._reactRootContainer=c,e[Yn]=c.current,Ja(e.nodeType===8?e.parentNode:e),as(function(){gl(t,c,n,r)}),c}function bl(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if(typeof a=="function"){var l=a;a=function(){var c=Wo(o);l.call(c)}}gl(t,o,e,a)}else o=qw(n,t,e,a,r);return Wo(o)}$p=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ja(t.pendingLanes);n!==0&&(td(t,n|1),Yt(t,_t()),!(Ge&6)&&(Js=_t()+500,Tr()))}break;case 13:as(function(){var r=Qn(e,1);if(r!==null){var a=Bt();An(r,e,1,a)}}),Rd(e,1)}};nd=function(e){if(e.tag===13){var t=Qn(e,134217728);if(t!==null){var n=Bt();An(t,e,134217728,n)}Rd(e,134217728)}};Mp=function(e){if(e.tag===13){var t=jr(e),n=Qn(e,t);if(n!==null){var r=Bt();An(n,e,t,r)}Rd(e,t)}};Up=function(){return Qe};Fp=function(e,t){var n=Qe;try{return Qe=e,t()}finally{Qe=n}};Lc=function(e,t,n){switch(t){case"input":if(Tc(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=cl(r);if(!a)throw Error(V(90));_p(r),Tc(r,a)}}}break;case"textarea":bp(e,n);break;case"select":t=n.value,t!=null&&Os(e,!!n.multiple,t,!1)}};Np=Td;Ep=as;var Hw={usingClientEntryPoint:!1,Events:[pi,Es,cl,kp,Sp,Td]},ya={findFiberByHostInstance:Gr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ww={bundleType:ya.bundleType,version:ya.version,rendererPackageName:ya.rendererPackageName,rendererConfig:ya.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Zn.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Dp(e),e===null?null:e.stateNode},findFiberByHostInstance:ya.findFiberByHostInstance||Bw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mi=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mi.isDisabled&&Mi.supportsFiber)try{al=Mi.inject(Ww),Mn=Mi}catch{}}ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hw;ln.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ld(t))throw Error(V(200));return zw(e,t,null,n)};ln.createRoot=function(e,t){if(!Ld(e))throw Error(V(299));var n=!1,r="",a=l_;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Pd(e,1,!1,null,null,n,!1,r,a),e[Yn]=t.current,Ja(e.nodeType===8?e.parentNode:e),new Od(t)};ln.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(V(188)):(e=Object.keys(e).join(","),Error(V(268,e)));return e=Dp(t),e=e===null?null:e.stateNode,e};ln.flushSync=function(e){return as(e)};ln.hydrate=function(e,t,n){if(!yl(t))throw Error(V(200));return bl(null,e,t,!0,n)};ln.hydrateRoot=function(e,t,n){if(!Ld(e))throw Error(V(405));var r=n!=null&&n.hydratedSources||null,a=!1,i="",o=l_;if(n!=null&&(n.unstable_strictMode===!0&&(a=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),t=o_(t,null,e,1,n??null,a,!1,i,o),e[Yn]=t.current,Ja(e),r)for(e=0;e<r.length;e++)n=r[e],a=n._getVersion,a=a(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new _l(t)};ln.render=function(e,t,n){if(!yl(t))throw Error(V(200));return bl(null,e,t,!1,n)};ln.unmountComponentAtNode=function(e){if(!yl(e))throw Error(V(40));return e._reactRootContainer?(as(function(){bl(null,null,e,!1,function(){e._reactRootContainer=null,e[Yn]=null})}),!0):!1};ln.unstable_batchedUpdates=Td;ln.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!yl(n))throw Error(V(200));if(e==null||e._reactInternals===void 0)throw Error(V(38));return bl(e,t,n,!1,r)};ln.version="18.3.1-next-f1338f8080-20240426";function c_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(c_)}catch(e){console.error(e)}}c_(),cp.exports=ln;var Vw=cp.exports,gf=Vw;xc.createRoot=gf.createRoot,xc.hydrateRoot=gf.hydrateRoot;const u_="data:image/svg+xml,%3csvg%20width='96'%20height='96'%20viewBox='0%200%2096%2096'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='8'%20y='8'%20width='80'%20height='80'%20rx='18'%20fill='%23F5F7FB'/%3e%3crect%20x='8'%20y='8'%20width='80'%20height='80'%20rx='18'%20fill='url(%23paint0_linear_1_1)'/%3e%3crect%20x='8'%20y='8'%20width='80'%20height='80'%20rx='18'%20stroke='%23E3E8EF'%20stroke-width='3'/%3e%3crect%20x='24'%20y='44'%20width='12'%20height='24'%20rx='4'%20fill='%2322C55E'/%3e%3crect%20x='42'%20y='34'%20width='12'%20height='34'%20rx='4'%20fill='%23F43F5E'/%3e%3crect%20x='60'%20y='24'%20width='12'%20height='44'%20rx='4'%20fill='%233B82F6'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_1_1'%20x1='16'%20y1='16'%20x2='80'%20y2='80'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FFFFFF'/%3e%3cstop%20offset='1'%20stop-color='%23EEF2FF'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",d_="data:image/svg+xml,%3csvg%20width='96'%20height='96'%20viewBox='0%200%2096%2096'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20x='8'%20y='8'%20width='80'%20height='80'%20rx='18'%20fill='%230EA44F'/%3e%3crect%20x='8'%20y='8'%20width='80'%20height='80'%20rx='18'%20fill='url(%23paint0_linear_1_2)'/%3e%3crect%20x='8'%20y='8'%20width='80'%20height='80'%20rx='18'%20stroke='%230D8D44'%20stroke-width='3'/%3e%3cpath%20d='M70%2036L44%2062L30%2048'%20stroke='white'%20stroke-width='8'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cdefs%3e%3clinearGradient%20id='paint0_linear_1_2'%20x1='20'%20y1='16'%20x2='76'%20y2='80'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%2322C55E'/%3e%3cstop%20offset='1'%20stop-color='%2316A34A'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e";var pu=function(e,t){return pu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])},pu(e,t)};function h_(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");pu(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var Vo=function(){return Vo=Object.assign||function(t){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},Vo.apply(this,arguments)};function ra(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]]);return n}function f_(e,t,n,r){var a=arguments.length,i=a<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,n):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,n,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(i=(a<3?o(i):a>3?o(t,n,i):o(t,n))||i);return a>3&&i&&Object.defineProperty(t,n,i),i}function m_(e,t){return function(n,r){t(n,r,e)}}function p_(e,t,n,r,a,i){function o(p){if(p!==void 0&&typeof p!="function")throw new TypeError("Function expected");return p}for(var l=r.kind,c=l==="getter"?"get":l==="setter"?"set":"value",u=!t&&e?r.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),m,h=!1,b=n.length-1;b>=0;b--){var y={};for(var g in r)y[g]=g==="access"?{}:r[g];for(var g in r.access)y.access[g]=r.access[g];y.addInitializer=function(p){if(h)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(p||null))};var w=(0,n[b])(l==="accessor"?{get:d.get,set:d.set}:d[c],y);if(l==="accessor"){if(w===void 0)continue;if(w===null||typeof w!="object")throw new TypeError("Object expected");(m=o(w.get))&&(d.get=m),(m=o(w.set))&&(d.set=m),(m=o(w.init))&&a.unshift(m)}else(m=o(w))&&(l==="field"?a.unshift(m):d[c]=m)}u&&Object.defineProperty(u,r.name,d),h=!0}function g_(e,t,n){for(var r=arguments.length>2,a=0;a<t.length;a++)n=r?t[a].call(e,n):t[a].call(e);return r?n:void 0}function __(e){return typeof e=="symbol"?e:"".concat(e)}function y_(e,t,n){return typeof t=="symbol"&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:n?"".concat(n," ",t):t})}function b_(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function ge(e,t,n,r){function a(i){return i instanceof n?i:new n(function(o){o(i)})}return new(n||(n=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(m){o(m)}}function c(d){try{u(r.throw(d))}catch(m){o(m)}}function u(d){d.done?i(d.value):a(d.value).then(l,c)}u((r=r.apply(e,t||[])).next())})}function v_(e,t){var n={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=l(0),o.throw=l(1),o.return=l(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(d){return c([u,d])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(n=0)),n;)try{if(r=1,a&&(i=u[0]&2?a.return:u[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,u[1])).done)return i;switch(a=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,a=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(i=n.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){n.label=u[1];break}if(u[0]===6&&n.label<i[1]){n.label=i[1],i=u;break}if(i&&n.label<i[2]){n.label=i[2],n.ops.push(u);break}i[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(d){u=[6,d],a=0}finally{r=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}var vl=Object.create?function(e,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,a)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]};function w_(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&vl(t,e,n)}function Go(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function $d(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),a,i=[],o;try{for(;(t===void 0||t-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(l){o={error:l}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return i}function x_(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat($d(arguments[t]));return e}function j_(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),a=0,t=0;t<n;t++)for(var i=arguments[t],o=0,l=i.length;o<l;o++,a++)r[a]=i[o];return r}function k_(e,t,n){if(n||arguments.length===2)for(var r=0,a=t.length,i;r<a;r++)(i||!(r in t))&&(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}function Ys(e){return this instanceof Ys?(this.v=e,this):new Ys(e)}function S_(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=n.apply(e,t||[]),a,i=[];return a=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",o),a[Symbol.asyncIterator]=function(){return this},a;function o(b){return function(y){return Promise.resolve(y).then(b,m)}}function l(b,y){r[b]&&(a[b]=function(g){return new Promise(function(w,p){i.push([b,g,w,p])>1||c(b,g)})},y&&(a[b]=y(a[b])))}function c(b,y){try{u(r[b](y))}catch(g){h(i[0][3],g)}}function u(b){b.value instanceof Ys?Promise.resolve(b.value.v).then(d,m):h(i[0][2],b)}function d(b){c("next",b)}function m(b){c("throw",b)}function h(b,y){b(y),i.shift(),i.length&&c(i[0][0],i[0][1])}}function N_(e){var t,n;return t={},r("next"),r("throw",function(a){throw a}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(a,i){t[a]=e[a]?function(o){return(n=!n)?{value:Ys(e[a](o)),done:!1}:i?i(o):o}:i}}function E_(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],n;return t?t.call(e):(e=typeof Go=="function"?Go(e):e[Symbol.iterator](),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(i){n[i]=e[i]&&function(o){return new Promise(function(l,c){o=e[i](o),a(l,c,o.done,o.value)})}}function a(i,o,l,c){Promise.resolve(c).then(function(u){i({value:u,done:l})},o)}}function C_(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var Gw=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},gu=function(e){return gu=Object.getOwnPropertyNames||function(t){var n=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[n.length]=r);return n},gu(e)};function T_(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n=gu(e),r=0;r<n.length;r++)n[r]!=="default"&&vl(t,e,n[r]);return Gw(t,e),t}function D_(e){return e&&e.__esModule?e:{default:e}}function A_(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)}function I_(e,t,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(e,n):a?a.value=n:t.set(e,n),n}function P_(e,t){if(t===null||typeof t!="object"&&typeof t!="function")throw new TypeError("Cannot use 'in' operator on non-object");return typeof e=="function"?t===e:e.has(t)}function R_(e,t,n){if(t!=null){if(typeof t!="object"&&typeof t!="function")throw new TypeError("Object expected.");var r,a;if(n){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(r===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],n&&(a=r)}if(typeof r!="function")throw new TypeError("Object not disposable.");a&&(r=function(){try{a.call(this)}catch(i){return Promise.reject(i)}}),e.stack.push({value:t,dispose:r,async:n})}else n&&e.stack.push({async:!0});return t}var Kw=typeof SuppressedError=="function"?SuppressedError:function(e,t,n){var r=new Error(n);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function O_(e){function t(i){e.error=e.hasError?new Kw(i,e.error,"An error was suppressed during disposal."):i,e.hasError=!0}var n,r=0;function a(){for(;n=e.stack.pop();)try{if(!n.async&&r===1)return r=0,e.stack.push(n),Promise.resolve().then(a);if(n.dispose){var i=n.dispose.call(n.value);if(n.async)return r|=2,Promise.resolve(i).then(a,function(o){return t(o),a()})}else r|=1}catch(o){t(o)}if(r===1)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}return a()}function L_(e,t){return typeof e=="string"&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(n,r,a,i,o){return r?t?".jsx":".js":a&&(!i||!o)?n:a+i+"."+o.toLowerCase()+"js"}):e}const Jw={__extends:h_,__assign:Vo,__rest:ra,__decorate:f_,__param:m_,__esDecorate:p_,__runInitializers:g_,__propKey:__,__setFunctionName:y_,__metadata:b_,__awaiter:ge,__generator:v_,__createBinding:vl,__exportStar:w_,__values:Go,__read:$d,__spread:x_,__spreadArrays:j_,__spreadArray:k_,__await:Ys,__asyncGenerator:S_,__asyncDelegator:N_,__asyncValues:E_,__makeTemplateObject:C_,__importStar:T_,__importDefault:D_,__classPrivateFieldGet:A_,__classPrivateFieldSet:I_,__classPrivateFieldIn:P_,__addDisposableResource:R_,__disposeResources:O_,__rewriteRelativeImportExtension:L_},Yw=Object.freeze(Object.defineProperty({__proto__:null,__addDisposableResource:R_,get __assign(){return Vo},__asyncDelegator:N_,__asyncGenerator:S_,__asyncValues:E_,__await:Ys,__awaiter:ge,__classPrivateFieldGet:A_,__classPrivateFieldIn:P_,__classPrivateFieldSet:I_,__createBinding:vl,__decorate:f_,__disposeResources:O_,__esDecorate:p_,__exportStar:w_,__extends:h_,__generator:v_,__importDefault:D_,__importStar:T_,__makeTemplateObject:C_,__metadata:b_,__param:m_,__propKey:__,__read:$d,__rest:ra,__rewriteRelativeImportExtension:L_,__runInitializers:g_,__setFunctionName:y_,__spread:x_,__spreadArray:k_,__spreadArrays:j_,__values:Go,default:Jw},Symbol.toStringTag,{value:"Module"})),Qw=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...n)=>$n(async()=>{const{default:r}=await Promise.resolve().then(()=>cs);return{default:r}},void 0).then(({default:r})=>r(...n)):t=fetch,(...n)=>t(...n)};class Md extends Error{constructor(t,n="FunctionsError",r){super(t),this.name=n,this.context=r}}class _f extends Md{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class yf extends Md{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class bf extends Md{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var _u;(function(e){e.Any="any",e.ApNortheast1="ap-northeast-1",e.ApNortheast2="ap-northeast-2",e.ApSouth1="ap-south-1",e.ApSoutheast1="ap-southeast-1",e.ApSoutheast2="ap-southeast-2",e.CaCentral1="ca-central-1",e.EuCentral1="eu-central-1",e.EuWest1="eu-west-1",e.EuWest2="eu-west-2",e.EuWest3="eu-west-3",e.SaEast1="sa-east-1",e.UsEast1="us-east-1",e.UsWest1="us-west-1",e.UsWest2="us-west-2"})(_u||(_u={}));class Xw{constructor(t,{headers:n={},customFetch:r,region:a=_u.Any}={}){this.url=t,this.headers=n,this.region=a,this.fetch=Qw(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t){return ge(this,arguments,void 0,function*(n,r={}){var a;try{const{headers:i,method:o,body:l,signal:c}=r;let u={},{region:d}=r;d||(d=this.region);const m=new URL(`${this.url}/${n}`);d&&d!=="any"&&(u["x-region"]=d,m.searchParams.set("forceFunctionRegion",d));let h;l&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)?typeof Blob<"u"&&l instanceof Blob||l instanceof ArrayBuffer?(u["Content-Type"]="application/octet-stream",h=l):typeof l=="string"?(u["Content-Type"]="text/plain",h=l):typeof FormData<"u"&&l instanceof FormData?h=l:(u["Content-Type"]="application/json",h=JSON.stringify(l)):h=l;const b=yield this.fetch(m.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},u),this.headers),i),body:h,signal:c}).catch(p=>{throw p.name==="AbortError"?p:new _f(p)}),y=b.headers.get("x-relay-error");if(y&&y==="true")throw new yf(b);if(!b.ok)throw new bf(b);let g=((a=b.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),w;return g==="application/json"?w=yield b.json():g==="application/octet-stream"||g==="application/pdf"?w=yield b.blob():g==="text/event-stream"?w=b:g==="multipart/form-data"?w=yield b.formData():w=yield b.text(),{data:w,error:null,response:b}}catch(i){return i instanceof Error&&i.name==="AbortError"?{data:null,error:new _f(i)}:{data:null,error:i,response:i instanceof bf||i instanceof yf?i.context:void 0}}})}}var Ft={};const sa=Qm(Yw);var Ui={},Fi={},zi={},Bi={},qi={},Zw=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Qs=Zw();const e0=Qs.fetch,$_=Qs.fetch.bind(Qs),M_=Qs.Headers,t0=Qs.Request,n0=Qs.Response,cs=Object.freeze(Object.defineProperty({__proto__:null,Headers:M_,Request:t0,Response:n0,default:$_,fetch:e0},Symbol.toStringTag,{value:"Module"})),r0=Qm(cs);var Hi={},vf;function U_(){if(vf)return Hi;vf=1,Object.defineProperty(Hi,"__esModule",{value:!0});class e extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}}return Hi.default=e,Hi}var wf;function F_(){if(wf)return qi;wf=1,Object.defineProperty(qi,"__esModule",{value:!0});const e=sa,t=e.__importDefault(r0),n=e.__importDefault(U_());class r{constructor(i){var o,l;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(o=i.shouldThrowOnError)!==null&&o!==void 0?o:!1,this.signal=i.signal,this.isMaybeSingle=(l=i.isMaybeSingle)!==null&&l!==void 0?l:!1,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=t.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,o){return this.headers=new Headers(this.headers),this.headers.set(i,o),this}then(i,o){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const l=this.fetch;let c=l(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var d,m,h,b;let y=null,g=null,w=null,p=u.status,_=u.statusText;if(u.ok){if(this.method!=="HEAD"){const k=await u.text();k===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((d=this.headers.get("Accept"))===null||d===void 0)&&d.includes("application/vnd.pgrst.plan+text"))?g=k:g=JSON.parse(k))}const x=(m=this.headers.get("Prefer"))===null||m===void 0?void 0:m.match(/count=(exact|planned|estimated)/),j=(h=u.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");x&&j&&j.length>1&&(w=parseInt(j[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(g)&&(g.length>1?(y={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,w=null,p=406,_="Not Acceptable"):g.length===1?g=g[0]:g=null)}else{const x=await u.text();try{y=JSON.parse(x),Array.isArray(y)&&u.status===404&&(g=[],y=null,p=200,_="OK")}catch{u.status===404&&x===""?(p=204,_="No Content"):y={message:x}}if(y&&this.isMaybeSingle&&(!((b=y==null?void 0:y.details)===null||b===void 0)&&b.includes("0 rows"))&&(y=null,p=200,_="OK"),y&&this.shouldThrowOnError)throw new n.default(y)}return{error:y,data:g,count:w,status:p,statusText:_}});return this.shouldThrowOnError||(c=c.catch(u=>{var d,m,h;return{error:{message:`${(d=u==null?void 0:u.name)!==null&&d!==void 0?d:"FetchError"}: ${u==null?void 0:u.message}`,details:`${(m=u==null?void 0:u.stack)!==null&&m!==void 0?m:""}`,hint:"",code:`${(h=u==null?void 0:u.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,o)}returns(){return this}overrideTypes(){return this}}return qi.default=r,qi}var xf;function z_(){if(xf)return Bi;xf=1,Object.defineProperty(Bi,"__esModule",{value:!0});const t=sa.__importDefault(F_());class n extends t.default{select(a){let i=!1;const o=(a??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:i=!0,nullsFirst:o,foreignTable:l,referencedTable:c=l}={}){const u=c?`${c}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${a}.${i?"asc":"desc"}${o===void 0?"":o?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:i,referencedTable:o=i}={}){const l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${a}`),this}range(a,i,{foreignTable:o,referencedTable:l=o}={}){const c=typeof l>"u"?"offset":`${l}.offset`,u=typeof l>"u"?"limit":`${l}.limit`;return this.url.searchParams.set(c,`${a}`),this.url.searchParams.set(u,`${i-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:i=!1,settings:o=!1,buffers:l=!1,wal:c=!1,format:u="text"}={}){var d;const m=[a?"analyze":null,i?"verbose":null,o?"settings":null,l?"buffers":null,c?"wal":null].filter(Boolean).join("|"),h=(d=this.headers.get("Accept"))!==null&&d!==void 0?d:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${u}; for="${h}"; options=${m};`),u==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}}return Bi.default=n,Bi}var jf;function Ud(){if(jf)return zi;jf=1,Object.defineProperty(zi,"__esModule",{value:!0});const t=sa.__importDefault(z_()),n=new RegExp("[,()]");class r extends t.default{eq(i,o){return this.url.searchParams.append(i,`eq.${o}`),this}neq(i,o){return this.url.searchParams.append(i,`neq.${o}`),this}gt(i,o){return this.url.searchParams.append(i,`gt.${o}`),this}gte(i,o){return this.url.searchParams.append(i,`gte.${o}`),this}lt(i,o){return this.url.searchParams.append(i,`lt.${o}`),this}lte(i,o){return this.url.searchParams.append(i,`lte.${o}`),this}like(i,o){return this.url.searchParams.append(i,`like.${o}`),this}likeAllOf(i,o){return this.url.searchParams.append(i,`like(all).{${o.join(",")}}`),this}likeAnyOf(i,o){return this.url.searchParams.append(i,`like(any).{${o.join(",")}}`),this}ilike(i,o){return this.url.searchParams.append(i,`ilike.${o}`),this}ilikeAllOf(i,o){return this.url.searchParams.append(i,`ilike(all).{${o.join(",")}}`),this}ilikeAnyOf(i,o){return this.url.searchParams.append(i,`ilike(any).{${o.join(",")}}`),this}is(i,o){return this.url.searchParams.append(i,`is.${o}`),this}in(i,o){const l=Array.from(new Set(o)).map(c=>typeof c=="string"&&n.test(c)?`"${c}"`:`${c}`).join(",");return this.url.searchParams.append(i,`in.(${l})`),this}contains(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cs.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cs.{${o.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(o)}`),this}containedBy(i,o){return typeof o=="string"?this.url.searchParams.append(i,`cd.${o}`):Array.isArray(o)?this.url.searchParams.append(i,`cd.{${o.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(o)}`),this}rangeGt(i,o){return this.url.searchParams.append(i,`sr.${o}`),this}rangeGte(i,o){return this.url.searchParams.append(i,`nxl.${o}`),this}rangeLt(i,o){return this.url.searchParams.append(i,`sl.${o}`),this}rangeLte(i,o){return this.url.searchParams.append(i,`nxr.${o}`),this}rangeAdjacent(i,o){return this.url.searchParams.append(i,`adj.${o}`),this}overlaps(i,o){return typeof o=="string"?this.url.searchParams.append(i,`ov.${o}`):this.url.searchParams.append(i,`ov.{${o.join(",")}}`),this}textSearch(i,o,{config:l,type:c}={}){let u="";c==="plain"?u="pl":c==="phrase"?u="ph":c==="websearch"&&(u="w");const d=l===void 0?"":`(${l})`;return this.url.searchParams.append(i,`${u}fts${d}.${o}`),this}match(i){return Object.entries(i).forEach(([o,l])=>{this.url.searchParams.append(o,`eq.${l}`)}),this}not(i,o,l){return this.url.searchParams.append(i,`not.${o}.${l}`),this}or(i,{foreignTable:o,referencedTable:l=o}={}){const c=l?`${l}.or`:"or";return this.url.searchParams.append(c,`(${i})`),this}filter(i,o,l){return this.url.searchParams.append(i,`${o}.${l}`),this}}return zi.default=r,zi}var kf;function B_(){if(kf)return Fi;kf=1,Object.defineProperty(Fi,"__esModule",{value:!0});const t=sa.__importDefault(Ud());class n{constructor(a,{headers:i={},schema:o,fetch:l}){this.url=a,this.headers=new Headers(i),this.schema=o,this.fetch=l}select(a,i){const{head:o=!1,count:l}=i??{},c=o?"HEAD":"GET";let u=!1;const d=(a??"*").split("").map(m=>/\s/.test(m)&&!u?"":(m==='"'&&(u=!u),m)).join("");return this.url.searchParams.set("select",d),l&&this.headers.append("Prefer",`count=${l}`),new t.default({method:c,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:i,defaultToNull:o=!0}={}){var l;const c="POST";if(i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const u=a.reduce((d,m)=>d.concat(Object.keys(m)),[]);if(u.length>0){const d=[...new Set(u)].map(m=>`"${m}"`);this.url.searchParams.set("columns",d.join(","))}}return new t.default({method:c,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch})}upsert(a,{onConflict:i,ignoreDuplicates:o=!1,count:l,defaultToNull:c=!0}={}){var u;const d="POST";if(this.headers.append("Prefer",`resolution=${o?"ignore":"merge"}-duplicates`),i!==void 0&&this.url.searchParams.set("on_conflict",i),l&&this.headers.append("Prefer",`count=${l}`),c||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const m=a.reduce((h,b)=>h.concat(Object.keys(b)),[]);if(m.length>0){const h=[...new Set(m)].map(b=>`"${b}"`);this.url.searchParams.set("columns",h.join(","))}}return new t.default({method:d,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(u=this.fetch)!==null&&u!==void 0?u:fetch})}update(a,{count:i}={}){var o;const l="PATCH";return i&&this.headers.append("Prefer",`count=${i}`),new t.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}delete({count:a}={}){var i;const o="DELETE";return a&&this.headers.append("Prefer",`count=${a}`),new t.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}}return Fi.default=n,Fi}var Sf;function s0(){if(Sf)return Ui;Sf=1,Object.defineProperty(Ui,"__esModule",{value:!0});const e=sa,t=e.__importDefault(B_()),n=e.__importDefault(Ud());class r{constructor(i,{headers:o={},schema:l,fetch:c}={}){this.url=i,this.headers=new Headers(o),this.schemaName=l,this.fetch=c}from(i){const o=new URL(`${this.url}/${i}`);return new t.default(o,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(i){return new r(this.url,{headers:this.headers,schema:i,fetch:this.fetch})}rpc(i,o={},{head:l=!1,get:c=!1,count:u}={}){var d;let m;const h=new URL(`${this.url}/rpc/${i}`);let b;l||c?(m=l?"HEAD":"GET",Object.entries(o).filter(([g,w])=>w!==void 0).map(([g,w])=>[g,Array.isArray(w)?`{${w.join(",")}}`:`${w}`]).forEach(([g,w])=>{h.searchParams.append(g,w)})):(m="POST",b=o);const y=new Headers(this.headers);return u&&y.set("Prefer",`count=${u}`),new n.default({method:m,url:h,headers:y,schema:this.schemaName,body:b,fetch:(d=this.fetch)!==null&&d!==void 0?d:fetch})}}return Ui.default=r,Ui}Object.defineProperty(Ft,"__esModule",{value:!0});var q_=Ft.PostgrestError=Z_=Ft.PostgrestBuilder=Q_=Ft.PostgrestTransformBuilder=J_=Ft.PostgrestFilterBuilder=G_=Ft.PostgrestQueryBuilder=W_=Ft.PostgrestClient=void 0;const aa=sa,H_=aa.__importDefault(s0());var W_=Ft.PostgrestClient=H_.default;const V_=aa.__importDefault(B_());var G_=Ft.PostgrestQueryBuilder=V_.default;const K_=aa.__importDefault(Ud());var J_=Ft.PostgrestFilterBuilder=K_.default;const Y_=aa.__importDefault(z_());var Q_=Ft.PostgrestTransformBuilder=Y_.default;const X_=aa.__importDefault(F_());var Z_=Ft.PostgrestBuilder=X_.default;const ey=aa.__importDefault(U_());q_=Ft.PostgrestError=ey.default;var ty=Ft.default={PostgrestClient:H_.default,PostgrestQueryBuilder:V_.default,PostgrestFilterBuilder:K_.default,PostgrestTransformBuilder:Y_.default,PostgrestBuilder:X_.default,PostgrestError:ey.default};const a0=db({__proto__:null,get PostgrestBuilder(){return Z_},get PostgrestClient(){return W_},get PostgrestError(){return q_},get PostgrestFilterBuilder(){return J_},get PostgrestQueryBuilder(){return G_},get PostgrestTransformBuilder(){return Q_},default:ty},[Ft]),{PostgrestClient:i0,PostgrestQueryBuilder:nC,PostgrestFilterBuilder:rC,PostgrestTransformBuilder:sC,PostgrestBuilder:aC,PostgrestError:iC}=ty||a0;class o0{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,a=parseInt(r.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let n=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(n+=`

Suggested solution: ${t.workaround}`),new Error(n)}static createWebSocket(t,n){const r=this.getWebSocketConstructor();return new r(t,n)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const l0="2.78.0",c0=`realtime-js/${l0}`,u0="1.0.0",yu=1e4,d0=1e3,h0=100;var Ma;(function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"})(Ma||(Ma={}));var xt;(function(e){e.closed="closed",e.errored="errored",e.joined="joined",e.joining="joining",e.leaving="leaving"})(xt||(xt={}));var Cn;(function(e){e.close="phx_close",e.error="phx_error",e.join="phx_join",e.reply="phx_reply",e.leave="phx_leave",e.access_token="access_token"})(Cn||(Cn={}));var bu;(function(e){e.websocket="websocket"})(bu||(bu={}));var Wr;(function(e){e.Connecting="connecting",e.Open="open",e.Closing="closing",e.Closed="closed"})(Wr||(Wr={}));class f0{constructor(){this.HEADER_LENGTH=1}decode(t,n){return t.constructor===ArrayBuffer?n(this._binaryDecode(t)):n(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const n=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,n,r)}_decodeBroadcast(t,n,r){const a=n.getUint8(1),i=n.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(t.slice(o,o+a));o=o+a;const c=r.decode(t.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class ny{constructor(t,n){this.callback=t,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ze;(function(e){e.abstime="abstime",e.bool="bool",e.date="date",e.daterange="daterange",e.float4="float4",e.float8="float8",e.int2="int2",e.int4="int4",e.int4range="int4range",e.int8="int8",e.int8range="int8range",e.json="json",e.jsonb="jsonb",e.money="money",e.numeric="numeric",e.oid="oid",e.reltime="reltime",e.text="text",e.time="time",e.timestamp="timestamp",e.timestamptz="timestamptz",e.timetz="timetz",e.tsrange="tsrange",e.tstzrange="tstzrange"})(Ze||(Ze={}));const Nf=(e,t,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return t?Object.keys(t).reduce((i,o)=>(i[o]=m0(o,e,t,a),i),{}):{}},m0=(e,t,n,r)=>{const a=t.find(l=>l.name===e),i=a==null?void 0:a.type,o=n[e];return i&&!r.includes(i)?ry(i,o):vu(o)},ry=(e,t)=>{if(e.charAt(0)==="_"){const n=e.slice(1,e.length);return y0(t,n)}switch(e){case Ze.bool:return p0(t);case Ze.float4:case Ze.float8:case Ze.int2:case Ze.int4:case Ze.int8:case Ze.numeric:case Ze.oid:return g0(t);case Ze.json:case Ze.jsonb:return _0(t);case Ze.timestamp:return b0(t);case Ze.abstime:case Ze.date:case Ze.daterange:case Ze.int4range:case Ze.int8range:case Ze.money:case Ze.reltime:case Ze.text:case Ze.time:case Ze.timestamptz:case Ze.timetz:case Ze.tsrange:case Ze.tstzrange:return vu(t);default:return vu(t)}},vu=e=>e,p0=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},g0=e=>{if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},_0=e=>{if(typeof e=="string")try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},y0=(e,t)=>{if(typeof e!="string")return e;const n=e.length-1,r=e[n];if(e[0]==="{"&&r==="}"){let i;const o=e.slice(1,n);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>ry(t,l))}return e},b0=e=>typeof e=="string"?e.replace(" ","T"):e,sy=e=>{const t=new URL(e);return t.protocol=t.protocol.replace(/^ws/i,"http"),t.pathname=t.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),t.pathname===""||t.pathname==="/"?t.pathname="/api/broadcast":t.pathname=t.pathname+"/api/broadcast",t.href};class Xl{constructor(t,n,r={},a=yu){this.channel=t,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,n){var r;return this._hasReceived(t)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:n}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(n))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var Ef;(function(e){e.SYNC="sync",e.JOIN="join",e.LEAVE="leave"})(Ef||(Ef={}));class Ua{constructor(t,n){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(n==null?void 0:n.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ua.syncState(this.state,a,i,o),this.pendingDiffs.forEach(c=>{this.state=Ua.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Ua.syncDiff(this.state,a,i,o),l())}),this.onJoin((a,i,o)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:o})}),this.onLeave((a,i,o)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,n,r,a){const i=this.cloneDeep(t),o=this.transformState(n),l={},c={};return this.map(i,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const m=i[u];if(m){const h=d.map(w=>w.presence_ref),b=m.map(w=>w.presence_ref),y=d.filter(w=>b.indexOf(w.presence_ref)<0),g=m.filter(w=>h.indexOf(w.presence_ref)<0);y.length>0&&(l[u]=y),g.length>0&&(c[u]=g)}else l[u]=d}),this.syncDiff(i,{joins:l,leaves:c},r,a)}static syncDiff(t,n,r,a){const{joins:i,leaves:o}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(l,c)=>{var u;const d=(u=t[l])!==null&&u!==void 0?u:[];if(t[l]=this.cloneDeep(c),d.length>0){const m=t[l].map(b=>b.presence_ref),h=d.filter(b=>m.indexOf(b.presence_ref)<0);t[l].unshift(...h)}r(l,d,c)}),this.map(o,(l,c)=>{let u=t[l];if(!u)return;const d=c.map(m=>m.presence_ref);u=u.filter(m=>d.indexOf(m.presence_ref)<0),t[l]=u,a(l,u,c),u.length===0&&delete t[l]}),t}static map(t,n){return Object.getOwnPropertyNames(t).map(r=>n(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((n,r)=>{const a=t[r];return"metas"in a?n[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=a,n},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Cf;(function(e){e.ALL="*",e.INSERT="INSERT",e.UPDATE="UPDATE",e.DELETE="DELETE"})(Cf||(Cf={}));var Fa;(function(e){e.BROADCAST="broadcast",e.PRESENCE="presence",e.POSTGRES_CHANGES="postgres_changes",e.SYSTEM="system"})(Fa||(Fa={}));var Hn;(function(e){e.SUBSCRIBED="SUBSCRIBED",e.TIMED_OUT="TIMED_OUT",e.CLOSED="CLOSED",e.CHANNEL_ERROR="CHANNEL_ERROR"})(Hn||(Hn={}));class Fd{constructor(t,n={config:{}},r){var a,i;if(this.topic=t,this.params=n,this.socket=r,this.bindings={},this.state=xt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new Xl(this,Cn.join,this.params,this.timeout),this.rejoinTimer=new ny(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=xt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=xt.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=xt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=xt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=xt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Cn.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new Ua(this),this.broadcastEndpointURL=sy(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(t,n=this.timeout){var r,a,i;if(this.socket.isConnected()||this.socket.connect(),this.state==xt.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(b=>b.filter))!==null&&a!==void 0?a:[],d=!!this.bindings[Fa.PRESENCE]&&this.bindings[Fa.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,m={},h={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:d}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(m.access_token=this.socket.accessTokenValue),this._onError(b=>t==null?void 0:t(Hn.CHANNEL_ERROR,b)),this._onClose(()=>t==null?void 0:t(Hn.CLOSED)),this.updateJoinPayload(Object.assign({config:h},m)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:b})=>{var y;if(this.socket.setAuth(),b===void 0){t==null||t(Hn.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,w=(y=g==null?void 0:g.length)!==null&&y!==void 0?y:0,p=[];for(let _=0;_<w;_++){const v=g[_],{filter:{event:x,schema:j,table:k,filter:S}}=v,A=b&&b[_];if(A&&A.event===x&&A.schema===j&&A.table===k&&A.filter===S)p.push(Object.assign(Object.assign({},v),{id:A.id}));else{this.unsubscribe(),this.state=xt.errored,t==null||t(Hn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,t&&t(Hn.SUBSCRIBED);return}}).receive("error",b=>{this.state=xt.errored,t==null||t(Hn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{t==null||t(Hn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,n={}){return await this.send({type:"presence",event:"track",payload:t},n.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,n,r){return this.state===xt.joined&&t===Fa.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,n,r)}async httpSend(t,n,r={}){var a;const i=this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"";if(n==null)return Promise.reject("Payload is required for httpSend()");const o={method:"POST",headers:{Authorization:i,apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:t,payload:n,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const u=await l.json();c=u.error||u.message||c}catch{}return Promise.reject(new Error(c))}async send(t,n={}){var r,a;if(!this._canPush()&&t.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=u.body)===null||a===void 0?void 0:a.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const u=this._push(t.type,t,n.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=xt.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Cn.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new Xl(this,Cn.leave,{},t),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=xt.closed,this.bindings={}}async _fetchWithTimeout(t,n,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),o=await this.socket.fetch(t,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(i),o}_push(t,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new Xl(this,t,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>h0){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(t,n,r){return n}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,n,r){var a,i;const o=t.toLocaleLowerCase(),{close:l,error:c,leave:u,join:d}=Cn;if(r&&[l,c,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let h=this._onMessage(o,n,r);if(n&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(b=>{var y,g,w;return((y=b.filter)===null||y===void 0?void 0:y.event)==="*"||((w=(g=b.filter)===null||g===void 0?void 0:g.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(b=>b.callback(h,r)):(i=this.bindings[o])===null||i===void 0||i.filter(b=>{var y,g,w,p,_,v;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in b){const x=b.id,j=(y=b.filter)===null||y===void 0?void 0:y.event;return x&&((g=n.ids)===null||g===void 0?void 0:g.includes(x))&&(j==="*"||(j==null?void 0:j.toLocaleLowerCase())===((w=n.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const x=(_=(p=b==null?void 0:b.filter)===null||p===void 0?void 0:p.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return x==="*"||x===((v=n==null?void 0:n.event)===null||v===void 0?void 0:v.toLocaleLowerCase())}else return b.type.toLocaleLowerCase()===o}).map(b=>{if(typeof h=="object"&&"ids"in h){const y=h.data,{schema:g,table:w,commit_timestamp:p,type:_,errors:v}=y;h=Object.assign(Object.assign({},{schema:g,table:w,commit_timestamp:p,eventType:_,new:{},old:{},errors:v}),this._getPayloadRecords(y))}b.callback(h,r)})}_isClosed(){return this.state===xt.closed}_isJoined(){return this.state===xt.joined}_isJoining(){return this.state===xt.joining}_isLeaving(){return this.state===xt.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,n,r){const a=t.toLocaleLowerCase(),i={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(t,n){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&Fd.isEqual(a.filter,n))})),this}static isEqual(t,n){if(Object.keys(t).length!==Object.keys(n).length)return!1;for(const r in t)if(t[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Cn.close,{},t)}_onError(t){this._on(Cn.error,{},n=>t(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=xt.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const n={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(n.new=Nf(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(n.old=Nf(t.columns,t.old_record)),n}}const Zl=()=>{},Wi={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},v0=[1e3,2e3,5e3,1e4],w0=1e4,x0=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class j0{constructor(t,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=yu,this.transport=null,this.heartbeatIntervalMs=Wi.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Zl,this.ref=0,this.reconnectTimer=null,this.logger=Zl,this.conn=null,this.sendBuffer=[],this.serializer=new f0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>{let i;return a?i=a:typeof fetch>"u"?i=(...o)=>$n(async()=>{const{default:l}=await Promise.resolve().then(()=>cs);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((r=n==null?void 0:n.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${t}/${bu.websocket}`,this.httpEndpoint=sy(t),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n==null?void 0:n.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=o0.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const n=t.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:u0}))}disconnect(t,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},t?this.conn.close(t,n??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const n=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const t=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,n,r){this.logger(t,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Ma.connecting:return Wr.Connecting;case Ma.open:return Wr.Open;case Ma.closing:return Wr.Closing;default:return Wr.Closed}}isConnected(){return this.connectionState()===Wr.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,n={config:{}}){const r=`realtime:${t}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new Fd(`realtime:${t}`,n,this);return this.channels.push(i),i}}push(t){const{topic:n,event:r,payload:a,ref:i}=t,o=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${n} ${r} (${i})`,a),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(d0,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Wi.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let n=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${t}"`),n.unsubscribe())}_remove(t){this.channels=this.channels.filter(n=>n.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:i,ref:o}=n,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${a} ${l}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(a,i,o)),this._triggerStateCallbacks("message",n)})}_clearTimer(t){var n;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var n;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Cn.error))}_appendParams(t,n){if(Object.keys(n).length===0)return t;const r=t.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${t}${r}${a}`}_workerObjectUrl(t){let n;if(t)n=t;else{const r=new Blob([x0],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(t,n=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(t=null){let n;t?n=t:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{const a={access_token:n,version:c0};n&&r.updateJoinPayload(a),r.joinedOnce&&r._isJoined()&&r._push(Cn.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${t}`,n)})}_triggerStateCallbacks(t,n){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${t} callback`,a)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new ny(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Wi.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var n,r,a,i,o,l,c,u,d;if(this.transport=(n=t==null?void 0:t.transport)!==null&&n!==void 0?n:null,this.timeout=(r=t==null?void 0:t.timeout)!==null&&r!==void 0?r:yu,this.heartbeatIntervalMs=(a=t==null?void 0:t.heartbeatIntervalMs)!==null&&a!==void 0?a:Wi.HEARTBEAT_INTERVAL,this.worker=(i=t==null?void 0:t.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=t==null?void 0:t.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=t==null?void 0:t.heartbeatCallback)!==null&&l!==void 0?l:Zl,t!=null&&t.params&&(this.params=t.params),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=t==null?void 0:t.reconnectAfterMs)!==null&&c!==void 0?c:m=>v0[m-1]||w0,this.encode=(u=t==null?void 0:t.encode)!==null&&u!==void 0?u:(m,h)=>h(JSON.stringify(m)),this.decode=(d=t==null?void 0:t.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t==null?void 0:t.workerUrl}}}class zd extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function ut(e){return typeof e=="object"&&e!==null&&"__isStorageError"in e}class k0 extends zd{constructor(t,n,r){super(t),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class wu extends zd{constructor(t,n){super(t),this.name="StorageUnknownError",this.originalError=n}}const Bd=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...n)=>$n(async()=>{const{default:r}=await Promise.resolve().then(()=>cs);return{default:r}},void 0).then(({default:r})=>r(...n)):t=fetch,(...n)=>t(...n)},S0=()=>ge(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield $n(()=>Promise.resolve().then(()=>cs),void 0)).Response:Response}),xu=e=>{if(Array.isArray(e))return e.map(n=>xu(n));if(typeof e=="function"||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));t[a]=xu(r)}),t},N0=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},ec=e=>{var t;return e.msg||e.message||e.error_description||(typeof e.error=="string"?e.error:(t=e.error)===null||t===void 0?void 0:t.message)||JSON.stringify(e)},E0=(e,t,n)=>ge(void 0,void 0,void 0,function*(){const r=yield S0();e instanceof r&&!(n!=null&&n.noResolveJson)?e.json().then(a=>{const i=e.status||500,o=(a==null?void 0:a.statusCode)||i+"";t(new k0(ec(a),i,o))}).catch(a=>{t(new wu(ec(a),a))}):t(new wu(ec(e),e))}),C0=(e,t,n,r)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"||!r?a:(N0(r)?(a.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,t!=null&&t.duplex&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),n))};function _i(e,t,n,r,a,i){return ge(this,void 0,void 0,function*(){return new Promise((o,l)=>{e(n,C0(t,r,a,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>E0(c,l,r))})})}function si(e,t,n,r){return ge(this,void 0,void 0,function*(){return _i(e,"GET",t,n,r)})}function Nn(e,t,n,r,a){return ge(this,void 0,void 0,function*(){return _i(e,"POST",t,r,a,n)})}function ju(e,t,n,r,a){return ge(this,void 0,void 0,function*(){return _i(e,"PUT",t,r,a,n)})}function T0(e,t,n,r){return ge(this,void 0,void 0,function*(){return _i(e,"HEAD",t,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function qd(e,t,n,r,a){return ge(this,void 0,void 0,function*(){return _i(e,"DELETE",t,r,a,n)})}class D0{constructor(t,n){this.downloadFn=t,this.shouldThrowOnError=n}then(t,n){return this.execute().then(t,n)}execute(){return ge(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}})}}var ay;class A0{constructor(t,n){this.downloadFn=t,this.shouldThrowOnError=n,this[ay]="BlobDownloadBuilder",this.promise=null}asStream(){return new D0(this.downloadFn,this.shouldThrowOnError)}then(t,n){return this.getPromise().then(t,n)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return ge(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(ut(t))return{data:null,error:t};throw t}})}}ay=Symbol.toStringTag;const I0={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Tf={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class P0{constructor(t,n={},r,a){this.shouldThrowOnError=!1,this.url=t,this.headers=n,this.bucketId=r,this.fetch=Bd(a)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(t,n,r,a){return ge(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Tf),a);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),a!=null&&a.headers&&(l=Object.assign(Object.assign({},l),a.headers));const u=this._removeEmptyFolders(n),d=this._getFinalPath(u),m=yield(t=="PUT"?ju:Nn)(this.fetch,`${this.url}/object/${d}`,i,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:m.Id,fullPath:m.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(ut(i))return{data:null,error:i};throw i}})}upload(t,n,r){return ge(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,n,r)})}uploadToSignedUrl(t,n,r,a){return ge(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(t),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",n);try{let c;const u=Object.assign({upsert:Tf.upsert},a),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const m=yield ju(this.fetch,l.toString(),c,{headers:d});return{data:{path:i,fullPath:m.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(ut(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,n){return ge(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t);const a=Object.assign({},this.headers);n!=null&&n.upsert&&(a["x-upsert"]="true");const i=yield Nn(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:a}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new zd("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:l},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}update(t,n,r){return ge(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,n,r)})}move(t,n,r){return ge(this,void 0,void 0,function*(){try{return{data:yield Nn(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}copy(t,n,r){return ge(this,void 0,void 0,function*(){try{return{data:{path:(yield Nn(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:n,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}createSignedUrl(t,n,r){return ge(this,void 0,void 0,function*(){try{let a=this._getFinalPath(t),i=yield Nn(this.fetch,`${this.url}/object/sign/${a}`,Object.assign({expiresIn:n},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}createSignedUrls(t,n,r){return ge(this,void 0,void 0,function*(){try{const a=yield Nn(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:t},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:a.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}download(t,n){const a=typeof(n==null?void 0:n.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((n==null?void 0:n.transform)||{}),o=i?`?${i}`:"",l=this._getFinalPath(t),c=()=>si(this.fetch,`${this.url}/${a}/${l}${o}`,{headers:this.headers,noResolveJson:!0});return new A0(c,this.shouldThrowOnError)}info(t){return ge(this,void 0,void 0,function*(){const n=this._getFinalPath(t);try{const r=yield si(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:xu(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}exists(t){return ge(this,void 0,void 0,function*(){const n=this._getFinalPath(t);try{return yield T0(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r)&&r instanceof wu){const a=r.originalError;if([400,404].includes(a==null?void 0:a.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,n){const r=this._getFinalPath(t),a=[],i=n!=null&&n.download?`download=${n.download===!0?"":n.download}`:"";i!==""&&a.push(i);const l=typeof(n==null?void 0:n.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((n==null?void 0:n.transform)||{});c!==""&&a.push(c);let u=a.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${u}`)}}}remove(t){return ge(this,void 0,void 0,function*(){try{return{data:yield qd(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}list(t,n,r){return ge(this,void 0,void 0,function*(){try{const a=Object.assign(Object.assign(Object.assign({},I0),n),{prefix:t||""});return{data:yield Nn(this.fetch,`${this.url}/object/list/${this.bucketId}`,a,{headers:this.headers},r),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}listV2(t,n){return ge(this,void 0,void 0,function*(){try{const r=Object.assign({},t);return{data:yield Nn(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const n=[];return t.width&&n.push(`width=${t.width}`),t.height&&n.push(`height=${t.height}`),t.resize&&n.push(`resize=${t.resize}`),t.format&&n.push(`format=${t.format}`),t.quality&&n.push(`quality=${t.quality}`),n.join("&")}}const iy="2.78.0",oy={"X-Client-Info":`storage-js/${iy}`};class R0{constructor(t,n={},r,a){this.shouldThrowOnError=!1;const i=new URL(t);a!=null&&a.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},oy),n),this.fetch=Bd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(t){return ge(this,void 0,void 0,function*(){try{const n=this.listBucketOptionsToQueryString(t);return{data:yield si(this.fetch,`${this.url}/bucket${n}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}getBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:yield si(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}createBucket(t){return ge(this,arguments,void 0,function*(n,r={public:!1}){try{return{data:yield Nn(this.fetch,`${this.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(ut(a))return{data:null,error:a};throw a}})}updateBucket(t,n){return ge(this,void 0,void 0,function*(){try{return{data:yield ju(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(ut(r))return{data:null,error:r};throw r}})}emptyBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:yield Nn(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}deleteBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:yield qd(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}listBucketOptionsToQueryString(t){const n={};return t&&("limit"in t&&(n.limit=String(t.limit)),"offset"in t&&(n.offset=String(t.offset)),t.search&&(n.search=t.search),t.sortColumn&&(n.sortColumn=t.sortColumn),t.sortOrder&&(n.sortOrder=t.sortOrder)),Object.keys(n).length>0?"?"+new URLSearchParams(n).toString():""}}class O0{constructor(t,n={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},oy),n),this.fetch=Bd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:yield Nn(this.fetch,`${this.url}/bucket`,{name:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}listBuckets(t){return ge(this,void 0,void 0,function*(){try{const n=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&n.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&n.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&n.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&n.set("sortOrder",t.sortOrder),t!=null&&t.search&&n.set("search",t.search);const r=n.toString(),a=r?`${this.url}/bucket?${r}`:`${this.url}/bucket`;return{data:yield si(this.fetch,a,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}deleteBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:yield qd(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(ut(n))return{data:null,error:n};throw n}})}}const Hd={"X-Client-Info":`storage-js/${iy}`,"Content-Type":"application/json"};class ly extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}}function nn(e){return typeof e=="object"&&e!==null&&"__isStorageVectorsError"in e}class tc extends ly{constructor(t,n,r){super(t),this.name="StorageVectorsApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class L0 extends ly{constructor(t,n){super(t),this.name="StorageVectorsUnknownError",this.originalError=n}}var Df;(function(e){e.InternalError="InternalError",e.S3VectorConflictException="S3VectorConflictException",e.S3VectorNotFoundException="S3VectorNotFoundException",e.S3VectorBucketNotEmpty="S3VectorBucketNotEmpty",e.S3VectorMaxBucketsExceeded="S3VectorMaxBucketsExceeded",e.S3VectorMaxIndexesExceeded="S3VectorMaxIndexesExceeded"})(Df||(Df={}));const Wd=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...n)=>$n(async()=>{const{default:r}=await Promise.resolve().then(()=>cs);return{default:r}},void 0).then(({default:r})=>r(...n)):t=fetch,(...n)=>t(...n)},$0=e=>{if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)},Af=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),M0=(e,t,n)=>ge(void 0,void 0,void 0,function*(){if(e&&typeof e=="object"&&"status"in e&&"ok"in e&&typeof e.status=="number"&&!(n!=null&&n.noResolveJson)){const a=e.status||500,i=e;if(typeof i.json=="function")i.json().then(o=>{const l=(o==null?void 0:o.statusCode)||(o==null?void 0:o.code)||a+"";t(new tc(Af(o),a,l))}).catch(()=>{const o=a+"",l=i.statusText||`HTTP ${a} error`;t(new tc(l,a,o))});else{const o=a+"",l=i.statusText||`HTTP ${a} error`;t(new tc(l,a,o))}}else t(new L0(Af(e),e))}),U0=(e,t,n,r)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return r?($0(r)?(a.headers=Object.assign({"Content-Type":"application/json"},t==null?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,Object.assign(Object.assign({},a),n)):a};function F0(e,t,n,r,a,i){return ge(this,void 0,void 0,function*(){return new Promise((o,l)=>{e(n,U0(t,r,a,i)).then(c=>{if(!c.ok)throw c;if(r!=null&&r.noResolveJson)return c;const u=c.headers.get("content-type");return!u||!u.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>M0(c,l,r))})})}function rn(e,t,n,r,a){return ge(this,void 0,void 0,function*(){return F0(e,"POST",t,r,a,n)})}class z0{constructor(t,n={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Hd),n),this.fetch=Wd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createIndex(t){return ge(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/CreateIndex`,t,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}getIndex(t,n){return ge(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/GetIndex`,{vectorBucketName:t,indexName:n},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(nn(r))return{data:null,error:r};throw r}})}listIndexes(t){return ge(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/ListIndexes`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}deleteIndex(t,n){return ge(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/DeleteIndex`,{vectorBucketName:t,indexName:n},{headers:this.headers}))||{},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(nn(r))return{data:null,error:r};throw r}})}}class B0{constructor(t,n={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Hd),n),this.fetch=Wd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}putVectors(t){return ge(this,void 0,void 0,function*(){try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:(yield rn(this.fetch,`${this.url}/PutVectors`,t,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}getVectors(t){return ge(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/GetVectors`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}listVectors(t){return ge(this,void 0,void 0,function*(){try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:yield rn(this.fetch,`${this.url}/ListVectors`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}queryVectors(t){return ge(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/QueryVectors`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}deleteVectors(t){return ge(this,void 0,void 0,function*(){try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:(yield rn(this.fetch,`${this.url}/DeleteVectors`,t,{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}}class q0{constructor(t,n={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Hd),n),this.fetch=Wd(r)}throwOnError(){return this.shouldThrowOnError=!0,this}createBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}getBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:yield rn(this.fetch,`${this.url}/GetVectorBucket`,{vectorBucketName:t},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}listBuckets(){return ge(this,arguments,void 0,function*(t={}){try{return{data:yield rn(this.fetch,`${this.url}/ListVectorBuckets`,t,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}deleteBucket(t){return ge(this,void 0,void 0,function*(){try{return{data:(yield rn(this.fetch,`${this.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:this.headers}))||{},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(nn(n))return{data:null,error:n};throw n}})}}class H0 extends q0{constructor(t,n={}){super(t,n.headers||{},n.fetch)}from(t){return new W0(this.url,this.headers,t,this.fetch)}}class W0 extends z0{constructor(t,n,r,a){super(t,n,a),this.vectorBucketName=r}createIndex(t){const n=Object.create(null,{createIndex:{get:()=>super.createIndex}});return ge(this,void 0,void 0,function*(){return n.createIndex.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName}))})}listIndexes(){const t=Object.create(null,{listIndexes:{get:()=>super.listIndexes}});return ge(this,arguments,void 0,function*(n={}){return t.listIndexes.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName}))})}getIndex(t){const n=Object.create(null,{getIndex:{get:()=>super.getIndex}});return ge(this,void 0,void 0,function*(){return n.getIndex.call(this,this.vectorBucketName,t)})}deleteIndex(t){const n=Object.create(null,{deleteIndex:{get:()=>super.deleteIndex}});return ge(this,void 0,void 0,function*(){return n.deleteIndex.call(this,this.vectorBucketName,t)})}index(t){return new V0(this.url,this.headers,this.vectorBucketName,t,this.fetch)}}class V0 extends B0{constructor(t,n,r,a,i){super(t,n,i),this.vectorBucketName=r,this.indexName=a}putVectors(t){const n=Object.create(null,{putVectors:{get:()=>super.putVectors}});return ge(this,void 0,void 0,function*(){return n.putVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}getVectors(t){const n=Object.create(null,{getVectors:{get:()=>super.getVectors}});return ge(this,void 0,void 0,function*(){return n.getVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}listVectors(){const t=Object.create(null,{listVectors:{get:()=>super.listVectors}});return ge(this,arguments,void 0,function*(n={}){return t.listVectors.call(this,Object.assign(Object.assign({},n),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}queryVectors(t){const n=Object.create(null,{queryVectors:{get:()=>super.queryVectors}});return ge(this,void 0,void 0,function*(){return n.queryVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}deleteVectors(t){const n=Object.create(null,{deleteVectors:{get:()=>super.deleteVectors}});return ge(this,void 0,void 0,function*(){return n.deleteVectors.call(this,Object.assign(Object.assign({},t),{vectorBucketName:this.vectorBucketName,indexName:this.indexName}))})}}class G0 extends R0{constructor(t,n={},r,a){super(t,n,r,a)}from(t){return new P0(this.url,this.headers,t,this.fetch)}get vectors(){return new H0(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new O0(this.url+"/iceberg",this.headers,this.fetch)}}const K0="2.78.0";let Sa="";typeof Deno<"u"?Sa="deno":typeof document<"u"?Sa="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Sa="react-native":Sa="node";const J0={"X-Client-Info":`supabase-js-${Sa}/${K0}`},Y0={headers:J0},Q0={schema:"public"},X0={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Z0={},ex=e=>{let t;return e?t=e:typeof fetch>"u"?t=$_:t=fetch,(...n)=>t(...n)},tx=()=>typeof Headers>"u"?M_:Headers,nx=(e,t,n)=>{const r=ex(n),a=tx();return async(i,o)=>{var l;const c=(l=await t())!==null&&l!==void 0?l:e;let u=new a(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",e),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:u}))}};function rx(e){return e.endsWith("/")?e:e+"/"}function sx(e,t){var n,r;const{db:a,auth:i,realtime:o,global:l}=e,{db:c,auth:u,realtime:d,global:m}=t,h={db:Object.assign(Object.assign({},c),a),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},d),o),storage:{},global:Object.assign(Object.assign(Object.assign({},m),l),{headers:Object.assign(Object.assign({},(n=m==null?void 0:m.headers)!==null&&n!==void 0?n:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}function ax(e){const t=e==null?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(rx(t))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const cy="2.78.0",bs=30*1e3,ku=3,nc=ku*bs,ix="http://localhost:9999",ox="supabase.auth.token",lx={"X-Client-Info":`gotrue-js/${cy}`},Su="X-Supabase-Api-Version",uy={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},cx=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ux=10*60*1e3;class ai extends Error{constructor(t,n,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function ve(e){return typeof e=="object"&&e!==null&&"__isAuthError"in e}class dx extends ai{constructor(t,n,r){super(t,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function hx(e){return ve(e)&&e.name==="AuthApiError"}class Vr extends ai{constructor(t,n){super(t),this.name="AuthUnknownError",this.originalError=n}}class Dr extends ai{constructor(t,n,r,a){super(t,r,a),this.name=n,this.status=r}}class jn extends Dr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function fx(e){return ve(e)&&e.name==="AuthSessionMissingError"}class hs extends Dr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Vi extends Dr{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class Gi extends Dr{constructor(t,n=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function mx(e){return ve(e)&&e.name==="AuthImplicitGrantRedirectError"}class If extends Dr{constructor(t,n=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Nu extends Dr{constructor(t,n){super(t,"AuthRetryableFetchError",n,void 0)}}function rc(e){return ve(e)&&e.name==="AuthRetryableFetchError"}class Pf extends Dr{constructor(t,n,r){super(t,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class Eu extends Dr{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ko="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rf=` 	
\r=`.split(""),px=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Rf.length;t+=1)e[Rf[t].charCodeAt(0)]=-2;for(let t=0;t<Ko.length;t+=1)e[Ko[t].charCodeAt(0)]=t;return e})();function Of(e,t,n){if(e!==null)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;n(Ko[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;n(Ko[r]),t.queuedBits-=6}}function dy(e,t,n){const r=px[e];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)n(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}}function Lf(e){const t=[],n=o=>{t.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=o=>{yx(o,r,n)};for(let o=0;o<e.length;o+=1)dy(e.charCodeAt(o),a,i);return t.join("")}function gx(e,t){if(e<=127){t(e);return}else if(e<=2047){t(192|e>>6),t(128|e&63);return}else if(e<=65535){t(224|e>>12),t(128|e>>6&63),t(128|e&63);return}else if(e<=1114111){t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),t(128|e&63);return}throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}function _x(e,t){for(let n=0;n<e.length;n+=1){let r=e.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(e.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}gx(r,t)}}function yx(e,t,n){if(t.utf8seq===0){if(e<=127){n(e);return}for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=e&31;else if(t.utf8seq===3)t.codepoint=e&15;else if(t.utf8seq===4)t.codepoint=e&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|e&63,t.utf8seq-=1,t.utf8seq===0&&n(t.codepoint)}}function zs(e){const t=[],n={queue:0,queuedBits:0},r=a=>{t.push(a)};for(let a=0;a<e.length;a+=1)dy(e.charCodeAt(a),n,r);return new Uint8Array(t)}function bx(e){const t=[];return _x(e,n=>t.push(n)),new Uint8Array(t)}function Yr(e){const t=[],n={queue:0,queuedBits:0},r=a=>{t.push(a)};return e.forEach(a=>Of(a,n,r)),Of(null,n,r),t.join("")}function vx(e){return Math.round(Date.now()/1e3)+e}function wx(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e=="x"?t:t&3|8).toString(16)})}const Mt=()=>typeof window<"u"&&typeof document<"u",Lr={tested:!1,writable:!1},hy=()=>{if(!Mt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Lr.tested)return Lr.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Lr.tested=!0,Lr.writable=!0}catch{Lr.tested=!0,Lr.writable=!1}return Lr.writable};function xx(e){const t={},n=new URL(e);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,i)=>{t[i]=a})}catch{}return n.searchParams.forEach((r,a)=>{t[a]=r}),t}const fy=e=>{let t;return e?t=e:typeof fetch>"u"?t=(...n)=>$n(async()=>{const{default:r}=await Promise.resolve().then(()=>cs);return{default:r}},void 0).then(({default:r})=>r(...n)):t=fetch,(...n)=>t(...n)},jx=e=>typeof e=="object"&&e!==null&&"status"in e&&"ok"in e&&"json"in e&&typeof e.json=="function",vs=async(e,t,n)=>{await e.setItem(t,JSON.stringify(n))},$r=async(e,t)=>{const n=await e.getItem(t);if(!n)return null;try{return JSON.parse(n)}catch{return n}},ir=async(e,t)=>{await e.removeItem(t)};class wl{constructor(){this.promise=new wl.promiseConstructor((t,n)=>{this.resolve=t,this.reject=n})}}wl.promiseConstructor=Promise;function sc(e){const t=e.split(".");if(t.length!==3)throw new Eu("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!cx.test(t[r]))throw new Eu("JWT not in base64url format");return{header:JSON.parse(Lf(t[0])),payload:JSON.parse(Lf(t[1])),signature:zs(t[2]),raw:{header:t[0],payload:t[1]}}}async function kx(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function Sx(e,t){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await e(i);if(!t(i,null,o)){r(o);return}}catch(o){if(!t(i,o)){a(o);return}}})()})}function Nx(e){return("0"+e.toString(16)).substr(-2)}function Ex(){const t=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let i=0;i<56;i++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(t),Array.from(t,Nx).join("")}async function Cx(e){const n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function Tx(e){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const n=await Cx(e);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function fs(e,t,n=!1){const r=Ex();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await vs(e,`${t}-code-verifier`,a);const i=await Tx(r);return[i,r===i?"plain":"s256"]}const Dx=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ax(e){const t=e.headers.get(Su);if(!t||!t.match(Dx))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function Ix(e){if(!e)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(e<=t)throw new Error("JWT has expired")}function Px(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Rx=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ms(e){if(!Rx.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ac(){const e={};return new Proxy(e,{get:(t,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Ox(e,t){return new Proxy(e,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!t.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t.value=!0),Reflect.get(n,r,a)}})}function $f(e){return JSON.parse(JSON.stringify(e))}const qr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Lx=[502,503,504];async function Mf(e){var t;if(!jx(e))throw new Nu(qr(e),0);if(Lx.includes(e.status))throw new Nu(qr(e),e.status);let n;try{n=await e.json()}catch(i){throw new Vr(qr(i),i)}let r;const a=Ax(e);if(a&&a.getTime()>=uy["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new Pf(qr(n),e.status,((t=n.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new jn}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Pf(qr(n),e.status,n.weak_password.reasons);throw new dx(qr(n),e.status||500,r)}const $x=(e,t,n,r)=>{const a={method:e,headers:(t==null?void 0:t.headers)||{}};return e==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t==null?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function Ee(e,t,n,r){var a;const i=Object.assign({},r==null?void 0:r.headers);i[Su]||(i[Su]=uy["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(a=r==null?void 0:r.query)!==null&&a!==void 0?a:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Mx(e,t,n+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Mx(e,t,n,r,a,i){const o=$x(t,r,a,i);let l;try{l=await e(n,Object.assign({},o))}catch(c){throw console.error(c),new Nu(qr(c),0)}if(l.ok||await Mf(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await Mf(c)}}function kn(e){var t;let n=null;zx(e)&&(n=Object.assign({},e),e.expires_at||(n.expires_at=vx(e.expires_in)));const r=(t=e.user)!==null&&t!==void 0?t:e;return{data:{session:n,user:r},error:null}}function Uf(e){const t=kn(e);return!t.error&&e.weak_password&&typeof e.weak_password=="object"&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&typeof e.weak_password.message=="string"&&e.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(t.data.weak_password=e.weak_password),t}function fr(e){var t;return{data:{user:(t=e.user)!==null&&t!==void 0?t:e},error:null}}function Ux(e){return{data:e,error:null}}function Fx(e){const{action_link:t,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i}=e,o=ra(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Ff(e){return e}function zx(e){return e.access_token&&e.refresh_token&&e.expires_in}const ic=["global","local","others"];class Bx{constructor({url:t="",headers:n={},fetch:r}){this.url=t,this.headers=n,this.fetch=fy(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(t,n=ic[0]){if(ic.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ic.join(", ")}`);try{return await Ee(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ve(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,n={}){try{return await Ee(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:fr})}catch(r){if(ve(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:n}=t,r=ra(t,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r==null?void 0:r.newEmail,delete a.newEmail),await Ee(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:Fx,redirectTo:n==null?void 0:n.redirectTo})}catch(n){if(ve(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(t){try{return await Ee(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:fr})}catch(n){if(ve(n))return{data:{user:null},error:n};throw n}}async listUsers(t){var n,r,a,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await Ee(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=t==null?void 0:t.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Ff});if(d.error)throw d.error;const m=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,b=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return b.length>0&&(b.forEach(y=>{const g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(y.split(";")[1].split("=")[1]);u[`${w}Page`]=g}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},m),u),error:null}}catch(u){if(ve(u))return{data:{users:[]},error:u};throw u}}async getUserById(t){ms(t);try{return await Ee(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:fr})}catch(n){if(ve(n))return{data:{user:null},error:n};throw n}}async updateUserById(t,n){ms(t);try{return await Ee(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:n,headers:this.headers,xform:fr})}catch(r){if(ve(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,n=!1){ms(t);try{return await Ee(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:n},xform:fr})}catch(r){if(ve(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){ms(t.userId);try{const{data:n,error:r}=await Ee(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _deleteFactor(t){ms(t.userId),ms(t.id);try{return{data:await Ee(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _listOAuthClients(t){var n,r,a,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await Ee(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=t==null?void 0:t.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=t==null?void 0:t.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Ff});if(d.error)throw d.error;const m=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,b=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return b.length>0&&(b.forEach(y=>{const g=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(y.split(";")[1].split("=")[1]);u[`${w}Page`]=g}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},m),u),error:null}}catch(u){if(ve(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(t){try{return await Ee(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _getOAuthClient(t){try{return await Ee(this.fetch,"GET",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _updateOAuthClient(t,n){try{return await Ee(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${t}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ve(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(t){try{return await Ee(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${t}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(t){try{return await Ee(this.fetch,"POST",`${this.url}/admin/oauth/clients/${t}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ve(n))return{data:null,error:n};throw n}}}function zf(e={}){return{getItem:t=>e[t]||null,setItem:(t,n)=>{e[t]=n},removeItem:t=>{delete e[t]}}}const ps={debug:!!(globalThis&&hy()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class my extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class qx extends my{}async function Hx(e,t,n){ps.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),ps.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){ps.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,a.name);try{return await n()}finally{ps.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,a.name)}}else{if(t===0)throw ps.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new qx(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ps.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function Wx(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function py(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Vx(e){return parseInt(e,16)}function Gx(e){const t=new TextEncoder().encode(e);return"0x"+Array.from(t,r=>r.toString(16).padStart(2,"0")).join("")}function Kx(e){var t;const{chainId:n,domain:r,expirationTime:a,issuedAt:i=new Date,nonce:o,notBefore:l,requestId:c,resources:u,scheme:d,uri:m,version:h}=e;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!m)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((t=e.statement)===null||t===void 0)&&t.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`)}const b=py(e.address),y=d?`${d}://${r}`:r,g=e.statement?`${e.statement}
`:"",w=`${y} wants you to sign in with your Ethereum account:
${b}

${g}`;let p=`URI: ${m}
Version: ${h}
Chain ID: ${n}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(a&&(p+=`
Expiration Time: ${a.toISOString()}`),l&&(p+=`
Not Before: ${l.toISOString()}`),c&&(p+=`
Request ID: ${c}`),u){let _=`
Resources:`;for(const v of u){if(!v||typeof v!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${v}`);_+=`
- ${v}`}p+=_}return`${w}
${p}`}class yt extends Error{constructor({message:t,code:n,cause:r,name:a}){var i;super(t,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=a??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class Jo extends yt{constructor(t,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:t}),this.name="WebAuthnUnknownError",this.originalError=n}}function Jx({error:e,options:t}){var n,r,a;const{publicKey:i}=t;if(!i)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new yt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if(e.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new yt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if(t.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new yt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if(((a=i.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new yt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if(e.name==="InvalidStateError")return new yt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if(e.name==="NotAllowedError")return new yt({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="NotSupportedError")return i.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new yt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new yt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if(e.name==="SecurityError"){const o=window.location.hostname;if(gy(o)){if(i.rp.id!==o)return new yt({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new yt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new yt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if(e.name==="UnknownError")return new yt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new yt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Yx({error:e,options:t}){const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal instanceof AbortSignal)return new yt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if(e.name==="NotAllowedError")return new yt({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if(e.name==="SecurityError"){const r=window.location.hostname;if(gy(r)){if(n.rpId!==r)return new yt({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else return new yt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e})}else if(e.name==="UnknownError")return new yt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new yt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}class Qx{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const t=new AbortController;return this.controller=t,t.signal}cancelCeremony(){if(this.controller){const t=new Error("Manually cancelling existing WebAuthn API call");t.name="AbortError",this.controller.abort(t),this.controller=void 0}}}const Xx=new Qx;function Zx(e){if(!e)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:n,excludeCredentials:r}=e,a=ra(e,["challenge","user","excludeCredentials"]),i=zs(t).buffer,o=Object.assign(Object.assign({},n),{id:zs(n.id).buffer}),l=Object.assign(Object.assign({},a),{challenge:i,user:o});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let c=0;c<r.length;c++){const u=r[c];l.excludeCredentials[c]=Object.assign(Object.assign({},u),{id:zs(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return l}function ej(e){if(!e)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:n}=e,r=ra(e,["challenge","allowCredentials"]),a=zs(t).buffer,i=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let o=0;o<n.length;o++){const l=n[o];i.allowCredentials[o]=Object.assign(Object.assign({},l),{id:zs(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return i}function tj(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e;return{id:e.id,rawId:e.id,response:{attestationObject:Yr(new Uint8Array(e.response.attestationObject)),clientDataJSON:Yr(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function nj(e){var t;if("toJSON"in e&&typeof e.toJSON=="function")return e.toJSON();const n=e,r=e.getClientExtensionResults(),a=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:Yr(new Uint8Array(a.authenticatorData)),clientDataJSON:Yr(new Uint8Array(a.clientDataJSON)),signature:Yr(new Uint8Array(a.signature)),userHandle:a.userHandle?Yr(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(t=n.authenticatorAttachment)!==null&&t!==void 0?t:void 0}}function gy(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Bf(){var e,t;return!!(Mt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.create)=="function"&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.get)=="function")}async function rj(e){try{const t=await navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Jo("Browser returned unexpected credential type",t)}:{data:null,error:new Jo("Empty credential response",t)}}catch(t){return{data:null,error:Jx({error:t,options:e})}}}async function sj(e){try{const t=await navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Jo("Browser returned unexpected credential type",t)}:{data:null,error:new Jo("Empty credential response",t)}}catch(t){return{data:null,error:Yx({error:t,options:e})}}}const aj={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},ij={userVerification:"preferred",hints:["security-key"]};function Yo(...e){const t=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of e)if(a)for(const i in a){const o=a[i];if(o!==void 0)if(Array.isArray(o))r[i]=o;else if(n(o))r[i]=o;else if(t(o)){const l=r[i];t(l)?r[i]=Yo(l,o):r[i]=Yo(o)}else r[i]=o}return r}function oj(e,t){return Yo(aj,e,t||{})}function lj(e,t){return Yo(ij,e,t||{})}class cj{constructor(t){this.client=t,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(t){return this.client.mfa.enroll(Object.assign(Object.assign({},t),{factorType:"webauthn"}))}async _challenge({factorId:t,webauthn:n,friendlyName:r,signal:a},i){try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:t,webauthn:n});if(!o)return{data:null,error:l};const c=a??Xx.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${r}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=oj(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:m}=await rj({publicKey:u,signal:c});return d?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:m}}case"request":{const u=lj(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:m}=await sj(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:c}));return d?{data:{factorId:t,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:m}}}}catch(o){return ve(o)?{data:null,error:o}:{data:null,error:new Vr("Unexpected error in challenge",o)}}}async _verify({challengeId:t,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:t,webauthn:r})}async _authenticate({factorId:t,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}},i){if(!n)return{data:null,error:new ai("rpId is required for WebAuthn authentication")};try{if(!Bf())return{data:null,error:new Vr("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:t,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:i});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:t,challengeId:o.challengeId,webauthn:{type:c.type,rpId:n,rpOrigins:r,credential_response:c.credential_response}})}catch(o){return ve(o)?{data:null,error:o}:{data:null,error:new Vr("Unexpected error in authenticate",o)}}}async _register({friendlyName:t,rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a},i){if(!n)return{data:null,error:new ai("rpId is required for WebAuthn registration")};try{if(!Bf())return{data:null,error:new Vr("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:t});if(!o)return await this.client.mfa.listFactors().then(d=>{var m;return(m=d.data)===null||m===void 0?void 0:m.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===t&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:l};const{data:c,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:i});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:n,rpOrigins:r,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:u}}catch(o){return ve(o)?{data:null,error:o}:{data:null,error:new Vr("Unexpected error in register",o)}}}}Wx();const uj={url:ix,storageKey:ox,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:lx,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function qf(e,t,n){return await n()}const gs={};class ii{get jwks(){var t,n;return(n=(t=gs[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(t){gs[this.storageKey]=Object.assign(Object.assign({},gs[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,n;return(n=(t=gs[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){gs[this.storageKey]=Object.assign(Object.assign({},gs[this.storageKey]),{cachedAt:t})}constructor(t){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ii.nextInstanceID,ii.nextInstanceID+=1,this.instanceID>0&&Mt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const a=Object.assign(Object.assign({},uj),t);if(this.logDebugMessages=!!a.debug,typeof a.debug=="function"&&(this.logger=a.debug),this.persistSession=a.persistSession,this.storageKey=a.storageKey,this.autoRefreshToken=a.autoRefreshToken,this.admin=new Bx({url:a.url,headers:a.headers,fetch:a.fetch}),this.url=a.url,this.headers=a.headers,this.fetch=fy(a.fetch),this.lock=a.lock||qf,this.detectSessionInUrl=a.detectSessionInUrl,this.flowType=a.flowType,this.hasCustomAuthorizationHeader=a.hasCustomAuthorizationHeader,a.lock?this.lock=a.lock:Mt()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=Hx:this.lock=qf,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new cj(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this)},this.persistSession?(a.storage?this.storage=a.storage:hy()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=zf(this.memoryStorage)),a.userStorage&&(this.userStorage=a.userStorage)):(this.memoryStorage={},this.storage=zf(this.memoryStorage)),Mt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${cy}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const n=xx(window.location.href);let r="none";if(this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce"),Mt()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),mx(i)){const c=(t=i.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=a;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return ve(n)?{error:n}:{error:new Vr("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var n,r,a;try{const i=await Ee(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=t==null?void 0:t.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=t==null?void 0:t.options)===null||a===void 0?void 0:a.captchaToken}},xform:kn}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(ve(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(t){var n,r,a;try{let i;if("email"in t){const{email:d,password:m,options:h}=t;let b=null,y=null;this.flowType==="pkce"&&([b,y]=await fs(this.storage,this.storageKey)),i=await Ee(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:m,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:b,code_challenge_method:y},xform:kn})}else if("phone"in t){const{phone:d,password:m,options:h}=t;i=await Ee(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:m,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},channel:(a=h==null?void 0:h.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:kn})}else throw new Vi("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(ve(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(t){try{let n;if("email"in t){const{email:i,password:o,options:l}=t;n=await Ee(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Uf})}else if("phone"in t){const{phone:i,password:o,options:l}=t;n=await Ee(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Uf})}else throw new Vi("You must provide either an email or phone number and a password");const{data:r,error:a}=n;return a?{data:{user:null,session:null},error:a}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new hs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(ve(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(t){var n,r,a,i;return await this._handleProviderSignIn(t.provider,{redirectTo:(n=t.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=t.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=t.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:n}=t;switch(n){case"ethereum":return await this.signInWithEthereum(t);case"solana":return await this.signInWithSolana(t);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(t){var n,r,a,i,o,l,c,u,d,m,h;let b,y;if("message"in t)b=t.message,y=t.signature;else{const{chain:g,wallet:w,statement:p,options:_}=t;let v;if(Mt())if(typeof w=="object")v=w;else{const P=window;if("ethereum"in P&&typeof P.ethereum=="object"&&"request"in P.ethereum&&typeof P.ethereum.request=="function")v=P.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof w!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=w}const x=new URL((n=_==null?void 0:_.url)!==null&&n!==void 0?n:window.location.href),j=await v.request({method:"eth_requestAccounts"}).then(P=>P).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!j||j.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=py(j[0]);let S=(r=_==null?void 0:_.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!S){const P=await v.request({method:"eth_chainId"});S=Vx(P)}const A={domain:x.host,address:k,statement:p,uri:x.href,version:"1",chainId:S,nonce:(a=_==null?void 0:_.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(o=(i=_==null?void 0:_.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=_==null?void 0:_.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=_==null?void 0:_.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(u=_==null?void 0:_.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=_==null?void 0:_.signInWithEthereum)===null||d===void 0?void 0:d.resources};b=Kx(A),y=await v.request({method:"personal_sign",params:[Gx(b),k]})}try{const{data:g,error:w}=await Ee(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:b,signature:y},!((m=t.options)===null||m===void 0)&&m.captchaToken?{gotrue_meta_security:{captcha_token:(h=t.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:kn});if(w)throw w;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new hs}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:w})}catch(g){if(ve(g))return{data:{user:null,session:null},error:g};throw g}}async signInWithSolana(t){var n,r,a,i,o,l,c,u,d,m,h,b;let y,g;if("message"in t)y=t.message,g=t.signature;else{const{chain:w,wallet:p,statement:_,options:v}=t;let x;if(Mt())if(typeof p=="object")x=p;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))x=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof p!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=p}const j=new URL((n=v==null?void 0:v.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in x&&x.signIn){const k=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},v==null?void 0:v.signInWithSolana),{version:"1",domain:j.host,uri:j.href}),_?{statement:_}:null));let S;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")S=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)S=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in S&&"signature"in S&&(typeof S.signedMessage=="string"||S.signedMessage instanceof Uint8Array)&&S.signature instanceof Uint8Array)y=typeof S.signedMessage=="string"?S.signedMessage:new TextDecoder().decode(S.signedMessage),g=S.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${j.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${j.href}`,`Issued At: ${(a=(r=v==null?void 0:v.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=v==null?void 0:v.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${v.signInWithSolana.notBefore}`]:[],...!((o=v==null?void 0:v.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${v.signInWithSolana.expirationTime}`]:[],...!((l=v==null?void 0:v.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${v.signInWithSolana.chainId}`]:[],...!((c=v==null?void 0:v.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${v.signInWithSolana.nonce}`]:[],...!((u=v==null?void 0:v.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${v.signInWithSolana.requestId}`]:[],...!((m=(d=v==null?void 0:v.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||m===void 0)&&m.length?["Resources",...v.signInWithSolana.resources.map(S=>`- ${S}`)]:[]].join(`
`);const k=await x.signMessage(new TextEncoder().encode(y),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");g=k}}try{const{data:w,error:p}=await Ee(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:Yr(g)},!((h=t.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(b=t.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:kn});if(p)throw p;return!w||!w.session||!w.user?{data:{user:null,session:null},error:new hs}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:Object.assign({},w),error:p})}catch(w){if(ve(w))return{data:{user:null,session:null},error:w};throw w}}async _exchangeCodeForSession(t){const n=await $r(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{const{data:i,error:o}=await Ee(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:kn});if(await ir(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new hs}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:o})}catch(i){if(ve(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(t){try{const{options:n,provider:r,token:a,access_token:i,nonce:o}=t,l=await Ee(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},xform:kn}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new hs}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(n){if(ve(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(t){var n,r,a,i,o;try{if("email"in t){const{email:l,options:c}=t;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await fs(this.storage,this.storageKey));const{error:m}=await Ee(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:m}}if("phone"in t){const{phone:l,options:c}=t,{data:u,error:d}=await Ee(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(a=c==null?void 0:c.data)!==null&&a!==void 0?a:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new Vi("You must provide either an email or phone number.")}catch(l){if(ve(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var n,r;try{let a,i;"options"in t&&(a=(n=t.options)===null||n===void 0?void 0:n.redirectTo,i=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await Ee(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:kn});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(a){if(ve(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(t){var n,r,a;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await fs(this.storage,this.storageKey)),await Ee(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(n=t.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=t==null?void 0:t.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Ux})}catch(i){if(ve(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:n},error:r}=t;if(r)throw r;if(!n)throw new jn;const{error:a}=await Ee(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:a}})}catch(t){if(ve(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const n=`${this.url}/resend`;if("email"in t){const{email:r,type:a,options:i}=t,{error:o}=await Ee(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in t){const{phone:r,type:a,options:i}=t,{data:o,error:l}=await Ee(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Vi("You must provide either an email or phone number and a type")}catch(n){if(ve(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(t,n){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await t(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const n=await $r(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?t=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<nc:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const o=await $r(this.userStorage,this.storageKey+"-user");o!=null&&o.user?t.user=o.user:t.user=ac()}if(this.storage.isServer&&t.user&&!t.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};t.user=Ox(t.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:t},error:null}}const{data:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{session:null},error:i}:{data:{session:a},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await Ee(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:fr}):await this._useSession(async n=>{var r,a,i;const{data:o,error:l}=n;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new jn}:await Ee(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=o.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:fr})})}catch(n){if(ve(n))return fx(n)&&(await this._removeSession(),await ir(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(t,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,n))}async _updateUser(t,n={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new jn;const o=a.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await fs(this.storage,this.storageKey));const{data:u,error:d}=await Ee(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n==null?void 0:n.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:fr});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(ve(r))return{data:{user:null},error:r};throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new jn;const n=Date.now()/1e3;let r=n,a=!0,i=null;const{payload:o}=sc(t.access_token);if(o.exp&&(r=o.exp,a=r<=n),a){const{data:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;i={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(n){if(ve(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async n=>{var r;if(!t){const{data:o,error:l}=n;if(l)throw l;t=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(t!=null&&t.refresh_token))throw new jn;const{data:a,error:i}=await this._callRefreshToken(t.refresh_token);return i?{data:{user:null,session:null},error:i}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(ve(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(t,n){try{if(!Mt())throw new Gi("No browser detected.");if(t.error||t.error_description||t.error_code)throw new Gi(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new If("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Gi("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new If("No code detected.");const{data:_,error:v}=await this._exchangeCodeForSession(t.code);if(v)throw v;const x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=t;if(!i||!l||!o||!u)throw new Gi("No session defined in URL");const d=Math.round(Date.now()/1e3),m=parseInt(l);let h=d+m;c&&(h=parseInt(c));const b=h-d;b*1e3<=bs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${b}s, should have been closer to ${m}s`);const y=h-m;d-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,h,d):d-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,h,d);const{data:g,error:w}=await this._getUser(i);if(w)throw w;const p={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:m,expires_at:h,refresh_token:o,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:p,redirectType:t.type},error:null}}catch(r){if(ve(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const n=await $r(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&n)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return{error:i};const o=(r=a.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,t);if(l&&!(hx(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await ir(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const n=wx(),r={id:n,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async n=>{var r,a;try{const{data:{session:i},error:o}=n;if(o)throw o;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",t,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(t))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",i),console.error(i)}})}async resetPasswordForEmail(t,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await fs(this.storage,this.storageKey,!0));try{return await Ee(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(ve(i))return{data:null,error:i};throw i}}async getUserIdentities(){var t;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(t=n.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(n){if(ve(n))return{data:null,error:n};throw n}}async linkIdentity(t){return"token"in t?this.linkIdentityIdToken(t):this.linkIdentityOAuth(t)}async linkIdentityOAuth(t){var n;try{const{data:r,error:a}=await this._useSession(async i=>{var o,l,c,u,d;const{data:m,error:h}=i;if(h)throw h;const b=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Ee(this.fetch,"GET",b,{headers:this.headers,jwt:(d=(u=m.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(a)throw a;return Mt()&&!(!((n=t.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:t.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(ve(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async linkIdentityIdToken(t){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:i}}=n;if(a)throw a;const{options:o,provider:l,token:c,access_token:u,nonce:d}=t,m=await Ee(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i==null?void 0:i.access_token)!==null&&r!==void 0?r:void 0,body:{provider:l,id_token:c,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:kn}),{data:h,error:b}=m;return b?{data:{user:null,session:null},error:b}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new hs}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),{data:h,error:b})}catch(a){if(ve(a))return{data:{user:null,session:null},error:a};throw a}})}async unlinkIdentity(t){try{return await this._useSession(async n=>{var r,a;const{data:i,error:o}=n;if(o)throw o;return await Ee(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _refreshAccessToken(t){const n=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await Sx(async a=>(a>0&&await kx(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await Ee(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:kn})),(a,i)=>{const o=200*Math.pow(2,a);return i&&rc(i)&&Date.now()+o-r<bs})}catch(r){if(this._debug(n,"error",r),ve(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",n,"url",r),Mt()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await $r(this.storage,this.storageKey);if(a&&this.userStorage){let o=await $r(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:a.user},await vs(this.userStorage,this.storageKey+"-user",o)),a.user=(t=o==null?void 0:o.user)!==null&&t!==void 0?t:ac()}else if(a&&!a.user&&!a.user){const o=await $r(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(a.user=o.user,await ir(this.storage,this.storageKey+"-user"),await vs(this.storage,this.storageKey,a)):a.user=ac()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<nc;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${nc}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:o}=await this._callRefreshToken(a.refresh_token);o&&(console.error(o),rc(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(a.access_token);!l&&(o!=null&&o.user)?(a.user=o.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var n,r;if(!t)throw new jn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new wl;const{data:i,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!i.session)throw new jn;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={data:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(a,"error",i),ve(i)){const o={data:null,error:i};return rc(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(t,n,r=!0){const a=`#_notifyAllSubscribers(${t})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:n});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,n)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const n=Object.assign({},t),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await vs(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const i=$f(a);await vs(this.storage,this.storageKey,i)}else{const a=$f(n);await vs(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),await ir(this.storage,this.storageKey),await ir(this.storage,this.storageKey+"-code-verifier"),await ir(this.storage,this.storageKey+"-user"),this.userStorage&&await ir(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Mt()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",t)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),bs);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-t)/bs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${bs}ms, refresh threshold is ${ku} ticks`),a<=ku&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof my)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Mt()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const n=`#_onVisibilityChanged(${t})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r!=null&&r.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await fs(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});a.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${a.join("&")}`}async _unenroll(t){try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;return i?{data:null,error:i}:await Ee(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _enroll(t){try{return await this._useSession(async n=>{var r,a;const{data:i,error:o}=n;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:t.factorType==="totp"?{issuer:t.issuer}:{}),{data:c,error:u}=await Ee(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(t.factorType==="totp"&&c.type==="totp"&&(!((a=c==null?void 0:c.totp)===null||a===void 0)&&a.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return{data:null,error:i};const o=Object.assign({challenge_id:t.challengeId},"webauthn"in t?{webauthn:Object.assign(Object.assign({},t.webauthn),{credential_response:t.webauthn.type==="create"?tj(t.webauthn.credential_response):nj(t.webauthn.credential_response)})}:{code:t.code}),{data:l,error:c}=await Ee(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:o,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),{data:l,error:c})})}catch(n){if(ve(n))return{data:null,error:n};throw n}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return{data:null,error:i};const o=await Ee(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:t,headers:this.headers,jwt:(r=a==null?void 0:a.session)===null||r===void 0?void 0:r.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:Zx(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:ej(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(ve(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(t){const{data:n,error:r}=await this._challenge({factorId:t.factorId});return r?{data:null,error:r}:await this._verify({factorId:t.factorId,challengeId:n.id,code:t.code})}async _listFactors(){var t;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const i of(t=n==null?void 0:n.factors)!==null&&t!==void 0?t:[])a.all.push(i),i.status==="verified"&&a[i.factor_type].push(i);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(){var t,n;const{data:{session:r},error:a}=await this.getSession();if(a)return{data:null,error:a};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=sc(r.access_token);let o=null;i.aal&&(o=i.aal);let l=o;((n=(t=r.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(l="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(t){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?{data:null,error:a}:r?await Ee(this.fetch,"GET",`${this.url}/oauth/authorizations/${t}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):{data:null,error:new jn}})}catch(n){if(ve(n))return{data:null,error:n};throw n}}async _approveAuthorization(t,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return{data:null,error:i};if(!a)return{data:null,error:new jn};const o=await Ee(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(ve(r))return{data:null,error:r};throw r}}async _denyAuthorization(t,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return{data:null,error:i};if(!a)return{data:null,error:new jn};const o=await Ee(this.fetch,"POST",`${this.url}/oauth/authorizations/${t}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&Mt()&&!(n!=null&&n.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(r){if(ve(r))return{data:null,error:r};throw r}}async fetchJwk(t,n={keys:[]}){let r=n.keys.find(l=>l.kid===t);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(l=>l.kid===t),r&&this.jwks_cached_at+ux>a)return r;const{data:i,error:o}=await Ee(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(l=>l.kid===t),!r)?null:r}async getClaims(t,n={}){try{let r=t;if(!r){const{data:b,error:y}=await this.getSession();if(y||!b.session)return{data:null,error:y};r=b.session.access_token}const{header:a,payload:i,signature:o,raw:{header:l,payload:c}}=sc(r);n!=null&&n.allowExpired||Ix(i.exp);const u=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n!=null&&n.keys?{keys:n.keys}:n==null?void 0:n.jwks);if(!u){const{error:b}=await this.getUser(r);if(b)throw b;return{data:{claims:i,header:a,signature:o},error:null}}const d=Px(a.alg),m=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,m,o,bx(`${l}.${c}`)))throw new Eu("Invalid JWT signature");return{data:{claims:i,header:a,signature:o},error:null}}catch(r){if(ve(r))return{data:null,error:r};throw r}}}ii.nextInstanceID=0;const dj=ii;class hj extends dj{constructor(t){super(t)}}class fj{constructor(t,n,r){var a,i,o;this.supabaseUrl=t,this.supabaseKey=n;const l=ax(t);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:Q0,realtime:Z0,auth:Object.assign(Object.assign({},X0),{storageKey:c}),global:Y0},d=sx(r??{},u);this.storageKey=(a=d.auth.storageKey)!==null&&a!==void 0?a:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(m,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=nx(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new i0(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new G0(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new Xw(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,n={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,n,r)}channel(t,n={config:{}}){return this.realtime.channel(t,n)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t,n;if(this.accessToken)return await this.accessToken();const{data:r}=await this.auth.getSession();return(n=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&n!==void 0?n:this.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:i,storageKey:o,flowType:l,lock:c,debug:u},d,m){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new hj({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),d),storageKey:o,autoRefreshToken:t,persistSession:n,detectSessionInUrl:r,storage:a,userStorage:i,flowType:l,lock:c,debug:u,fetch:m,hasCustomAuthorizationHeader:Object.keys(this.headers).some(b=>b.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new j0(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(t,n,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const mj=(e,t,n)=>new fj(e,t,n);function pj(){if(typeof window<"u"||typeof process>"u")return!1;const e=process.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}pj()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const gj="https://muanayogiboxooftkyny.supabase.co",_j="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im11YW5heW9naWJveG9vZnRreW55Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzNzgxNzMsImV4cCI6MjA3Nzk1NDE3M30.jJdaGXC1LEOZU9yPl-o5G2PF80OlmtNm0W4Vx5Fj1X8",_y={url:gj,anonKey:_j},yj={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let Ki=null,yy=null;const bj="/auth/callback";function Vd(e){const t=yj;for(const n of e){const r=t[n];if(typeof r=="string"&&r.trim())return r.trim()}return null}function Gd(){var t;const e=Vd(["VITE_SUPABASE_URL","NEXT_PUBLIC_SUPABASE_URL"]);return e||((t=_y.url)==null?void 0:t.trim())||null}function Hf(){return Gd()}function by(){var t;const e=Vd(["VITE_SUPABASE_ANON_KEY","NEXT_PUBLIC_SUPABASE_ANON_KEY"]);return e||((t=_y.anonKey)==null?void 0:t.trim())||null}function oi(){return!!(Gd()&&by())}function or(e){yy=e}function Cu(){return!!yy}function Ce(){return oi()&&Cu()}function ce(){if(Ki)return Ki;const e=Gd(),t=by();if(!e||!t)throw new Error("Supabase credentials are missing. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY in your environment.");return Ki=mj(e,t,{auth:{persistSession:!0,autoRefreshToken:!0}}),Ki}function vj(){var t;const e=Vd(["VITE_SUPABASE_REDIRECT_URL","NEXT_PUBLIC_SUPABASE_REDIRECT_URL"]);return e||(typeof window<"u"&&((t=window.location)!=null&&t.origin)?`${window.location.origin}${bj}`:null)}const es="standard",We="demo-user-0001",vy="demo@lifegoalapp.com",Tu="Demo Creator",Kd="lifegoalapp-demo-db-v1",Wf=typeof globalThis.structuredClone=="function"?globalThis.structuredClone:void 0;function Le(e){return Wf?Wf(e):JSON.parse(JSON.stringify(e))}function xe(e){if(typeof crypto<"u"&&"randomUUID"in crypto)return crypto.randomUUID();const t=Math.random().toString(16).slice(2,10);return`${e}-${t}`}const X=new Date,Ve=e=>e.toISOString(),_o=e=>e.toISOString().slice(0,10),dt={goals:[{id:xe("goal"),user_id:We,title:"Launch the LifeGoal beta cohort",description:"Invite 25 early adopters, gather feedback, and iterate on the habit tracker experience.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-2,4)),target_date:Ve(new Date(X.getFullYear(),X.getMonth()+1,15)),progress_notes:"Beta content is finalized. Scheduling 1:1 kickoff calls next week and preparing support docs for onboarding.",status_tag:"on_track",life_wheel_category:null,start_date:null,timing_notes:null,estimated_duration_days:null},{id:xe("goal"),user_id:We,title:"Design the 2024 vision board refresh",description:"Collect inspiring imagery, craft narrative captions, and share with accountability partners.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-1,12)),target_date:Ve(new Date(X.getFullYear(),X.getMonth()+2,1)),progress_notes:"Gathered 60% of imagery, but workshop facilitation partner is double-booked. Need a backup facilitator.",status_tag:"off_track",life_wheel_category:null,start_date:null,timing_notes:null,estimated_duration_days:null},{id:xe("goal"),user_id:We,title:"Archive the pilot insights playbook",description:"Synthesize interviews, share top 10 learnings, and distribute the retrospective deck to the team.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-3,22)),target_date:Ve(new Date(X.getFullYear(),X.getMonth()-1,30)),progress_notes:"Deliverables shipped! Scheduling a celebration retro and exporting learnings to Notion.",status_tag:"achieved",life_wheel_category:null,start_date:null,timing_notes:null,estimated_duration_days:null}],habits:[],habitLogs:[],habitAlerts:[],visionImages:[],checkins:[],notificationPreferences:null,goalReflections:[],journalEntries:[]};(function(){const t=dt.goals[0],n=dt.goals[1],r=dt.goals[2],a=xe("habit"),i=xe("habit"),o=xe("habit");dt.habits=[{id:a,goal_id:t.id,name:"Morning focus ritual",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"career",label:"Career & Mission"}}},{id:i,goal_id:t.id,name:"Reach out to a beta tester",frequency:"weekly",schedule:{type:"weekly",days:["mon","wed","fri"],life_wheel_domain:{key:"relationships",label:"Relationships & Community"}}},{id:o,goal_id:n.id,name:"Source a new inspiration image",frequency:"weekly",schedule:{type:"weekly",days:["sat"],life_wheel_domain:{key:"creativity",label:"Creativity & Expression"}}},{id:xe("habit"),goal_id:t.id,name:"Hydrate with 80 oz of water",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"health",label:"Health & Vitality"}}},{id:xe("habit"),goal_id:t.id,name:"Midday stretch walk",frequency:"weekly",schedule:{type:"weekly",days:["mon","tue","wed","thu","fri"],life_wheel_domain:{key:"health",label:"Health & Vitality"}}},{id:xe("habit"),goal_id:t.id,name:"Inbox zero sweep",frequency:"weekly",schedule:{type:"weekly",days:["mon","tue","wed","thu"],life_wheel_domain:{key:"career",label:"Career & Mission"}}},{id:xe("habit"),goal_id:t.id,name:"Review tomorrow's priorities",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"mindset",label:"Mindset & Clarity"}}},{id:xe("habit"),goal_id:t.id,name:"Capture product insight",frequency:"weekly",schedule:{type:"weekly",days:["mon","wed","fri"],life_wheel_domain:{key:"career",label:"Career & Mission"}}},{id:xe("habit"),goal_id:t.id,name:"Update roadmap milestone",frequency:"weekly",schedule:{type:"weekly",days:["mon"],life_wheel_domain:{key:"career",label:"Career & Mission"}}},{id:xe("habit"),goal_id:t.id,name:"Host accountability check-in",frequency:"weekly",schedule:{type:"weekly",days:["wed"],life_wheel_domain:{key:"relationships",label:"Relationships & Community"}}},{id:xe("habit"),goal_id:t.id,name:"Share progress update with community",frequency:"weekly",schedule:{type:"weekly",days:["fri"],life_wheel_domain:{key:"community",label:"Community & Impact"}}},{id:xe("habit"),goal_id:t.id,name:"Schedule deep work block",frequency:"weekly",schedule:{type:"weekly",days:["tue","thu"],life_wheel_domain:{key:"career",label:"Career & Mission"}}},{id:xe("habit"),goal_id:t.id,name:"Strength training circuit",frequency:"weekly",schedule:{type:"weekly",days:["tue","thu"],life_wheel_domain:{key:"health",label:"Health & Vitality"}}},{id:xe("habit"),goal_id:t.id,name:"Digital sunset ritual",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"wellness",label:"Rest & Recovery"}}},{id:xe("habit"),goal_id:t.id,name:"Sleep by 10:30 routine",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"wellness",label:"Rest & Recovery"}}},{id:xe("habit"),goal_id:t.id,name:"Balanced breakfast prep",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"health",label:"Health & Vitality"}}},{id:xe("habit"),goal_id:n.id,name:"Reflect in vision journal",frequency:"weekly",schedule:{type:"weekly",days:["sun"],life_wheel_domain:{key:"personal_growth",label:"Personal Growth"}}},{id:xe("habit"),goal_id:n.id,name:"Curate mood board snippet",frequency:"weekly",schedule:{type:"weekly",days:["thu"],life_wheel_domain:{key:"creativity",label:"Creativity & Expression"}}},{id:xe("habit"),goal_id:n.id,name:"Capture photo inspiration",frequency:"weekly",schedule:{type:"weekly",days:["sat","sun"],life_wheel_domain:{key:"creativity",label:"Creativity & Expression"}}},{id:xe("habit"),goal_id:n.id,name:"Schedule creative play session",frequency:"weekly",schedule:{type:"weekly",days:["sat"],life_wheel_domain:{key:"fun",label:"Fun & Adventure"}}},{id:xe("habit"),goal_id:n.id,name:"Sketch storyboard concept",frequency:"weekly",schedule:{type:"weekly",days:["tue"],life_wheel_domain:{key:"creativity",label:"Creativity & Expression"}}},{id:xe("habit"),goal_id:n.id,name:"Practice gratitude note",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"mindset",label:"Mindset & Clarity"}}},{id:xe("habit"),goal_id:n.id,name:"10-minute mindful breathing",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"personal_growth",label:"Personal Growth"}}},{id:xe("habit"),goal_id:n.id,name:"Write 3 lines in reflection journal",frequency:"daily",schedule:{type:"daily",life_wheel_domain:{key:"personal_growth",label:"Personal Growth"}}},{id:xe("habit"),goal_id:n.id,name:"Plan weekend adventure",frequency:"weekly",schedule:{type:"weekly",days:["thu"],life_wheel_domain:{key:"fun",label:"Fun & Adventure"}}},{id:xe("habit"),goal_id:r.id,name:"Review financial dashboard",frequency:"weekly",schedule:{type:"weekly",days:["mon"],life_wheel_domain:{key:"finances",label:"Finances & Wealth"}}},{id:xe("habit"),goal_id:r.id,name:"Reconcile budget entries",frequency:"weekly",schedule:{type:"weekly",days:["fri"],life_wheel_domain:{key:"finances",label:"Finances & Wealth"}}},{id:xe("habit"),goal_id:r.id,name:"Offer mentorship comment",frequency:"weekly",schedule:{type:"weekly",days:["wed"],life_wheel_domain:{key:"giving_back",label:"Giving Back"}}},{id:xe("habit"),goal_id:r.id,name:"Declutter workspace reset",frequency:"weekly",schedule:{type:"weekly",days:["fri"],life_wheel_domain:{key:"environment",label:"Environment & Surroundings"}}},{id:xe("habit"),goal_id:r.id,name:"Tend to plant watering",frequency:"weekly",schedule:{type:"weekly",days:["wed"],life_wheel_domain:{key:"environment",label:"Environment & Surroundings"}}}];const l=new Date(X);l.setDate(l.getDate()-6);for(let c=0;c<7;c+=1){const u=new Date(l);u.setDate(l.getDate()+c);const d=u.toISOString().slice(0,10);dt.habitLogs.push({id:xe("habit-log"),habit_id:a,date:d,completed:c%7!==2},{id:xe("habit-log"),habit_id:i,date:d,completed:c%3===0})}dt.visionImages=[{id:xe("vision"),user_id:We,image_path:null,image_url:"https://images.unsplash.com/photo-1521737604893-d14cc237f11d?auto=format&fit=crop&w=800&q=80",image_source:"url",caption:"Morning deep work setup to stay consistent with focus ritual.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-1,5)),file_path:null,file_format:null},{id:xe("vision"),user_id:We,image_path:null,image_url:"https://images.unsplash.com/photo-1487014679447-9f8336841d58?auto=format&fit=crop&w=800&q=80",image_source:"url",caption:"Community celebration after the beta launch milestone.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-1,20)),file_path:null,file_format:null}],dt.checkins=[{id:xe("checkin"),user_id:We,date:Ve(new Date(X.getFullYear(),X.getMonth()-2,1)),scores:{health:7,relationships:6,career:8,personal_growth:7,fun:5,finances:6,giving_back:4,environment:8}},{id:xe("checkin"),user_id:We,date:Ve(new Date(X.getFullYear(),X.getMonth()-1,1)),scores:{health:8,relationships:7,career:8,personal_growth:8,fun:6,finances:6,giving_back:5,environment:8}},{id:xe("checkin"),user_id:We,date:Ve(new Date(X.getFullYear(),X.getMonth(),1)),scores:{health:8,relationships:8,career:9,personal_growth:8,fun:6,finances:7,giving_back:6,environment:8}}],dt.notificationPreferences={user_id:We,habit_reminders_enabled:!0,habit_reminder_time:"08:00",checkin_nudges_enabled:!0,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone??"UTC",subscription:null,created_at:Ve(new Date(X.getFullYear(),X.getMonth()-2,12)),updated_at:Ve(new Date(X.getFullYear(),X.getMonth(),2))},dt.goalReflections=[{id:xe("reflection"),goal_id:t.id,user_id:We,entry_date:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-6)).slice(0,10),confidence:4,highlight:"Completed onboarding playbook recordings and received strong feedback from the first beta captain.",challenge:"Need to coordinate calendar slots with three testers who have limited availability this week.",created_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-6))},{id:xe("reflection"),goal_id:t.id,user_id:We,entry_date:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-3)).slice(0,10),confidence:5,highlight:"Shipped revised habit tracker walkthrough and booked 5 new intro calls.",challenge:"Document follow-up questions so we can convert interest into active beta signups.",created_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-3))},{id:xe("reflection"),goal_id:t.id,user_id:We,entry_date:Ve(new Date(X.getFullYear(),X.getMonth()-1,19)).slice(0,10),confidence:4,highlight:"Wrapped partner onboarding guides and scheduled joint announcement with marketing.",challenge:"Need a final review of the pricing FAQ before we hit publish.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-1,19))},{id:xe("reflection"),goal_id:t.id,user_id:We,entry_date:Ve(new Date(X.getFullYear(),X.getMonth()-2,21)).slice(0,10),confidence:3,highlight:"Outlined migration checklist and synced with engineering on rollout blockers.",challenge:"Still clarifying analytics requirements with two stakeholders.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-2,21))},{id:xe("reflection"),goal_id:n.id,user_id:We,entry_date:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-8)).slice(0,10),confidence:3,highlight:"Gathered quotes for printing the updated vision board and drafted storytelling script.",challenge:"Still missing imagery for the community impact section and facilitator backup.",created_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-8))},{id:xe("reflection"),goal_id:n.id,user_id:We,entry_date:Ve(new Date(X.getFullYear(),X.getMonth()-1,7)).slice(0,10),confidence:4,highlight:"Finalized the mood board color palette and secured three new contributor stories.",challenge:"Need approval on licensing terms for two photos sourced from the community.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-1,7))},{id:xe("reflection"),goal_id:n.id,user_id:We,entry_date:Ve(new Date(X.getFullYear(),X.getMonth()-2,11)).slice(0,10),confidence:2,highlight:"Mapped storytelling outline and flagged where we need additional imagery.",challenge:"Waiting on legal review for featuring partner logos in the board.",created_at:Ve(new Date(X.getFullYear(),X.getMonth()-2,11))}],dt.journalEntries=[{id:xe("journal"),user_id:We,created_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-2)),updated_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-2)),entry_date:_o(new Date(X.getFullYear(),X.getMonth(),X.getDate()-2)),title:"Beta kickoff energy",content:"Hosted three intro calls and felt the cohort's excitement. Captured five new insight threads to unpack tomorrow.",mood:"excited",tags:["beta","momentum"],is_private:!0,attachments:null,linked_goal_ids:[t.id],linked_habit_ids:[a,i],type:es,mood_score:null,category:null,unlock_date:null,goal_id:null},{id:xe("journal"),user_id:We,created_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-1)),updated_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-1)),entry_date:_o(new Date(X.getFullYear(),X.getMonth(),X.getDate()-1)),title:"Vision sprint reflection",content:"Spent the afternoon curating the board refresh. Loved the deep purple palette that emerged and tagged next steps for the mood boards.",mood:"happy",tags:["vision","creative flow"],is_private:!0,attachments:null,linked_goal_ids:[n.id],linked_habit_ids:[o],type:es,mood_score:null,category:null,unlock_date:null,goal_id:null},{id:xe("journal"),user_id:We,created_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-5)),updated_at:Ve(new Date(X.getFullYear(),X.getMonth(),X.getDate()-5)),entry_date:_o(new Date(X.getFullYear(),X.getMonth(),X.getDate()-5)),title:"Integrating pilot learnings",content:"Documented the post-pilot insights. Noticed a confidence dip midweek when decisions piled up, but feel steady after the walk-and-talk debrief.",mood:"neutral",tags:["reflection","pilot"],is_private:!0,attachments:null,linked_goal_ids:[r.id],linked_habit_ids:[o],type:es,mood_score:null,category:null,unlock_date:null,goal_id:null}]})();function yi(e){let t=e.status_tag??"on_track";return(t==="blocked"||t==="off-track")&&(t="off_track"),{...e,description:e.description??null,target_date:e.target_date??null,progress_notes:e.progress_notes??null,status_tag:t}}function wj(){if(typeof window>"u")return Le(dt);try{const e=window.localStorage.getItem(Kd);if(!e)return Le(dt);const t=JSON.parse(e);return{goals:(t.goals??Le(dt.goals)).map(yi),habits:t.habits??Le(dt.habits),habitLogs:t.habitLogs??Le(dt.habitLogs),habitAlerts:t.habitAlerts??Le(dt.habitAlerts),visionImages:t.visionImages??Le(dt.visionImages),checkins:t.checkins??Le(dt.checkins),notificationPreferences:t.notificationPreferences??Le(dt.notificationPreferences),goalReflections:t.goalReflections??Le(dt.goalReflections),journalEntries:t.journalEntries??Le(dt.journalEntries)}}catch(e){return console.warn("Unable to parse demo data state, falling back to defaults.",e),Le(dt)}}let rt=wj();function xj(){if(!(typeof window>"u"))try{window.localStorage.setItem(Kd,JSON.stringify(rt))}catch(e){console.warn("Unable to persist demo data to localStorage.",e)}}function Qt(e){rt=e(rt),xj()}function jj(e){return[...e].sort((t,n)=>{const r=t.created_at??t.date??"",a=n.created_at??n.date??"";return r>a?-1:r<a?1:0})}function Jd(e){return[...e].sort((t,n)=>{const r=t.entry_date??"",a=n.entry_date??"";if(r===a){const i=t.created_at??"",o=n.created_at??"";return i>o?-1:i<o?1:0}return r>a?-1:1})}function kj(e){return Le(jj(rt.goals.filter(t=>t.user_id===e).map(yi)))}function Sj(e){const t=yi({id:e.id??xe("goal"),user_id:e.user_id,title:e.title,description:e.description??null,created_at:e.created_at??new Date().toISOString(),target_date:e.target_date??null,progress_notes:e.progress_notes??null,status_tag:e.status_tag??null,life_wheel_category:e.life_wheel_category??null,start_date:e.start_date??null,timing_notes:e.timing_notes??null,estimated_duration_days:e.estimated_duration_days??null});return Qt(n=>({...n,goals:[t,...n.goals]})),Le(t)}function Nj(e,t){let n=null;return Qt(r=>{const a=r.goals.map(i=>i.id!==e?i:(n=yi({...i,...t,description:t.description??i.description,target_date:t.target_date??i.target_date,progress_notes:t.progress_notes??i.progress_notes,status_tag:t.status_tag??i.status_tag,life_wheel_category:t.life_wheel_category??i.life_wheel_category,start_date:t.start_date??i.start_date,timing_notes:t.timing_notes??i.timing_notes,estimated_duration_days:t.estimated_duration_days??i.estimated_duration_days}),n));return{...r,goals:a}}),n?Le(n):null}function Ej(e){let t=null;return Qt(n=>{const r=n.goals.filter(c=>c.id===e?(t=c,!1):!0),a=n.habits.filter(c=>c.goal_id!==e),i=new Set(a.map(c=>c.id)),o=n.habitLogs.filter(c=>i.has(c.habit_id)),l=n.goalReflections.filter(c=>c.goal_id!==e);return{...n,goals:r,habits:a,habitLogs:o,goalReflections:l}}),t?Le(yi(t)):null}function wy(e){const t=new Set(rt.goals.filter(n=>n.user_id===e).map(n=>n.id));return Le(rt.habits.filter(n=>t.has(n.goal_id)).sort((n,r)=>n.name.localeCompare(r.name)))}function xy(e,t,n){if(!e.length)return[];const r=new Set(e);return Le(rt.habitLogs.filter(a=>r.has(a.habit_id)?a.date>=t&&a.date<=n:!1))}function Cj(e){return Le(rt.visionImages.filter(t=>t.user_id===e).sort((t,n)=>t.created_at>n.created_at?-1:t.created_at<n.created_at?1:0))}function jy(e){const t={id:e.id??xe("vision"),user_id:e.user_id,image_path:e.image_path??null,image_url:e.image_url??null,image_source:e.image_source??"file",caption:e.caption??null,created_at:e.created_at??new Date().toISOString(),file_path:e.file_path??null,file_format:e.file_format??null};return Qt(n=>({...n,visionImages:[t,...n.visionImages]})),Le(t)}function Tj(e){let t=null;return Qt(n=>{const r=n.visionImages.filter(a=>a.id===e?(t=a,!1):!0);return{...n,visionImages:r}}),t?Le(t):null}function Dj(e,t=12){const n=rt.checkins.filter(r=>r.user_id===e).sort((r,a)=>r.date>a.date?-1:r.date<a.date?1:0).slice(0,t);return Le(n)}function Aj(e){const t={id:e.id??xe("checkin"),user_id:e.user_id,date:e.date,scores:e.scores};return Qt(n=>({...n,checkins:[t,...n.checkins]})),Le(t)}function Ij(e,t){let n=null;return Qt(r=>{const a=r.checkins.map(i=>i.id!==e?i:(n={...i,...t,scores:t.scores??i.scores},n));return{...r,checkins:a}}),n?Le(n):null}function Pj(e){var t;return((t=rt.notificationPreferences)==null?void 0:t.user_id)!==e?null:Le(rt.notificationPreferences)}function Rj(e,t){var r,a,i,o,l,c;const n={user_id:e,habit_reminders_enabled:"habit_reminders_enabled"in t?!!t.habit_reminders_enabled:((r=rt.notificationPreferences)==null?void 0:r.habit_reminders_enabled)??!1,habit_reminder_time:"habit_reminder_time"in t?t.habit_reminder_time??null:((a=rt.notificationPreferences)==null?void 0:a.habit_reminder_time)??null,checkin_nudges_enabled:"checkin_nudges_enabled"in t?!!t.checkin_nudges_enabled:((i=rt.notificationPreferences)==null?void 0:i.checkin_nudges_enabled)??!1,timezone:"timezone"in t?t.timezone??null:((o=rt.notificationPreferences)==null?void 0:o.timezone)??null,subscription:"subscription"in t?t.subscription:((l=rt.notificationPreferences)==null?void 0:l.subscription)??null,created_at:((c=rt.notificationPreferences)==null?void 0:c.created_at)??new Date().toISOString(),updated_at:new Date().toISOString()};return Qt(u=>({...u,notificationPreferences:n})),Le(n)}function Oj(e){var n;if(((n=rt.notificationPreferences)==null?void 0:n.user_id)!==e)return null;const t={...rt.notificationPreferences,habit_reminders_enabled:!1,checkin_nudges_enabled:!1,habit_reminder_time:null,subscription:null,updated_at:new Date().toISOString()};return Qt(r=>({...r,notificationPreferences:t})),Le(t)}async function Lj(e){if(typeof window>"u"||typeof FileReader>"u")throw new Error("FileReader is not available in this environment.");return new Promise((t,n)=>{const r=new FileReader;r.onload=()=>{typeof r.result=="string"?t(r.result):n(new Error("Unable to read file as data URL."))},r.onerror=()=>n(new Error("Failed to read file.")),r.readAsDataURL(e)})}function $j(e){return Le(rt.goalReflections.filter(t=>t.goal_id===e).sort((t,n)=>t.entry_date>n.entry_date?-1:t.entry_date<n.entry_date?1:0))}function Mj(e){const t={id:e.id??xe("reflection"),goal_id:e.goal_id,user_id:e.user_id,entry_date:e.entry_date,confidence:e.confidence??null,highlight:e.highlight??null,challenge:e.challenge??null,created_at:e.created_at??new Date().toISOString()};return Qt(n=>({...n,goalReflections:[t,...n.goalReflections]})),Le(t)}function Uj(e){let t=null;return Qt(n=>{const r=n.goalReflections.filter(a=>a.id===e?(t=a,!1):!0);return{...n,goalReflections:r}}),t?Le(t):null}function Fj(e){return Le(Jd(rt.journalEntries.filter(t=>t.user_id===e)))}function zj(e){const t={id:e.id??xe("journal"),user_id:e.user_id,created_at:e.created_at??new Date().toISOString(),updated_at:e.updated_at??new Date().toISOString(),entry_date:e.entry_date??_o(new Date),title:e.title??null,content:e.content,mood:e.mood??null,tags:e.tags??null,is_private:e.is_private??!0,attachments:e.attachments??null,linked_goal_ids:e.linked_goal_ids??null,linked_habit_ids:e.linked_habit_ids??null,type:e.type??es,mood_score:e.mood_score??null,category:e.category??null,unlock_date:e.unlock_date??null,goal_id:e.goal_id??null};return Qt(n=>({...n,journalEntries:Jd([t,...n.journalEntries])})),Le(t)}function Bj(e,t){let n=null;return Qt(r=>{const a=r.journalEntries.map(i=>i.id!==e?i:(n={...i,...t,entry_date:t.entry_date??i.entry_date,title:t.title??i.title,content:t.content??i.content,mood:t.mood??i.mood,tags:t.tags??i.tags,is_private:t.is_private??i.is_private,attachments:t.attachments??i.attachments,linked_goal_ids:t.linked_goal_ids??i.linked_goal_ids,linked_habit_ids:t.linked_habit_ids??i.linked_habit_ids,updated_at:new Date().toISOString()},n));return{...r,journalEntries:Jd(a)}}),n?Le(n):null}function qj(e){let t=null;return Qt(n=>{const r=n.journalEntries.filter(a=>a.id===e?(t=a,!1):!0);return{...n,journalEntries:r}}),t?Le(t):null}function Hj(e){return Le(e?rt.habitAlerts.filter(t=>t.habit_id===e):rt.habitAlerts)}function Wj(){return Le(rt)}function Vj(){if(!(typeof window>"u"))try{window.localStorage.removeItem(Kd),rt=Le(dt)}catch(e){console.warn("Unable to clear demo data from localStorage.",e)}}function Na(){const e=new Date().toISOString(),t=Math.floor(Date.now()/1e3);return{access_token:"demo-access-token",refresh_token:"demo-refresh-token",token_type:"bearer",user:{id:We,app_metadata:{provider:"demo",providers:["demo"]},user_metadata:{full_name:Tu,onboarding_complete:!0},aud:"authenticated",confirmation_sent_at:e,confirmed_at:e,created_at:e,email:vy,email_confirmed_at:e,factors:[],identities:[],invited_at:e,last_sign_in_at:e,phone:"",phone_confirmed_at:null,recovery_sent_at:e,role:"authenticated",updated_at:e,raw_app_meta_data:{provider:"demo",providers:["demo"]},raw_user_meta_data:{full_name:Tu,onboarding_complete:!0}},expires_in:3600,expires_at:t+3600,provider_refresh_token:null,provider_token:null}}function un(e){var t;return e?((t=e.user)==null?void 0:t.id)===We:!1}const ky=f.createContext(void 0);function Vf(e){const n=(e.message??"").toLowerCase(),r=typeof e.status=="number"?e.status:null;return n.includes("database error querying schema")?new Error('Supabase returned "Database error querying schema". This means your project database is missing the latest tables or policies. Open the Supabase SQL editor and run the SQL in supabase/migrations (or sql/manual.sql) to apply the schema, then try again.'):r===500?new Error("Supabase responded with HTTP 500 while exchanging credentials (grant_type=password). This almost always happens when the latest tables, policies, or RPCs have not been applied. Run the SQL in supabase/migrations or sql/manual.sql inside the Supabase SQL editor, then rerun the sign-in."):e}function _s(e){return e instanceof Error?Vf(e):Vf(new Error(String(e)))}function Gj({children:e}){const t=oi()?"supabase":"demo",[n,r]=f.useState(null),[a,i]=f.useState(t==="supabase"),[o,l]=f.useState(null),[c,u]=f.useState(null);f.useEffect(()=>{if(t==="demo"){u(null),l(null),r(null),or(null),i(!1);return}try{u(ce()),l(null)}catch(p){u(null),l(p instanceof Error?p:new Error("Failed to initialize Supabase client."))}},[t]),f.useEffect(()=>{let p=!0;if(!c||t!=="supabase")return i(!1),()=>{p=!1};c.auth.getSession().then(({data:v})=>{if(!p)return;const x=v.session??null;r(x),or(x)}).finally(()=>{p&&i(!1)});const{data:{subscription:_}}=c.auth.onAuthStateChange((v,x)=>{const j=x??null;r(j),or(j)});return()=>{p=!1,_.unsubscribe()}},[t,c]);const d=f.useCallback(async p=>{if(t==="demo"){r(Na()),or(null);return}if(!c)throw o??new Error("Supabase credentials are not configured.");const{error:_}=await c.auth.signInWithPassword(p);if(_)throw _s(_)},[t,c,o]),m=f.useCallback(async p=>{if(t==="demo"){r(Na()),or(null);return}if(!c)throw o??new Error("Supabase credentials are not configured.");const{error:_}=await c.auth.signUp(p);if(_)throw _s(_)},[t,c,o]),h=f.useCallback(async p=>{if(t==="demo"){r(Na()),or(null);return}if(!c)throw o??new Error("Supabase credentials are not configured.");const{error:_}=await c.auth.signInWithOtp({email:p});if(_)throw _s(_)},[t,c,o]),b=f.useCallback(async()=>{if(t==="demo"){r(Na()),or(null);return}if(!c)throw o??new Error("Supabase credentials are not configured.");const p=vj()??"https://www.lifegoalapp.com/auth/callback",{error:_}=await c.auth.signInWithOAuth({provider:"google",options:{redirectTo:p}});if(_)throw _s(_)},[t,c,o]),y=f.useCallback(async p=>{if(t==="demo")return;if(!c)throw o??new Error("Supabase credentials are not configured.");const{error:_}=await c.auth.resetPasswordForEmail(p);if(_)throw _s(_)},[t,c,o]),g=f.useCallback(async()=>{if(t==="demo"){r(null),or(null);return}if(!c)throw o??new Error("Supabase credentials are not configured.");const{error:p}=await c.auth.signOut();if(p)throw _s(p)},[t,c,o]),w=f.useMemo(()=>({session:n,initializing:a,isConfigured:t==="demo"?!0:!!c,isAuthenticated:!!n,mode:t,client:c,signInWithPassword:d,signUpWithPassword:m,signInWithOtp:h,signInWithGoogle:b,sendPasswordReset:y,signOut:g}),[n,a,t,c,d,m,h,b,y,g]);return s.jsx(ky.Provider,{value:w,children:e})}function Pn(){const e=f.useContext(ky);if(!e)throw new Error("useSupabaseAuth must be used within a SupabaseAuthProvider");return e}async function xl(){return Ce()?ce().from("goals").select("*").order("created_at",{ascending:!1}).returns():{data:kj(We),error:null}}async function Du(e){return Ce()?ce().from("goals").insert(e).select().returns().single():{data:Sj(e),error:null}}async function Kj(e,t){return Ce()?ce().from("goals").update(t).eq("id",e).select().returns().single():{data:Nj(e,t),error:null}}async function Jj(e){return Ce()?ce().from("goals").delete().eq("id",e).select().single():{data:Ej(e),error:null}}const Xs=["on_track","at_risk","off_track","achieved"],gr={on_track:{label:"On track",description:"Progress is moving smoothly with no blockers.",empty:"No goals have been marked on track yet."},at_risk:{label:"At risk",description:"Momentum is slowing down and needs attention.",empty:"No goals flagged at risk—keep monitoring your progress."},off_track:{label:"Off track",description:"Major blockers or misses require a reset or new plan.",empty:"No goals are off track right now."},achieved:{label:"Achieved",description:"The goal has been completed—celebrate the win!",empty:"Celebrate once goals start crossing the finish line."}},Sy=Xs.map(e=>({value:e,label:gr[e].label,description:gr[e].description})),li="on_track";function Qr(e){if(!e)return li;const t=e.toLowerCase().replace(/-/g,"_");return t==="blocked"?"off_track":Xs.includes(t)?t:li}function Yj(){const[e,t]=f.useState(!1),[n,r]=f.useState(null),[a,i]=f.useState(null),o=f.useCallback(async l=>{t(!0),r(null),i(null);try{throw new Error("AI goal suggest URL is not configured. Please set VITE_AI_GOAL_SUGGEST_URL.");if(!b.ok){let _="Failed to generate AI suggestion";try{const v=await b.json();v.error&&(_=v.error)}catch{_=`${_}: ${b.statusText}`}throw new Error(_)}}catch(c){const u=c instanceof Error?c.message:"An unexpected error occurred";r(u),console.error("Error generating AI suggestion:",c)}finally{t(!1)}},[]);return{loading:e,error:n,suggestion:a,generateSuggestion:o}}function Ny({session:e,isOpen:t,onClose:n,onSave:r,initialCategory:a}){var ne,Z;const{loading:i,error:o,suggestion:l,generateSuggestion:c}=Yj(),[u,d]=f.useState(()=>({title:"",description:"",lifeWheelCategory:a||"health_fitness",startDate:"",targetDate:"",estimatedDurationDays:"",timingNotes:"",statusTag:li,steps:[],alerts:[]})),[m,h]=f.useState({title:"",description:"",dueDate:"",substeps:[]}),[b,y]=f.useState(""),[g,w]=f.useState({alertType:"reminder",alertTime:"",title:"",message:"",repeatPattern:"once",enabled:!0}),[p,_]=f.useState(!1),[v,x]=f.useState("basic"),j=I=>C=>{d(L=>({...L,[I]:C.target.value}))},k=()=>{var C;if(!((C=m.title)!=null&&C.trim()))return;const I={id:crypto.randomUUID(),title:m.title,description:m.description||"",dueDate:m.dueDate||"",substeps:m.substeps||[]};d(L=>({...L,steps:[...L.steps,I]})),h({title:"",description:"",dueDate:"",substeps:[]})},S=I=>{d(C=>({...C,steps:C.steps.filter(L=>L.id!==I)}))},A=()=>{if(!b.trim())return;const I={id:crypto.randomUUID(),title:b};h(C=>({...C,substeps:[...C.substeps||[],I]})),y("")},P=I=>{h(C=>({...C,substeps:(C.substeps||[]).filter(L=>L.id!==I)}))},R=()=>{var C;if(!((C=g.title)!=null&&C.trim())||!g.alertTime)return;const I={id:crypto.randomUUID(),alertType:g.alertType||"reminder",alertTime:g.alertTime||"",title:g.title,message:g.message||"",repeatPattern:g.repeatPattern||"once",enabled:g.enabled!==!1};d(L=>({...L,alerts:[...L.alerts,I]})),w({alertType:"reminder",alertTime:"",title:"",message:"",repeatPattern:"once",enabled:!0})},q=I=>{d(C=>({...C,alerts:C.alerts.filter(L=>L.id!==I)}))},O=async()=>{if(!u.description.trim())return;let I;if(u.targetDate){const C=new Date(u.targetDate),L=new Date,K=Math.ceil((C.getTime()-L.getTime())/(1e3*60*60*24));K>0&&(I=`${K} days`)}else u.estimatedDurationDays&&(I=`${u.estimatedDurationDays} days`);await c({description:u.description,timeframe:I,category:u.lifeWheelCategory})},oe=()=>{if(!l)return;d(C=>({...C,title:l.goal}));const I=l.milestones.map((C,L)=>({id:crypto.randomUUID(),title:C,description:"",dueDate:"",substeps:[]}));l.tasks.length>0&&I.length>0&&(I[0].substeps=l.tasks.map(C=>({id:crypto.randomUUID(),title:C}))),d(C=>({...C,steps:[...C.steps,...I]}))},z=async I=>{I.preventDefault(),_(!0);try{await r(u),d({title:"",description:"",lifeWheelCategory:a||"health_fitness",startDate:"",targetDate:"",estimatedDurationDays:"",timingNotes:"",statusTag:li,steps:[],alerts:[]}),n()}catch(C){console.error("Error saving life goal:",C)}finally{_(!1)}};return t?s.jsx("div",{className:"life-goal-dialog-overlay",onClick:n,children:s.jsxs("div",{className:"life-goal-dialog",onClick:I=>I.stopPropagation(),children:[s.jsxs("header",{className:"life-goal-dialog__header",children:[s.jsx("h2",{children:"Create Life Goal"}),s.jsx("button",{type:"button",className:"life-goal-dialog__close",onClick:n,"aria-label":"Close dialog",children:"×"})]}),s.jsxs("div",{className:"life-goal-dialog__tabs",children:[s.jsx("button",{type:"button",className:`life-goal-dialog__tab ${v==="basic"?"life-goal-dialog__tab--active":""}`,onClick:()=>x("basic"),children:"Basic Info"}),s.jsxs("button",{type:"button",className:`life-goal-dialog__tab ${v==="steps"?"life-goal-dialog__tab--active":""}`,onClick:()=>x("steps"),children:["Steps (",u.steps.length,")"]}),s.jsx("button",{type:"button",className:`life-goal-dialog__tab ${v==="timing"?"life-goal-dialog__tab--active":""}`,onClick:()=>x("timing"),children:"Timing"}),s.jsxs("button",{type:"button",className:`life-goal-dialog__tab ${v==="alerts"?"life-goal-dialog__tab--active":""}`,onClick:()=>x("alerts"),children:["Alerts (",u.alerts.length,")"]})]}),s.jsxs("form",{className:"life-goal-dialog__form",onSubmit:z,children:[v==="basic"&&s.jsxs("div",{className:"life-goal-dialog__section",children:[s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Goal Title *"}),s.jsx("input",{type:"text",value:u.title,onChange:j("title"),placeholder:"e.g., Run a marathon",required:!0})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Description"}),s.jsx("textarea",{value:u.description,onChange:j("description"),placeholder:"Describe what success looks like and why this goal matters to you...",rows:4})]}),s.jsxs("div",{className:"life-goal-dialog__ai-section",children:[s.jsx("button",{type:"button",className:"life-goal-dialog__ai-generate",onClick:O,disabled:!u.description.trim()||i,children:i?"🤖 Generating...":"✨ Generate with AI"}),i&&s.jsx("p",{className:"life-goal-dialog__ai-status",children:"Generating AI suggestion based on your description..."}),o&&s.jsxs("div",{className:"life-goal-dialog__ai-error",children:[s.jsx("strong",{children:"Error:"})," ",o]}),l&&s.jsxs("div",{className:"life-goal-dialog__ai-suggestion",children:[s.jsx("h4",{children:"💡 AI Suggestion"}),s.jsxs("div",{className:"life-goal-dialog__ai-content",children:[s.jsxs("div",{className:"life-goal-dialog__ai-goal",children:[s.jsx("strong",{children:"Goal:"}),s.jsx("p",{children:l.goal})]}),l.milestones.length>0&&s.jsxs("div",{className:"life-goal-dialog__ai-milestones",children:[s.jsx("strong",{children:"Milestones:"}),s.jsx("ul",{children:l.milestones.map((I,C)=>s.jsx("li",{children:I},C))})]}),l.tasks.length>0&&s.jsxs("div",{className:"life-goal-dialog__ai-tasks",children:[s.jsx("strong",{children:"Tasks:"}),s.jsx("ul",{children:l.tasks.map((I,C)=>s.jsx("li",{children:I},C))})]}),s.jsx("button",{type:"button",className:"life-goal-dialog__ai-use",onClick:oe,children:"✓ Use this as goal"})]})]})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Life Area"}),s.jsxs("select",{value:u.lifeWheelCategory,onChange:j("lifeWheelCategory"),children:[s.jsx("option",{value:"spirituality_community",children:"Spirituality & Community"}),s.jsx("option",{value:"finance_wealth",children:"Finance & Wealth"}),s.jsx("option",{value:"love_relations",children:"Love & Relations"}),s.jsx("option",{value:"fun_creativity",children:"Fun & Creativity"}),s.jsx("option",{value:"career_development",children:"Career & Self Development"}),s.jsx("option",{value:"health_fitness",children:"Health & Fitness"}),s.jsx("option",{value:"family_friends",children:"Family & Friends"}),s.jsx("option",{value:"living_spaces",children:"Living Spaces"})]})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Status"}),s.jsx("select",{value:u.statusTag,onChange:j("statusTag"),children:Sy.map(I=>s.jsx("option",{value:I.value,children:I.label},I.value))})]})]}),v==="steps"&&s.jsxs("div",{className:"life-goal-dialog__section",children:[s.jsxs("div",{className:"life-goal-dialog__steps-form",children:[s.jsx("h3",{children:"Add a Step"}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Step Title *"}),s.jsx("input",{type:"text",value:m.title||"",onChange:I=>h({...m,title:I.target.value}),placeholder:"e.g., Complete 5K training program"})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Step Description"}),s.jsx("textarea",{value:m.description||"",onChange:I=>h({...m,description:I.target.value}),placeholder:"Additional details about this step...",rows:2})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Due Date"}),s.jsx("input",{type:"date",value:m.dueDate||"",onChange:I=>h({...m,dueDate:I.target.value})})]}),s.jsxs("div",{className:"life-goal-dialog__substeps",children:[s.jsx("h4",{children:"Substeps"}),s.jsxs("div",{className:"life-goal-dialog__substep-input",children:[s.jsx("input",{type:"text",value:b,onChange:I=>y(I.target.value),placeholder:"Add a substep..."}),s.jsx("button",{type:"button",onClick:A,disabled:!b.trim(),children:"Add"})]}),m.substeps&&m.substeps.length>0&&s.jsx("ul",{className:"life-goal-dialog__substep-list",children:m.substeps.map(I=>s.jsxs("li",{children:[s.jsx("span",{children:I.title}),s.jsx("button",{type:"button",onClick:()=>P(I.id),children:"Remove"})]},I.id))})]}),s.jsx("button",{type:"button",className:"life-goal-dialog__add-step",onClick:k,disabled:!((ne=m.title)!=null&&ne.trim()),children:"Add Step"})]}),u.steps.length>0&&s.jsxs("div",{className:"life-goal-dialog__steps-list",children:[s.jsxs("h3",{children:["Steps (",u.steps.length,")"]}),s.jsx("ul",{children:u.steps.map((I,C)=>s.jsxs("li",{className:"life-goal-dialog__step-item",children:[s.jsxs("div",{className:"life-goal-dialog__step-header",children:[s.jsxs("span",{className:"life-goal-dialog__step-number",children:[C+1,"."]}),s.jsx("strong",{children:I.title}),s.jsx("button",{type:"button",onClick:()=>S(I.id),children:"Remove"})]}),I.description&&s.jsx("p",{children:I.description}),I.dueDate&&s.jsxs("p",{className:"life-goal-dialog__step-date",children:["Due: ",I.dueDate]}),I.substeps.length>0&&s.jsx("ul",{className:"life-goal-dialog__step-substeps",children:I.substeps.map(L=>s.jsx("li",{children:L.title},L.id))})]},I.id))})]})]}),v==="timing"&&s.jsxs("div",{className:"life-goal-dialog__section",children:[s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Start Date"}),s.jsx("input",{type:"date",value:u.startDate,onChange:j("startDate")})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Target Date"}),s.jsx("input",{type:"date",value:u.targetDate,onChange:j("targetDate")})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Estimated Duration (days)"}),s.jsx("input",{type:"number",value:u.estimatedDurationDays,onChange:j("estimatedDurationDays"),placeholder:"e.g., 90",min:"1"})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Timing Notes"}),s.jsx("textarea",{value:u.timingNotes,onChange:j("timingNotes"),placeholder:"Add notes about your schedule, milestones, or important dates...",rows:4})]})]}),v==="alerts"&&s.jsxs("div",{className:"life-goal-dialog__section",children:[s.jsxs("div",{className:"life-goal-dialog__alert-form",children:[s.jsx("h3",{children:"Add an Alert"}),s.jsx("p",{className:"life-goal-dialog__hint",children:"Alerts work as PWA notifications and will appear even when the app is closed (on supported devices)."}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Alert Type"}),s.jsxs("select",{value:g.alertType||"reminder",onChange:I=>w({...g,alertType:I.target.value}),children:[s.jsx("option",{value:"reminder",children:"Reminder"}),s.jsx("option",{value:"milestone",children:"Milestone"}),s.jsx("option",{value:"deadline",children:"Deadline"}),s.jsx("option",{value:"custom",children:"Custom"})]})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Alert Time *"}),s.jsx("input",{type:"datetime-local",value:g.alertTime||"",onChange:I=>w({...g,alertTime:I.target.value})})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Alert Title *"}),s.jsx("input",{type:"text",value:g.title||"",onChange:I=>w({...g,title:I.target.value}),placeholder:"e.g., Time to train!"})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Alert Message"}),s.jsx("textarea",{value:g.message||"",onChange:I=>w({...g,message:I.target.value}),placeholder:"Additional message for the notification...",rows:2})]}),s.jsxs("label",{className:"life-goal-dialog__field",children:[s.jsx("span",{children:"Repeat"}),s.jsxs("select",{value:g.repeatPattern||"once",onChange:I=>w({...g,repeatPattern:I.target.value}),children:[s.jsx("option",{value:"once",children:"Once"}),s.jsx("option",{value:"daily",children:"Daily"}),s.jsx("option",{value:"weekly",children:"Weekly"}),s.jsx("option",{value:"monthly",children:"Monthly"})]})]}),s.jsx("button",{type:"button",className:"life-goal-dialog__add-alert",onClick:R,disabled:!((Z=g.title)!=null&&Z.trim())||!g.alertTime,children:"Add Alert"})]}),u.alerts.length>0&&s.jsxs("div",{className:"life-goal-dialog__alerts-list",children:[s.jsxs("h3",{children:["Alerts (",u.alerts.length,")"]}),s.jsx("ul",{children:u.alerts.map(I=>s.jsxs("li",{className:"life-goal-dialog__alert-item",children:[s.jsxs("div",{className:"life-goal-dialog__alert-header",children:[s.jsx("strong",{children:I.title}),s.jsx("span",{className:"life-goal-dialog__alert-type",children:I.alertType}),s.jsx("button",{type:"button",onClick:()=>q(I.id),children:"Remove"})]}),s.jsxs("p",{className:"life-goal-dialog__alert-time",children:[new Date(I.alertTime).toLocaleString()," • ",I.repeatPattern]}),I.message&&s.jsx("p",{children:I.message})]},I.id))})]})]}),s.jsxs("div",{className:"life-goal-dialog__actions",children:[s.jsx("button",{type:"button",className:"life-goal-dialog__cancel",onClick:n,children:"Cancel"}),s.jsx("button",{type:"submit",className:"life-goal-dialog__save",disabled:p||!u.title.trim(),children:p?"Saving...":"Save Goal"})]})]})]})}):null}async function Ey(e){return Ce()?ce().from("life_goal_steps").insert(e).select().returns().single():{data:{id:crypto.randomUUID(),goal_id:e.goal_id,step_order:e.step_order??0,title:e.title,description:e.description??null,completed:e.completed??!1,completed_at:e.completed_at??null,due_date:e.due_date??null,created_at:new Date().toISOString()},error:null}}async function Cy(e){return Ce()?ce().from("life_goal_substeps").insert(e).select().returns().single():{data:{id:crypto.randomUUID(),step_id:e.step_id,substep_order:e.substep_order??0,title:e.title,completed:e.completed??!1,completed_at:e.completed_at??null,created_at:new Date().toISOString()},error:null}}async function Ty(e){return Ce()?ce().from("life_goal_alerts").insert(e).select().returns().single():{data:{id:crypto.randomUUID(),goal_id:e.goal_id,user_id:e.user_id,alert_type:e.alert_type,alert_time:e.alert_time,title:e.title,message:e.message??null,sent:e.sent??!1,sent_at:e.sent_at??null,repeat_pattern:e.repeat_pattern??null,enabled:e.enabled??!0,created_at:new Date().toISOString()},error:null}}const Qo=Sy,Qj=li,Mr={title:"",description:"",targetDate:"",progressNotes:"",statusTag:Qj};function Gf({session:e}){var E;const{isConfigured:t}=Pn(),n=un(e),[r,a]=f.useState([]),[i,o]=f.useState(!1),[l,c]=f.useState(null),[u,d]=f.useState(null),[m,h]=f.useState(Mr),[b,y]=f.useState(!1),[g,w]=f.useState(!1),[p,_]=f.useState(null),[v,x]=f.useState(Mr),[j,k]=f.useState(null),[S,A]=f.useState(null),[P,R]=f.useState(null),[q,O]=f.useState("all"),[oe,z]=f.useState(!1),ne=f.useCallback(async()=>{if(!t){a([]),w(!1);return}o(!0),c(null),d(null);try{const{data:T,error:U}=await xl();if(U)throw U;a(T??[]),_(null),A(null)}catch(T){c(T instanceof Error?T.message:"Unable to load goals. Try again in a moment.")}finally{w(!0),o(!1)}},[t]);f.useEffect(()=>{t&&ne()},[(E=e==null?void 0:e.user)==null?void 0:E.id,t,ne]),f.useEffect(()=>{t||(a([]),w(!1),_(null),A(null))},[t]);const Z=f.useMemo(()=>{const T=Xs.reduce((U,J)=>(U[J]=0,U),{});return r.reduce((U,J)=>{const le=Qr(J.status_tag);return U[le]=(U[le]??0)+1,U},T)},[r]),I=f.useMemo(()=>q==="all"?r:r.filter(T=>Qr(T.status_tag)===q),[r,q]),C=f.useMemo(()=>I.filter(T=>!!(T.target_date&&new Date(T.target_date).getTime()<Date.now())),[I]),L=r.length,K=f.useMemo(()=>[{value:"all",label:"All statuses",count:L,description:"View every goal in this workspace."},...Xs.map(T=>({value:T,label:gr[T].label,count:Z[T]??0,description:gr[T].description}))],[Z,L]),ue=f.useMemo(()=>{if(!t&&!n)return"Connect Supabase to sync your goals.";if(L===0)return g?"No goals yet—start by capturing your first big win.":"Loading goals…";if(q==="all")return`${L} goal${L===1?"":"s"} in flight`;const T=gr[q].label.toLowerCase();return`Showing ${I.length} of ${L} goal${L===1?"":"s"} marked ${T}.`},[I.length,g,t,n,q,L]),de=T=>U=>{h(J=>({...J,[T]:U.target.value}))},De=T=>U=>{const J=U.target.value;x(le=>({...le,[T]:J}))},fe=async T=>{if(T.preventDefault(),d(null),!t){c("Supabase credentials are not configured. Add them to continue.");return}const U=m.title.trim();if(!U){c("Name your goal before saving.");return}y(!0),c(null),d(null);try{const J={title:U,description:m.description.trim()||null,target_date:m.targetDate?m.targetDate:null,user_id:e.user.id,progress_notes:m.progressNotes.trim()||null,status_tag:m.statusTag},{data:le,error:M}=await Du(J);if(M)throw M;le&&a(re=>[le,...re]),h(Mr),d(n?"Goal saved to demo data.":"Goal saved.")}catch(J){c(J instanceof Error?J.message:"Unable to save your goal.")}finally{y(!1)}},H=T=>{_(T.id),A(null),c(null),d(null),x({title:T.title??"",description:T.description??"",targetDate:T.target_date?T.target_date.slice(0,10):"",progressNotes:T.progress_notes??"",statusTag:Qr(T.status_tag)})},we=()=>{_(null),x(Mr)},B=async T=>{if(T.preventDefault(),d(null),!p){c("Select a goal to update before saving changes.");return}if(!t){c("Supabase credentials are not configured. Add them to continue.");return}const U=v.title.trim();if(!U){c("Name your goal before saving changes.");return}k(p),c(null),d(null);try{const J={title:U,description:v.description.trim()||null,target_date:v.targetDate||null,progress_notes:v.progressNotes.trim()||null,status_tag:v.statusTag},{data:le,error:M}=await Kj(p,J);if(M)throw M;a(re=>re.map(me=>me.id!==p?me:le||{...me,...J})),d(n?"Goal updated in demo data.":"Goal updated."),_(null),x(Mr)}catch(J){c(J instanceof Error?J.message:"Unable to update the goal.")}finally{k(null)}},D=T=>{A(T),_(U=>U===T?(x(Mr),null):U),c(null),d(null)},ae=()=>{A(null)},G=async T=>{if(!t){c("Supabase credentials are not configured. Add them to continue.");return}R(T),c(null),d(null);try{const{error:U}=await Jj(T);if(U)throw U;a(J=>J.filter(le=>le.id!==T)),d(n?"Goal removed from demo data.":"Goal removed."),p===T&&(_(null),x(Mr))}catch(U){c(U instanceof Error?U.message:"Unable to delete the goal right now.")}finally{R(null),A(null)}},ye=()=>{z(!0),c(null),d(null)},Se=()=>{z(!1)},Te=f.useCallback(async T=>{if(c(null),d(null),!t&&!n)throw c("Supabase credentials are not configured. Add them to continue."),new Error("Supabase not configured");try{const U={user_id:e.user.id,title:T.title,description:T.description||null,life_wheel_category:T.lifeWheelCategory,start_date:T.startDate||null,target_date:T.targetDate||null,estimated_duration_days:T.estimatedDurationDays?parseInt(T.estimatedDurationDays,10):null,timing_notes:T.timingNotes||null,status_tag:T.statusTag},{data:J,error:le}=await Du(U);if(le)throw le;if(!J)throw new Error("Failed to create goal");for(let M=0;M<T.steps.length;M++){const re=T.steps[M],me={goal_id:J.id,step_order:M,title:re.title,description:re.description||null,due_date:re.dueDate||null},{data:Pe,error:Ue}=await Ey(me);if(Ue)throw Ue;if(Pe)for(let Ae=0;Ae<re.substeps.length;Ae++){const Re=re.substeps[Ae],pt={step_id:Pe.id,substep_order:Ae,title:Re.title},{error:Et}=await Cy(pt);if(Et)throw Et}}for(const M of T.alerts){const re={goal_id:J.id,user_id:e.user.id,alert_type:M.alertType,alert_time:M.alertTime,title:M.title,message:M.message||null,repeat_pattern:M.repeatPattern,enabled:M.enabled},{error:me}=await Ty(re);if(me)throw me}a(M=>[J,...M]),d(n?"Life goal saved to demo data.":"Life goal created successfully!")}catch(U){throw c(U instanceof Error?U.message:"Failed to save life goal"),U}},[e.user.id,t,n]);return s.jsxs("section",{className:"goal-workspace",children:[s.jsxs("header",{className:"goal-workspace__header",children:[s.jsx("div",{children:s.jsx("h2",{children:"Goals & Habits workspace"})}),s.jsx("button",{type:"button",className:"goal-workspace__refresh",onClick:ne,disabled:i||!t,children:i?"Refreshing…":"Refresh goals"})]}),n?s.jsx("p",{className:"goal-workspace__status goal-workspace__status--info",children:"You're working with demo Supabase data stored locally. Capture goals freely and connect Supabase later to sync them to the cloud."}):t?null:s.jsxs("p",{className:"goal-workspace__status goal-workspace__status--warning",children:["Add your Supabase credentials to ",s.jsx("code",{children:".env.local"})," to load and persist goals. Until then, you can plan offline, but nothing will sync yet."]}),u?s.jsx("p",{className:"goal-workspace__status goal-workspace__status--success",children:u}):null,l?s.jsx("p",{className:"goal-workspace__status goal-workspace__status--error",children:l}):null,s.jsxs("div",{className:"goal-workspace__grid",children:[s.jsxs("div",{className:"goal-form",children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[s.jsx("h3",{children:"Capture a new goal"}),s.jsx("button",{type:"button",className:"goal-workspace__add-life-goal",onClick:ye,disabled:!t&&!n,style:{padding:"0.5rem 1rem",backgroundColor:"var(--color-primary, #4F46E5)",color:"white",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontWeight:"500",fontSize:"0.875rem",transition:"background-color 0.2s"},children:"✨ Add Life Goal"})]}),s.jsx("p",{style:{marginTop:"-0.5rem",marginBottom:"1rem",fontSize:"0.875rem",color:"var(--color-text-secondary, #6B7280)"},children:'Use the quick form below or click "✨ Add Life Goal" to create a detailed goal with AI assistance, steps, timing, and alerts.'}),s.jsxs("form",{onSubmit:fe,children:[s.jsxs("label",{className:"goal-form__field",children:[s.jsx("span",{children:"Goal title"}),s.jsx("input",{type:"text",value:m.title,onChange:de("title"),placeholder:"Launch the habit tracker beta",required:!0})]}),s.jsxs("label",{className:"goal-form__field",children:[s.jsx("span",{children:"Why it matters"}),s.jsx("textarea",{value:m.description,onChange:de("description"),placeholder:"Describe the outcome, success criteria, and the motivation behind this goal.",rows:4})]}),s.jsxs("label",{className:"goal-form__field",children:[s.jsx("span",{children:"Target date"}),s.jsx("input",{type:"date",value:m.targetDate,onChange:de("targetDate")})]}),s.jsxs("label",{className:"goal-form__field",children:[s.jsx("span",{children:"Status for weekly review"}),s.jsx("select",{value:m.statusTag,onChange:de("statusTag"),children:Qo.map(T=>s.jsx("option",{value:T.value,children:T.label},T.value))}),s.jsx("small",{className:"goal-form__hint",children:Kf(m.statusTag)})]}),s.jsxs("label",{className:"goal-form__field",children:[s.jsx("span",{children:"Weekly progress notes"}),s.jsx("textarea",{value:m.progressNotes,onChange:de("progressNotes"),placeholder:"Capture highlights, blockers, or next actions for your next review.",rows:4})]}),s.jsx("button",{type:"submit",className:"goal-form__submit",disabled:b,children:b?"Saving…":"Save goal"})]})]}),s.jsxs("div",{className:"goal-list",children:[s.jsxs("div",{className:"goal-list__header",children:[s.jsx("h3",{children:"Active goals"}),s.jsx("span",{className:"goal-list__meta",children:ue})]}),L>0?s.jsx("div",{className:"goal-list__filters",role:"group","aria-label":"Filter goals by status",children:K.map(T=>s.jsxs("button",{type:"button",className:`goal-list__filter ${q===T.value?"goal-list__filter--active":""}`,onClick:()=>O(T.value),"aria-pressed":q===T.value,children:[s.jsx("span",{className:"goal-list__filter-label",children:T.label}),s.jsx("span",{className:"goal-list__filter-count",children:T.count})]},T.value))}):null,s.jsx("ul",{className:"goal-list__items",children:I.map(T=>{const U=p===T.id,J=S===T.id,le=j===T.id,M=P===T.id;return s.jsx("li",{className:"goal-card",children:U?s.jsxs("form",{className:"goal-card__editor",onSubmit:B,children:[s.jsx("h4",{children:"Edit goal"}),s.jsxs("label",{className:"goal-card__field",children:[s.jsx("span",{children:"Goal title"}),s.jsx("input",{type:"text",value:v.title,onChange:De("title"),required:!0})]}),s.jsxs("label",{className:"goal-card__field",children:[s.jsx("span",{children:"Why it matters"}),s.jsx("textarea",{value:v.description,onChange:De("description"),rows:3})]}),s.jsxs("label",{className:"goal-card__field",children:[s.jsx("span",{children:"Target date"}),s.jsx("input",{type:"date",value:v.targetDate,onChange:De("targetDate")})]}),s.jsxs("label",{className:"goal-card__field",children:[s.jsx("span",{children:"Status for weekly review"}),s.jsx("select",{value:v.statusTag,onChange:De("statusTag"),children:Qo.map(re=>s.jsx("option",{value:re.value,children:re.label},re.value))}),s.jsx("small",{className:"goal-card__hint",children:Kf(v.statusTag)})]}),s.jsxs("label",{className:"goal-card__field",children:[s.jsx("span",{children:"Weekly progress notes"}),s.jsx("textarea",{value:v.progressNotes,onChange:De("progressNotes"),rows:3,placeholder:"Summarize learnings, blockers, or wins."})]}),s.jsxs("div",{className:"goal-card__editor-actions",children:[s.jsx("button",{type:"submit",className:"goal-card__button goal-card__button--primary",disabled:le,children:le?"Saving…":"Save changes"}),s.jsx("button",{type:"button",className:"goal-card__button goal-card__button--ghost",onClick:we,disabled:le,children:"Cancel"})]})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"goal-card__header",children:[s.jsxs("div",{className:"goal-card__title",children:[s.jsx("h4",{children:T.title}),s.jsx("span",{className:"goal-card__date",children:T.target_date?`Target: ${Xj(T.target_date)}`:"No target date set"})]}),s.jsx("span",{className:`goal-status goal-status--${Qr(T.status_tag)}`,children:Zj(T.status_tag)})]}),T.description?s.jsx("p",{children:T.description}):null,T.progress_notes?s.jsxs("div",{className:"goal-card__notes",children:[s.jsx("h5",{children:"Weekly notes"}),s.jsx("p",{children:T.progress_notes})]}):s.jsx("div",{className:"goal-card__notes goal-card__notes--empty",children:s.jsx("p",{children:"Use weekly notes to track wins and surface blockers for your next review."})}),s.jsxs("footer",{className:"goal-card__footer",children:[s.jsxs("span",{children:["Created ",ek(T.created_at)]}),s.jsx("div",{className:"goal-card__actions",children:J?s.jsxs(s.Fragment,{children:[s.jsx("button",{type:"button",className:"goal-card__button goal-card__button--danger",onClick:()=>void G(T.id),disabled:M,children:M?"Removing…":"Confirm delete"}),s.jsx("button",{type:"button",className:"goal-card__button goal-card__button--ghost",onClick:ae,disabled:M,children:"Cancel"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{type:"button",className:"goal-card__button goal-card__button--primary",onClick:()=>H(T),children:"Edit"}),s.jsx("button",{type:"button",className:"goal-card__button goal-card__button--danger",onClick:()=>D(T.id),children:"Delete"})]})})]})]})},T.id)})}),I.length===0&&L>0?s.jsx("p",{className:"goal-list__empty",children:q==="all"?"No goals match the current filters.":gr[q].empty}):null,I.length>0&&C.length>0?s.jsx("p",{className:"goal-list__status",children:C.length===I.length?"Every goal here has passed its target date—time to celebrate and set the next milestone!":`${C.length} goal${C.length===1?" has":"s have"} crossed the target date.`}):null]})]}),s.jsx(Ny,{session:e,isOpen:oe,onClose:Se,onSave:Te,initialCategory:null})]})}function Xj(e){const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function Zj(e){const t=Qr(e),n=Qo.find(r=>r.value===t);return(n==null?void 0:n.label)??"On track"}function Kf(e){const t=Qo.find(n=>n.value===e);return(t==null?void 0:t.description)??""}function ek(e){const t=new Date(e);if(Number.isNaN(t.getTime()))return e;const n=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}),r=Date.now(),a=t.getTime()-r,i=1e3*60*60*24,o=Math.round(a/i);if(Math.abs(o)<1){const u=Math.round(a/36e5);return u===0?"just now":n.format(u,"hour")}if(Math.abs(o)<30)return n.format(o,"day");const l=Math.round(o/30);if(Math.abs(l)<12)return n.format(l,"month");const c=Math.round(l/12);return n.format(c,"year")}async function tk(e){return Ce()?ce().from("goal_reflections").select("*").eq("goal_id",e).order("entry_date",{ascending:!1}).order("created_at",{ascending:!1}).returns():{data:$j(e),error:null}}async function nk(e){return Ce()?ce().from("goal_reflections").insert(e).select().returns().single():{data:Mj(e),error:null}}async function rk(e){return Ce()?ce().from("goal_reflections").delete().eq("id",e).select().returns().single():{data:Uj(e),error:null}}async function sk(e,t,n){if(!e)return{data:[],error:null,source:"demo"};if(!Ce())return{data:Ji(e,t,n),error:null,source:"demo"};const r=ce();try{const a={goalId:e,goalTitle:t,reflections:n.slice(0,10).map(c=>({id:c.id,entryDate:c.entry_date,confidence:c.confidence??null,highlight:c.highlight??null,challenge:c.challenge??null}))},{data:i,error:o}=await r.functions.invoke("generate-reflection-prompts",{body:a});if(o)return console.warn("Falling back to demo follow-up prompts after Supabase function error.",o),{data:Ji(e,t,n),error:null,source:"demo"};const l=ak(e,i);return l.length>0?{data:l,error:null,source:"supabase"}:{data:Ji(e,t,n),error:null,source:"demo"}}catch(a){return console.warn("Falling back to demo follow-up prompts after invocation failure.",a),{data:Ji(e,t,n),error:null,source:"demo"}}}function ak(e,t){return!t||!Array.isArray(t.prompts)?[]:t.prompts.map((n,r)=>{const a=Array.isArray(n.actions)?n.actions.filter(Boolean):[];return!n.title||!n.summary||a.length===0?null:{id:n.id||`${e}-supabase-${r}`,title:n.title,summary:n.summary,focus:n.focus||"Next step",actions:a,confidenceSignal:n.confidenceSignal??"sustain"}}).filter(n=>!!n)}function Ji(e,t,n){if(!n.length)return[];const a=[...n].sort((h,b)=>{const y=new Date(h.entry_date??h.created_at??0).getTime();return new Date(b.entry_date??b.created_at??0).getTime()-y}).slice(0,6),i=a[0];if(!i)return[];const o=a[1]??null,l=Dy(i.confidence),c=Jf(a.slice(0,3)),u=Jf(a.slice(3,6)),d=c!==null&&u!==null?Number((c-u).toFixed(1)):null,m=[];return i.highlight&&m.push({id:`${e}-celebrate`,title:"Amplify this week’s highlight",summary:`Protect the momentum from “${i.highlight}” so it becomes a repeatable win${t?` for ${t}`:""}.`,focus:ik(i.highlight),actions:lk(i.highlight),confidenceSignal:l&&l>=4?"celebrate":"sustain"}),i.challenge&&m.push({id:`${e}-challenge`,title:"Coach through the current blocker",summary:`Break “${i.challenge}” into the next coaching experiment so progress returns quickly.`,focus:ok(i.challenge),actions:ck(i.challenge),confidenceSignal:l&&l<=3?"boost":"sustain"}),d!==null&&(d<=-.3?m.push({id:`${e}-stabilize`,title:"Stabilize the confidence trend",summary:`Confidence dipped ${Math.abs(d)} points across recent reflections. Design a reset ritual to steady the next review.`,focus:"Confidence recovery",actions:uk(i,o),confidenceSignal:"boost"}):d>=.3&&m.push({id:`${e}-double-down`,title:"Double down on what’s working",summary:`Confidence climbed ${d} points lately. Capture the routines that created the lift so you can repeat them.`,focus:"Momentum design",actions:dk(i,o),confidenceSignal:"celebrate"})),m.length===0&&m.push({id:`${e}-reflection-cadence`,title:"Plan the next reflection touchpoint",summary:"Translate your notes into one concrete win, one unlock, and one check-in date.",focus:"Weekly cadence",actions:["List one win you want to extend into next week and add it to your calendar.","Identify the single biggest unlock you can deliver in the next 72 hours.","Schedule your next reflection to keep the coaching rhythm alive."],confidenceSignal:"sustain"}),m.slice(0,3)}function Dy(e){return typeof e!="number"||Number.isNaN(e)?null:Math.min(5,Math.max(1,Number(e.toFixed(1))))}function Jf(e){const t=e.map(r=>Dy(r.confidence)).filter(r=>r!==null);if(t.length===0)return null;const n=t.reduce((r,a)=>r+a,0);return Number((n/t.length).toFixed(1))}function ik(e){const t=e.toLowerCase();return/(team|collaboration|partner|client)/.test(t)?"Relationship win":t.includes("launch")||t.includes("release")||t.includes("ship")?"Delivery milestone":t.includes("learning")||t.includes("workshop")||t.includes("research")?"Learning loop":"Momentum boost"}function ok(e){const t=e.toLowerCase();return t.includes("time")||t.includes("schedule")||t.includes("calendar")?"Timeboxing":t.includes("stakeholder")||t.includes("communication")||t.includes("alignment")?"Stakeholder sync":t.includes("resource")||t.includes("budget")||t.includes("support")?"Resource planning":t.includes("clarity")||t.includes("scope")||t.includes("plan")?"Clarity reset":"Blocker focus"}function lk(e){const t=e.toLowerCase();return t.includes("team")||t.includes("partner")||t.includes("client")?["Capture the collaboration moves that made the win possible in your playbook.","Send a quick thank-you or recap to the partner to reinforce the behavior.","Book a 15-minute retro to agree on how to repeat the success next sprint."]:t.includes("launch")||t.includes("release")||t.includes("ship")?["Document the launch checklist that kept the delivery smooth.","Identify one metric that proves the launch is creating impact.","Schedule a quick review to decide the next enhancement while excitement is high."]:t.includes("learning")||t.includes("research")||t.includes("experiment")?["Summarize the top insight you want to apply immediately.","Share the learning with one teammate or stakeholder.","Pick a follow-up experiment to run within the next week."]:["Write down the core behavior that led to the win and add it to your weekly ritual.","Identify who needs to know about the progress and send a short update.","Set a reminder to repeat the winning action in next week’s schedule."]}function ck(e){const t=e.toLowerCase();return t.includes("time")||t.includes("schedule")||t.includes("calendar")?["Block a focused working session dedicated to the stuck work.","Drop one lower-priority commitment to create breathing room.","Share your updated schedule with stakeholders so expectations stay aligned."]:t.includes("stakeholder")||t.includes("communication")||t.includes("alignment")?["Draft the single message you need stakeholders to align on.","Book a quick sync to close gaps or reset expectations.","Document decisions in a shared space so momentum is easy to reference."]:t.includes("resource")||t.includes("budget")||t.includes("support")?["List the resources you truly need versus nice-to-haves.","Identify one sponsor who can unlock the missing support.","Propose a lightweight experiment that fits within the current constraints."]:t.includes("clarity")||t.includes("scope")||t.includes("plan")?["Rewrite the desired outcome in one sentence to regain clarity.","Break the work into the next two concrete milestones.","Confirm the plan with your team or coach to reduce ambiguity."]:["Define what success looks like for the blocked area in one sentence.","List the first tiny move that would create momentum within 48 hours.","Ask for a specific resource, partner, or decision to clear the path."]}function uk(e,t){const n=e.highlight?`Bring back the energy from “${e.highlight}.”`:"Reconnect with last month’s wins.",r=t!=null&&t.challenge?`Close the loop on the lingering blocker: “${t.challenge}.”`:"Review your prior blockers to confirm they are resolved.";return[n,r,"Decide on one ritual (daily standup, end-of-week retro, etc.) that will rebuild confidence steadily."]}function dk(e,t){const n=e.highlight?`List the ingredients that made “${e.highlight}” possible.`:"Capture the behaviors that lifted confidence.",r=t!=null&&t.highlight?`Contrast this win with last week’s highlight (“${t.highlight}”) to spot the throughline.`:"Note the throughline between recent reflections to make the momentum durable.";return[n,r,"Decide how you will celebrate progress and communicate the next bold step."]}const hk=[{value:5,label:"Energized",description:"Progress is flowing and support is locked in."},{value:4,label:"Optimistic",description:"Momentum is strong with a few items to watch."},{value:3,label:"Steady",description:"Holding steady with balanced wins and challenges."},{value:2,label:"Wobbly",description:"Momentum is slipping—focus on unblocking the next step."},{value:1,label:"Stalled",description:"Goal needs attention and a fresh plan to move forward."}],Xo=hk.reduce((e,t)=>(e[t.value]=t,e),{}),fk=new Intl.DateTimeFormat(void 0,{month:"short",year:"numeric"}),mk=640,pk=260,ws=48;function gk(e){const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}function Yf(e){if(!e||!Xo[e])return"Not recorded";const t=Xo[e];return`${e}/5 · ${t.label}`}function _k(e){if(typeof e!="number"||Number.isNaN(e))return null;const t=Math.min(5,Math.max(1,e));return Math.round(t*10)/10}function yk(e){const t=new Map;for(const o of e){if(!o.entry_date)continue;const l=new Date(o.entry_date);if(Number.isNaN(l.getTime()))continue;const c=new Date(l.getFullYear(),l.getMonth(),1),u=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`,d=_k(o.confidence??null);if(d===null)continue;const m=t.get(u);m?m.confidences.push(d):t.set(u,{monthStart:c,confidences:[d]})}if(t.size===0)return null;const n=Array.from(t.entries()).map(([o,l])=>{const c=l.confidences.reduce((d,m)=>d+m,0),u=Number((c/l.confidences.length).toFixed(2));return{label:fk.format(l.monthStart),monthKey:o,monthStart:l.monthStart,average:u,entryCount:l.confidences.length}}).sort((o,l)=>o.monthStart.getTime()-l.monthStart.getTime()),r=n.length>0?n[n.length-1]:void 0;if(!r)return null;const a=n.length>1?n[n.length-2]:null,i=a?bk(r,a):`Confidence is averaging ${r.average.toFixed(1)} this month. Add more reflections to build your trendline.`;return{points:n,summary:i}}function bk(e,t){const n=Number((e.average-t.average).toFixed(1));return Math.abs(n)<.05?`Confidence held steady at ${e.average.toFixed(1)} from ${t.label} to ${e.label}.`:`Confidence ${n>0?"climbed":"dipped"} ${vk(n)} between ${t.label} and ${e.label}.`}function vk(e,t=1){const n=Math.abs(e).toFixed(t);return`${e>0?"+":"−"}${n}`}function wk(e){if(e.length===0)return null;const t=mk,n=pk,r=ws,a=t-r*2,i=n-r*2,o=n-r,l=e.map((g,w)=>e.length===1?r+a/2:r+w/(e.length-1)*a),c=e.map(g=>{const w=(g.average-1)/4;return o-w*i}),u=l.map((g,w)=>{const p=c[w];return`${w===0?"M":"L"}${g.toFixed(2)},${p.toFixed(2)}`}).join(" "),d=l[0],m=l[l.length-1],h=[`M${d.toFixed(2)},${o.toFixed(2)}`].concat(l.map((g,w)=>`L${g.toFixed(2)},${c[w].toFixed(2)}`),`L${m.toFixed(2)},${o.toFixed(2)}`,"Z").join(" "),b=e.map((g,w)=>({cx:Number(l[w].toFixed(2)),cy:Number(c[w].toFixed(2)),label:g.label,average:Number(g.average.toFixed(1))})),y=[5,4,3,2,1].map(g=>{const w=(g-1)/4,p=o-w*i;return{value:g,y:Number(p.toFixed(2))}});return{width:t,height:n,path:u,areaPath:h,points:b,baselineY:o,yTicks:y}}function oc(){return new Date().toISOString().slice(0,10)}function xk({session:e}){var Se,Te;const{isConfigured:t}=Pn(),n=un(e),[r,a]=f.useState([]),[i,o]=f.useState([]),[l,c]=f.useState(""),[u,d]=f.useState(!1),[m,h]=f.useState(!1),[b,y]=f.useState(null),[g,w]=f.useState(!1),[p,_]=f.useState(null),[v,x]=f.useState(null),[j,k]=f.useState([]),[S,A]=f.useState(null),[P,R]=f.useState(!1),[q,O]=f.useState(null),[oe,z]=f.useState(oc()),[ne,Z]=f.useState(4),[I,C]=f.useState(""),[L,K]=f.useState(""),ue=f.useId(),de=f.useMemo(()=>r.find(E=>E.id===l)??null,[r,l]),De=f.useMemo(()=>yk(i),[i]),fe=f.useMemo(()=>De?wk(De.points):null,[De]),H=f.useCallback(async()=>{if(!t){a([]),c("");return}d(!0),x(null);try{const{data:E,error:T}=await xl();if(T)throw T;const U=(E??[]).filter(J=>J.user_id===e.user.id);if(a(U),U.length===0){c(""),o([]);return}c(J=>{var le;return J&&U.some(M=>M.id===J)?J:((le=U[0])==null?void 0:le.id)??""})}catch(E){x(E instanceof Error?E.message:"Unable to load goals for reflections right now."),a([]),c("")}finally{d(!1)}},[e,t,n]),we=f.useCallback(async E=>{if(!E){o([]),k([]),A(null),O(null);return}if(!t){o([]),k([]),A(null),O(null);return}h(!0),x(null);try{const{data:T,error:U}=await tk(E);if(U)throw U;o(T??[])}catch(T){x(T instanceof Error?T.message:"Unable to load your reflection history. Please try again shortly."),o([]),k([]),A(null),O(null)}finally{h(!1)}},[e,t,n]);f.useEffect(()=>{if(!t&&!n){a([]),o([]),k([]),A(null),O(null),c("");return}H()},[(Se=e==null?void 0:e.user)==null?void 0:Se.id,t,n,H]),f.useEffect(()=>{if(!l){o([]),k([]),A(null),O(null);return}we(l)},[l,we]),f.useEffect(()=>{y(null)},[l]);const B=E=>{c(E.target.value)},D=async E=>{if(E.preventDefault(),!t&&!n){y({kind:"error",message:"Connect Supabase to save reflections."});return}if(!l){y({kind:"error",message:"Choose a goal before saving a reflection."});return}const T=I.trim(),U=L.trim();if(!T){y({kind:"error",message:"Capture at least one highlight from your latest progress."});return}w(!0),y(null);try{const{data:J,error:le}=await nk({goal_id:l,user_id:e.user.id,entry_date:oe,confidence:ne,highlight:T,challenge:U||null});if(le)throw le;J&&o(M=>[J,...M.filter(re=>re.id!==J.id)]),y({kind:"success",message:"Reflection saved. Keep momentum insights flowing."}),z(oc()),Z(4),C(""),K("")}catch(J){y({kind:"error",message:J instanceof Error?J.message:"Unable to save this reflection. Please try again."})}finally{w(!1)}},ae=async E=>{if(!t&&!n){y({kind:"error",message:"Connect Supabase to manage saved reflections."});return}if(window.confirm("Remove this reflection? This action cannot be undone.")){_(E.id),y(null);try{const{error:U}=await rk(E.id);if(U)throw U;o(J=>J.filter(le=>le.id!==E.id)),y({kind:"success",message:"Reflection removed."})}catch(U){y({kind:"error",message:U instanceof Error?U.message:"Unable to delete the reflection right now."})}finally{_(null)}}};f.useEffect(()=>{if(!l||i.length===0){k([]),A(null),O(null),R(!1);return}let E=!1;R(!0),O(null);const T=de==null?void 0:de.title;return(async()=>{try{const{data:U,source:J}=await sk(l,T,i);if(E)return;k(U??[]),A(J)}catch(U){if(E)return;k([]),A(null),O(U instanceof Error?U.message:"Unable to translate reflections into prompts right now.")}finally{if(E)return;R(!1)}})(),()=>{E=!0}},[l,i,de==null?void 0:de.title]);const G=((Te=Xo[ne])==null?void 0:Te.description)??"",ye=f.useMemo(()=>r.length>0&&!!l,[r,l]);return s.jsxs("section",{className:"goal-reflection-journal",children:[s.jsxs("header",{className:"goal-reflection-journal__header",children:[s.jsxs("div",{children:[s.jsx("h2",{children:"Goal reflection journal"}),s.jsx("p",{children:"Log weekly insights for each goal, capture what worked, and note the challenges that need support. The confidence score keeps your focus tuned to momentum swings."})]}),r.length>0?s.jsxs("label",{className:"goal-reflection-journal__goal-picker",children:[s.jsx("span",{children:"Viewing"}),s.jsx("select",{value:l,onChange:B,disabled:u,children:r.map(E=>s.jsx("option",{value:E.id,children:E.title},E.id))})]}):null]}),n?s.jsx("p",{className:"goal-reflection-journal__status goal-reflection-journal__status--info",children:"Reflections are stored locally while you explore the demo workspace. Add Supabase credentials to sync journal entries across devices."}):t?null:s.jsx("p",{className:"goal-reflection-journal__status goal-reflection-journal__status--warning",children:"Connect Supabase to persist reflections and collaborate with your team."}),b?s.jsx("p",{className:`goal-reflection-journal__status goal-reflection-journal__status--${b.kind}`,role:"status",children:b.message}):null,v?s.jsx("p",{className:"goal-reflection-journal__status goal-reflection-journal__status--error",children:v}):null,!t&&!n?s.jsx("p",{className:"goal-reflection-journal__empty",children:"Add your Supabase credentials to unlock the reflection journal and keep weekly reviews in sync."}):r.length===0&&!u?s.jsx("p",{className:"goal-reflection-journal__empty",children:"Create a goal first, then return here to log highlights, challenges, and confidence."}):s.jsxs("div",{className:"goal-reflection-journal__layout",children:[s.jsxs("form",{className:"goal-reflection-journal__form",onSubmit:D,children:[s.jsx("h3",{children:"Log a reflection"}),s.jsxs("label",{className:"goal-reflection-journal__field",children:[s.jsx("span",{children:"Date"}),s.jsx("input",{type:"date",value:oe,max:oc(),onChange:E=>z(E.target.value),required:!0,disabled:!ye})]}),s.jsxs("label",{className:"goal-reflection-journal__field",children:[s.jsx("span",{children:"Confidence"}),s.jsx("input",{type:"range",min:1,max:5,step:1,value:ne,onChange:E=>Z(Number(E.target.value)),disabled:!ye}),s.jsxs("div",{className:"goal-reflection-journal__confidence",children:[s.jsx("strong",{children:Yf(ne)}),s.jsx("span",{children:G})]})]}),s.jsxs("label",{className:"goal-reflection-journal__field",children:[s.jsx("span",{children:"Highlight"}),s.jsx("textarea",{value:I,onChange:E=>C(E.target.value),placeholder:"Wins, breakthroughs, or learning moments from this week.",rows:3,disabled:!ye,required:!0})]}),s.jsxs("label",{className:"goal-reflection-journal__field",children:[s.jsx("span",{children:"Challenge"}),s.jsx("textarea",{value:L,onChange:E=>K(E.target.value),placeholder:"Roadblocks to unblock next week. Optional but encouraged.",rows:3,disabled:!ye})]}),s.jsx("button",{type:"submit",className:"goal-reflection-journal__submit",disabled:!ye||g,children:g?"Saving…":"Save reflection"})]}),s.jsxs("div",{className:"goal-reflection-journal__history",children:[s.jsxs("div",{className:"goal-reflection-journal__history-header",children:[s.jsx("h3",{children:"Reflection history"}),s.jsx("p",{children:de?`Tracking ${i.length} reflection${i.length===1?"":"s"} for ${de.title}.`:"Select a goal to view its reflection history."})]}),s.jsxs("article",{className:"goal-reflection-journal__trend-card",children:[s.jsxs("header",{className:"goal-reflection-journal__trend-header",children:[s.jsx("h4",{children:"Confidence trendline"}),s.jsx("p",{children:m?"Crunching confidence history…":(De==null?void 0:De.summary)??"Log reflections each month to reveal how confidence shifts over time."})]}),m?s.jsx("p",{className:"goal-reflection-journal__trend-empty",children:"Loading trend…"}):De&&fe?s.jsxs(s.Fragment,{children:[s.jsx("figure",{className:"goal-reflection-journal__trend-chart",children:s.jsxs("svg",{viewBox:`0 0 ${fe.width} ${fe.height}`,role:"img","aria-labelledby":ue,children:[s.jsx("title",{id:ue,children:"Confidence trendline"}),s.jsxs("desc",{children:["Monthly average confidence scores for ",(de==null?void 0:de.title)??"the selected goal","."]}),s.jsx("defs",{children:s.jsxs("linearGradient",{id:`${ue}-gradient`,x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"0%",stopColor:"#2563eb",stopOpacity:"0.4"}),s.jsx("stop",{offset:"100%",stopColor:"#2563eb",stopOpacity:"0"})]})}),s.jsx("g",{className:"goal-reflection-journal__trend-grid",children:fe.yTicks.map(E=>s.jsxs("g",{children:[s.jsx("line",{x1:ws,x2:fe.width-ws,y1:E.y,y2:E.y,className:"goal-reflection-journal__trend-gridline"}),s.jsx("text",{x:ws-14,y:E.y+4,className:"goal-reflection-journal__trend-axis-label",children:E.value})]},E.value))}),s.jsx("path",{d:fe.areaPath,fill:`url(#${ue}-gradient)`}),s.jsx("path",{d:fe.path,fill:"none",stroke:"#2563eb",strokeWidth:3,strokeLinejoin:"round",strokeLinecap:"round"}),fe.points.map(E=>s.jsxs("g",{className:"goal-reflection-journal__trend-point",children:[s.jsx("circle",{cx:E.cx,cy:E.cy,r:10,fill:"none",stroke:"#bfdbfe",strokeWidth:2}),s.jsx("circle",{cx:E.cx,cy:E.cy,r:6,fill:"#2563eb"})]},E.label)),s.jsx("line",{x1:ws,x2:fe.width-ws,y1:fe.baselineY,y2:fe.baselineY,className:"goal-reflection-journal__trend-baseline"})]})}),s.jsx("ul",{className:"goal-reflection-journal__trend-legend",children:De.points.map(E=>s.jsxs("li",{children:[s.jsx("span",{className:"goal-reflection-journal__trend-month",children:E.label}),s.jsx("strong",{className:"goal-reflection-journal__trend-average",children:E.average.toFixed(1)}),s.jsx("span",{className:"goal-reflection-journal__trend-count",children:E.entryCount===1?"1 entry":`${E.entryCount} entries`})]},E.monthKey))})]}):s.jsx("p",{className:"goal-reflection-journal__trend-empty",children:"Log at least one reflection per month to unlock the confidence trendline."})]}),s.jsxs("article",{className:"goal-reflection-journal__prompts-card",children:[s.jsxs("header",{className:"goal-reflection-journal__prompts-header",children:[s.jsx("h4",{children:"AI-assisted follow-up prompts"}),s.jsx("p",{children:"Turn your latest reflections into next-step coaching experiments that keep the goal moving."})]}),q?s.jsx("p",{className:"goal-reflection-journal__prompts-status goal-reflection-journal__prompts-status--error",children:q}):null,P?s.jsx("p",{className:"goal-reflection-journal__prompts-status",children:"Generating tailored prompts…"}):j.length>0?s.jsx("ul",{className:"goal-reflection-journal__prompts-list",children:j.map(E=>s.jsxs("li",{className:`goal-reflection-journal__prompt goal-reflection-journal__prompt--${E.confidenceSignal}`,children:[s.jsx("span",{className:"goal-reflection-journal__prompt-focus",children:E.focus}),s.jsx("h5",{children:E.title}),s.jsx("p",{children:E.summary}),s.jsx("ol",{children:E.actions.map((T,U)=>s.jsx("li",{children:T},U))})]},E.id))}):s.jsx("p",{className:"goal-reflection-journal__prompts-status",children:"Add a new reflection to unlock tailored next steps for your weekly review."}),S==="demo"?s.jsxs("p",{className:"goal-reflection-journal__prompts-footnote",children:["Prompts are generated locally so you can iterate without Supabase. Connect your Supabase Edge Function named ",s.jsx("code",{children:"generate-reflection-prompts"})," to power AI-authored guidance for your team."]}):null]}),m?s.jsx("p",{className:"goal-reflection-journal__empty",children:"Loading reflections…"}):i.length===0?s.jsx("p",{className:"goal-reflection-journal__empty",children:"Log your first reflection to start visualizing confidence swings and weekly momentum."}):s.jsx("ul",{className:"goal-reflection-journal__list",children:i.map(E=>{const T=Yf(E.confidence),U=E.confidence?Xo[E.confidence]:void 0;return s.jsxs("li",{className:"goal-reflection-journal__item",children:[s.jsxs("header",{children:[s.jsxs("div",{children:[s.jsx("h4",{children:gk(E.entry_date)}),s.jsx("p",{className:"goal-reflection-journal__confidence-label",children:T}),U?s.jsx("p",{className:"goal-reflection-journal__confidence-description",children:U.description}):null]}),s.jsx("button",{type:"button",onClick:()=>void ae(E),className:"goal-reflection-journal__delete",disabled:p===E.id||g,children:p===E.id?"Removing…":"Delete"})]}),s.jsxs("div",{className:"goal-reflection-journal__note",children:[s.jsx("h5",{children:"Highlight"}),s.jsx("p",{children:E.highlight})]}),E.challenge?s.jsxs("div",{className:"goal-reflection-journal__note goal-reflection-journal__note--challenge",children:[s.jsx("h5",{children:"Challenge"}),s.jsx("p",{children:E.challenge})]}):null]},E.id)})})]})]})]})}async function jk(e,t=12){return Ce()?ce().from("checkins").select("*").eq("user_id",e).order("date",{ascending:!1}).limit(t).returns():{data:Dj(e||We,t),error:null}}async function Qf(e){return Ce()?ce().from("checkins").insert(e).select().returns().single():{data:Aj(e),error:null}}async function kk(e,t){return Ce()?ce().from("checkins").update(t).eq("id",e).select().returns().single():{data:Ij(e,t),error:null}}const st=[{key:"spirituality_community",label:"Spirituality & Community"},{key:"finance_wealth",label:"Finance & Wealth"},{key:"love_relations",label:"Love & Relations"},{key:"fun_creativity",label:"Fun & Creativity"},{key:"career_development",label:"Career & Self Development"},{key:"health_fitness",label:"Health & Fitness"},{key:"family_friends",label:"Family & Friends"},{key:"living_spaces",label:"Living Spaces"}],Bn=[{id:"q1",categoryKey:"spirituality_community",text:"How connected do you feel to your spiritual or community practices?",imageNumber:1},{id:"q2",categoryKey:"spirituality_community",text:"How often do you engage in activities that nurture your sense of purpose?",imageNumber:2},{id:"q3",categoryKey:"spirituality_community",text:"How supported do you feel by your community or spiritual circle?",imageNumber:3},{id:"q4",categoryKey:"finance_wealth",text:"How satisfied are you with your current financial situation?",imageNumber:4},{id:"q5",categoryKey:"finance_wealth",text:"How well are you managing your savings and investments?",imageNumber:5},{id:"q6",categoryKey:"finance_wealth",text:"How confident do you feel about your financial future?",imageNumber:6},{id:"q7",categoryKey:"love_relations",text:"How fulfilling is your romantic relationship or dating life?",imageNumber:7},{id:"q8",categoryKey:"love_relations",text:"How well do you communicate with your romantic partner?",imageNumber:8},{id:"q9",categoryKey:"love_relations",text:"How much quality time do you spend with your loved one?",imageNumber:9},{id:"q10",categoryKey:"fun_creativity",text:"How much time do you dedicate to hobbies and creative pursuits?",imageNumber:10},{id:"q11",categoryKey:"fun_creativity",text:"How often do you engage in activities that bring you joy?",imageNumber:11},{id:"q12",categoryKey:"fun_creativity",text:"How satisfied are you with your work-life balance for fun activities?",imageNumber:12},{id:"q13",categoryKey:"career_development",text:"How satisfied are you with your career progress?",imageNumber:13},{id:"q14",categoryKey:"career_development",text:"How much are you learning and growing in your professional life?",imageNumber:14},{id:"q15",categoryKey:"career_development",text:"How aligned is your work with your personal goals?",imageNumber:15},{id:"q16",categoryKey:"health_fitness",text:"How would you rate your overall physical health?",imageNumber:16},{id:"q17",categoryKey:"health_fitness",text:"How consistent are you with exercise and movement?",imageNumber:17},{id:"q18",categoryKey:"health_fitness",text:"How well are you taking care of your nutrition and sleep?",imageNumber:18},{id:"q19",categoryKey:"family_friends",text:"How strong is your connection with family members?",imageNumber:19},{id:"q20",categoryKey:"family_friends",text:"How often do you spend quality time with friends?",imageNumber:20},{id:"q21",categoryKey:"family_friends",text:"How supported do you feel by your family and friends?",imageNumber:21},{id:"q22",categoryKey:"living_spaces",text:"How comfortable and organized is your living environment?",imageNumber:22},{id:"q23",categoryKey:"living_spaces",text:"How much does your home reflect your personality and values?",imageNumber:23},{id:"q24",categoryKey:"living_spaces",text:"How satisfied are you with your current living situation?",imageNumber:24}],Yd=10,Ea=320,Xf=5,yo=new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric",year:"numeric"});function Zf(e){return e.toISOString().slice(0,10)}function Hr(){return st.reduce((e,t)=>(e[t.key]=5,e),{})}function Rs(e){const t=Hr();if(e&&typeof e=="object"&&!Array.isArray(e)){const n=e;for(const r of st){const a=n[r.key];t[r.key]=typeof a=="number"?ci(a):0}}return t}function ci(e){return Number.isNaN(e)?0:Math.min(Yd,Math.max(0,Math.round(e)))}function Zo(e){const t=st.reduce((n,r)=>n+(e[r.key]??0),0);return Number((t/st.length).toFixed(1))}function Sk(e){if(e.length<2)return null;const[t,n]=e,r=Rs(t.scores),a=Rs(n.scores),i=st.map(y=>{const g=ci(r[y.key]??0),w=ci(a[y.key]??0);return{key:y.key,label:y.label,delta:g-w,latest:g,previous:w}}),o=i.filter(y=>y.delta>0).sort((y,g)=>g.delta-y.delta).slice(0,3),l=i.filter(y=>y.delta<0).sort((y,g)=>y.delta-g.delta).slice(0,3),c=i.filter(y=>y.delta===0).length,u=Zo(r),d=Zo(a),m=Number((u-d).toFixed(1)),h=Math.abs(m)<.05?0:m,b=h>0?"up":h<0?"down":"steady";return{previousLabel:yo.format(new Date(n.date)),latestAverage:u,previousAverage:d,averageDelta:h,averageDirection:b,improvements:o,declines:l,stableCount:c}}function em(e){return e===0?"0":`${e>0?"+":"−"}${Math.abs(e)}`}function Nk(e,t=1){if(Math.abs(e)<.05)return"0";const n=Math.abs(e).toFixed(t);return`${e>0?"+":"−"}${n}`}function lc(e){return Math.round((e-1)*5)}function tm(e){const t=Ea/2,n=t-36,r=(c,u)=>{const d=Math.PI*2*u/st.length-Math.PI/2,m=t+Math.cos(d)*n*c,h=t+Math.sin(d)*n*c;return{x:m,y:h}},a=st.map((c,u)=>{const m=ci(e[c.key]??0)/Yd,{x:h,y:b}=r(m,u);return`${h},${b}`}).join(" "),i=Array.from({length:Xf},(c,u)=>{const d=(u+1)/Xf,m=st.map((h,b)=>{const{x:y,y:g}=r(d,b);return`${y},${g}`}).join(" ");return{ratio:d,points:m}}),o=st.map((c,u)=>{const{x:d,y:m}=r(1,u);return{key:c.key,x1:t,y1:t,x2:d,y2:m}}),l=st.map((c,u)=>{const d=n+20,m=Math.PI*2*u/st.length-Math.PI/2,h=t+Math.cos(m)*d,b=t+Math.sin(m)*d;let y;Math.abs(Math.cos(m))<.2?y="middle":Math.cos(m)>0?y="start":y="end";let g;return Math.sin(m)>.2?g="text-before-edge":Math.sin(m)<-.2?g="text-after-edge":g="middle",{key:c.key,text:c.label,x:h,y:b,anchor:y,baseline:g}});return{polygonPoints:a,levelPolygons:i,axes:o,labels:l}}function Ek({session:e}){var B;const{isConfigured:t}=Pn(),n=un(e),[r,a]=f.useState([]),[i,o]=f.useState(!1),[l,c]=f.useState(!1),[u,d]=f.useState(null),[m,h]=f.useState(null),[b,y]=f.useState(()=>Zf(new Date)),[g,w]=f.useState(()=>Hr()),[p,_]=f.useState(null),[v,x]=f.useState(!1),[j,k]=f.useState(0),[S,A]=f.useState(new Map),[P,R]=f.useState(null),[q,O]=f.useState(""),oe=f.useCallback(async()=>{if(!t&&!n){a([]),_(null);return}o(!0),d(null);try{const{data:D,error:ae}=await jk(e.user.id);if(ae)throw ae;const G=D??[];a(G),G.length>0?_(ye=>ye??G[0].id):_(null)}catch(D){d(D instanceof Error?D.message:"Unable to load check-in history right now. Please try again soon.")}finally{o(!1)}},[t,n,e.user.id]);f.useEffect(()=>{t&&oe()},[(B=e==null?void 0:e.user)==null?void 0:B.id,t,n,oe]),f.useEffect(()=>{!t&&!n&&(a([]),_(null))},[t,n]),f.useEffect(()=>{if(r.length===0){w(Hr());return}const D=r[0];w(Rs(D.scores))},[r]);const z=f.useMemo(()=>p?r.find(D=>D.id===p)??null:r[0]??null,[p,r]),ne=f.useMemo(()=>z?Rs(z.scores):null,[z]),Z=f.useMemo(()=>ne?tm(ne):null,[ne]),I=f.useMemo(()=>ne?Zo(ne):0,[ne]),C=f.useMemo(()=>Sk(r),[r]),L=D=>ae=>{const G=ci(Number(ae.target.value));w(ye=>({...ye,[D]:G}))},K=async D=>{if(D.preventDefault(),d(null),h(null),!e){d("Sign in to record your life wheel check-ins.");return}if(!t&&!n){d("Supabase credentials are missing. Update your environment variables to continue.");return}c(!0);try{const ae=r.find(G=>G.date===b);if(ae){const{data:G,error:ye}=await kk(ae.id,{date:b,scores:g});if(ye)throw ye;G&&(a(Se=>Se.map(E=>E.id===G.id?G:E).sort((E,T)=>T.date.localeCompare(E.date))),_(G.id)),h("Check-in updated. Your radar view is refreshed.")}else{const{data:G,error:ye}=await Qf({user_id:e.user.id,date:b,scores:g});if(ye)throw ye;G&&(a(Se=>[G,...Se].sort((E,T)=>T.date.localeCompare(E.date))),_(G.id)),h("Check-in saved! Revisit the history to spot your trends.")}}catch(ae){d(ae instanceof Error?ae.message:"Unable to save your check-in right now.")}finally{c(!1)}},ue=()=>{if(r.length===0){w(Hr());return}w(Rs(r[0].scores))},de=()=>{x(!0),k(0),A(new Map),R(null),O(""),w(Hr())},De=()=>{if(P===null)return;const D=Bn[j],ae={questionId:D.id,score:P,customNote:q.trim()},G=new Map(S);G.set(D.id,ae),A(G);const ye=Bn.filter(Se=>Se.categoryKey===D.categoryKey).map(Se=>{var Te;return((Te=G.get(Se.id))==null?void 0:Te.score)||0}).filter(Se=>Se>0);if(ye.length>0){const Se=ye.reduce((E,T)=>E+T,0)/ye.length,Te=lc(Se);w(E=>({...E,[D.categoryKey]:Te}))}j<Bn.length-1?(k(j+1),R(null),O("")):fe(G)},fe=async D=>{c(!0),d(null),h(null);try{const ae=Hr();st.forEach(Se=>{const E=Bn.filter(T=>T.categoryKey===Se.key).map(T=>{var U;return((U=D.get(T.id))==null?void 0:U.score)||0}).filter(T=>T>0);if(E.length>0){const T=E.reduce((U,J)=>U+J,0)/E.length;ae[Se.key]=lc(T)}});const{data:G,error:ye}=await Qf({user_id:e.user.id,date:b,scores:ae});if(ye)throw ye;G&&(a(Se=>[G,...Se].sort((E,T)=>T.date.localeCompare(E.date))),_(G.id)),h("Wellbeing check-in completed! Your life wheel has been updated."),x(!1)}catch(ae){d(ae instanceof Error?ae.message:"Unable to save your check-in.")}finally{c(!1)}},H=f.useMemo(()=>{if(!v)return null;const D=Hr();return st.forEach(ae=>{const ye=Bn.filter(Se=>Se.categoryKey===ae.key).map(Se=>{var Te;return((Te=S.get(Se.id))==null?void 0:Te.score)||0}).filter(Se=>Se>0);if(ye.length>0){const Se=ye.reduce((Te,E)=>Te+E,0)/ye.length;D[ae.key]=lc(Se)}}),D},[v,S]),we=f.useMemo(()=>H?tm(H):null,[H]);if(v){const D=Bn[j],ae=(j+1)/Bn.length*100;return s.jsx("section",{className:"life-wheel life-wheel--questionnaire",children:s.jsxs("div",{className:"questionnaire-container",children:[s.jsxs("div",{className:"questionnaire-progress",children:[s.jsx("div",{className:"questionnaire-progress__bar",style:{width:`${ae}%`}}),s.jsxs("span",{className:"questionnaire-progress__text",children:["Question ",j+1," of ",Bn.length]})]}),s.jsxs("div",{className:"questionnaire-content",children:[s.jsx("div",{className:"questionnaire-image",children:D.imageNumber}),s.jsx("h3",{className:"questionnaire-question",children:D.text}),s.jsxs("div",{className:"questionnaire-options",children:[s.jsxs("button",{type:"button",className:`questionnaire-option ${P===1?"questionnaire-option--selected":""}`,onClick:()=>R(1),children:[s.jsx("span",{className:"questionnaire-option__label",children:"Not Well"}),s.jsx("span",{className:"questionnaire-option__score",children:"1"})]}),s.jsxs("button",{type:"button",className:`questionnaire-option ${P===2?"questionnaire-option--selected":""}`,onClick:()=>R(2),children:[s.jsx("span",{className:"questionnaire-option__label",children:"Okay"}),s.jsx("span",{className:"questionnaire-option__score",children:"2"})]}),s.jsxs("button",{type:"button",className:`questionnaire-option ${P===3?"questionnaire-option--selected":""}`,onClick:()=>R(3),children:[s.jsx("span",{className:"questionnaire-option__label",children:"Excellent"}),s.jsx("span",{className:"questionnaire-option__score",children:"3"})]})]}),s.jsxs("div",{className:"questionnaire-note",children:[s.jsx("label",{htmlFor:"custom-note",children:"Add your thoughts (optional)"}),s.jsx("textarea",{id:"custom-note",value:q,onChange:G=>O(G.target.value),placeholder:"Share any additional insights about this area of your life...",rows:3})]}),s.jsx("button",{type:"button",className:"questionnaire-submit",onClick:De,disabled:P===null||l,children:l?"Saving...":j===Bn.length-1?"Complete Check-in":"Next Question"})]},D.id),s.jsxs("div",{className:"questionnaire-wheel",children:[s.jsx("h4",{children:"Your Life Wheel"}),we?s.jsxs("svg",{className:"life-wheel__radar",viewBox:`0 0 ${Ea} ${Ea}`,role:"img","aria-label":"Your life wheel progress",children:[s.jsx("g",{className:"life-wheel__radar-grid",children:we.levelPolygons.map(G=>s.jsx("polygon",{points:G.points},G.ratio))}),s.jsx("g",{className:"life-wheel__radar-axes",children:we.axes.map(G=>s.jsx("line",{x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2},G.key))}),s.jsx("polygon",{className:"life-wheel__radar-shape",points:we.polygonPoints}),s.jsx("g",{className:"life-wheel__radar-labels",children:we.labels.map(G=>s.jsx("text",{x:G.x,y:G.y,textAnchor:G.anchor,dominantBaseline:G.baseline,children:G.text},G.key))})]}):s.jsx("div",{className:"life-wheel__empty",children:s.jsx("p",{children:"Your wheel will appear as you answer questions"})})]})]})})}return s.jsxs("section",{className:"life-wheel",children:[s.jsxs("header",{className:"life-wheel__header",children:[s.jsxs("div",{children:[s.jsx("h2",{children:"Wellbeing Wheel Check-in"}),s.jsx("p",{children:"Take a calming questionnaire to reflect on your wellbeing across 8 life categories."})]}),s.jsx("button",{type:"button",className:"life-wheel__refresh",onClick:()=>void oe(),disabled:i||!t&&!n,children:i?"Refreshing…":"Refresh history"})]}),n?s.jsx("p",{className:"life-wheel__status life-wheel__status--info",children:"Life wheel entries are stored locally in demo mode. Connect Supabase when you're ready to sync check-ins across devices."}):t?null:s.jsx("p",{className:"life-wheel__status life-wheel__status--warning",children:"Add your Supabase credentials so we can sync your check-ins across devices. Until then your entries stay local."}),u&&s.jsx("p",{className:"life-wheel__status life-wheel__status--error",children:u}),m&&s.jsx("p",{className:"life-wheel__status life-wheel__status--success",children:m}),s.jsx("div",{className:"life-wheel__start-section",children:s.jsx("button",{type:"button",className:"life-wheel__start-questionnaire",onClick:de,disabled:!t&&!n,children:"Start New Wellbeing Check-in"})}),s.jsxs("div",{className:"life-wheel__grid",children:[s.jsxs("div",{className:"life-wheel__panel life-wheel__panel--chart",children:[z&&Z?s.jsxs(s.Fragment,{children:[s.jsxs("svg",{className:"life-wheel__radar",viewBox:`0 0 ${Ea} ${Ea}`,role:"img","aria-label":`Life wheel radar chart for ${yo.format(new Date(z.date))}`,children:[s.jsx("g",{className:"life-wheel__radar-grid",children:Z.levelPolygons.map(D=>s.jsx("polygon",{points:D.points},D.ratio))}),s.jsx("g",{className:"life-wheel__radar-axes",children:Z.axes.map(D=>s.jsx("line",{x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2},D.key))}),s.jsx("polygon",{className:"life-wheel__radar-shape",points:Z.polygonPoints}),s.jsx("g",{className:"life-wheel__radar-labels",children:Z.labels.map(D=>s.jsx("text",{x:D.x,y:D.y,textAnchor:D.anchor,dominantBaseline:D.baseline,children:D.text},D.key))})]}),s.jsxs("div",{className:"life-wheel__snapshot",children:[s.jsx("h3",{children:yo.format(new Date(z.date))}),s.jsxs("p",{children:["Average score: ",s.jsx("strong",{children:I}),"/10. Track improvements by logging a new check-in whenever your priorities shift."]})]})]}):s.jsx("div",{className:"life-wheel__empty",children:s.jsx("p",{children:"Log your first check-in to unlock the radar chart and trend history."})}),s.jsxs("div",{className:"life-wheel__history",children:[s.jsx("h3",{children:"Recent check-ins"}),r.length===0?s.jsx("p",{children:"No check-ins yet. Share how each area feels to begin your streak."}):s.jsx("ul",{children:r.map(D=>{const ae=z?D.id===z.id:!1,G=Rs(D.scores),ye=Zo(G);return s.jsx("li",{children:s.jsxs("button",{type:"button",className:`life-wheel__history-item ${ae?"life-wheel__history-item--active":""}`,onClick:()=>_(D.id),children:[s.jsx("span",{children:yo.format(new Date(D.date))}),s.jsxs("span",{children:[ye,"/10 avg"]})]})},D.id)})})]}),s.jsxs("div",{className:"life-wheel__insights",children:[s.jsxs("div",{className:"life-wheel__insights-header",children:[s.jsx("h3",{children:"Trend insights"}),s.jsx("p",{children:C?C.averageDirection==="steady"?`Overall balance held steady compared to ${C.previousLabel}.`:`Overall balance ${C.averageDirection==="up"?"improved":"dipped"} by ${Nk(C.averageDelta)} points compared to ${C.previousLabel}.`:"Log at least two check-ins to unlock week-over-week highlights."})]}),C?s.jsxs(s.Fragment,{children:[s.jsxs("p",{className:"life-wheel__insights-meta",children:["Latest average ",s.jsx("strong",{children:C.latestAverage.toFixed(1)}),"/10 • Previous"," ",s.jsx("strong",{children:C.previousAverage.toFixed(1)}),"/10"]}),s.jsxs("div",{className:"life-wheel__insight-cards",children:[s.jsxs("section",{className:"life-wheel__insight-card life-wheel__insight-card--lift",children:[s.jsx("h4",{children:"Where you gained momentum"}),C.improvements.length>0?s.jsx("ul",{className:"life-wheel__insight-list",children:C.improvements.map(D=>s.jsxs("li",{children:[s.jsx("span",{className:"life-wheel__insight-label",children:D.label}),s.jsx("span",{className:"life-wheel__insight-delta life-wheel__insight-delta--positive",children:em(D.delta)}),s.jsxs("span",{className:"life-wheel__insight-score",children:["Now ",D.latest,"/10"]})]},D.key))}):s.jsx("p",{className:"life-wheel__insight-empty",children:"No gains yet—celebrate a win with your next check-in."})]}),s.jsxs("section",{className:"life-wheel__insight-card life-wheel__insight-card--dip",children:[s.jsx("h4",{children:"Where to focus next"}),C.declines.length>0?s.jsx("ul",{className:"life-wheel__insight-list",children:C.declines.map(D=>s.jsxs("li",{children:[s.jsx("span",{className:"life-wheel__insight-label",children:D.label}),s.jsx("span",{className:"life-wheel__insight-delta life-wheel__insight-delta--negative",children:em(D.delta)}),s.jsxs("span",{className:"life-wheel__insight-score",children:["Now ",D.latest,"/10"]})]},D.key))}):s.jsx("p",{className:"life-wheel__insight-empty",children:"No dips detected—keep nurturing these areas."})]})]}),C.stableCount>0?s.jsxs("p",{className:"life-wheel__insights-stable",children:[C.stableCount," ",C.stableCount===1?"area":"areas"," held steady. Consistency counts."]}):null]}):null]})]}),s.jsx("div",{className:"life-wheel__panel life-wheel__panel--form",children:s.jsxs("form",{className:"life-wheel__form",onSubmit:K,children:[s.jsxs("div",{className:"life-wheel__field",children:[s.jsx("label",{htmlFor:"life-wheel-date",children:"Check-in date"}),s.jsx("input",{id:"life-wheel-date",type:"date",value:b,max:Zf(new Date),onChange:D=>y(D.target.value),required:!0})]}),s.jsx("div",{className:"life-wheel__field-group",children:st.map(D=>s.jsxs("div",{className:"life-wheel__field",children:[s.jsx("label",{htmlFor:`life-wheel-${D.key}`,children:D.label}),s.jsxs("div",{className:"life-wheel__slider",children:[s.jsx("input",{id:`life-wheel-${D.key}`,type:"range",min:0,max:Yd,step:1,value:g[D.key]??0,onChange:L(D.key)}),s.jsx("span",{children:g[D.key]??0})]})]},D.key))}),s.jsxs("div",{className:"life-wheel__actions",children:[s.jsx("button",{type:"button",className:"life-wheel__secondary",onClick:ue,children:"Use latest scores"}),s.jsx("button",{type:"submit",className:"life-wheel__primary",disabled:l,children:l?"Saving…":"Save check-in"})]})]})})]})]})}const bo=400,nm=5;function Ck(){const e=bo/2,t=e-40;return st.map((n,r)=>{const a=Math.PI*2*r/st.length-Math.PI/2,i=Math.PI*2*(r+1)/st.length-Math.PI/2,o=(a+i)/2,l=e+Math.cos(a)*t,c=e+Math.sin(a)*t,u=e+Math.cos(i)*t,d=e+Math.sin(i)*t,m=`M ${e} ${e} L ${l} ${c} A ${t} ${t} 0 0 1 ${u} ${d} Z`,h=t+24,b=e+Math.cos(o)*h,y=e+Math.sin(o)*h;let g;Math.abs(Math.cos(o))<.2?g="middle":Math.cos(o)>0?g="start":g="end";let w;return Math.sin(o)>.2?w="text-before-edge":Math.sin(o)<-.2?w="text-after-edge":w="middle",{categoryKey:n.key,label:n.label,path:m,labelX:b,labelY:y,anchor:g,baseline:w,angle:o}})}function Tk({onCategorySelect:e,selectedCategory:t}){const[n,r]=f.useState(null),a=f.useMemo(()=>Ck(),[]),i=bo/2,o=i-40,l=h=>{e(h)},c=h=>{r(h)},u=()=>{r(null)},d=Array.from({length:nm},(h,b)=>{const y=(b+1)/nm,g=o*y,w=st.map((p,_)=>{const v=Math.PI*2*_/st.length-Math.PI/2,x=i+Math.cos(v)*g,j=i+Math.sin(v)*g;return`${x},${j}`}).join(" ");return{ratio:y,points:w}}),m=st.map((h,b)=>{const y=Math.PI*2*b/st.length-Math.PI/2,g=i+Math.cos(y)*o,w=i+Math.sin(y)*o;return{key:h.key,x1:i,y1:i,x2:g,y2:w}});return s.jsx("div",{className:"interactive-life-wheel",children:s.jsxs("svg",{className:"interactive-life-wheel__svg",viewBox:`0 0 ${bo} ${bo}`,role:"img","aria-label":"Interactive life wheel - click a slice to add a goal",children:[s.jsx("g",{className:"interactive-life-wheel__grid",children:d.map((h,b)=>s.jsx("polygon",{points:h.points},b))}),s.jsx("g",{className:"interactive-life-wheel__axes",children:m.map(h=>s.jsx("line",{x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2},h.key))}),s.jsx("g",{className:"interactive-life-wheel__slices",children:a.map(h=>{const b=t===h.categoryKey,y=n===h.categoryKey,g=`interactive-life-wheel__slice ${b?"interactive-life-wheel__slice--selected":""} ${y?"interactive-life-wheel__slice--hovered":""}`;return s.jsx("path",{d:h.path,className:g,onClick:()=>l(h.categoryKey),onMouseEnter:()=>c(h.categoryKey),onMouseLeave:u,role:"button","aria-label":`${h.label} - click to add a goal`,tabIndex:0,onKeyDown:w=>{(w.key==="Enter"||w.key===" ")&&(w.preventDefault(),l(h.categoryKey))}},h.categoryKey)})}),s.jsx("g",{className:"interactive-life-wheel__labels",children:a.map(h=>s.jsx("text",{x:h.labelX,y:h.labelY,textAnchor:h.anchor,dominantBaseline:h.baseline,className:"interactive-life-wheel__label",style:{pointerEvents:"none"},children:h.label},h.categoryKey))})]})})}const Dk={spirituality_community:{title:"Spirituality & Community",description:"Connect with your spiritual practices and community involvement.",examples:["Develop a daily meditation practice","Join a community service group","Explore spiritual teachings"],icon:"🙏"},finance_wealth:{title:"Finance & Wealth",description:"Build financial security and grow your wealth.",examples:["Save for retirement","Create a budget plan","Invest in financial education"],icon:"💰"},love_relations:{title:"Love & Relations",description:"Nurture romantic relationships and intimate connections.",examples:["Plan regular date nights","Improve communication skills","Build emotional intimacy"],icon:"❤️"},fun_creativity:{title:"Fun & Creativity",description:"Express yourself creatively and enjoy recreational activities.",examples:["Learn a musical instrument","Start a creative hobby","Plan adventure activities"],icon:"🎨"},career_development:{title:"Career & Self Development",description:"Advance your career and invest in personal growth.",examples:["Earn a professional certification","Develop leadership skills","Network with industry professionals"],icon:"📈"},health_fitness:{title:"Health & Fitness",description:"Improve your physical health and fitness.",examples:["Train for a 5K race","Establish a workout routine","Improve nutrition habits"],icon:"💪"},family_friends:{title:"Family & Friends",description:"Strengthen bonds with family and friends.",examples:["Schedule regular family time","Reconnect with old friends","Create family traditions"],icon:"👨‍👩‍👧‍👦"},living_spaces:{title:"Living Spaces",description:"Create a comfortable and organized living environment.",examples:["Declutter and organize home","Improve home decor","Create a peaceful workspace"],icon:"🏠"}};function Ak({categoryKey:e,onAddGoal:t}){if(!e)return s.jsxs("div",{className:"category-info-card category-info-card--empty",children:[s.jsx("div",{className:"category-info-card__icon",children:"🎯"}),s.jsx("h3",{children:"Select a Life Area"}),s.jsx("p",{children:"Click on a slice of the life wheel to explore that area and add goals."})]});const n=Dk[e];return s.jsxs("div",{className:"category-info-card",children:[s.jsxs("div",{className:"category-info-card__header",children:[s.jsx("span",{className:"category-info-card__icon",children:n.icon}),s.jsx("h3",{children:n.title})]}),s.jsx("p",{className:"category-info-card__description",children:n.description}),s.jsxs("div",{className:"category-info-card__examples",children:[s.jsx("h4",{children:"Goal Ideas:"}),s.jsx("ul",{children:n.examples.map((r,a)=>s.jsx("li",{children:r},a))})]}),s.jsxs("button",{type:"button",className:"category-info-card__action",onClick:t,children:["Add Goal to ",n.title]})]})}function Qd(e){const t=()=>typeof window>"u"||typeof window.matchMedia!="function"?!1:window.matchMedia(e).matches,[n,r]=f.useState(t);return f.useEffect(()=>{if(typeof window>"u"||typeof window.matchMedia!="function")return()=>{};const a=window.matchMedia(e),i=o=>{r(o.matches)};return r(a.matches),a.addEventListener("change",i),()=>{a.removeEventListener("change",i)}},[e]),n}function Ik({session:e}){const[t,n]=f.useState(null),[r,a]=f.useState(!1),[i,o]=f.useState(!1),[l,c]=f.useState(null),[u,d]=f.useState(null),m=Qd("(max-width: 720px)"),h=f.useMemo(()=>{if(!t)return"Choose a life area to focus on";const p=st.find(_=>_.key===t);return p?`Focus: ${p.label}`:"Explore each life area"},[t]),b=p=>{n(p)},y=()=>{a(!0)},g=()=>{a(!1)},w=f.useCallback(async p=>{o(!0),c(null),d(null);try{const _={user_id:e.user.id,title:p.title,description:p.description||null,life_wheel_category:p.lifeWheelCategory,start_date:p.startDate||null,target_date:p.targetDate||null,estimated_duration_days:p.estimatedDurationDays?parseInt(p.estimatedDurationDays,10):null,timing_notes:p.timingNotes||null,status_tag:p.statusTag},{data:v,error:x}=await Du(_);if(x)throw x;if(!v)throw new Error("Failed to create goal");for(let j=0;j<p.steps.length;j++){const k=p.steps[j],S={goal_id:v.id,step_order:j,title:k.title,description:k.description||null,due_date:k.dueDate||null},{data:A,error:P}=await Ey(S);if(P)throw P;if(A)for(let R=0;R<k.substeps.length;R++){const q=k.substeps[R],O={step_id:A.id,substep_order:R,title:q.title},{error:oe}=await Cy(O);if(oe)throw oe}}for(const j of p.alerts){const k={goal_id:v.id,user_id:e.user.id,alert_type:j.alertType,alert_time:j.alertTime,title:j.title,message:j.message||null,repeat_pattern:j.repeatPattern,enabled:j.enabled},{error:S}=await Ty(k);if(S)throw S}d("Life goal created successfully!"),setTimeout(()=>d(null),3e3)}catch(_){throw c(_ instanceof Error?_.message:"Failed to save life goal"),_}finally{o(!1)}},[e.user.id]);return s.jsxs("section",{className:`life-goals-section ${m?"life-goals-section--mobile":""}`,children:[s.jsxs("header",{className:"life-goals-section__header",children:[s.jsx("div",{className:"life-goals-section__eyebrow",children:"Long-term roadmap"}),s.jsxs("div",{className:"life-goals-section__heading-row",children:[s.jsxs("div",{children:[s.jsx("h2",{children:"Life Goals"}),s.jsx("p",{children:"Use the life wheel to explore different areas of your life. Click or tap on a slice to view goal ideas and create detailed life goals with steps, timing, and notifications."})]}),s.jsx("button",{className:"life-goals-section__cta",type:"button",onClick:y,children:"Add a life goal"})]}),s.jsxs("div",{className:"life-goals-section__mobile-bar","aria-live":"polite",children:[s.jsx("span",{className:"life-goals-section__chip",children:h}),s.jsx("span",{className:"life-goals-section__chip life-goals-section__chip--muted",children:"Tap the wheel to change focus"})]})]}),l&&s.jsx("p",{className:"life-goals-section__status life-goals-section__status--error",children:l}),u&&s.jsx("p",{className:"life-goals-section__status life-goals-section__status--success",children:u}),s.jsxs("div",{className:"life-goals-section__interactive",children:[s.jsxs("div",{className:"life-goals-section__wheel-card",children:[s.jsxs("div",{className:"life-goals-section__card-header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"life-goals-section__card-label",children:"Life wheel"}),s.jsx("p",{className:"life-goals-section__card-helper",children:"Tap any slice to browse goal prompts for that area."})]}),s.jsx("button",{type:"button",className:"life-goals-section__icon-button",onClick:y,children:"+"})]}),s.jsx("div",{className:"life-goals-section__wheel",children:s.jsx(Tk,{onCategorySelect:b,selectedCategory:t})})]}),s.jsx("div",{className:"life-goals-section__info",children:s.jsx(Ak,{categoryKey:t,onAddGoal:y})})]}),s.jsx(Ny,{session:e,isOpen:r,onClose:g,onSave:w,initialCategory:t})]})}function Pk(e){return typeof e=="string"&&["daily","specific_days","times_per_week","every_n_days"].includes(e)}function ia(e){if(!e||typeof e!="object")return null;const t=e;return t.mode!==void 0&&!Pk(t.mode)?null:{mode:t.mode,days:Array.isArray(t.days)?t.days:void 0,timesPerWeek:typeof t.timesPerWeek=="number"?t.timesPerWeek:void 0,intervalDays:typeof t.intervalDays=="number"?t.intervalDays:void 0,startDate:typeof t.startDate=="string"?t.startDate:void 0}}function Ay(e){const t=new Date(e),n=t.getDay(),r=n===0?7:n,a=new Date(t);a.setDate(t.getDate()-r+1),a.setHours(0,0,0,0);const i=new Date(a);return i.setDate(a.getDate()+6),i.setHours(23,59,59,999),{monday:a,sunday:i}}function Rk(e,t,n){let r=0;const a=new Date(e);a.setHours(0,0,0,0);const i=new Date(t);for(i.setHours(23,59,59,999);a<=i;)n.includes(a.getDay())&&r++,a.setDate(a.getDate()+1);return r}function Iy(e,t){const n=e.timesPerWeek??0,r=t.filter(a=>a.done).length;return{completed:r,target:n,targetMet:r>=n}}function Py(e,t,n=new Date){const r=e.intervalDays;if(!r||r<=0)return null;const a=e.startDate||t;if(!a)return null;const i=new Date(a);i.setHours(0,0,0,0);const o=new Date(n);o.setHours(0,0,0,0);const l=o.getTime()-i.getTime(),c=Math.floor(l/(1e3*60*60*24));if(c>=0&&c%r===0)return o;const u=c>=0?c%r:r+c%r,d=r-u,m=new Date(o);return m.setDate(m.getDate()+d),m}function Ry(e,t=new Date,n=[]){const r=ia(e.schedule);if(!r||!r.mode)return!0;const a=new Date(t);switch(a.setHours(0,0,0,0),r.mode){case"daily":return!0;case"specific_days":{if(!r.days||!Array.isArray(r.days))return!0;const i=t.getDay();return r.days.includes(i)}case"times_per_week":{const i=r.timesPerWeek;return typeof i!="number"||i<=0?!0:n.filter(l=>l.done).length<i}case"every_n_days":{const i=r.intervalDays;if(typeof i!="number"||i<=0)return!0;const o=r.startDate||e.created_at;if(!o)return!0;const l=new Date(o);l.setHours(0,0,0,0);const c=a.getTime()-l.getTime(),u=Math.floor(c/(1e3*60*60*24));return u<0?!1:u%i===0}default:return!1}}function Au(e,t,n=new Date){const r=ia(e.schedule);if(!r||!r.mode)return t;const a=new Date(n);switch(a.setDate(a.getDate()-t+1),a.setHours(0,0,0,0),r.mode){case"daily":return t;case"specific_days":return!r.days||!Array.isArray(r.days)||r.days.length===0?t:Rk(a,n,r.days);case"times_per_week":{const i=r.timesPerWeek;if(typeof i!="number"||i<=0)return t;const o=Math.floor(t/7),l=t%7,c=Math.round(l/7*i);return o*i+c}case"every_n_days":{const i=r.intervalDays;return typeof i!="number"||i<=0?t:Math.ceil(t/i)}default:return t}}const Ok=Object.freeze(Object.defineProperty({__proto__:null,getEveryNDaysNextDue:Py,getISOWeekBounds:Ay,getScheduledCountForWindow:Au,getTimesPerWeekProgress:Iy,isHabitScheduledToday:Ry,parseSchedule:ia},Symbol.toStringTag,{value:"Module"}));async function bi(){return ce().from("habits_v2").select("*").eq("archived",!1).order("created_at",{ascending:!1}).returns()}async function Iu(e){const t=ce(),n=new Date().toISOString().split("T")[0];return t.from("habit_logs_v2").select("*").eq("user_id",e).eq("date",n).returns()}async function Xd(e,t){const n=ce(),r={...e,user_id:t};return n.from("habits_v2").insert(r).select().single()}async function el(e,t){const n=ce(),r={...e,user_id:t};return n.from("habit_logs_v2").insert(r).select().single()}async function Oy(e){const t=ce(),{data:n,error:r}=await t.from("habits_v2").select("id").eq("user_id",e).eq("archived",!1);if(r)return{data:null,error:r};if(!n||n.length===0)return{data:[],error:null};const a=n.map(o=>o.id);return await t.from("v_habit_streaks").select("*").in("habit_id",a).order("current_streak",{ascending:!1}).returns()}async function Ly(e){return ce().from("habit_logs_v2").select("*").eq("user_id",e.userId).eq("habit_id",e.habitId).gte("date",e.startDate).lte("date",e.endDate).order("date",{ascending:!0}).returns()}async function $y(e,t){const n={title:e.title,emoji:null,type:"boolean",schedule:{mode:"daily"},domain_key:e.domainKey??null,goal_id:e.goalId??null,archived:!1,target_num:null,target_unit:null};return Xd(n,t)}async function My(e){const t=ce(),{error:n}=await t.from("habits_v2").update({archived:!0}).eq("id",e);return{data:null,error:n}}async function Pu(e,t,n=new Date){if(!t||t.length===0)return{data:[],error:null};const r=ce(),{monday:a,sunday:i}=Ay(n),o=a.toISOString().split("T")[0],l=i.toISOString().split("T")[0];return r.from("habit_logs_v2").select("*").eq("user_id",e).in("habit_id",t).gte("date",o).lte("date",l).order("date",{ascending:!0}).returns()}async function jl(e){return!e.habitIds||e.habitIds.length===0?{data:[],error:null}:ce().from("habit_logs_v2").select("*").eq("user_id",e.userId).in("habit_id",e.habitIds).gte("date",e.startDate).lte("date",e.endDate).order("date",{ascending:!0}).returns()}async function Lk(e,t){return ce().from("habits_v2").update(t).eq("id",e).select().single()}async function Uy(e,t){return ce().from("habits_v2").update(t).eq("id",e).select().single()}async function $k(e){return ce().from("habits_v2").select("*").eq("id",e).single()}const Mk=Object.freeze(Object.defineProperty({__proto__:null,archiveHabitV2:My,createHabitV2:Xd,getHabitV2:$k,listHabitLogsForRangeMultiV2:jl,listHabitLogsForRangeV2:Ly,listHabitLogsForWeekV2:Pu,listHabitStreaksV2:Oy,listHabitsV2:bi,listTodayHabitLogsV2:Iu,logHabitCompletionV2:el,quickAddDailyHabit:$y,updateHabitFullV2:Uy,updateHabitV2:Lk},Symbol.toStringTag,{value:"Module"}));function Uk(e){return{id:e.id,goal_id:e.goal_id||"",name:e.title,frequency:zk(e.schedule),schedule:e.schedule}}function Fk(e){return{...Uk(e),goal:e.goal_id?{id:e.goal_id,title:"",target_date:null}:null}}function Zd(e){return{id:e.id,habit_id:e.habit_id,date:e.date,completed:e.done}}function zk(e){if(!e||typeof e!="object")return"daily";const n=e.mode;return n==="daily"?"daily":n==="specific_days"||n==="times_per_week"?"weekly":n==="every_n_days"?"custom":"daily"}async function Fy(e){const{data:t,error:n}=await bi();return n?{data:null,error:n}:{data:(t||[]).map(Fk),error:null}}async function zy(e,t){if(!t){if(!Ce())return{data:null,error:{message:"No user ID provided and not authenticated"}};const i=ce(),{data:{session:o}}=await i.auth.getSession();if(!o)return{data:null,error:{message:"Not authenticated"}};t=o.user.id}const n={habit_id:e.habit_id,done:e.completed??!0,value:null,date:e.date},{data:r,error:a}=await el(n,t);return a?{data:null,error:a}:r?{data:Zd(r),error:null}:{data:null,error:null}}async function By(e,t){if(!Ce())return{data:null,error:{message:"Not in Supabase mode"}};const n=ce(),{data:{session:r}}=await n.auth.getSession();if(!r)return{data:null,error:{message:"Not authenticated"}};const{data:a,error:i}=await n.from("habit_logs_v2").delete().eq("habit_id",e).eq("user_id",r.user.id).eq("date",t).select().single();return i?{data:null,error:i}:a?{data:Zd(a),error:null}:{data:null,error:null}}async function qy(e,t,n,r){if(!e.length)return{data:[],error:null};if(!r){if(!Ce())return{data:null,error:{message:"No user ID provided"}};const l=ce(),{data:{session:c}}=await l.auth.getSession();if(!c)return{data:null,error:{message:"Not authenticated"}};r=c.user.id}const{data:a,error:i}=await jl({userId:r,habitIds:e,startDate:t,endDate:n});return i?{data:null,error:i}:{data:(a||[]).map(Zd),error:null}}function Hy(e,t){const n=new Date(e,t-1,1),r=new Date(e,t,0),a=rm(n),i=rm(r);return{startDate:a,endDate:i}}function rm(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}async function Bk(e,t,n){try{const{startDate:r,endDate:a}=Hy(t,n);if(!Ce())return qk(e,t,n,r,a);const i=ce(),{data:o,error:l}=await i.from("habits_v2").select("*").eq("user_id",e).eq("archived",!1);if(l)return{data:null,error:l};if(!o||o.length===0)return{data:{userId:e,year:t,month:n,startDate:r,endDate:a,habits:[],overallCompletionPercentage:0},error:null};const c=o,u=c.map(x=>x.id),{data:d,error:m}=await i.from("habit_completions").select("*").eq("user_id",e).in("habit_id",u).gte("completed_date",r).lte("completed_date",a);if(m)return{data:null,error:m};const h=d||[],b=new Date(t,n-1,1),g=new Date(t,n,0).getDate(),w=c.map(x=>{const k=h.filter(A=>A.habit_id===x.id&&A.completed).length,S=g>0?Math.round(k/g*100):0;return{habitId:x.id,habitName:x.title,totalDays:g,completedDays:k,completionPercentage:S,goalTitle:null,emoji:x.emoji,schedule:x.schedule}}),p=w.reduce((x,j)=>x+j.totalDays,0),_=w.reduce((x,j)=>x+j.completedDays,0),v=p>0?Math.round(_/p*100):0;return{data:{userId:e,year:t,month:n,startDate:r,endDate:a,habits:w,overallCompletionPercentage:v},error:null}}catch(r){return console.error("Error in getHabitCompletionsByMonth:",r),{data:null,error:r}}}function qk(e,t,n,r,a){try{const i=e||We,o=wy(i);if(!o||o.length===0)return{data:{userId:i,year:t,month:n,startDate:r,endDate:a,habits:[],overallCompletionPercentage:0},error:null};const l=o.map(g=>g.id),c=xy(l,r,a),d=new Date(t,n,0).getDate(),m=o.map(g=>{const p=c.filter(v=>v.habit_id===g.id&&v.completed).length,_=d>0?Math.round(p/d*100):0;return{habitId:g.id,habitName:g.name,totalDays:d,completedDays:p,completionPercentage:_,goalTitle:null}}),h=m.reduce((g,w)=>g+w.totalDays,0),b=m.reduce((g,w)=>g+w.completedDays,0),y=h>0?Math.round(b/h*100):0;return{data:{userId:i,year:t,month:n,startDate:r,endDate:a,habits:m,overallCompletionPercentage:y},error:null}}catch(i){return console.error("Error in getHabitCompletionsByMonthDemo:",i),{data:null,error:i}}}async function Hk(e,t,n){try{if(!Ce())return Wk(e,t,n);const r=ce(),{data:a,error:i}=await r.from("habit_completions").select("*").eq("user_id",e).eq("habit_id",t).eq("completed_date",n).maybeSingle();if(i)return{data:null,error:i};const o=a;if(o){const l=!o.completed,{data:c,error:u}=await r.from("habit_completions").update({completed:l}).eq("id",o.id).select().single();return u?{data:null,error:u}:{data:c,error:null}}else{const l={user_id:e,habit_id:t,completed_date:n,completed:!0},{data:c,error:u}=await r.from("habit_completions").insert(l).select().single();return u?{data:null,error:u}:{data:c,error:null}}}catch(r){return console.error("Error in toggleHabitCompletionForDate:",r),{data:null,error:r}}}function Wk(e,t,n){try{const r=e||We;return{data:{id:`demo-${t}-${n}`,user_id:r,habit_id:t,completed_date:n,completed:!0,created_at:new Date().toISOString()},error:null}}catch(r){return console.error("Error in toggleHabitCompletionForDateDemo:",r),{data:null,error:r}}}async function Vk(e,t,n){try{const{startDate:r,endDate:a}=Hy(t,n);if(!Ce())return Gk(e,t,n,r,a);const i=ce(),{data:o,error:l}=await i.from("habit_completions").select("habit_id, completed_date, completed").eq("user_id",e).gte("completed_date",r).lte("completed_date",a);if(l)return{data:null,error:l};const c=o||[],u={};for(const d of c)u[d.habit_id]||(u[d.habit_id]={}),u[d.habit_id][d.completed_date]=d.completed;return{data:u,error:null}}catch(r){return console.error("Error in getMonthlyCompletionGrid:",r),{data:null,error:r}}}function Gk(e,t,n,r,a){try{const l=wy(e||We).map(d=>d.id),c=xy(l,r,a),u={};for(const d of c)u[d.habit_id]||(u[d.habit_id]={}),u[d.habit_id][d.date]=d.completed;return{data:u,error:null}}catch(i){return console.error("Error in getMonthlyCompletionGridDemo:",i),{data:null,error:i}}}const Wy="demo_habit_reminder_prefs",Kk="demo_reminder_action_logs";function Vy(){try{const e=localStorage.getItem(Wy);if(e)return JSON.parse(e)}catch{}return[]}function Jk(e){try{localStorage.setItem(Wy,JSON.stringify(e))}catch{}}function Yk(){try{const e=localStorage.getItem(Kk);if(e)return JSON.parse(e)}catch{}return[]}async function Gy(){if(!Ce())return{data:Vy(),error:null};const e=ce(),{data:{session:t},error:n}=await e.auth.getSession();if(n||!t)return{data:null,error:n||new Error("No session")};try{const r=await fetch("undefined/functions/v1/send-reminders/habit-prefs",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.access_token}`}});if(!r.ok){const i=await r.json().catch(()=>({}));return{data:null,error:new Error(i.error||"Failed to fetch habit prefs")}}return{data:await r.json(),error:null}}catch(r){return{data:null,error:r instanceof Error?r:new Error(String(r))}}}async function tl(e,t){if(!Ce()){const i=Vy(),o=i.findIndex(l=>l.habit_id===e);return o>=0?(t.enabled!==void 0&&(i[o].enabled=t.enabled),t.preferred_time!==void 0&&(i[o].preferred_time=t.preferred_time),Jk(i),{data:{habit_id:e,enabled:i[o].enabled,preferred_time:i[o].preferred_time,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},error:null}):{data:null,error:new Error("Habit not found")}}const n=ce(),{data:{session:r},error:a}=await n.auth.getSession();if(a||!r)return{data:null,error:a||new Error("No session")};try{const i=await fetch("undefined/functions/v1/send-reminders/habit-prefs",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r.access_token}`},body:JSON.stringify({habit_id:e,...t})});if(!i.ok){const l=await i.json().catch(()=>({}));return{data:null,error:new Error(l.error||"Failed to update habit pref")}}return{data:await i.json(),error:null}}catch(i){return{data:null,error:i instanceof Error?i:new Error(String(i))}}}async function sm(e=50){if(!Ce())return{data:Yk(),error:null};const t=ce(),{data:{session:n},error:r}=await t.auth.getSession();if(r||!n)return{data:null,error:r||new Error("No session")};try{const a=await fetch(`undefined/functions/v1/send-reminders/action-logs?limit=${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`}});if(!a.ok){const o=await a.json().catch(()=>({}));return{data:null,error:new Error(o.error||"Failed to fetch action logs")}}return{data:await a.json(),error:null}}catch(a){return{data:null,error:a instanceof Error?a:new Error(String(a))}}}function vo(e){if(!e)return"";const t=e.match(/^(\d{1,2}):(\d{1,2})/);if(!t)return"";const n=t[1].padStart(2,"0"),r=t[2].padStart(2,"0");return`${n}:${r}`}function Qk(e){switch(e){case"done":return"✓ Done";case"snooze":return"💤 Snoozed";case"dismiss":return"✕ Dismissed";default:return e}}function Xk({habitId:e,habitName:t,onClose:n}){const[r,a]=f.useState(null),[i,o]=f.useState(!0),[l,c]=f.useState(!1),[u,d]=f.useState(null),[m,h]=f.useState(!1),[b,y]=f.useState("08:00"),[g,w]=f.useState(!0);f.useEffect(()=>{p()},[e]);const p=async()=>{o(!0),d(null);try{const{data:x,error:j}=await Gy();if(j)throw j;const k=(x||[]).find(S=>S.habit_id===e);a(k||null),k&&(w(k.enabled),y(vo(k.preferred_time)||"08:00"))}catch(x){d(x instanceof Error?x.message:"Failed to load reminder preferences")}finally{o(!1)}},_=async()=>{c(!0),d(null);try{const{data:x,error:j}=await tl(e,{enabled:g,preferred_time:b});if(j)throw j;await p(),h(!1)}catch(x){d(x instanceof Error?x.message:"Failed to update reminder")}finally{c(!1)}},v=async()=>{if(r){c(!0),d(null);try{const{error:x}=await tl(e,{enabled:!r.enabled});if(x)throw x;await p()}catch(x){d(x instanceof Error?x.message:"Failed to toggle reminder")}finally{c(!1)}}};return s.jsxs("div",{className:"habit-alert-config",children:[s.jsxs("div",{className:"habit-alert-config__header",children:[s.jsxs("h3",{children:['Reminders for "',t,'"']}),n&&s.jsx("button",{type:"button",className:"habit-alert-config__close",onClick:n,"aria-label":"Close",children:"×"})]}),u&&s.jsx("div",{className:"habit-alert-config__error",role:"alert",children:u}),i?s.jsx("div",{className:"habit-alert-config__loading",children:"Loading reminder preferences..."}):s.jsxs(s.Fragment,{children:[!r&&!m?s.jsxs("div",{className:"habit-alert-config__empty",children:[s.jsx("p",{children:"No reminder configured for this habit yet."}),s.jsx("p",{className:"habit-alert-config__hint",children:"Set a preferred time to receive notifications for this habit."}),s.jsx("button",{type:"button",className:"habit-alert-config__add-btn",onClick:()=>h(!0),disabled:l,children:"+ Set Reminder Time"})]}):r&&!m?s.jsx("div",{className:"habit-alert-config__list",children:s.jsxs("div",{className:"habit-alert-config__item",children:[s.jsxs("div",{className:"habit-alert-config__item-info",children:[s.jsxs("div",{className:"habit-alert-config__item-time",children:["Daily at ",vo(r.preferred_time)||"Not set"]}),s.jsx("div",{className:"habit-alert-config__item-status",children:r.enabled?s.jsx("span",{className:"habit-alert-config__badge habit-alert-config__badge--enabled",children:"Enabled"}):s.jsx("span",{className:"habit-alert-config__badge habit-alert-config__badge--disabled",children:"Disabled"})})]}),s.jsxs("div",{className:"habit-alert-config__item-actions",children:[s.jsx("button",{type:"button",className:"habit-alert-config__btn habit-alert-config__btn--toggle",onClick:v,disabled:l,children:r.enabled?"Disable":"Enable"}),s.jsx("button",{type:"button",className:"habit-alert-config__btn habit-alert-config__btn--secondary",onClick:()=>h(!0),disabled:l,children:"Edit Time"})]})]})}):null,m?s.jsxs("div",{className:"habit-alert-config__form",children:[s.jsx("h4",{children:r?"Edit Reminder":"Set Reminder"}),s.jsxs("div",{className:"habit-alert-config__form-group",children:[s.jsx("label",{htmlFor:"reminder-time",children:"Preferred Time"}),s.jsx("input",{id:"reminder-time",type:"time",value:b,onChange:x=>y(x.target.value),className:"habit-alert-config__input"})]}),s.jsx("div",{className:"habit-alert-config__form-group",children:s.jsxs("label",{className:"habit-alert-config__checkbox",children:[s.jsx("input",{type:"checkbox",checked:g,onChange:x=>w(x.target.checked)}),s.jsx("span",{children:"Enable reminder"})]})}),s.jsxs("div",{className:"habit-alert-config__form-actions",children:[s.jsx("button",{type:"button",className:"habit-alert-config__btn habit-alert-config__btn--primary",onClick:_,disabled:l,children:l?"Saving...":"Save Reminder"}),s.jsx("button",{type:"button",className:"habit-alert-config__btn habit-alert-config__btn--secondary",onClick:()=>{h(!1),r&&(w(r.enabled),y(vo(r.preferred_time)||"08:00"))},disabled:l,children:"Cancel"})]})]}):null]})]})}function Zk(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}async function eS(e){return Ce()?ce().from("habit_alerts").select("*").eq("habit_id",e).order("alert_time").returns():{data:Hj(e),error:null}}function tS(e,t){return e.enabled?e.days_of_week===null||e.days_of_week.length===0?!0:e.days_of_week.includes(t):!1}async function nS(e,t,n){const{data:r,error:a}=await eS(e);if(a||!r)return new Map;const i=new Map;let o=new Date(t);for(;o<=n;){const l=o.getDay(),c=Zk(o),u=r.filter(d=>tS(d,l));u.length>0&&i.set(c,u),o=new Date(o),o.setDate(o.getDate()+1)}return i}const rS=200;function am(e){if(!e)return null;const t=e.trim();return t?`%${t.replace(/%/g,"\\%")}%`:null}async function sS(e={}){if(!Ce()){let o=Fj(We);const l=am(e.search);if(l){const d=l.slice(1,-1).toLowerCase();o=o.filter(m=>{var y;const h=((y=m.title)==null?void 0:y.toLowerCase())??"",b=m.content.toLowerCase();return h.includes(d)||b.includes(d)})}e.tag&&(o=o.filter(d=>{var m;return((m=d.tags)==null?void 0:m.includes(e.tag??""))??!1})),e.fromDate&&(o=o.filter(d=>d.entry_date>=e.fromDate)),e.toDate&&(o=o.filter(d=>d.entry_date<=e.toDate));const c=e.offset??0,u=e.limit??o.length;return{data:o.slice(c,c+u),error:null}}let n=ce().from("journal_entries").select("*").order("entry_date",{ascending:!1}).order("created_at",{ascending:!1});e.fromDate&&(n=n.gte("entry_date",e.fromDate)),e.toDate&&(n=n.lte("entry_date",e.toDate));const r=am(e.search);r&&(n=n.or(`title.ilike.${r},content.ilike.${r}`)),e.tag&&(n=n.contains("tags",[e.tag]));const a=e.limit??rS;if(typeof e.offset=="number"){const o=e.offset,l=o+a-1;n=n.range(o,l)}else n=n.limit(a);const i=await n.returns();return{data:i.data,error:i.error}}async function Ru(e){return Ce()?ce().from("journal_entries").insert(e).select().single():{data:zj(e),error:null}}async function aS(e,t){return Ce()?ce().from("journal_entries").update(t).eq("id",e).select().single():{data:Bj(e,t),error:null}}async function iS(e){return Ce()?ce().from("journal_entries").delete().eq("id",e).select().single():{data:qj(e),error:null}}const Ou=60,oS={health:"#22c55e",relationships:"#fb7185",career:"#60a5fa",personal_growth:"#a855f7",fun:"#f97316",finances:"#facc15",giving_back:"#14b8a6",environment:"#38bdf8",spirituality:"#7c3aed",creativity:"#f472b6",community:"#0ea5e9",mindset:"#8b5cf6",wellness:"#34d399",rest:"#60a5fa"},im="You’re offline. Updates will sync automatically once you reconnect.",om="Offline updates are still queued and will retry shortly.";function Lu({session:e,variant:t="full"}){var He,tt;const{isConfigured:n}=Pn(),r=un(e),a=t==="compact",[i,o]=f.useState([]),[l,c]=f.useState(!1),[u,d]=f.useState(null),[m,h]=f.useState({}),[b,y]=f.useState({}),[g,w]=f.useState({}),[p,_]=f.useState({}),[v,x]=f.useState(()=>en(new Date)),[j,k]=f.useState(()=>en(new Date)),[S,A]=f.useState([]),[P,R]=f.useState({}),[q,O]=f.useState({}),[oe,z]=f.useState([]),[ne,Z]=f.useState(()=>new Date().getMonth()),[I,C]=f.useState(()=>new Date().getFullYear()),[L,K]=f.useState(null),[ue,de]=f.useState({}),[De,fe]=f.useState(null),[H,we]=f.useState(new Map),[B,D]=f.useState(!1),[ae,G]=f.useState(""),[ye,Se]=f.useState(""),[Te,E]=f.useState(""),[T,U]=f.useState(""),[J,le]=f.useState(""),[M,re]=f.useState(!1),[me,Pe]=f.useState(null),[Ue,Ae]=f.useState(null),[Re,pt]=f.useState(!1),[Et,Ar]=f.useState("today"),[qe,dn]=f.useState(""),[bn,W]=f.useState(!1),[_e,$e]=f.useState(null),[er,tr]=f.useState(null);f.useEffect(()=>{const $=zt(j);($.getMonth()!==ne||$.getFullYear()!==I)&&(Z($.getMonth()),C($.getFullYear()))},[j,ne,I]);const vn=f.useMemo(()=>{var Y,F;if(!i.length||!S.length)return{scheduledTotal:0,scheduledComplete:0};let $=0,se=0;for(const ie of i)for(const ke of S){if(!ys(ie,ke))continue;$+=1,!!((F=(Y=b[ie.id])==null?void 0:Y[ke])!=null&&F.completed)&&(se+=1)}return{scheduledTotal:$,scheduledComplete:se}},[i,S,b]),wn=f.useCallback(async()=>{if(!n){o([]),h({}),y({}),R({}),z([]),A([]);return}c(!0),d(null);const $=new Date,se=en($),Y=j>se?se:j,F=new Date(I,ne,1),ie=new Date(I,ne+1,0),ke=en(F),lt=en(ie),ct=vS(F,ie);x(se),Y!==j&&k(Y),A(ct);try{const{data:Ie,error:Ke}=await Fy(e.user.id);if(Ke)throw Ke;const Fe=Ie??[];if(o(Fe),Fe.length===0){h({}),y({}),R({}),z([]);return}const ze=Fe.map(Xe=>Xe.id),it=$u($,Ou-1),Je=F<it?F:it,{data:vt,error:Oe}=await qy(ze,en(Je),lt);if(Oe)throw Oe;const Be=vt??[],Wt=ze.reduce((Xe,zn)=>(Xe[zn]={logId:null,completed:!1},Xe),{}),Xt=Fe.reduce((Xe,zn)=>{const Or=ct.reduce((ca,wi)=>(ca[wi]={logId:null,completed:!1},ca),{});return Xe[zn.id]=Or,Xe},{});for(const Xe of Be){const zn={logId:Xe.id,completed:!!Xe.completed};if(Xe.date===Y&&(Wt[Xe.habit_id]=zn),Xe.date>=ke&&Xe.date<=lt){const Or=Xt[Xe.habit_id];Or&&(Or[Xe.date]=zn)}}h(Wt),y(Xt),z(Be),R(uc(Fe,Be,Y))}catch(Ie){d(Ie instanceof Error?Ie.message:"Unable to load habits right now. Try refreshing shortly.")}finally{c(!1)}},[e,n,r,ne,I,j]);f.useEffect(()=>{n&&wn()},[(He=e==null?void 0:e.user)==null?void 0:He.id,n,r,wn]);const Fn=f.useCallback(async($,se)=>{var ie;if(!n||!((ie=e==null?void 0:e.user)!=null&&ie.id))return;const Y=await Bk(e.user.id,$,se+1);Y.data?K(Y.data):Y.error&&console.error("Error loading monthly statistics:",Y.error);const F=await Vk(e.user.id,$,se+1);F.data?de(F.data):F.error&&console.error("Error loading monthly completion grid:",F.error)},[(tt=e==null?void 0:e.user)==null?void 0:tt.id,n]);f.useEffect(()=>{Fn(I,ne)},[I,ne,Fn]),f.useEffect(()=>{if(i.length===0||S.length===0){we(new Map);return}const $=new Date(I,ne,1),se=new Date(I,ne+1,0);(async()=>{const F=new Map;for(const ie of i){const ke=await nS(ie.id,$,se);ke.size>0&&F.set(ie.id,ke)}we(F)})()},[i,S,I,ne]),f.useEffect(()=>{!n&&!r&&(o([]),h({}),y({}),R({}),z([]),A([]))},[n,r]),f.useEffect(()=>{if(!("serviceWorker"in navigator))return;const $=se=>{const Y=se.data;if(!Y||typeof Y!="object")return;const{type:F,detail:ie}=Y;F==="SUPABASE_WRITE_QUEUED"?d(im):F==="SUPABASE_QUEUE_FLUSHED"?(d(ke=>ke?ke===im||ke===om?null:ke:null),(ie==null?void 0:ie.pending)===0&&wn()):F==="SUPABASE_QUEUE_REPLAY_FAILED"&&d(om)};return navigator.serviceWorker.addEventListener("message",$),()=>{navigator.serviceWorker.removeEventListener("message",$)}},[wn]),f.useEffect(()=>{if(!("serviceWorker"in navigator))return;const $=()=>{navigator.serviceWorker.ready.then(se=>{var Y;(Y=se.active)==null||Y.postMessage({type:"PROCESS_SUPABASE_QUEUE"})}).catch(()=>{})};return window.addEventListener("online",$),$(),()=>{window.removeEventListener("online",$)}},[]);const nr=async($,se)=>{var ct;if(!n&&!r){d("Supabase credentials are not configured yet.");return}const Y=se===j,F=`${$.id}:${se}`;Y&&w(Ie=>({...Ie,[$.id]:!0})),_(Ie=>({...Ie,[F]:!0})),d(null);const ie=m[$.id],ke=(ct=b[$.id])==null?void 0:ct[se],lt=!!(ke!=null&&ke.completed||Y&&(ie!=null&&ie.completed));try{if(lt){const{error:Ie}=await By($.id,se);if(Ie)throw Ie;Y&&h(Ke=>({...Ke,[$.id]:{logId:null,completed:!1}})),y(Ke=>{const Fe={...Ke},ze={...Fe[$.id]??{}};return ze[se]={logId:null,completed:!1},Fe[$.id]=ze,Fe}),z(Ke=>{const Fe=Ke.filter(ze=>!(ze.habit_id===$.id&&ze.date===se));return R(uc(i,Fe,j)),Fe})}else{const Ie={habit_id:$.id,date:se,completed:!0},{data:Ke,error:Fe}=await zy(Ie);if(Fe)throw Fe;const ze=Ke??{id:(ke==null?void 0:ke.logId)??`temp-${$.id}-${se}`,habit_id:$.id,date:se,completed:!0};Y&&h(it=>({...it,[$.id]:{logId:ze.id,completed:!0}})),y(it=>{const Je={...it},vt={...Je[$.id]??{}};return vt[se]={logId:ze.id,completed:!0},Je[$.id]=vt,Je}),z(it=>{const Je=it.filter(vt=>!(vt.habit_id===$.id&&vt.date===se));return Je.push(ze),R(uc(i,Je,j)),Je})}}catch(Ie){d(Ie instanceof Error?Ie.message:"Unable to update the habit.")}finally{Y&&w(Ie=>({...Ie,[$.id]:!1})),_(Ie=>{const Ke={...Ie};return delete Ke[F],Ke})}},Ir=async $=>{await nr($,j)},us=f.useCallback($=>{k(se=>{const Y=zt(se),F=Number.isNaN(Y.getTime())?new Date:Y,ie=cc(F,$),ke=en(ie);return ke>v?v:ke})},[v]),oa=f.useCallback($=>{if(!$)return;const se=zt($);if(Number.isNaN(se.getTime()))return;const Y=en(se);k(Y>v?v:Y)},[v]),la=f.useCallback(()=>k(v),[v]),Pr=async($,se,Y)=>{if(!n&&!r){d("Supabase credentials are not configured yet.");return}const F=`${$}:${Y}`;_(ie=>({...ie,[F]:!0})),d(null);try{const{data:ie,error:ke}=await Hk(e.user.id,$,Y);if(ke)throw ke;await Fn(I,ne)}catch(ie){d(ie instanceof Error?ie.message:"Unable to update the habit.")}finally{_(ie=>{const ke={...ie};return delete ke[F],ke})}},rr=f.useMemo(()=>{var Y;if(i.length===0)return{total:0,scheduled:0,completed:0};let $=0,se=0;for(const F of i){const ie=P[F.id];((ie==null?void 0:ie.scheduledToday)??ys(F,j))&&($+=1),(Y=m[F.id])!=null&&Y.completed&&(se+=1)}return{total:i.length,scheduled:$,completed:se}},[i,m,P,j]),Rr=$=>{O(se=>({...se,[$]:!se[$]}))},N=$=>{const se=Ur(j),Y=j<v,F=j===v,ie=["habit-day-nav",`habit-day-nav--${$}`];return s.jsxs("div",{className:ie.join(" "),role:"group","aria-label":"Choose day to track habits",children:[s.jsx("button",{type:"button",className:"habit-day-nav__button",onClick:()=>us(-1),children:"← Previous day"}),s.jsxs("div",{className:"habit-day-nav__info",children:[s.jsx("p",{className:"habit-day-nav__label",children:"Tracking day"}),s.jsx("p",{className:"habit-day-nav__value",children:se}),s.jsxs("div",{className:"habit-day-nav__actions",children:[F?s.jsx("span",{className:"habit-day-nav__chip habit-day-nav__chip--current",children:"Today"}):s.jsx("button",{type:"button",className:"habit-day-nav__chip",onClick:la,children:"Jump to today"}),s.jsxs("label",{className:"habit-day-nav__picker","aria-label":"Select a date to track",children:[s.jsx("span",{className:"sr-only",children:"Select a date to track"}),s.jsx("input",{type:"date",value:j,max:v,onChange:ke=>oa(ke.target.value)})]})]})]}),s.jsx("button",{type:"button",className:"habit-day-nav__button",onClick:()=>us(1),disabled:!Y,children:"Next day →"})]})},ee=()=>s.jsx("ul",{className:"habit-checklist",role:"list",children:i.map($=>{var vt,Oe;const se=m[$.id],Y=!!(se!=null&&se.completed),F=!!g[$.id],ie=P[$.id],ke=(ie==null?void 0:ie.scheduledToday)??ys($,j),lt=(ie==null?void 0:ie.lastCompletedOn)??(Y?j:null),ct=pm(lt,j),Ie=lm($.schedule),Ke=Ie?cm(Ie):null,Fe=((vt=$.goal)==null?void 0:vt.title)??"Unassigned goal",ze=`habit-checkbox-${$.id}`,it=`habit-details-${$.id}`,Je=!!q[$.id];return s.jsxs("li",{className:`habit-checklist__item ${ke?"":"habit-checklist__item--rest"} ${Y?"habit-checklist__item--completed":""}`,children:[s.jsxs("div",{className:`habit-checklist__row ${Je?"habit-checklist__row--expanded":""}`,role:"button",tabIndex:0,"aria-expanded":Je,"aria-controls":it,onClick:()=>Rr($.id),onKeyDown:Be=>{Be.currentTarget===Be.target&&(Be.key==="Enter"||Be.key===" ")&&(Be.preventDefault(),Rr($.id))},children:[s.jsx("input",{id:ze,type:"checkbox",className:"habit-checklist__checkbox",checked:Y,onClick:Be=>Be.stopPropagation(),onChange:Be=>{Be.stopPropagation(),Ir($)},disabled:F||!ke&&!Y}),s.jsx("label",{htmlFor:ze,className:"habit-checklist__name",onClick:Be=>Be.stopPropagation(),children:$.name}),s.jsx("span",{className:`habit-checklist__chevron ${Je?"habit-checklist__chevron--open":""}`,"aria-hidden":"true"})]}),s.jsxs("div",{className:`habit-checklist__details-panel ${Je?"habit-checklist__details-panel--open":""}`,id:it,children:[s.jsx("p",{className:"habit-checklist__meta",children:Ke?`Life wheel • ${Ke}`:`Goal • ${Fe}`}),Ke&&((Oe=$.goal)!=null&&Oe.title)?s.jsxs("p",{className:"habit-checklist__meta habit-checklist__meta--secondary",children:["Goal • ",$.goal.title]}):null,ct?s.jsx("p",{className:"habit-checklist__note",children:ct}):null,s.jsxs("div",{className:"habit-checklist__detail-actions",children:[ke?null:s.jsx("span",{className:"habit-checklist__pill",children:"Rest day"}),F?s.jsx("span",{className:"habit-checklist__saving",children:"Updating…"}):null,s.jsx("button",{type:"button",className:"habit-checklist__alert-btn",onClick:Be=>{Be.stopPropagation(),fe({id:$.id,name:$.name})},children:"🔔 Alerts"})]})]})]},$.id)})}),te=()=>{const $=yS(j),se=bS(),Y=rr.scheduled||rr.total,F=Y?`${Math.min(rr.completed,Y)}/${Y} done`:"No habits scheduled",ie=j===v,ke=ie?"Things to do today":"Things to do for this day",lt=ie?"Check off the rituals that keep your life wheel balanced.":`Logging for ${Ur(j)}. Check off the rituals that keep your life wheel balanced.`,ct=u||(r?"Habit progress is stored locally in demo mode. Connect Supabase to sync across devices.":n?"Tap refresh if you updated habits elsewhere to pull in the latest list.":"Connect Supabase to sync your rituals and keep streaks backed up."),Ie=u?"error":r?"info":n?"muted":"warning",Ke=`Habit checklist for ${Ur(j)}`,Fe=()=>{D(!0),G(""),Se(""),E(""),U(""),le(""),Pe(null),Ae(null)},ze=async()=>{const Oe=[];ae.trim()&&Oe.push(`🌅 Morning:
${ae.trim()}`),ye.trim()&&Oe.push(`☀️ Day:
${ye.trim()}`),Te.trim()&&Oe.push(`🌙 Evening:
${Te.trim()}`),T.trim()&&Oe.push(`👥 Interactions:
${T.trim()}`),J.trim()&&Oe.push(`📝 Notes:
${J.trim()}`);const Be=Oe.join(`

`);if(!Be){Pe("Add at least one entry before saving.");return}re(!0),Pe(null),Ae(null);try{const Wt={user_id:e.user.id,entry_date:j,title:null,content:Be,mood:null,tags:null,linked_goal_ids:null,linked_habit_ids:null,is_private:!0,type:"quick",mood_score:null,category:null,unlock_date:null,goal_id:null},{error:Xt}=await Ru(Wt);if(Xt)throw new Error(Xt.message);D(!1),G(""),Se(""),E(""),U(""),le(""),Ae("Saved to your journal.")}catch(Wt){Pe(Wt instanceof Error?Wt.message:"Unable to save your journal entry.")}finally{re(!1)}},it=Ur(j),Je=Oe=>{pt(!0),Ar(Oe),dn(""),$e(null),tr(null)},vt=async()=>{const Oe=qe.trim();if(!Oe){$e("Add your intentions or todos before saving.");return}W(!0),$e(null),tr(null);try{const Be=Et==="tomorrow"?en(cc(zt(j),1)):j,Wt=Et==="tomorrow"?"Tomorrow's Intentions":"Today's Intentions",Xt={user_id:e.user.id,entry_date:Be,title:Wt,content:Oe,mood:null,tags:["intentions","todos"],linked_goal_ids:null,linked_habit_ids:null,is_private:!0,type:"quick",mood_score:null,category:null,unlock_date:null,goal_id:null},{error:Xe}=await Ru(Xt);if(Xe)throw new Error(Xe.message);pt(!1),dn(""),tr("Saved to your journal.")}catch(Be){$e(Be instanceof Error?Be.message:"Unable to save your journal entry.")}finally{W(!1)}};return s.jsxs("div",{className:"habit-checklist-card",role:"region","aria-label":Ke,children:[s.jsxs("div",{className:"habit-checklist-card__board",children:[s.jsxs("div",{className:"habit-checklist-card__board-head",children:[s.jsxs("div",{className:"habit-checklist-card__date-group",children:[s.jsx("p",{className:"habit-checklist-card__date",children:$}),s.jsx("p",{className:"habit-checklist-card__time",children:se})]}),s.jsxs("div",{className:"habit-checklist-card__head-actions",children:[s.jsx("span",{className:"habit-checklist-card__progress",children:F}),s.jsx("button",{type:"button",className:"habit-checklist-card__refresh",onClick:()=>void wn(),disabled:l||!n&&!r,children:l?"Refreshing…":"Refresh"})]})]}),s.jsxs("div",{className:"habit-checklist-card__board-body",children:[N("compact"),s.jsxs("div",{className:"habit-checklist-card__title",children:[s.jsx("h2",{children:ke}),s.jsx("p",{children:lt})]}),i.length===0?s.jsxs("div",{className:"habit-checklist-card__empty",children:[s.jsx("p",{children:"No habits scheduled for this day."}),s.jsx("p",{children:"Add a ritual to any goal and it will show up here for quick check-ins."})]}):ee(),s.jsxs("div",{className:"habit-quick-journal","aria-live":"polite",children:[s.jsxs("div",{className:"habit-quick-journal__header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"habit-quick-journal__eyebrow",children:"Reflect for this day"}),s.jsx("h3",{className:"habit-quick-journal__title",children:"Quick journal"})]}),s.jsx("span",{className:"habit-quick-journal__badge",children:it})]}),s.jsx("p",{className:"habit-quick-journal__hint",children:"Capture a few thoughts tied to the same date you are tracking above."}),B?s.jsxs("div",{className:"habit-quick-journal__sheet",children:[s.jsxs("label",{className:"habit-quick-journal__field habit-quick-journal__field--morning",children:[s.jsx("span",{className:"habit-quick-journal__field-label",children:"🌅 Morning"}),s.jsx("textarea",{rows:3,value:ae,onChange:Oe=>G(Oe.target.value),placeholder:"How did you start your day?"})]}),s.jsxs("label",{className:"habit-quick-journal__field habit-quick-journal__field--day",children:[s.jsx("span",{className:"habit-quick-journal__field-label",children:"☀️ Day"}),s.jsx("textarea",{rows:3,value:ye,onChange:Oe=>Se(Oe.target.value),placeholder:"What happened during the day?"})]}),s.jsxs("label",{className:"habit-quick-journal__field habit-quick-journal__field--evening",children:[s.jsx("span",{className:"habit-quick-journal__field-label",children:"🌙 Evening"}),s.jsx("textarea",{rows:3,value:Te,onChange:Oe=>E(Oe.target.value),placeholder:"How did you wind down?"})]}),s.jsxs("label",{className:"habit-quick-journal__field",children:[s.jsx("span",{className:"habit-quick-journal__field-label",children:"👥 Who did I interact with?"}),s.jsx("textarea",{rows:2,value:T,onChange:Oe=>U(Oe.target.value),placeholder:"People you spent time with or talked to..."})]}),s.jsxs("label",{className:"habit-quick-journal__field",children:[s.jsx("span",{className:"habit-quick-journal__field-label",children:"📝 Additional notes"}),s.jsx("textarea",{rows:3,value:J,onChange:Oe=>le(Oe.target.value),placeholder:"What stood out about this day?"})]}),me?s.jsx("p",{className:"habit-quick-journal__status habit-quick-journal__status--error",children:me}):null,s.jsxs("div",{className:"habit-quick-journal__actions",children:[s.jsx("button",{type:"button",className:"habit-quick-journal__save",onClick:()=>void ze(),disabled:M,children:M?"Saving…":"Save entry"}),s.jsx("button",{type:"button",className:"habit-quick-journal__cancel",onClick:()=>{D(!1),G(""),Se(""),E(""),U(""),le(""),Pe(null)},disabled:M,children:"Cancel"})]})]}):s.jsx("button",{type:"button",className:"habit-quick-journal__button",onClick:Fe,children:"+ Add quick journal"}),Ue?s.jsx("p",{className:"habit-quick-journal__status habit-quick-journal__status--success",children:Ue}):null]}),s.jsxs("div",{className:"habit-quick-journal habit-quick-journal--intentions","aria-live":"polite",children:[s.jsxs("div",{className:"habit-quick-journal__header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"habit-quick-journal__eyebrow",children:"Plan for this day"}),s.jsx("h3",{className:"habit-quick-journal__title",children:"Intentions & Todos"})]}),s.jsx("span",{className:"habit-quick-journal__badge",children:it})]}),s.jsx("p",{className:"habit-quick-journal__hint",children:"Set your intentions and list your key todos for the day ahead."}),Re?s.jsxs("div",{className:"habit-quick-journal__sheet",children:[s.jsxs("label",{className:"habit-quick-journal__field",children:[s.jsxs("span",{className:"habit-quick-journal__field-label",children:[Et==="tomorrow"?"Tomorrow's Intentions":"Today's Intentions"," (",Et==="tomorrow"?Ur(en(cc(zt(j),1))):it,")"]}),s.jsx("textarea",{rows:4,value:qe,onChange:Oe=>dn(Oe.target.value),placeholder:Et==="tomorrow"?"What do you intend to accomplish tomorrow? What's most important?":"What do you intend to accomplish today? What's most important?"})]}),_e?s.jsx("p",{className:"habit-quick-journal__status habit-quick-journal__status--error",children:_e}):null,s.jsxs("div",{className:"habit-quick-journal__actions",children:[s.jsx("button",{type:"button",className:"habit-quick-journal__save",onClick:()=>void vt(),disabled:bn,children:bn?"Saving…":"Save entry"}),s.jsx("button",{type:"button",className:"habit-quick-journal__cancel",onClick:()=>{pt(!1),dn(""),$e(null)},disabled:bn,children:"Cancel"})]})]}):s.jsxs("div",{className:"habit-quick-journal__button-group",children:[s.jsx("button",{type:"button",className:"habit-quick-journal__button habit-quick-journal__button--half",onClick:()=>Je("today"),children:"+ Today's intentions"}),s.jsx("button",{type:"button",className:"habit-quick-journal__button habit-quick-journal__button--half",onClick:()=>Je("tomorrow"),children:"+ Tomorrow's intentions"})]}),er?s.jsx("p",{className:"habit-quick-journal__status habit-quick-journal__status--success",children:er}):null]})]})]}),s.jsx("p",{className:`habit-checklist-card__status habit-checklist-card__status--${Ie}`,children:ct})]})},pe=$=>{const se=lm($),Y=se?cm(se):null,F=cS((se==null?void 0:se.key)??null);return{domainMeta:se,domainLabel:Y,domainColor:F,displayLabel:Y||"Habit"}},be=($,se,Y)=>({id:$,name:se,frequency:"daily",schedule:Y}),je=()=>{if(S.length===0)return null;const $=vn.scheduledTotal?Math.round(vn.scheduledComplete/vn.scheduledTotal*100):0,se=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Y=F=>{Z(F)};return s.jsxs("div",{className:"habit-monthly","aria-label":"Monthly habit dashboard",children:[s.jsx("div",{className:"habit-monthly__month-switcher",children:s.jsx("div",{className:"habit-monthly__month-tabs",role:"tablist","aria-label":"Select month",children:se.map((F,ie)=>{const ke=ie===ne,lt=new Date().getMonth(),ct=new Date().getFullYear(),Ie=ie===lt&&I===ct;return s.jsx("button",{type:"button",role:"tab","aria-selected":ke,"aria-controls":"habit-monthly-grid",className:`habit-monthly__month-tab ${ke?"habit-monthly__month-tab--active":""} ${Ie?"habit-monthly__month-tab--current":""}`,onClick:()=>Y(ie),disabled:l,children:F},F)})})}),s.jsxs("div",{id:"habit-monthly-grid",role:"tabpanel","aria-label":`Habit data for ${se[ne]} ${I}`,children:[s.jsxs("div",{className:"habit-monthly__summary",children:[s.jsxs("div",{children:[s.jsx("h3",{children:um(I,ne)}),s.jsx("p",{children:vn.scheduledTotal===0?"No scheduled habits this month yet. Build your rituals to see them here.":`${vn.scheduledComplete} of ${vn.scheduledTotal} scheduled check-ins complete (${$}%).`})]}),s.jsx("div",{className:"habit-monthly__summary-meter",role:"img","aria-label":`Monthly completion ${$}%`,children:s.jsx("div",{className:"habit-monthly__summary-meter-bar",style:{width:`${$}%`}})})]}),L&&L.habits.length>0&&s.jsxs("div",{className:"habit-monthly__stats",style:{margin:"1rem 0",padding:"1rem",background:"#f8f9fa",borderRadius:"8px"},children:[s.jsxs("h4",{style:{margin:"0 0 0.75rem 0",fontSize:"0.875rem",fontWeight:600},children:["Per-Habit Completion for ",se[ne]," ",I]}),s.jsx("div",{style:{display:"grid",gap:"0.5rem"},children:L.habits.map(F=>s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.8125rem",padding:"0.5rem",background:"white",borderRadius:"4px"},children:[s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontWeight:500,marginBottom:"0.125rem"},children:F.habitName}),F.goalTitle&&s.jsxs("div",{style:{fontSize:"0.75rem",color:"#6b7280"},children:["Goal: ",F.goalTitle]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginLeft:"1rem"},children:[s.jsxs("span",{style:{color:"#6b7280",fontSize:"0.75rem"},children:[F.completedDays,"/",F.totalDays," days"]}),s.jsxs("span",{style:{fontWeight:600,minWidth:"3rem",textAlign:"right",color:F.completionPercentage>=80?"#10b981":F.completionPercentage>=50?"#f59e0b":"#ef4444"},children:[F.completionPercentage,"%"]})]})]},F.habitId))}),s.jsxs("div",{style:{marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid #e5e7eb",fontSize:"0.8125rem",fontWeight:600},children:["Overall: ",L.overallCompletionPercentage,"% completion rate"]})]}),s.jsx("div",{className:"habit-monthly__table-wrapper",children:s.jsxs("table",{className:"habit-monthly__table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"habit-monthly__habit-column",scope:"col",children:"Life wheel habit"}),S.map(F=>s.jsxs("th",{scope:"col",className:"habit-monthly__day-column",children:[s.jsx("span",{className:"habit-monthly__day-number",children:dm(F)}),s.jsx("span",{className:"habit-monthly__day-name",children:hm(F)})]},F))]})}),s.jsx("tbody",{children:((L==null?void 0:L.habits)||[]).map(F=>{const ie=ue[F.habitId]??{},ke=F.schedule??null,{domainColor:lt,displayLabel:ct}=pe(ke);return s.jsxs("tr",{className:"habit-monthly__row",style:{borderLeftColor:lt},children:[s.jsx("th",{scope:"row",className:"habit-monthly__habit-cell",children:s.jsxs("div",{className:"habit-monthly__habit",children:[s.jsx("span",{className:"habit-monthly__domain",style:{backgroundColor:lt},children:ct}),s.jsxs("div",{className:"habit-monthly__habit-details",children:[s.jsxs("span",{className:"habit-monthly__habit-name",children:[F.emoji?`${F.emoji} `:"",F.habitName]}),s.jsx("span",{className:"habit-monthly__habit-goal",children:F.goalTitle?`Goal: ${F.goalTitle}`:"No goal assigned"})]})]})}),S.map(Ie=>{const Ke=`${F.habitId}:${Ie}`,Fe=!!ie[Ie],ze=Ie===j,it=!!p[Ke],Je=Ur(Ie),vt=be(F.habitId,F.habitName,ke),Oe=ys(vt,Ie),Be=["habit-monthly__cell"];return Oe?Be.push("habit-monthly__cell--scheduled"):Be.push("habit-monthly__cell--rest"),Fe&&Be.push("habit-monthly__cell--completed"),ze&&Be.push("habit-monthly__cell--today"),it&&Be.push("habit-monthly__cell--saving"),s.jsx("td",{className:Be.join(" "),children:s.jsx("button",{type:"button",className:`habit-monthly__toggle ${Fe?"habit-monthly__toggle--checked":""}`,"aria-pressed":Fe,"aria-label":`${Fe?"Uncheck":"Check"} ${F.habitName} for ${Je}`,onClick:()=>void Pr(F.habitId,F.habitName,Ie),disabled:!Oe&&!Fe||it,title:Oe?Je:`${Je} (rest day)`,children:it?"…":Fe?"✓":""})},Ke)})]},F.habitId)})})]})}),s.jsx("div",{className:"habit-monthly__mobile-view",children:((L==null?void 0:L.habits)||[]).length===0?s.jsxs("div",{className:"habit-monthly__mobile-empty",children:[s.jsx("h3",{children:"No habits scheduled"}),s.jsx("p",{children:"Add habits to your goals to see them tracked here month by month."})]}):((L==null?void 0:L.habits)||[]).map(F=>{const ie=ue[F.habitId]??{},ke=F.schedule??null,{domainColor:lt,displayLabel:ct}=pe(ke),Ie=Object.values(ie).filter(Boolean).length,Ke=S.length,Fe=Ke>0?Math.round(Ie/Ke*100):0;return s.jsxs("div",{className:"habit-monthly__mobile-card",style:{borderLeftColor:lt},children:[s.jsxs("div",{className:"habit-monthly__mobile-header",children:[s.jsx("span",{className:"habit-monthly__mobile-domain",style:{backgroundColor:lt},children:ct}),s.jsxs("div",{className:"habit-monthly__mobile-info",children:[s.jsxs("h3",{className:"habit-monthly__mobile-name",children:[F.emoji?`${F.emoji} `:"",F.habitName]}),s.jsx("p",{className:"habit-monthly__mobile-goal",children:F.goalTitle?`Goal: ${F.goalTitle}`:"No goal assigned"})]})]}),s.jsx("div",{className:"habit-monthly__mobile-days",children:S.map(ze=>{const it=`${F.habitId}:${ze}`,Je=!!ie[ze],vt=ze===j,Oe=!!p[it],Be=Ur(ze),Wt=be(F.habitId,F.habitName,ke),Xt=ys(Wt,ze),Xe=["habit-monthly__mobile-day"];return Xt?Xe.push("habit-monthly__mobile-day--scheduled"):Xe.push("habit-monthly__mobile-day--rest"),Je&&Xe.push("habit-monthly__mobile-day--completed"),vt&&Xe.push("habit-monthly__mobile-day--today"),s.jsxs("div",{className:Xe.join(" "),children:[s.jsx("span",{className:"habit-monthly__mobile-day-num",children:dm(ze)}),s.jsx("span",{className:"habit-monthly__mobile-day-name",children:hm(ze)}),s.jsx("button",{type:"button",className:`habit-monthly__mobile-toggle ${Je?"habit-monthly__mobile-toggle--checked":""}`,"aria-pressed":Je,"aria-label":`${Je?"Uncheck":"Check"} ${F.habitName} for ${Be}`,onClick:()=>void Pr(F.habitId,F.habitName,ze),disabled:!Xt&&!Je||Oe,children:Oe?"…":Je?"✓":""})]},ze)})}),s.jsxs("div",{className:"habit-monthly__mobile-summary",children:[s.jsx("div",{className:"habit-monthly__mobile-completion",children:s.jsxs("span",{children:[Ie," of ",Ke," days"]})}),s.jsxs("span",{className:`habit-monthly__mobile-percentage ${Fe>=80?"habit-monthly__mobile-percentage--high":Fe>=50?"habit-monthly__mobile-percentage--medium":"habit-monthly__mobile-percentage--low"}`,children:[Fe,"%"]})]})]},F.habitId)})})]})]})};return a?s.jsx("section",{className:"habit-tracker habit-tracker--compact",children:te()}):s.jsxs("section",{className:"habit-tracker",children:[s.jsxs("header",{className:"habit-tracker__header",children:[s.jsxs("div",{children:[s.jsx("h2",{children:`Monthly habits dashboard • ${um(I,ne)} (${S.length} days)`}),s.jsx("p",{children:"Use the monthly grid to see every habit alongside the life wheel domains they support."})]}),s.jsx("button",{type:"button",className:"habit-tracker__refresh",onClick:()=>void wn(),disabled:l||!n&&!r,children:l?"Refreshing…":"Refresh habits"})]}),r?s.jsx("p",{className:"habit-tracker__status habit-tracker__status--info",children:"Habit progress updates are stored locally in demo mode. Connect Supabase to sync completions across devices."}):n?null:s.jsx("p",{className:"habit-tracker__status habit-tracker__status--warning",children:"Connect your Supabase credentials to sync habits and log completions across devices."}),u?s.jsx("p",{className:"habit-tracker__status habit-tracker__status--error",children:u}):null,i.length===0?s.jsxs("div",{className:"habit-tracker__empty",children:[s.jsx("h3",{children:"No habits scheduled for this day"}),s.jsx("p",{children:"Once you add habits to your goals, they will appear here so you can check in daily and keep your streak alive."})]}):s.jsxs(s.Fragment,{children:[N("full"),s.jsx("ul",{className:"habit-tracker__list",children:i.map($=>{var ze;const se=m[$.id],Y=!!(se!=null&&se.completed),F=!!g[$.id],ie=P[$.id],ke=(ie==null?void 0:ie.scheduledToday)??ys($,j),lt=(ie==null?void 0:ie.currentStreak)??(Y?1:0),ct=(ie==null?void 0:ie.longestStreak)??Math.max(lt,0),Ie=(ie==null?void 0:ie.lastCompletedOn)??(Y?j:null),Ke=ke?Y?"Completed for this day. Keep the streak going!":"Tap the toggle when you finish this habit for the selected day.":"This is a rest day for this habit.",Fe=pm(Ie,j);return s.jsxs("li",{className:`habit-card ${Y?"habit-card--completed":""}`,children:[s.jsxs("div",{className:"habit-card__content",children:[s.jsxs("div",{children:[s.jsx("h3",{children:$.name}),s.jsxs("p",{className:"habit-card__goal",children:["Goal: ",s.jsx("span",{children:((ze=$.goal)==null?void 0:ze.title)??"Unassigned goal"})]}),s.jsx("p",{className:"habit-card__meta",children:uS($.frequency,$.schedule)})]}),s.jsx("button",{type:"button",className:`habit-card__toggle ${Y?"habit-card__toggle--active":""}`,onClick:()=>void Ir($),disabled:F,children:F?"Saving…":Y?"Mark incomplete":"Mark complete"})]}),s.jsxs("footer",{className:"habit-card__footer",children:[s.jsxs("div",{className:"habit-card__streaks",children:[s.jsxs("div",{className:"habit-card__streak habit-card__streak--current",children:[s.jsx("span",{className:"habit-card__streak-label",children:"Current streak"}),s.jsx("span",{className:"habit-card__streak-value",children:mm(lt)})]}),s.jsxs("div",{className:"habit-card__streak habit-card__streak--longest",children:[s.jsx("span",{className:"habit-card__streak-label",children:"Longest streak"}),s.jsx("span",{className:"habit-card__streak-value",children:mm(ct)})]})]}),s.jsxs("p",{className:`habit-card__status ${ke?"":"habit-card__status--rest"}`,children:[Ke,Fe?` ${Fe}`:""]})]})]},$.id)})}),je()]}),De&&s.jsx("div",{className:"habit-alert-modal-overlay",onClick:()=>fe(null),children:s.jsx("div",{className:"habit-alert-modal-content",onClick:$=>$.stopPropagation(),children:s.jsx(Xk,{habitId:De.id,habitName:De.name,onClose:()=>fe(null)})})})]})}function lm(e){if(!e||typeof e!="object")return null;const n=e.life_wheel_domain;if(!n)return null;if(typeof n=="string")return{key:n,label:null};if(typeof n=="object"&&n!==null){const r=n,a=typeof r.key=="string"?r.key:null,i=typeof r.label=="string"?r.label:null;if(a||i)return{key:a,label:i}}return null}function lS(e){return e?e.toString().trim().toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,""):null}function cS(e){const t=lS(e);return t?oS[t]??"#94a3b8":"#94a3b8"}function cm(e){return e.label?e.label:e.key?e.key.split("_").filter(Boolean).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):null}function uS(e,t){const n=dS(t);return n?`${e} • ${n}`:e}function dS(e){if(!e)return null;if(Array.isArray(e))return e.join(", ");if(typeof e=="object"){const t=e;if(Array.isArray(t.days))return t.days.filter(n=>typeof n=="string").map(hS).join(", ");if(typeof t.time=="string")return`at ${t.time}`}return null}function hS(e){return e.charAt(0).toUpperCase()+e.slice(1)}const fS=new Intl.DateTimeFormat(void 0,{month:"long",year:"numeric"}),mS=new Intl.DateTimeFormat(void 0,{day:"numeric"}),pS=new Intl.DateTimeFormat(void 0,{weekday:"short"}),gS=new Intl.DateTimeFormat(void 0,{weekday:"short",day:"numeric",month:"long",year:"numeric"}),_S=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1});function um(e,t){return fS.format(new Date(e,t,1))}function dm(e){return mS.format(zt(e))}function hm(e){return pS.format(zt(e))}function yS(e){return gS.format(zt(e))}function bS(e=new Date){return _S.format(e)}function Ur(e){return zt(e).toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})}function en(e){const t=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${n}-${r}`}function vS(e,t){const n=[],r=new Date(e.getTime());for(;r<=t;)n.push(en(r)),r.setDate(r.getDate()+1);return n}function cc(e,t){const n=new Date(e.getTime());return n.setDate(n.getDate()+t),n}function $u(e,t){const n=new Date(e.getTime());return n.setDate(n.getDate()-t),n}const fm={sun:0,sunday:0,mon:1,monday:1,tue:2,tues:2,tuesday:2,wed:3,wednesday:3,thu:4,thur:4,thurs:4,thursday:4,fri:5,friday:5,sat:6,saturday:6};function Ky(e,t){if(t&&Array.isArray(t)){const n=t.map(r=>typeof r=="string"?fm[r.toLowerCase()]:void 0).filter(r=>typeof r=="number");if(n.length>0)return r=>n.includes(r.getDay())}if(t&&typeof t=="object"&&t!==null){const n=t,r=typeof n.type=="string"?n.type.toLowerCase():"";if(r==="weekly"&&Array.isArray(n.days)){const a=n.days.map(i=>typeof i=="string"?fm[i.toLowerCase()]:void 0).filter(i=>typeof i=="number");if(a.length>0)return i=>a.includes(i.getDay())}if(r==="daily")return()=>!0}return typeof e=="string"&&e.toLowerCase().includes("weekly")?()=>!0:()=>!0}function zt(e){const[t,n,r]=e.split("-"),a=Number(t),i=Number(n),o=Number(r);return[a,i,o].some(l=>Number.isNaN(l))?new Date(e):new Date(a,i-1,o)}function ys(e,t){const n=zt(t);return Ky(e.frequency,e.schedule)(n)}function uc(e,t,n){if(e.length===0)return{};const r=zt(n),a=$u(r,Ou-1),i=en(a),o=new Map,l=new Map;for(const u of t){if(!u.completed||u.date<i||u.date>n)continue;let d=o.get(u.habit_id);d||(d=new Set,o.set(u.habit_id,d)),d.add(u.date);const m=l.get(u.habit_id);(!m||u.date>m)&&l.set(u.habit_id,u.date)}const c={};for(const u of e){const d=Ky(u.frequency,u.schedule),m=d(r),h=o.get(u.id)??new Set;let b=0,y=0,g=0,w=!0;for(let p=0;p<Ou;p+=1){const _=$u(r,p);if(_<a)break;if(!d(_))continue;const v=en(_);h.has(v)?(g+=1,w&&(b+=1),g>y&&(y=g)):(w&&(w=!1),g=0)}c[u.id]={scheduledToday:m,currentStreak:b,longestStreak:Math.max(y,b),lastCompletedOn:l.get(u.id)??null}}return c}function mm(e){const t=Math.max(0,Math.round(e));return`${t} ${t===1?"day":"days"}`}function wS(e,t){const n=zt(e),r=zt(t),a=n.getTime()-r.getTime();return Math.round(a/(1e3*60*60*24))}function pm(e,t){if(!e)return null;if(e===t)return"Last completed today.";const n=wS(t,e);if(n===1)return"Last completed yesterday.";if(n>1&&n<=7)return`Last completed ${n} days ago.`;const r=zt(e);return`Last completed on ${r.toLocaleDateString(void 0,{month:"short",day:"numeric",year:r.getFullYear()!==zt(t).getFullYear()?"numeric":void 0})}.`}function dc(e){return e.toISOString().split("T")[0]}function gm(e,t){return t<=0?0:Math.round(e/t*100)}async function xS(e,t,n=new Date){if(!t||t.length===0)return[];const r=t.map(m=>m.id),a=new Date(n);a.setHours(23,59,59,999);const i=new Date(a);i.setDate(i.getDate()-6),i.setHours(0,0,0,0);const o=new Date(a);o.setDate(o.getDate()-29),o.setHours(0,0,0,0);const{data:l,error:c}=await jl({userId:e,habitIds:r,startDate:dc(o),endDate:dc(a)});if(c)return console.error("Error fetching logs for adherence metrics:",c),t.map(m=>({habitId:m.id,habitTitle:m.title,window7:{scheduledCount:0,completedCount:0,percentage:0},window30:{scheduledCount:0,completedCount:0,percentage:0}}));const u=l??[],d=dc(i);return t.map(m=>{const h=u.filter(_=>_.habit_id===m.id&&_.done),b=h.filter(_=>_.date>=d),y=Au(m,7,a),g=Au(m,30,a),w=b.length,p=h.length;return{habitId:m.id,habitTitle:m.title,window7:{scheduledCount:y,completedCount:w,percentage:gm(w,y)},window30:{scheduledCount:g,completedCount:p,percentage:gm(p,g)}}})}function Mu(e){var t;return e?e.code==="42P01"||(((t=e.message)==null?void 0:t.includes("does not exist"))??!1):!1}function Jy(){return ce()}async function jS(e){const{suggestionId:t,userId:n,rationale:r}=e;try{const{getHabitV2:a,updateHabitV2:i}=await $n(async()=>{const{getHabitV2:k,updateHabitV2:S}=await Promise.resolve().then(()=>Mk);return{getHabitV2:k,updateHabitV2:S}},void 0),{clampScheduleChange:o}=await $n(async()=>{const{clampScheduleChange:k}=await Promise.resolve().then(()=>PS);return{clampScheduleChange:k}},void 0),{parseSchedule:l}=await $n(async()=>{const{parseSchedule:k}=await Promise.resolve().then(()=>Ok);return{parseSchedule:k}},void 0),c=Jy(),{data:u,error:d}=await c.from("habit_adjustments").select("*").eq("id",t).single();if(d)return Mu(d)?{ok:!1,error:"Revert feature not available (table not found)"}:{ok:!1,error:d.message};if(!u)return{ok:!1,error:"Suggestion not found"};if(!u.applied)return{ok:!1,error:"Suggestion has not been applied yet"};if(u.reverted)return{ok:!1,error:"Suggestion has already been reverted"};const m=u.old_schedule!==null,h=u.old_target_num!==null;if(!m&&!h)return{ok:!1,error:"No previous values to restore (old_schedule and old_target_num are both null)"};const{data:b,error:y}=await a(u.habit_id);if(y)return{ok:!1,error:y.message};if(!b)return{ok:!1,error:"Habit not found"};if(b.user_id!==n)return{ok:!1,error:"Not authorized to modify this habit"};const g={};if(m&&u.old_schedule){const k=l(u.old_schedule);k&&(g.schedule=k)}h&&typeof u.old_target_num=="number"&&(g.target_num=u.old_target_num);const w=o(b,g),p={};w.schedule&&(p.schedule=w.schedule),w.target_num!==void 0&&(p.target_num=w.target_num);const{data:_,error:v}=await i(u.habit_id,p);if(v)return{ok:!1,error:v.message};if(!_)return{ok:!1,error:"Failed to update habit"};const x=new Date().toISOString(),{error:j}=await c.from("habit_adjustments").update({reverted:!0,reverted_at:x,revert_rationale:r??null,applied_at:u.applied_at??x}).eq("id",t);return j&&!Mu(j)&&console.warn("Warning: Revert succeeded but audit update failed. Audit data may be incomplete.",j),{ok:!0,updatedHabit:_}}catch(a){return console.error("Unexpected error in revertSuggestionForHabit:",a),{ok:!1,error:"Unexpected error occurred while reverting suggestion"}}}async function _m(e,t=50){try{const n=ce(),{data:r,error:a}=await n.from("habits_v2").select("id").eq("user_id",e).eq("archived",!1);if(a)return console.error("Error fetching user habits:",a),[];if(!r||r.length===0)return[];const i=r.map(d=>d.id),o=Jy(),{data:l,error:c}=await o.from("habit_adjustments").select("*").in("habit_id",i).eq("applied",!0).eq("reverted",!1).order("created_at",{ascending:!1}).limit(t);return c?Mu(c)?(console.warn("habit_adjustments table not found. Returning empty list."),[]):(console.error("Error listing revertable suggestions:",c),[]):(l==null?void 0:l.filter(d=>d.old_schedule!==null||d.old_target_num!==null))??[]}catch(n){return console.error("Unexpected error in listRevertableSuggestions:",n),[]}}function kS({onCancel:e,onCompleteDraft:t,initialDraft:n}){const[r,a]=f.useState(1),i=!!(n!=null&&n.habitId),[o,l]=f.useState(""),[c,u]=f.useState(""),[d,m]=f.useState("boolean"),[h,b]=f.useState("every_day"),[y,g]=f.useState(void 0),[w,p]=f.useState(""),[_,v]=f.useState(!1),[x,j]=f.useState("08:00");f.useEffect(()=>{var P;n&&(l(n.emoji||""),u(n.title),m(n.type),b(n.schedule.choice),g(n.targetValue??void 0),p(n.targetUnit||""),v(n.remindersEnabled??!1),j(((P=n.reminderTimes)==null?void 0:P[0])||"08:00"),a(1))},[n]);const k=()=>{r<3&&a(r+1)},S=()=>{r>1&&a(r-1)},A=()=>{const P={title:c,emoji:o||null,type:d,schedule:{choice:h},remindersEnabled:_,reminderTimes:_&&x?[x]:[],habitId:n==null?void 0:n.habitId};d!=="boolean"&&(P.targetValue=y??null,P.targetUnit=w||null),t==null||t(P)};return s.jsxs("div",{className:"habit-wizard-container",style:{background:"white",border:"2px solid #667eea",borderRadius:"12px",padding:"2rem",marginBottom:"2rem",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.2)"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[s.jsx("h2",{style:{margin:0,fontSize:"1.5rem",color:"#667eea"},children:i?"Edit Habit":"Create New Habit"}),s.jsx("button",{onClick:e,"aria-label":"Close wizard",style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"1.5rem",color:"#64748b",padding:"0.25rem 0.5rem",lineHeight:1},children:"×"})]}),s.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"1rem",marginBottom:"2rem"},children:[1,2,3].map(P=>s.jsx("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:r>=P?"#667eea":"#e2e8f0",color:r>=P?"white":"#64748b",fontWeight:600,fontSize:"1rem"},children:P},P))}),r===1&&s.jsxs("div",{className:"habit-wizard-step",style:{marginBottom:"2rem"},children:[s.jsx("h3",{style:{marginTop:0,marginBottom:"1.5rem",fontSize:"1.25rem"},children:"Step 1: Basics"}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{htmlFor:"habit-emoji",style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.875rem"},children:"Emoji (optional)"}),s.jsx("input",{id:"habit-emoji",type:"text",value:o,onChange:P=>l(P.target.value),placeholder:"💪",maxLength:2,style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",boxSizing:"border-box"}})]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{htmlFor:"habit-title",style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.875rem"},children:"Habit Title *"}),s.jsx("input",{id:"habit-title",type:"text",value:c,onChange:P=>u(P.target.value),placeholder:"e.g., Morning workout",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",boxSizing:"border-box"}})]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{htmlFor:"habit-type",style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.875rem"},children:"Type *"}),s.jsxs("select",{id:"habit-type",value:d,onChange:P=>m(P.target.value),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",boxSizing:"border-box",background:"white"},children:[s.jsx("option",{value:"boolean",children:"Yes/No (e.g., Did you meditate?)"}),s.jsx("option",{value:"quantity",children:"Quantity (e.g., 8 glasses of water)"}),s.jsx("option",{value:"duration",children:"Duration (e.g., 30 minutes of exercise)"})]})]})]}),r===2&&s.jsxs("div",{className:"habit-wizard-step",style:{marginBottom:"2rem"},children:[s.jsx("h3",{style:{marginTop:0,marginBottom:"1.5rem",fontSize:"1.25rem"},children:"Step 2: Schedule"}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{htmlFor:"habit-schedule",style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.875rem"},children:"How often?"}),s.jsxs("select",{id:"habit-schedule",value:h,onChange:P=>b(P.target.value),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",boxSizing:"border-box",background:"white"},children:[s.jsx("option",{value:"every_day",children:"Every day"}),s.jsx("option",{value:"specific_days",children:"Specific days"}),s.jsx("option",{value:"x_per_week",children:"X times per week"})]})]}),s.jsxs("p",{style:{fontSize:"0.875rem",color:"#64748b",margin:0},children:[h==="every_day"&&"This habit will be tracked every single day.",h==="specific_days"&&"You'll be able to select specific days of the week.",h==="x_per_week"&&"You'll set a weekly goal for how many times to complete this habit."]})]}),r===3&&s.jsxs("div",{className:"habit-wizard-step",style:{marginBottom:"2rem"},children:[s.jsx("h3",{style:{marginTop:0,marginBottom:"1.5rem",fontSize:"1.25rem"},children:"Step 3: Targets & Reminders"}),d!=="boolean"&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsxs("label",{htmlFor:"habit-target-value",style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.875rem"},children:["Target ",d==="quantity"?"Amount":"Duration"]}),s.jsx("input",{id:"habit-target-value",type:"number",value:y??"",onChange:P=>{const R=P.target.value;g(R?parseFloat(R):void 0)},placeholder:d==="quantity"?"e.g., 8":"e.g., 30",min:"0",step:"any",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",boxSizing:"border-box"}})]}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{htmlFor:"habit-target-unit",style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.875rem"},children:"Unit"}),s.jsx("input",{id:"habit-target-unit",type:"text",value:w,onChange:P=>p(P.target.value),placeholder:d==="quantity"?"e.g., glasses, cups":"e.g., minutes, hours",style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",boxSizing:"border-box"}})]})]}),s.jsx("div",{style:{marginBottom:"1.5rem"},children:s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",cursor:"pointer"},children:[s.jsx("input",{type:"checkbox",checked:_,onChange:P=>v(P.target.checked),style:{width:"1.25rem",height:"1.25rem",cursor:"pointer"}}),s.jsx("span",{style:{fontWeight:500,fontSize:"0.875rem"},children:"Enable reminders"})]})}),_&&s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{htmlFor:"habit-reminder-time",style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.875rem"},children:"Reminder Time"}),s.jsx("input",{id:"habit-reminder-time",type:"time",value:x,onChange:P=>j(P.target.value),style:{width:"100%",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"1rem",boxSizing:"border-box"}})]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:"1rem"},children:[s.jsx("button",{onClick:r===1?e:S,style:{padding:"0.75rem 1.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",background:"white",color:"#64748b",fontSize:"1rem",fontWeight:500,cursor:"pointer"},children:r===1?"Cancel":"Back"}),s.jsx("button",{onClick:r===3?A:k,disabled:r===1&&!c,style:{padding:"0.75rem 1.5rem",border:"none",borderRadius:"8px",background:r===1&&!c?"#e2e8f0":"#667eea",color:"white",fontSize:"1rem",fontWeight:500,cursor:r===1&&!c?"not-allowed":"pointer"},children:r===3?i?"Save changes":"Create draft":"Next"})]})]})}function SS(e){if(typeof e!="object"||e===null)return!1;const t=e;return typeof t.title=="string"&&typeof t.emoji=="string"&&(t.type==="boolean"||t.type==="quantity"||t.type==="duration")&&typeof t.schedule=="object"&&t.schedule!==null}async function NS(){try{const e=await fetch("/app/habits/templates.json");if(!e.ok)return console.error(`Failed to load habit templates: HTTP ${e.status}`),[];const t=await e.json();return Array.isArray(t)?t.filter(r=>{const a=SS(r);return a||console.warn("Skipping invalid template:",r),a}):(console.error("Habit templates data is not an array"),[])}catch(e){return console.error("Error loading habit templates:",e),[]}}function ES({session:e,habits:t}){const[n,r]=f.useState(""),[a,i]=f.useState([]),[o,l]=f.useState(!1),[c,u]=f.useState(null),[d,m]=f.useState([]);f.useEffect(()=>{if(!n||!e){i([]),m([]);return}(async()=>{l(!0),u(null);try{const g=new Date,w=new Date(g);w.setDate(w.getDate()-30);const p=w.toISOString().split("T")[0],_=g.toISOString().split("T")[0],{data:v,error:x}=await Ly({userId:e.user.id,habitId:n,startDate:p,endDate:_});if(x)throw new Error(x.message);i(v??[]);const j=h(v??[]);m(j)}catch(g){u(g instanceof Error?g.message:"Failed to load insights"),console.error("Error loading habit logs:",g)}finally{l(!1)}})()},[n,e]);const h=y=>{const g={};y.forEach(_=>{_.done&&(g[_.date]=!0)});const w=new Date,p=[];for(let _=0;_<31;_++){const v=new Date(w);v.setDate(v.getDate()-(30-_));const x=v.toISOString().split("T")[0];p.push({date:x,hasLog:g[x]??!1})}return p},b=y=>{r(y.target.value)};return s.jsxs("div",{style:{background:"white",border:"2px solid #e2e8f0",borderRadius:"12px",padding:"2rem",marginBottom:"2rem"},children:[s.jsx("h2",{style:{marginTop:0,marginBottom:"1.5rem",fontSize:"1.5rem"},children:"Habit Insights"}),s.jsxs("div",{style:{marginBottom:"1.5rem"},children:[s.jsx("label",{htmlFor:"insights-habit-select",style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:600,color:"#374151"},children:"Select a habit"}),s.jsxs("select",{id:"insights-habit-select",value:n,onChange:b,style:{width:"100%",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"8px",fontSize:"0.875rem",background:"white",cursor:"pointer"},children:[s.jsx("option",{value:"",children:"Choose a habit..."}),t.map(y=>s.jsxs("option",{value:y.id,children:[y.emoji?`${y.emoji} `:"",y.title]},y.id))]})]}),!n&&s.jsx("p",{style:{color:"#64748b",fontSize:"0.875rem",margin:0},children:"Select a habit to view insights."}),n&&o&&s.jsx("p",{style:{color:"#64748b",fontSize:"0.875rem",margin:0},children:"Loading insights..."}),n&&c&&s.jsx("div",{style:{background:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"8px",padding:"0.75rem",fontSize:"0.875rem",color:"#991b1b"},children:c}),n&&!o&&!c&&d.length>0&&s.jsxs("div",{children:[s.jsx("h4",{style:{marginTop:0,marginBottom:"1rem",fontSize:"1rem",fontWeight:600},children:"31-Day Heatmap"}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem",fontSize:"0.75rem",color:"#6b7280"},children:[s.jsx("span",{children:"31 days ago"}),s.jsx("span",{children:"Today"})]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(31, 1fr)",gap:"4px",width:"100%"},children:d.map(y=>s.jsx("div",{title:y.date,style:{aspectRatio:"1",background:y.hasLog?"#10b981":"#e5e7eb",borderRadius:"4px",cursor:"pointer"}},y.date))}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"1rem",marginTop:"1.5rem"},children:[s.jsxs("div",{style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"1rem"},children:[s.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#1e293b"},children:a.filter(y=>y.done).length}),s.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:"Completions (31 days)"})]}),s.jsxs("div",{style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"1rem"},children:[s.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#1e293b"},children:[Math.round(a.filter(y=>y.done).length/31*100),"%"]}),s.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:"Success rate"})]})]})]})]})}function CS(e){const{adherence7:t,adherence30:n,currentStreak:r,previousStreak:a=0,minProgressStreak:i=14}=e;return t<45?{classification:"underperforming",suggestedAction:"ease",rationale:`7-day adherence is low at ${t}%. Consider reducing frequency or targets to rebuild momentum.`}:a>=7&&r===0?{classification:"underperforming",suggestedAction:"ease",rationale:`Previous streak of ${a} days was broken. Consider easing the habit to help restart.`}:n>=85&&r>=i?{classification:"high",suggestedAction:"progress",rationale:`Excellent performance with ${n}% adherence over 30 days and ${r}-day streak. Ready to level up!`}:t>=45&&t<=80?{classification:"stable",suggestedAction:"maintain",rationale:`Good consistency at ${t}% weekly adherence. Keep up the current pace.`}:{classification:"observe",suggestedAction:"observe",rationale:`Performance is ${t}% weekly / ${n}% monthly. Continue monitoring before making changes.`}}function Yy(e,t,n){const{classification:r,suggestedAction:a,rationale:i}=t,o={habitId:e.id,classification:r,suggestedAction:a,rationale:i};if(a==="maintain"||a==="observe")return o;const l=TS(e,a);return l?{...o,previewChange:l}:o}function TS(e,t){const n=ia(e.schedule),r=DS(n,t);if(r)return r;if((e.type==="quantity"||e.type==="duration")&&e.target_num)return AS(e.target_num,e.type,t)}function DS(e,t){if(!(!e||!e.mode)){if(e.mode==="times_per_week"&&typeof e.timesPerWeek=="number"){const n=e.timesPerWeek;if(t==="ease"){const r=Math.max(1,n-1);if(r!==n)return{schedule:{...e,timesPerWeek:r},changeDescription:`Reduce from ${n}x to ${r}x per week`}}else if(t==="progress"){const r=n+1;return{schedule:{...e,timesPerWeek:r},changeDescription:`Increase from ${n}x to ${r}x per week`}}}if(e.mode==="every_n_days"&&typeof e.intervalDays=="number"){const n=e.intervalDays;if(t==="ease"){const r=n+1;return{schedule:{...e,intervalDays:r},changeDescription:`Change from every ${n} days to every ${r} days`}}else if(t==="progress"){const r=Math.max(1,n-1);if(r!==n)return{schedule:{...e,intervalDays:r},changeDescription:`Change from every ${n} days to every ${r} days`}}}}}function AS(e,t,n){if(n==="ease"){const a=Math.max(1,Math.round(e*.9));if(a!==e)return{target_num:a,changeDescription:`Reduce target from ${e} to ${a} ${t==="duration"?"minutes":"units"}`}}else if(n==="progress"){const a=Math.round(e*1.1);return{target_num:a,changeDescription:`Increase target from ${e} to ${a} ${t==="duration"?"minutes":"units"}`}}}function IS(e,t){const n={};if(t.schedule){const r={...t.schedule};typeof r.timesPerWeek=="number"&&(r.timesPerWeek=Math.max(1,Math.min(7,r.timesPerWeek))),typeof r.intervalDays=="number"&&(r.intervalDays=Math.max(1,Math.min(30,r.intervalDays))),n.schedule=r}return t.target_num!==void 0&&(e.type==="boolean"?n.target_num=null:n.target_num=Math.max(.5,t.target_num)),n}const PS=Object.freeze(Object.defineProperty({__proto__:null,buildSuggestion:Yy,clampScheduleChange:IS,parseSchedule:ia},Symbol.toStringTag,{value:"Module"})),Yi=new Map;function RS(e){return JSON.stringify({classification:e.classification,adherence7:e.adherence7,adherence30:e.adherence30,streak:e.streak,preview:e.preview})}function OS(){return"".length>0}function LS(e){let t="";if(e.preview){const n=[];if(e.preview.schedule){const r=e.preview.schedule;r.mode==="times_per_week"&&r.timesPerWeek?n.push(`change frequency to ${r.timesPerWeek}x per week`):r.mode==="every_n_days"&&r.intervalDays&&n.push(`change to every ${r.intervalDays} days`)}e.preview.target_num!==void 0&&n.push(`adjust target to ${e.preview.target_num}`),n.length>0&&(t=` The proposed adjustment would ${n.join(" and ")}.`)}return`You are a supportive habit coach. Based on this habit performance data, provide a brief 2-3 sentence rationale explaining the recommendation in an encouraging, actionable way.

Classification: ${e.classification}
7-day adherence: ${e.adherence7}%
30-day adherence: ${e.adherence30}%
Current streak: ${e.streak} days${t}

Keep the response concise, positive, and focused on helping the user succeed. Do not use markdown formatting.`}async function $S(e,t=3e3){var n,r,a;try{return null;try{const c=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer undefined"},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"user",content:e}],max_tokens:150,temperature:.7}),signal:o.signal});if(clearTimeout(l),!c.ok)return console.warn("OpenAI API returned non-OK status:",c.status),null;const u=await c.json(),d=(a=(r=(n=u==null?void 0:u.choices)==null?void 0:n[0])==null?void 0:r.message)==null?void 0:a.content;return typeof d=="string"&&d.trim().length>0?d.trim():null}catch(c){return clearTimeout(l),c instanceof Error&&c.name==="AbortError"?console.warn("OpenAI API call timed out"):console.warn("OpenAI API call failed:",c),null}}catch(i){return console.warn("Unexpected error calling OpenAI:",i),null}}async function MS(e){const t=RS(e),n=Yi.get(t);if(n)return{...n,source:"cache"};if(!OS()){const o={rationale:e.baselineRationale,isAiEnhanced:!1,source:"baseline"};return Yi.set(t,o),o}const r=LS(e),a=await $S(r,3e3);if(a){const o={rationale:a,isAiEnhanced:!0,source:"ai"};return Yi.set(t,o),o}const i={rationale:e.baselineRationale,isAiEnhanced:!1,source:"baseline"};return Yi.set(t,i),i}const ym=!1;function US({session:e}){const[t,n]=f.useState(!1),[r,a]=f.useState([]),[i,o]=f.useState([]),[l,c]=f.useState([]),[u,d]=f.useState(!1),[m,h]=f.useState(null),[b,y]=f.useState([]),[g,w]=f.useState(!1),[p,_]=f.useState(null),[v,x]=f.useState([]),[j,k]=f.useState(!1),[S,A]=f.useState(!1),[P,R]=f.useState(!1),[q,O]=f.useState(null),[oe,z]=f.useState(void 0),[ne,Z]=f.useState(null),[I,C]=f.useState([]),[L,K]=f.useState(!1),[ue,de]=f.useState(null),[De,fe]=f.useState(new Set),[H,we]=f.useState(new Set),[B,D]=f.useState({}),[ae,G]=f.useState({}),[ye,Se]=f.useState(new Set),[Te,E]=f.useState(new Set),[T,U]=f.useState([]),[J,le]=f.useState(new Set),[M,re]=f.useState(new Set),[me,Pe]=f.useState(null),[Ue,Ae]=f.useState(""),[Re,pt]=f.useState(null),[Et,Ar]=f.useState({}),[qe,dn]=f.useState(new Set),bn=f.useMemo(()=>{const N=new Date;return r.filter(ee=>{const te=l.filter(pe=>pe.habit_id===ee.id);return Ry(ee,N,te)})},[r,l]);f.useEffect(()=>{if(!e)return;(async()=>{d(!0),h(null),w(!0),_(null);try{const{data:ee,error:te}=await bi();if(te)throw new Error(te.message);const pe=ee??[];a(pe);const{data:be,error:je}=await Iu(e.user.id);if(je)throw new Error(je.message);if(o(be??[]),pe.length>0){const $=pe.map(F=>F.id),{data:se,error:Y}=await Pu(e.user.id,$);Y?console.error("Error loading week logs:",Y):c(se??[])}const{data:He,error:tt}=await Oy(e.user.id);tt?(console.error("Error loading streaks:",tt),_(tt.message)):y(He??[])}catch(ee){h(ee instanceof Error?ee.message:"Unable to load habits right now.")}finally{d(!1),w(!1)}})()},[e]),f.useEffect(()=>{(async()=>{K(!0),de(null);try{const ee=await NS();C(ee)}catch(ee){de(ee instanceof Error?ee.message:"Failed to load templates"),console.error("Error loading habit templates:",ee)}finally{K(!1)}})()},[]);const W=f.useRef([]);f.useEffect(()=>{W.current=r},[r]);const _e=f.useCallback(async N=>{var ee;if(((ee=N.data)==null?void 0:ee.type)==="HABIT_ACTION_FROM_NOTIFICATION"){const{habitId:te,action:pe,completed:be,wasAlreadyCompleted:je}=N.data;if(pe==="done"&&be){await Promise.all([$e(),er()]);const He=W.current.find($=>$.id===te),tt=(He==null?void 0:He.title)||"Habit";Z(je?`"${tt}" was already completed today.`:`✓ Marked "${tt}" as done!`),setTimeout(()=>Z(null),3e3)}else pe==="snooze"&&(Z("Habit snoozed until tomorrow."),setTimeout(()=>Z(null),3e3))}},[e]);f.useEffect(()=>{var N;if(e)return(N=navigator.serviceWorker)==null||N.addEventListener("message",_e),()=>{var ee;(ee=navigator.serviceWorker)==null||ee.removeEventListener("message",_e)}},[e,_e]);const $e=async()=>{if(e)try{const{data:N,error:ee}=await Iu(e.user.id);if(ee)throw new Error(ee.message);o(N??[])}catch(N){console.error("Error reloading today's logs:",N)}},er=async()=>{if(!(!e||r.length===0))try{const N=r.map(pe=>pe.id),{data:ee,error:te}=await Pu(e.user.id,N);if(te)throw new Error(te.message);c(ee??[])}catch(N){console.error("Error reloading week logs:",N)}},tr=async()=>{if(!(!e||r.length===0)){k(!0);try{const N=await xS(e.user.id,r);x(N);const ee={};for(const pe of r){const be=N.find($=>$.habitId===pe.id);if(!be)continue;const je=b.find($=>$.habit_id===pe.id),He=CS({adherence7:be.window7.percentage,adherence30:be.window30.percentage,currentStreak:(je==null?void 0:je.current_streak)??0}),tt=Yy(pe,He,be);ee[pe.id]=tt,Et[pe.id]||MS({classification:He.classification,adherence7:be.window7.percentage,adherence30:be.window30.percentage,streak:(je==null?void 0:je.current_streak)??0,preview:tt.previewChange,baselineRationale:He.rationale}).then($=>{Ar(se=>({...se,[pe.id]:$}))}).catch($=>{console.warn("Error enhancing rationale:",$)})}G(ee);const te=await _m(e.user.id);U(te)}catch(N){console.error("Error loading adherence data:",N)}finally{k(!1)}}},vn=async(N,ee)=>{if(ee==="boolean"){if(!e){h("Session expired. Please refresh the page.");return}fe(te=>new Set(te).add(N)),h(null);try{const{data:te,error:pe}=await el({habit_id:N,done:!0,value:null},e.user.id);if(pe)throw new Error(pe.message);if(!te)throw new Error("Failed to log habit - no data returned");await Promise.all([$e(),er()])}catch(te){h(te instanceof Error?te.message:"Failed to log habit"),console.error("Error logging habit:",te)}finally{fe(te=>{const pe=new Set(te);return pe.delete(N),pe})}}},wn=async(N,ee)=>{if(!e){h("Session expired. Please refresh the page.");return}fe(te=>new Set(te).add(N.id)),h(null);try{const{data:te,error:pe}=await el({habit_id:N.id,done:!0,value:ee},e.user.id);if(pe)throw new Error(pe.message);if(!te)throw new Error("Failed to log habit - no data returned");await Promise.all([$e(),er()]),D(be=>{const je={...be};return delete je[N.id],je})}catch(te){h(te instanceof Error?te.message:"Failed to log habit"),console.error("Error logging habit:",te)}finally{fe(te=>{const pe=new Set(te);return pe.delete(N.id),pe})}},Fn=(N,ee)=>{const te=r.find(pe=>pe.id===N);pt({habitId:N,habitTitle:ee||(te==null?void 0:te.title)||"this habit"})},nr=async()=>{if(!Re)return;const{habitId:N}=Re;if(!e){h("Session expired. Please refresh the page."),pt(null);return}we(ee=>new Set(ee).add(N)),h(null),pt(null);try{const{error:ee}=await My(N);if(ee)throw new Error(ee.message);a(te=>te.filter(pe=>pe.id!==N)),Z("Habit archived successfully."),setTimeout(()=>Z(null),3e3)}catch(ee){h(ee instanceof Error?ee.message:"Failed to archive habit"),console.error("Error archiving habit:",ee)}finally{we(ee=>{const te=new Set(ee);return te.delete(N),te})}},Ir=N=>{const ee={habitId:N.id,title:N.title,emoji:N.emoji,type:N.type,targetValue:N.target_num,targetUnit:N.target_unit,schedule:{choice:us(N.schedule)},remindersEnabled:!1,reminderTimes:[]};z(ee),R(!0)},us=N=>{if(typeof N!="object"||N===null)return"every_day";const ee=N.mode;if(typeof ee!="string")return"every_day";switch(ee){case"daily":return"every_day";case"specific_days":return"specific_days";case"times_per_week":return"x_per_week";case"every_n_days":return"every_day";default:return"every_day"}},oa=async N=>{console.log("Habit draft",N),O(N),h(null),Z(null);const ee=!!N.habitId;try{if(ee&&N.habitId){const te={title:N.title,emoji:N.emoji,type:N.type,target_num:N.targetValue??null,target_unit:N.targetUnit??null,schedule:N.schedule},{data:pe,error:be}=await Uy(N.habitId,te);if(be)throw new Error(be.message);if(!pe)throw new Error("Failed to update habit - no data returned");R(!1),O(null),z(void 0),Z("Habit saved successfully!"),a(je=>je.map(He=>He.id===N.habitId?pe:He))}else{const te={title:N.title,emoji:N.emoji,type:N.type,target_num:N.targetValue??null,target_unit:N.targetUnit??null,schedule:N.schedule,archived:!1},{data:pe,error:be}=await Xd(te,e.user.id);if(be)throw new Error(be.message);if(!pe)throw new Error("Failed to create habit - no data returned");R(!1),O(null),z(void 0),Z(`Habit "${N.title}" created successfully!`),a([pe,...r])}setTimeout(()=>Z(null),3e3)}catch(te){const pe=ee?"update":"create";h(te instanceof Error?te.message:`Failed to ${pe} habit`),console.error(`Error ${pe}ing habit:`,te)}},la=()=>{R(!1),z(void 0)},Pr=async(N,ee)=>{if(!e){h("Session expired. Please refresh the page.");return}le(te=>new Set(te).add(N)),h(null);try{const te=await jS({suggestionId:N,userId:e.user.id,rationale:ee});if(!te.ok)throw new Error(te.error??"Failed to revert suggestion");if(te.updatedHabit){const tt=te.updatedHabit;a($=>$.map(se=>se.id===tt.id?tt:se))}re(tt=>new Set(tt).add(N));const pe=T.find(tt=>tt.id===N),be=r.find(tt=>tt.id===(pe==null?void 0:pe.habit_id)),je=(be==null?void 0:be.title)??"habit";Z(`Successfully reverted changes to "${je}"!`),setTimeout(()=>Z(null),3e3);const He=await _m(e.user.id);U(He)}catch(te){h(te instanceof Error?te.message:"Failed to revert suggestion"),console.error("Error reverting suggestion:",te)}finally{le(te=>{const pe=new Set(te);return pe.delete(N),pe}),Pe(null),Ae("")}},rr=N=>{switch(N.mode){case"daily":return"every_day";case"specific_days":return"specific_days";case"times_per_week":return"x_per_week";case"every_n_days":return"every_day";default:return"every_day"}},Rr=N=>{const ee={title:N.title,emoji:N.emoji?N.emoji:null,type:N.type,targetValue:N.target_num??null,targetUnit:N.target_unit??null,schedule:{choice:rr(N.schedule)},remindersEnabled:N.reminders&&N.reminders.length>0||!1,reminderTimes:N.reminders||[]};z(ee),R(!0)};return s.jsxs("div",{className:"habits-module-container",style:{maxWidth:"1200px",margin:"0 auto",padding:"2rem 1rem"},children:[s.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"3rem 2rem",borderRadius:"16px",marginBottom:"2rem",boxShadow:"0 10px 30px rgba(102, 126, 234, 0.3)"},children:[s.jsx("h1",{style:{margin:"0 0 1rem 0",fontSize:"2.5rem",fontWeight:"800"},children:"Habits"}),s.jsx("p",{style:{margin:0,fontSize:"1.125rem",opacity:.95},children:"Create and track habits that support your goals."})]}),s.jsxs("div",{style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"1rem",marginBottom:"2rem"},children:[s.jsxs("button",{onClick:()=>n(!t),style:{background:"transparent",border:"none",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#64748b",padding:0,fontWeight:500},children:[s.jsx("span",{children:t?"▼":"▶"}),"Developer setup notes (Supabase & Edge functions)"]}),t&&s.jsx("div",{style:{fontSize:"0.875rem",lineHeight:"1.6",marginTop:"1rem",color:"#475569"},children:s.jsxs("ul",{style:{marginLeft:"1.5rem",marginBottom:0},children:[s.jsxs("li",{children:["SQL migrations for ",s.jsx("code",{children:"habits_v2"}),", ",s.jsx("code",{children:"habit_logs_v2"}),", ",s.jsx("code",{children:"habit_reminders"}),", and related tables exist under ",s.jsx("code",{children:"/supabase/migrations/"})]}),s.jsxs("li",{children:["Edge Functions live under ",s.jsx("code",{children:"/supabase/functions/"})]}),s.jsxs("li",{children:["More details are in ",s.jsx("code",{children:"/HABITS_SETUP_GUIDE.md"})]})]})})]}),m&&s.jsx("div",{role:"alert",style:{background:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"8px",padding:"1rem",marginBottom:"2rem",color:"#991b1b"},children:m}),ne&&s.jsx("div",{role:"status","aria-live":"polite",style:{background:"#d1fae5",border:"1px solid #6ee7b7",borderRadius:"8px",padding:"1rem",marginBottom:"2rem",color:"#065f46"},children:ne}),!P&&s.jsxs("div",{style:{background:"white",border:"2px solid #e2e8f0",borderRadius:"12px",padding:"2rem",marginBottom:"2rem"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[s.jsx("h2",{style:{margin:0,fontSize:"1.5rem"},children:"Templates"}),s.jsxs("button",{onClick:()=>{z(void 0),R(!0)},style:{padding:"0.5rem 1rem",background:"#667eea",color:"white",border:"none",borderRadius:"8px",fontSize:"0.875rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx("span",{style:{fontSize:"1.125rem"},children:"+"}),"New habit"]})]}),L&&s.jsx("p",{style:{color:"#64748b",margin:0},children:"Loading templates…"}),ue&&s.jsx("p",{style:{color:"#dc2626",fontSize:"0.875rem",margin:0},children:ue}),!L&&!ue&&I.length>0&&s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"1rem"},children:I.map(N=>{var pe;let ee="";N.schedule.mode==="daily"?ee="Daily":N.schedule.mode==="specific_days"?ee=`${((pe=N.schedule.days)==null?void 0:pe.length)||0} days/week`:N.schedule.mode==="times_per_week"?ee=`${N.schedule.value||0}x/week`:N.schedule.mode==="every_n_days"&&(ee=`Every ${N.schedule.value||0} days`);const te=`${N.emoji}-${N.title}`;return s.jsxs("button",{onClick:()=>Rr(N),style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"1rem",cursor:"pointer",textAlign:"left",transition:"all 0.2s",display:"flex",flexDirection:"column",gap:"0.5rem"},onMouseEnter:be=>{be.currentTarget.style.borderColor="#667eea",be.currentTarget.style.background="#f1f5f9"},onMouseLeave:be=>{be.currentTarget.style.borderColor="#e2e8f0",be.currentTarget.style.background="#f8fafc"},children:[s.jsx("div",{style:{fontSize:"2rem",marginBottom:"0.25rem"},children:N.emoji}),s.jsx("div",{style:{fontWeight:600,fontSize:"0.875rem",color:"#1e293b"},children:N.title}),s.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b"},children:[N.type," • ",ee]})]},te)})}),!L&&!ue&&I.length===0&&s.jsx("p",{style:{color:"#64748b",fontSize:"0.875rem",margin:0},children:"No templates available."})]}),P&&s.jsx(kS,{onCancel:la,onCompleteDraft:oa,initialDraft:oe}),q&&!P&&s.jsxs("div",{style:{background:"#ecfdf5",border:"1px solid #6ee7b7",borderRadius:"8px",padding:"1rem",marginBottom:"2rem",fontSize:"0.875rem"},children:[s.jsx("strong",{children:"Draft created:"})," ",q.title," (",q.type,")"]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:"2rem",marginBottom:"2rem"},children:[s.jsxs("div",{style:{background:"white",border:"2px solid #e2e8f0",borderRadius:"12px",padding:"2rem"},children:[s.jsx("div",{style:{marginBottom:"1.5rem"},children:s.jsx("h2",{style:{margin:0,fontSize:"1.5rem"},children:"Your habits"})}),u?s.jsx("p",{style:{color:"#64748b",margin:0},children:"Loading habits…"}):r.length===0?s.jsx("p",{style:{color:"#64748b",margin:0},children:"No habits yet. Create your first habit to get started!"}):s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:r.map(N=>s.jsxs("div",{className:"habit-card",style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"1rem",position:"relative"},children:[!N.archived&&s.jsxs("div",{style:{position:"absolute",top:"0.5rem",right:"0.5rem",display:"flex",gap:"0.25rem"},children:[s.jsx("button",{type:"button",onClick:()=>Ir(N),className:"action-btn","aria-label":`Edit habit: ${N.title}`,title:"Edit habit",style:{background:"transparent",border:"1px solid #e2e8f0",borderRadius:"4px",padding:"0.375rem",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",transition:"all 0.2s"},children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),s.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),s.jsx("button",{type:"button",onClick:()=>Fn(N.id,N.title),disabled:H.has(N.id),className:"action-btn archive","aria-label":`Archive habit: ${N.title}`,title:"Archive habit",style:{background:"transparent",border:"1px solid #e2e8f0",borderRadius:"4px",padding:"0.375rem",cursor:H.has(N.id)?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",color:H.has(N.id)?"#94a3b8":"#64748b",opacity:H.has(N.id)?.6:1,transition:"all 0.2s"},children:s.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("polyline",{points:"3 6 5 6 21 6"}),s.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem",paddingRight:"4.5rem"},children:[N.emoji&&s.jsx("span",{style:{fontSize:"1.5rem"},children:N.emoji}),s.jsx("h3",{style:{margin:0,fontSize:"1.125rem",fontWeight:600},children:N.title})]}),s.jsxs("div",{style:{fontSize:"0.875rem",color:"#64748b",display:"flex",flexDirection:"column",gap:"0.25rem"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Type:"})," ",N.type,N.type!=="boolean"&&N.target_num&&s.jsxs("span",{children:[" (",N.target_num," ",N.target_unit||"units",")"]})]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Schedule:"})," Custom schedule"]})]})]},N.id))})]}),s.jsxs("div",{style:{background:"white",border:"2px solid #e2e8f0",borderRadius:"12px",padding:"2rem"},children:[s.jsx("h2",{style:{marginTop:0,marginBottom:"1.5rem",fontSize:"1.5rem"},children:"Today's checklist"}),u?s.jsx("p",{style:{color:"#64748b",margin:0},children:"Loading today's status…"}):bn.length===0?s.jsx("p",{style:{color:"#64748b",margin:0},children:"No habits to check today."}):s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:bn.map(N=>{const ee=i.find(Y=>Y.habit_id===N.id),te=(ee==null?void 0:ee.done)??!1,pe=ee==null?void 0:ee.value,be=De.has(N.id),je=B[N.id]||"",He=ia(N.schedule),tt=l.filter(Y=>Y.habit_id===N.id);let $=null;if((He==null?void 0:He.mode)==="times_per_week"&&He.timesPerWeek){const Y=Iy(He,tt);$={completed:Y.completed,target:Y.target}}let se=null;if((He==null?void 0:He.mode)==="every_n_days"){const Y=Py(He,N.created_at);if(Y){const F=new Date;F.setHours(0,0,0,0);const ie=Math.round((Y.getTime()-F.getTime())/(1e3*60*60*24));ie===0?se="Due today":ie===1?se="Due tomorrow":ie>0&&(se=`Due in ${ie} days`)}}return s.jsxs("div",{style:{background:te?"#f0fdf4":"#f8fafc",border:`1px solid ${te?"#bbf7d0":"#e2e8f0"}`,borderRadius:"8px",padding:"1rem",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flex:1,minWidth:0},children:[N.emoji&&s.jsx("span",{style:{fontSize:"1.25rem"},children:N.emoji}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[s.jsx("span",{style:{fontWeight:500},children:N.title}),$&&s.jsxs("span",{style:{fontSize:"0.625rem",background:"#e0e7ff",color:"#4338ca",padding:"0.125rem 0.375rem",borderRadius:"4px",fontWeight:600},children:[$.completed,"/",$.target," this week"]}),se&&s.jsx("span",{style:{fontSize:"0.625rem",background:"#fef3c7",color:"#92400e",padding:"0.125rem 0.375rem",borderRadius:"4px",fontWeight:600},children:se})]}),!te&&N.type!=="boolean"&&N.target_num&&s.jsxs("div",{style:{fontSize:"0.75rem",color:"#64748b",marginTop:"0.25rem"},children:["Target: ",N.target_num," ",N.target_unit||"units"]})]})]}),s.jsx("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:te?s.jsxs("div",{style:{fontSize:"0.875rem",color:"#15803d",fontWeight:600,whiteSpace:"nowrap"},children:["Done",pe!=null&&N.type!=="boolean"&&s.jsxs("span",{children:[" – ",pe," ",N.target_unit||"units"]})]}):s.jsx(s.Fragment,{children:N.type==="boolean"?s.jsx("button",{onClick:()=>vn(N.id,N.type),disabled:be,style:{padding:"0.5rem 1rem",background:be?"#94a3b8":"#667eea",color:"white",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontWeight:600,cursor:be?"not-allowed":"pointer",opacity:be?.7:1,whiteSpace:"nowrap"},children:be?"Saving…":"Mark done"}):N.type==="quantity"?s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"number",min:"0",step:"1",value:je,onChange:Y=>D(F=>({...F,[N.id]:Y.target.value})),placeholder:"0",disabled:be,style:{width:"70px",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",textAlign:"center"}}),s.jsx("button",{onClick:()=>{const Y=parseFloat(je);!isNaN(Y)&&Y>0&&wn(N,Y)},disabled:be||!je||parseFloat(je)<=0,style:{padding:"0.5rem 1rem",background:be||!je||parseFloat(je)<=0?"#94a3b8":"#667eea",color:"white",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontWeight:600,cursor:be||!je||parseFloat(je)<=0?"not-allowed":"pointer",opacity:be||!je||parseFloat(je)<=0?.7:1,whiteSpace:"nowrap"},children:be?"Saving…":"Log"})]}):N.type==="duration"?s.jsxs(s.Fragment,{children:[s.jsx("input",{type:"number",min:"0",step:"1",value:je,onChange:Y=>D(F=>({...F,[N.id]:Y.target.value})),placeholder:"0",disabled:be,style:{width:"70px",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",textAlign:"center"}}),s.jsx("button",{onClick:()=>{const Y=parseFloat(je);!isNaN(Y)&&Y>0&&wn(N,Y)},disabled:be||!je||parseFloat(je)<=0,style:{padding:"0.5rem 0.75rem",background:be||!je||parseFloat(je)<=0?"#94a3b8":"#667eea",color:"white",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontWeight:600,cursor:be||!je||parseFloat(je)<=0?"not-allowed":"pointer",opacity:be||!je||parseFloat(je)<=0?.7:1,whiteSpace:"nowrap"},children:be?"Saving…":"Log min"})]}):null})})]},N.id)})})]})]}),s.jsxs("div",{style:{background:"white",border:"2px solid #e2e8f0",borderRadius:"12px",padding:"2rem",marginBottom:"2rem"},children:[s.jsx("h2",{style:{marginTop:0,marginBottom:"1.5rem",fontSize:"1.5rem"},children:"Streaks"}),g?s.jsx("p",{style:{color:"#64748b",margin:0},children:"Loading streaks…"}):p?s.jsx("div",{style:{background:"#fee2e2",border:"1px solid #fca5a5",borderRadius:"8px",padding:"0.75rem",fontSize:"0.875rem",color:"#991b1b"},children:p}):b.length===0?s.jsx("p",{style:{color:"#64748b",margin:0,fontSize:"0.875rem"},children:"Start logging habits to see streaks here."}):s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:b.map(N=>{const ee=r.find(te=>te.id===N.habit_id);return ee?s.jsxs("div",{style:{background:"#f8fafc",border:"1px solid #e2e8f0",borderRadius:"8px",padding:"1rem",display:"flex",alignItems:"center",justifyContent:"space-between",gap:"1rem"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[ee.emoji&&s.jsx("span",{style:{fontSize:"1.25rem"},children:ee.emoji}),s.jsx("div",{style:{fontWeight:500},children:ee.title})]}),s.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.875rem"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[s.jsx("span",{children:"🔥"}),s.jsx("span",{style:{color:"#64748b"},children:"Current:"}),s.jsxs("span",{style:{fontWeight:600,color:"#1e293b"},children:[N.current_streak," days"]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem"},children:[s.jsx("span",{children:"⭐"}),s.jsx("span",{style:{color:"#64748b"},children:"Best:"}),s.jsxs("span",{style:{fontWeight:600,color:"#1e293b"},children:[N.best_streak," days"]})]})]})]},N.habit_id):null})})]}),s.jsxs("div",{style:{background:"white",border:"2px solid #e2e8f0",borderRadius:"12px",padding:"2rem",marginBottom:"2rem"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[s.jsx("h2",{style:{margin:0,fontSize:"1.5rem"},children:"Adherence"}),s.jsx("button",{onClick:()=>{S||tr(),A(!S)},style:{padding:"0.5rem 1rem",background:S?"#64748b":"#667eea",color:"white",border:"none",borderRadius:"6px",fontSize:"0.75rem",fontWeight:600,cursor:"pointer"},children:S?"Hide":"Show 7d/30d metrics"})]}),S&&s.jsx(s.Fragment,{children:j?s.jsx("p",{style:{color:"#64748b",margin:0},children:"Loading adherence data…"}):v.length===0?s.jsx("p",{style:{color:"#64748b",margin:0,fontSize:"0.875rem"},children:"No habits to analyze. Create habits and log progress to see adherence metrics."}):s.jsx("div",{style:{overflowX:"auto"},children:s.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"0.875rem"},children:[s.jsx("thead",{children:s.jsxs("tr",{style:{borderBottom:"2px solid #e2e8f0"},children:[s.jsx("th",{style:{textAlign:"left",padding:"0.75rem 0.5rem",fontWeight:600},children:"Habit"}),s.jsx("th",{style:{textAlign:"center",padding:"0.75rem 0.5rem",fontWeight:600},children:"7-day"}),s.jsx("th",{style:{textAlign:"center",padding:"0.75rem 0.5rem",fontWeight:600},children:"30-day"}),s.jsx("th",{style:{textAlign:"left",padding:"0.75rem 0.5rem",fontWeight:600},children:"Suggestion"}),ym]})}),s.jsx("tbody",{children:v.map(N=>{var be;const ee=r.find(je=>je.id===N.habitId),te=ae[N.habitId];ye.has(N.habitId),Te.has(N.habitId);const pe=je=>{switch(je){case"ease":return{background:"#fef3c7",color:"#92400e"};case"progress":return{background:"#dbeafe",color:"#1e40af"};case"maintain":return{background:"#dcfce7",color:"#166534"};default:return{background:"#f1f5f9",color:"#475569"}}};return s.jsxs("tr",{style:{borderBottom:"1px solid #f1f5f9"},children:[s.jsx("td",{style:{padding:"0.75rem 0.5rem"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[(ee==null?void 0:ee.emoji)&&s.jsx("span",{children:ee.emoji}),s.jsx("span",{children:N.habitTitle})]})}),s.jsxs("td",{style:{textAlign:"center",padding:"0.75rem 0.5rem"},children:[s.jsxs("span",{style:{display:"inline-block",padding:"0.25rem 0.5rem",borderRadius:"4px",fontWeight:600,background:N.window7.percentage>=80?"#dcfce7":N.window7.percentage>=50?"#fef9c3":"#fee2e2",color:N.window7.percentage>=80?"#166534":N.window7.percentage>=50?"#854d0e":"#991b1b"},children:[N.window7.percentage,"%"]}),s.jsxs("div",{style:{fontSize:"0.625rem",color:"#64748b",marginTop:"0.125rem"},children:[N.window7.completedCount,"/",N.window7.scheduledCount]})]}),s.jsxs("td",{style:{textAlign:"center",padding:"0.75rem 0.5rem"},children:[s.jsxs("span",{style:{display:"inline-block",padding:"0.25rem 0.5rem",borderRadius:"4px",fontWeight:600,background:N.window30.percentage>=80?"#dcfce7":N.window30.percentage>=50?"#fef9c3":"#fee2e2",color:N.window30.percentage>=80?"#166534":N.window30.percentage>=50?"#854d0e":"#991b1b"},children:[N.window30.percentage,"%"]}),s.jsxs("div",{style:{fontSize:"0.625rem",color:"#64748b",marginTop:"0.125rem"},children:[N.window30.completedCount,"/",N.window30.scheduledCount]})]}),s.jsx("td",{style:{padding:"0.75rem 0.5rem"},children:te?s.jsxs("div",{children:[s.jsx("span",{style:{display:"inline-block",padding:"0.25rem 0.5rem",borderRadius:"4px",fontWeight:600,fontSize:"0.75rem",textTransform:"capitalize",...pe(te.suggestedAction)},children:te.suggestedAction}),Et[N.habitId]?s.jsxs("div",{style:{marginTop:"0.25rem"},children:[s.jsxs("button",{onClick:()=>{dn(je=>{const He=new Set(je);return He.has(N.habitId)?He.delete(N.habitId):He.add(N.habitId),He})},style:{background:"transparent",border:"none",padding:0,cursor:"pointer",fontSize:"0.625rem",color:"#64748b",display:"flex",alignItems:"center",gap:"0.25rem",textAlign:"left",maxWidth:"200px"},children:[s.jsx("span",{style:{transform:qe.has(N.habitId)?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s",display:"inline-block"},children:"▶"}),s.jsxs("span",{children:[qe.has(N.habitId)?"Hide":"View"," rationale",Et[N.habitId].isAiEnhanced&&s.jsx("span",{style:{marginLeft:"0.25rem",background:"#e0e7ff",color:"#4338ca",padding:"0.0625rem 0.25rem",borderRadius:"2px",fontSize:"0.5rem"},children:"AI"})]})]}),qe.has(N.habitId)&&s.jsx("div",{style:{fontSize:"0.625rem",color:"#475569",marginTop:"0.25rem",maxWidth:"200px",padding:"0.5rem",background:"#f8fafc",borderRadius:"4px",border:"1px solid #e2e8f0"},children:Et[N.habitId].rationale})]}):s.jsx("div",{style:{fontSize:"0.625rem",color:"#64748b",marginTop:"0.25rem",maxWidth:"200px"},children:te.rationale}),((be=te.previewChange)==null?void 0:be.changeDescription)&&s.jsxs("div",{style:{fontSize:"0.625rem",color:"#6366f1",marginTop:"0.25rem",fontStyle:"italic"},children:["Preview: ",te.previewChange.changeDescription]})]}):s.jsx("span",{style:{color:"#94a3b8",fontSize:"0.75rem"},children:"—"})}),ym]},N.habitId)})})]})})})]}),me&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>{Pe(null),Ae("")},children:s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"2rem",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"},onClick:N=>N.stopPropagation(),children:[s.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1.125rem"},children:"Revert Changes?"}),s.jsxs("p",{style:{margin:"0 0 1rem 0",color:"#64748b",fontSize:"0.875rem"},children:['This will restore the previous schedule/target settings for "',me.habitTitle,'".']}),s.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:500},children:"Reason for reverting (optional):"}),s.jsx("textarea",{value:Ue,onChange:N=>Ae(N.target.value),placeholder:"Why are you reverting this change?",style:{width:"100%",minHeight:"80px",padding:"0.75rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem",resize:"vertical",marginBottom:"1.5rem",boxSizing:"border-box"}}),s.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>{Pe(null),Ae("")},style:{padding:"0.5rem 1rem",background:"#f1f5f9",color:"#475569",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontWeight:500,cursor:"pointer"},children:"Cancel"}),s.jsx("button",{onClick:()=>Pr(me.suggestionId,Ue||void 0),disabled:J.has(me.suggestionId),style:{padding:"0.5rem 1rem",background:J.has(me.suggestionId)?"#94a3b8":"#f59e0b",color:"white",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontWeight:600,cursor:J.has(me.suggestionId)?"not-allowed":"pointer"},children:J.has(me.suggestionId)?"Reverting…":"Confirm Revert"})]})]})}),Re&&s.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>pt(null),children:s.jsxs("div",{role:"dialog","aria-labelledby":"archive-dialog-title","aria-describedby":"archive-dialog-description",style:{background:"white",borderRadius:"12px",padding:"2rem",maxWidth:"400px",width:"90%",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"},onClick:N=>N.stopPropagation(),children:[s.jsx("h3",{id:"archive-dialog-title",style:{margin:"0 0 1rem 0",fontSize:"1.125rem"},children:"Archive Habit?"}),s.jsxs("p",{id:"archive-dialog-description",style:{margin:"0 0 1.5rem 0",color:"#64748b",fontSize:"0.875rem"},children:['Are you sure you want to archive "',Re.habitTitle,'"? The habit will be removed from your active list, but all history and logs will be preserved.']}),s.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[s.jsx("button",{onClick:()=>pt(null),style:{padding:"0.5rem 1rem",background:"#f1f5f9",color:"#475569",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontWeight:500,cursor:"pointer"},children:"Cancel"}),s.jsx("button",{onClick:nr,disabled:H.has(Re.habitId),style:{padding:"0.5rem 1rem",background:H.has(Re.habitId)?"#94a3b8":"#dc2626",color:"white",border:"none",borderRadius:"6px",fontSize:"0.875rem",fontWeight:600,cursor:H.has(Re.habitId)?"not-allowed":"pointer"},children:H.has(Re.habitId)?"Archiving…":"Archive"})]})]})}),s.jsx(ES,{session:e,habits:r})]})}function FS({session:e}){return s.jsxs("div",{className:"mobile-habit-home",children:[s.jsx("header",{className:"mobile-habit-home__header",children:s.jsx("h1",{children:"Daily habit checklist"})}),s.jsx(Lu,{session:e,variant:"compact"})]})}function zS({onClose:e,children:t}){return s.jsx("div",{className:"ideas-page",role:"dialog","aria-modal":"true","aria-label":"Developer ideas page",children:s.jsxs("div",{className:"ideas-page__content",children:[s.jsxs("header",{className:"ideas-page__header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"ideas-page__eyebrow",children:"Developer Ideas"}),s.jsx("h2",{children:"Focus fuels compounding progress"}),s.jsx("p",{children:"Let’s start with a question: Why do some people get so much further ahead than others? For Warren Buffett, the answer comes down to ruthless focus. His famous 5/25 Rule is all about this idea."}),s.jsx("p",{children:"Here’s how it works: Write down the 25 goals or interests you have. Then circle the top 5. Now — and this is the hard part — avoid the other 20 at all costs. Because according to Buffett, your biggest threat isn’t failure. It’s distraction."})]}),s.jsx("button",{type:"button",className:"ideas-page__close",onClick:e,children:"Close"})]}),t?s.jsx("div",{className:"ideas-page__body",children:t}):null]})})}const BS={stabilize:{label:"Stabilize"},boost:{label:"Boost"},celebrate:{label:"Celebrate"}};function Bs(e){return e.toISOString().slice(0,10)}function Qy(e){const t=new Date(e.getFullYear(),e.getMonth(),1),n=new Date(e.getFullYear(),e.getMonth()+1,0);return{start:t,end:n}}function qS(e,t){const{start:n,end:r}=Qy(e),a=r.getDate(),i=Bs(e);return Array.from({length:a},(o,l)=>{const c=new Date(e.getFullYear(),e.getMonth(),l+1),u=Bs(c);return{date:u,label:c.getDate().toString(),completions:t[u]??0,isToday:u===i}})}function HS(e,t){const n=new Intl.DateTimeFormat(void 0,{weekday:"short"});return Array.from({length:7},(r,a)=>{const i=new Date(e);i.setDate(e.getDate()-(6-a));const o=Bs(i);return{date:o,label:n.format(i),completions:t[o]??0}})}function WS({session:e,stats:t}){var Se,Te;const{isConfigured:n}=Pn(),r=un(e),[a,i]=f.useState([]),[o,l]=f.useState([]),[c,u]=f.useState([]),[d,m]=f.useState(!1),[h,b]=f.useState(null),[y,g]=f.useState(""),[w,p]=f.useState(""),[_,v]=f.useState(((Se=st[0])==null?void 0:Se.key)??""),[x,j]=f.useState(null),[k,S]=f.useState(null),[A,P]=f.useState(!1),[R,q]=f.useState(!1),O=f.useMemo(()=>new Date,[]),{start:oe,end:z}=f.useMemo(()=>Qy(O),[O]),ne=f.useId(),Z=f.useId(),I=f.useId(),C=n||r,L=a.length>0,K=f.useCallback(async()=>{if(!e||!n&&!r){i([]),l([]),u([]);return}m(!0),b(null);try{const[{data:E,error:T},{data:U,error:J}]=await Promise.all([xl(),bi()]);if(T)throw T;if(J)throw J;const le=(E??[]).filter(Re=>Re.user_id===e.user.id);i(le);const M=U??[],re=new Map(le.map(Re=>[Re.id,{id:Re.id,title:Re.title,target_date:Re.target_date}])),me=M.map(Re=>({...Re,goal:Re.goal_id?re.get(Re.goal_id)??null:null}));if(l(me),me.length===0){u([]);return}const Pe=me.map(Re=>Re.id),{data:Ue,error:Ae}=await jl({userId:e.user.id,habitIds:Pe,startDate:Bs(oe),endDate:Bs(z)});if(Ae)throw Ae;u(Ue??[])}catch(E){b(E instanceof Error?E.message:"Unable to load dashboard insights. Please try again shortly.")}finally{m(!1)}},[e,n,r,oe,z]);f.useEffect(()=>{n&&K()},[(Te=e==null?void 0:e.user)==null?void 0:Te.id,n,r,K]),f.useEffect(()=>{!n&&!r&&(i([]),l([]),u([]))},[n,r]),f.useEffect(()=>{var E;w||a.length===0||p(((E=a[0])==null?void 0:E.id)??"")},[a,w]);const ue=async E=>{var U;if(E.preventDefault(),j(null),S(null),!C){S("Connect Supabase to create new habits from the dashboard.");return}const T=y.trim();if(!T){S("Name your habit to save it.");return}P(!0);try{const{data:J,error:le}=await $y({title:T,domainKey:_||null,goalId:w||null,emoji:null},e.user.id);if(le)throw le;if(!J)throw new Error("Failed to create habit - no data returned");j("Habit added to your daily checklist."),g(""),p(""),v(((U=st[0])==null?void 0:U.key)??""),await K()}catch(J){S(J instanceof Error?J.message:"Unable to save the habit. Please try again shortly.")}finally{P(!1)}},de=f.useMemo(()=>c.reduce((E,T)=>(T.done&&(E[T.date]=(E[T.date]??0)+1),E),{}),[c]),De=f.useMemo(()=>qS(O,de),[O,de]),fe=f.useMemo(()=>HS(O,de),[O,de]),H=o.length,we=f.useMemo(()=>{const E=fe.reduce((J,le)=>J+le.completions,0),T=H*fe.length,U=T>0?Math.min(100,Math.round(E/T*100)):0;return{completed:E,possible:T,completionRate:U}},[fe,H]),B=f.useMemo(()=>{const E=Bs(O);return a.filter(T=>T.target_date&&T.target_date>=E).sort((T,U)=>(T.target_date??"").localeCompare(U.target_date??"")).slice(0,4)},[a,O]),D=f.useMemo(()=>{var M,re;const E={on_track:0,at_risk:0,off_track:0,achieved:0},T={};for(const me of a){const Pe=Qr(me.status_tag);E[Pe]+=1;const Ue=((M=me.title)==null?void 0:M.trim())||"Untitled goal",Ae=((re=me.progress_notes)==null?void 0:re.trim())??"",Re=Ae||null,pt=T[Pe];(!pt||Re&&!pt.note)&&(T[Pe]={title:Ue,note:Re})}const U=Xs.reduce((me,Pe)=>me+E[Pe],0),J=U-E.achieved,le=E.at_risk+E.off_track;return{counts:E,total:U,activeTotal:J,flagged:le,examples:T}},[a]),ae=f.useMemo(()=>{const{total:E,flagged:T,counts:U}=D;if(E===0)return"Add your first goal to start tracking progress health.";if(T>0){if(U.off_track>0){const le=U.off_track;return`${le} goal${le===1?" is":"s are"} off track. Use the latest notes to plan a reset.`}const J=U.at_risk;return`${J} goal${J===1?" needs":"s need"} a boost this week to stay on track.`}if(U.achieved>0&&U.achieved===E)return"All of your goals here are achieved—time to dream up the next milestone!";if(U.achieved>0){const J=U.achieved;return`Celebrate ${J} recent ${J===1?"win":"wins"} while keeping the rest in motion.`}return"Everything is trending smoothly—keep showing up for your rituals."},[D]),G=f.useMemo(()=>JS(a,O),[a,O]),ye=f.useMemo(()=>[{id:"client-sync",title:"Client strategy sync",detail:"Finalize the talking points and share the deck before the call.",dueLabel:"Today · 2:30 PM",accent:"sunrise"},{id:"habit-journal",title:"Evening reflection",detail:"Log your top three wins and note one improvement for tomorrow.",dueLabel:"Tonight · 9:00 PM",accent:"ocean"}],[]);return s.jsxs("section",{className:"progress-dashboard",children:[R?s.jsx(zS,{onClose:()=>q(!1)}):null,s.jsxs("header",{className:"progress-dashboard__header",children:[s.jsxs("div",{children:[s.jsx("h2",{children:"Progress dashboard"}),s.jsx("p",{children:"Visualize your month at a glance, track streaks, and keep upcoming goal milestones on your radar."})]}),s.jsxs("div",{className:"progress-dashboard__actions",children:[s.jsx("button",{type:"button",className:"progress-dashboard__ideas",onClick:()=>q(!0),children:"Developer ideas"}),s.jsx("button",{type:"button",className:"progress-dashboard__refresh",onClick:()=>void K(),disabled:d||!n&&!r,children:d?"Refreshing…":"Refresh insights"})]})]}),s.jsxs("section",{className:"workspace-snapshot","aria-labelledby":"workspace-snapshot-heading",children:[s.jsxs("div",{className:"workspace-snapshot__header",children:[s.jsx("h3",{id:"workspace-snapshot-heading",children:"Workspace snapshot"}),s.jsx("p",{children:"Track your stored rituals & goals at a glance"})]}),t?s.jsxs("div",{className:"workspace-snapshot__stats",children:[s.jsxs("div",{className:"workspace-snapshot__stat",children:[s.jsx("span",{className:"workspace-snapshot__stat-label",children:"Goals saved"}),s.jsx("span",{className:"workspace-snapshot__stat-value",children:t.goalCount})]}),s.jsxs("div",{className:"workspace-snapshot__stat",children:[s.jsx("span",{className:"workspace-snapshot__stat-label",children:"Habits tracked"}),s.jsx("span",{className:"workspace-snapshot__stat-value",children:t.habitCount})]}),s.jsxs("div",{className:"workspace-snapshot__stat",children:[s.jsx("span",{className:"workspace-snapshot__stat-label",children:"Check-ins logged"}),s.jsx("span",{className:"workspace-snapshot__stat-value",children:t.checkinCount})]})]}):s.jsx("p",{className:"workspace-snapshot__hint",children:"Sign in to Supabase to see your synced ritual stats."})]}),s.jsxs("section",{className:"urgent-tasks","aria-label":"Urgent tasks",children:[s.jsxs("div",{className:"urgent-tasks__header",children:[s.jsx("h3",{children:"Urgent tasks"}),s.jsx("p",{children:"Pin a couple of sticky notes to spotlight what needs your focus first."})]}),s.jsx("div",{className:"urgent-tasks__board",children:ye.map(E=>s.jsxs("article",{className:`sticky-note sticky-note--${E.accent}`,children:[s.jsx("span",{className:"sticky-note__pin","aria-hidden":"true"}),s.jsx("h4",{children:E.title}),s.jsx("p",{children:E.detail}),s.jsxs("p",{className:"sticky-note__due",children:[s.jsx("strong",{children:"Due"})," ",E.dueLabel]})]},E.id))})]}),r?s.jsx("p",{className:"progress-dashboard__status progress-dashboard__status--info",children:"Dashboard metrics are generated from demo data stored locally. Connect Supabase to analyze real habit completions and goal milestones."}):n?null:s.jsx("p",{className:"progress-dashboard__status progress-dashboard__status--warning",children:"Add your Supabase credentials to enable analytics, calendar history, and personalized goal summaries."}),h?s.jsx("p",{className:"progress-dashboard__status progress-dashboard__status--error",children:h}):null,s.jsxs("div",{className:"progress-dashboard__grid",children:[s.jsxs("article",{className:"progress-card progress-card--habit-create",children:[s.jsxs("header",{children:[s.jsx("h3",{children:"Capture a new daily habit"}),s.jsx("p",{children:"Align a fresh ritual with your life wheel so it appears on today's checklist."})]}),s.jsxs("form",{className:"habit-create-form",onSubmit:ue,children:[s.jsxs("label",{className:"habit-create-form__field",htmlFor:ne,children:[s.jsx("span",{children:"Habit name"}),s.jsx("input",{id:ne,type:"text",value:y,onChange:E=>g(E.target.value),placeholder:"Evening wind-down ritual",autoComplete:"off",disabled:!C})]}),s.jsxs("div",{className:"habit-create-form__row",children:[s.jsxs("label",{className:"habit-create-form__field",htmlFor:Z,children:[s.jsx("span",{children:"Life wheel focus"}),s.jsx("select",{id:Z,value:_,onChange:E=>v(E.target.value),disabled:!C,children:st.map(E=>s.jsx("option",{value:E.key,children:E.label},E.key))})]}),s.jsxs("label",{className:"habit-create-form__field",htmlFor:I,children:[s.jsx("span",{children:"Attach to goal"}),s.jsxs("select",{id:I,value:w,onChange:E=>p(E.target.value),disabled:!C||!L,children:[s.jsx("option",{value:"",disabled:!0,children:L?"Choose a goal":"No goals yet"}),a.map(E=>s.jsx("option",{value:E.id,children:E.title??"Untitled goal"},E.id))]})]})]}),x?s.jsx("p",{className:"habit-create-form__status habit-create-form__status--success",children:x}):null,k?s.jsx("p",{className:"habit-create-form__status habit-create-form__status--error",children:k}):null,s.jsx("button",{type:"submit",className:"habit-create-form__submit",disabled:A||!C,children:A?"Saving…":"Add daily habit"})]}),C?null:s.jsx("p",{className:"habit-create-form__hint",children:"Connect Supabase or explore demo mode to create habits from the dashboard."})]}),s.jsxs("article",{className:"progress-card progress-card--digest",children:[s.jsxs("header",{children:[s.jsx("h3",{children:"Weekly focus digest"}),s.jsx("p",{children:G.intro}),G.headline?s.jsx("p",{className:"focus-digest__headline",children:G.headline}):null]}),G.actions.length===0?s.jsx("p",{className:"progress-card__empty",children:G.emptyMessage}):s.jsx("ul",{className:"focus-digest__actions",children:G.actions.map(E=>s.jsxs("li",{className:`focus-digest__action focus-digest__action--${E.tone}`,children:[s.jsxs("div",{className:"focus-digest__meta",children:[s.jsx("span",{className:`goal-status goal-status--${E.status}`,children:gr[E.status].label}),s.jsx("span",{className:`focus-digest__tone focus-digest__tone--${E.tone}`,children:BS[E.tone].label})]}),s.jsx("p",{className:"focus-digest__action-title",children:E.title}),s.jsx("p",{className:"focus-digest__action-summary",children:E.summary}),E.note?s.jsx("p",{className:"focus-digest__action-note",children:E.note}):null]},E.id))})]}),s.jsxs("article",{className:"progress-card progress-card--summary",children:[s.jsxs("header",{children:[s.jsx("h3",{children:"This week's momentum"}),s.jsx("p",{children:H>0?`You checked off ${we.completed} of ${we.possible} planned habits this week.`:"Add habits to start measuring your streaks."})]}),s.jsxs("div",{className:"progress-card__metric",children:[s.jsxs("span",{className:"progress-card__metric-value",children:[we.completionRate,"%"]}),s.jsx("span",{className:"progress-card__metric-label",children:"Completion rate"})]}),s.jsx("ul",{className:"progress-card__trend","aria-label":"Daily habit completions for the past 7 days",children:fe.map(E=>s.jsxs("li",{children:[s.jsx("span",{className:"progress-card__trend-label",children:E.label}),s.jsx("span",{className:"progress-card__trend-value",children:E.completions})]},E.date))})]}),s.jsxs("article",{className:"progress-card progress-card--statuses",children:[s.jsxs("header",{children:[s.jsx("h3",{children:"Goal health snapshot"}),s.jsx("p",{children:ae})]}),D.total===0?s.jsx("p",{className:"progress-card__empty",children:"Add at least one goal to see the health breakdown."}):s.jsx("ul",{className:"progress-status-list",children:Xs.map(E=>{const T=D.counts[E],U=D.total>0?Math.round(T/D.total*100):0,J=gr[E],le=D.examples[E],M=le!=null&&le.note?Xy(le.note):"",re=!!M;return s.jsxs("li",{className:`progress-status progress-status--${E}`,children:[s.jsxs("div",{className:"progress-status__label",children:[s.jsx("span",{className:`goal-status goal-status--${E}`,children:J.label}),s.jsxs("span",{className:"progress-status__count",children:[T," ",T===1?"goal":"goals",s.jsxs("span",{className:"progress-status__percent",children:["(",U,"%)"]})]})]}),s.jsx("div",{className:"progress-status__bar",role:"progressbar","aria-valuenow":U,"aria-valuemin":0,"aria-valuemax":100,children:s.jsx("span",{className:`progress-status__bar-fill progress-status__bar-fill--${E}`,style:{width:`${U}%`}})}),re?s.jsxs("div",{className:"progress-status__note",children:[s.jsx("span",{className:"progress-status__note-title",children:(le==null?void 0:le.title)??J.label}),s.jsx("span",{className:"progress-status__note-text",children:M})]}):s.jsx("p",{className:"progress-status__description",children:T===0?J.empty:J.description})]},E)})})]}),s.jsxs("article",{className:"progress-card progress-card--calendar",children:[s.jsxs("header",{children:[s.jsx("h3",{children:O.toLocaleString(void 0,{month:"long",year:"numeric"})}),s.jsx("p",{children:"Each dot represents habits you completed on that day."})]}),s.jsx("div",{className:"progress-calendar",role:"grid","aria-label":"Habit completion calendar",children:De.map(E=>s.jsxs("div",{role:"gridcell","aria-label":`${E.date}: ${E.completions} habits completed`,className:`progress-calendar__day ${E.isToday?"progress-calendar__day--today":""}`,children:[s.jsx("span",{className:"progress-calendar__date",children:E.label}),s.jsx("span",{className:`progress-calendar__dot progress-calendar__dot--level-${VS(E.completions)}`}),s.jsx("span",{className:"progress-calendar__count",children:E.completions})]},E.date))})]}),s.jsxs("article",{className:"progress-card progress-card--goals",children:[s.jsxs("header",{children:[s.jsx("h3",{children:"Upcoming goal milestones"}),s.jsx("p",{children:"Stay ahead of deadlines by keeping these target dates in focus."})]}),B.length===0?s.jsx("p",{className:"progress-card__empty",children:"No upcoming target dates. Set target dates when creating your goals."}):s.jsx("ul",{className:"progress-card__goal-list",children:B.map(E=>s.jsxs("li",{children:[s.jsx("span",{className:"progress-card__goal-title",children:E.title}),s.jsx("span",{className:"progress-card__goal-date",children:Zy(E.target_date)})]},E.id))})]})]})]})}function VS(e){return e===0?0:e===1?1:e===2?2:e<=4?3:4}function Xy(e,t=160){const n=e.replace(/\s+/g," ").trim();return n?n.length<=t?n:`${n.slice(0,Math.max(0,t-1))}…`:""}function Zy(e){return new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric"})}function GS(e,t){if(!e.target_date)return null;const n=new Date(e.target_date);if(Number.isNaN(n.getTime()))return null;const r=h=>{const b=new Date(h);return b.setHours(0,0,0,0),b},a=r(t).getTime(),o=r(n).getTime()-a,l=Math.round(o/(1e3*60*60*24)),c=Math.abs(l),u=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"});let d="day",m=l;return c>=60?(d="month",m=Math.round(l/30)):c>=14&&(d="week",m=Math.round(l/7)),{relative:u.format(m,d),readable:Zy(e.target_date),isPast:l<0}}function nl(e){if(e.target_date){const t=new Date(e.target_date).getTime();if(!Number.isNaN(t))return t}if(e.created_at){const t=new Date(e.created_at).getTime();if(!Number.isNaN(t))return t}return Number.POSITIVE_INFINITY}function hc(e,t){const n=nl(e),r=nl(t);return!Number.isFinite(n)&&!Number.isFinite(r)?0:Number.isFinite(n)?Number.isFinite(r)?n-r:-1:1}function KS(e){return e.length===0?null:e.slice().sort((t,n)=>{const r=nl(t),a=nl(n);return Number.isFinite(a)&&Number.isFinite(r)?a-r:Number.isFinite(a)?-1:Number.isFinite(r)?1:0})[0]}function Qi(e,t,n,r){var c;const a=((c=e.title)==null?void 0:c.trim())||"Untitled goal",i=Xy(e.progress_notes??""),o=GS(e,r);let l;return t==="off_track"?o?l=o.isPast?`Target date was ${o.relative} (${o.readable}). Plan a reset and log next steps.`:`Target date is ${o.relative} (${o.readable}). Rebuild the plan and confirm support.`:l="Define a new checkpoint and list the blockers so you can tackle them head-on.":t==="at_risk"?o?l=`Protect momentum before ${o.relative} (${o.readable}) by booking time for the next milestone.`:l="Schedule a working session and capture the next milestone to keep things moving.":t==="achieved"?o?l=`Celebrate the win and share highlights from ${o.readable}.`:l="Celebrate the win and document what made it successful for future projects.":o?l=`Lock in your next micro-win ${o.relative} (${o.readable}) so progress stays steady.`:l="Capture the very next action and set a target date to keep momentum focused.",{id:e.id,tone:n,status:t,title:a,summary:l,note:i?`Latest note: ${i}`:void 0}}function JS(e,t){if(e.length===0)return{intro:"Use this digest to plan your weekly sprint once goals are in place.",headline:"",actions:[],emptyMessage:"Add your first goal to unlock personalized focus prompts."};const n=e.map(y=>({goal:y,status:Qr(y.status_tag)})),r=n.filter(y=>y.status==="off_track").map(y=>y.goal),a=n.filter(y=>y.status==="at_risk").map(y=>y.goal),i=n.filter(y=>y.status==="on_track").map(y=>y.goal),o=n.filter(y=>y.status==="achieved").map(y=>y.goal),l=r.length+a.length,c=n.length;let u,d;l>0?(u=`You have ${l} goal${l===1?"":"s"} that need attention this week.`,d=r.length>0?"Stabilize off-track goals first, then boost the ones losing momentum.":"Give at-risk goals a boost so they stay out of the danger zone."):i.length>0?(u=`All ${c===1?"goal is":"goals are"} currently on track.`,d="Lock in the next milestone while energy is high."):(u="Wins are rolling in—capture what worked and plan the next adventure.",d="Celebrate progress and choose the next big focus.");const m=[],h=r.slice().sort((y,g)=>hc(y,g));for(const y of h.slice(0,2))m.push(Qi(y,"off_track","stabilize",t));if(m.length<3){const y=a.slice().sort((g,w)=>hc(g,w));for(const g of y.slice(0,3-m.length))m.push(Qi(g,"at_risk","boost",t))}if(m.length<3&&i.length>0){const y=i.slice().sort((g,w)=>hc(g,w))[0];y&&m.push(Qi(y,"on_track","boost",t))}if(m.length<3&&o.length>0){const y=KS(o);y&&m.push(Qi(y,"achieved","celebrate",t))}const b=l>0?"Once these goals are stabilized we will suggest the next set of focus moves here.":"Capture new goals or progress notes to unlock personalized focus ideas.";return{intro:u,headline:d,actions:m,emptyMessage:b}}const eh="vision-board";async function YS(e){if(!Ce())return{data:Cj(e||We),error:null};const n=await ce().from("vision_images").select("*").eq("user_id",e).order("created_at",{ascending:!1}).returns();return{data:n.data,error:n.error}}function bm(e){if(e.image_source==="url"&&e.image_url)return e.image_url;const t=e.image_path;if(!t)return"";if(!Ce())return t;const n=ce(),{data:r}=n.storage.from(eh).getPublicUrl(t);return r.publicUrl}async function QS({userId:e,file:t,fileName:n,caption:r,originalFormat:a}){var g;if(!Ce())try{const w=await Lj(t);return{data:jy({user_id:e||We,image_path:w,caption:r!=null&&r.trim()?r.trim():null,file_format:a||null}),error:null}}catch(w){return{data:null,error:w instanceof Error?w:new Error("Unable to store vision image.")}}const i=ce(),o=((g=n.split(".").pop())==null?void 0:g.toLowerCase())??"webp",l=typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():`${Date.now()}`,c=n.replace(/\.[^/.]+$/,"").toLowerCase().replace(/[^a-z0-9]+/g,"-").slice(0,40),u=`${e}/${l}-${c||"vision-image"}.${o}`,{data:d,error:m}=await i.storage.from(eh).upload(u,t,{cacheControl:"3600",upsert:!1,contentType:t instanceof File?t.type:"image/webp"});if(m)return{data:null,error:new Error(m.message)};const h={user_id:e,image_path:(d==null?void 0:d.path)??u,image_source:"file",caption:r!=null&&r.trim()?r.trim():null,file_path:(d==null?void 0:d.path)??u,file_format:a||o},{data:b,error:y}=await i.from("vision_images").insert(h).select().returns().single();return y?{data:null,error:y}:{data:b,error:null}}async function XS({userId:e,imageUrl:t,caption:n}){try{new URL(t)}catch{return{data:null,error:new Error("Invalid URL format")}}if(!Ce())try{return{data:jy({user_id:e||We,image_url:t,image_source:"url",caption:n!=null&&n.trim()?n.trim():null}),error:null}}catch(l){return{data:null,error:l instanceof Error?l:new Error("Unable to store vision image.")}}const r=ce(),a={user_id:e,image_url:t,image_source:"url",caption:n!=null&&n.trim()?n.trim():null},{data:i,error:o}=await r.from("vision_images").insert(a).select().returns().single();return o?{data:null,error:o}:{data:i,error:null}}async function ZS(e){if(!Ce())return Tj(e.id),null;const t=ce(),{error:n}=await t.from("vision_images").delete().eq("id",e.id);if(n)return n;if(e.image_source==="file"&&e.image_path){const{error:r}=await t.storage.from(eh).remove([e.image_path]);if(r)return new Error(r.message)}return null}function eb(e){var i;const t=(i=e.name.split(".").pop())==null?void 0:i.toLowerCase(),r=t?{jpg:"jpeg",jpeg:"jpeg",png:"png",webp:"webp",gif:"gif"}[t]:void 0;return r||{"image/jpeg":"jpeg","image/png":"png","image/webp":"webp","image/gif":"gif"}[e.type]||"unknown"}async function eN(e,t=.85){const n=eb(e);return n==="webp"?{blob:e,format:"webp",originalFormat:"webp",fileName:e.name}:new Promise((r,a)=>{const i=new Image,o=URL.createObjectURL(e);i.onload=()=>{try{const l=document.createElement("canvas");l.width=i.naturalWidth,l.height=i.naturalHeight;const c=l.getContext("2d");if(!c)throw new Error("Failed to get canvas context");c.drawImage(i,0,0),l.toBlob(u=>{if(URL.revokeObjectURL(o),!u){a(new Error("Failed to convert image to WebP"));return}const d=e.name.replace(/\.[^/.]+$/,"")+".webp";r({blob:u,format:"webp",originalFormat:n,fileName:d})},"image/webp",t)}catch(l){URL.revokeObjectURL(o),a(l)}},i.onerror=()=>{URL.revokeObjectURL(o),a(new Error("Failed to load image"))},i.src=o})}function tN(){const e=document.createElement("canvas");return e.width=1,e.height=1,e.toDataURL("image/webp").indexOf("data:image/webp")===0}const vm=5*1024*1024;function nN({session:e}){var we;const{isConfigured:t}=Pn(),n=un(e),[r,a]=f.useState([]),[i,o]=f.useState(!1),[l,c]=f.useState(null),[u,d]=f.useState(!1),[m,h]=f.useState("file"),[b,y]=f.useState(null),[g,w]=f.useState(""),[p,_]=f.useState(""),[v,x]=f.useState("newest"),[j,k]=f.useState(!1),[S,A]=f.useState("masonry"),[P,R]=f.useState(!1),[q,O]=f.useState(null),[oe,z]=f.useState(!1),[ne,Z]=f.useState(!1),I=f.useCallback(async()=>{if(!t&&!n){a([]),k(!1);return}o(!0),c(null);try{const{data:B,error:D}=await YS(e.user.id);if(D)throw D;const ae=(B??[]).map(G=>({...G,publicUrl:bm(G)}));a(ae)}catch(B){c(B instanceof Error?B.message:"Unable to load your vision board.")}finally{k(!0),o(!1)}},[t,n,e.user.id]);f.useEffect(()=>{!e||!t&&!n||I()},[(we=e==null?void 0:e.user)==null?void 0:we.id,t,n,I]),f.useEffect(()=>{!t&&!n&&(a([]),k(!1))},[t,n]);const C=f.useMemo(()=>{const B=[...r];return v==="caption"?B.sort((D,ae)=>(D.caption??"").localeCompare(ae.caption??"")):B.sort((D,ae)=>{const G=D.created_at?new Date(D.created_at).getTime():0,ye=ae.created_at?new Date(ae.created_at).getTime():0;return v==="newest"?ye-G:G-ye})},[r,v]),L=B=>{var ae;const D=((ae=B.target.files)==null?void 0:ae[0])??null;if(y(D),D){const G=new FileReader;G.onloadend=()=>{O(G.result)},G.readAsDataURL(D)}else O(null)},K=B=>{B.preventDefault(),B.stopPropagation(),!u&&(t||n)&&z(!0)},ue=B=>{B.preventDefault(),B.stopPropagation(),z(!1)},de=async B=>{if(B.preventDefault(),B.stopPropagation(),z(!1),!t&&!n)return;const D=B.dataTransfer.files[0];if(!D)return;if(!D.type.startsWith("image/")){c("Please drop an image file (PNG, JPG, or WEBP).");return}if(D.size>vm){c("Images must be 5MB or smaller.");return}y(D),h("file"),R(!0);const ae=new FileReader;ae.onloadend=()=>{O(ae.result)},ae.readAsDataURL(D)},De=B=>{w(B),B.trim()?O(B.trim()):O(null)},fe=async B=>{if(B.preventDefault(),!e){c("You need to sign in to curate your vision board.");return}if(!t&&!n){c("Supabase credentials are missing. Update your environment variables to continue.");return}if(m==="file"){if(!b){c("Choose an image to upload.");return}if(b.size>vm){c("Images must be 5MB or smaller.");return}}else{if(!g.trim()){c("Enter an image URL.");return}try{new URL(g.trim())}catch{c("Enter a valid URL.");return}}d(!0),c(null);try{let D,ae;if(m==="file"&&b){let G=b,ye=b.name,Se=eb(b);if(tN()&&b.type!=="image/webp")try{Z(!0);const Te=await eN(b,.85);G=Te.blob,ye=Te.fileName,Se=Te.originalFormat}catch(Te){console.warn("WebP conversion failed, uploading original:",Te)}finally{Z(!1)}({data:D,error:ae}=await QS({userId:e.user.id,file:G,fileName:ye,caption:p,originalFormat:Se}))}else({data:D,error:ae}=await XS({userId:e.user.id,imageUrl:g.trim(),caption:p}));if(ae)throw ae;D&&a(G=>[{...D,publicUrl:bm(D)},...G]),y(null),w(""),_(""),O(null),B.target.reset()}catch(D){c(D instanceof Error?D.message:"Unable to upload the image right now.")}finally{d(!1)}},H=async B=>{if(!t&&!n){c("Connect Supabase to remove items from your vision board.");return}if(window.confirm("Remove this vision board entry? This cannot be undone.")){c(null);try{const ae=await ZS(B);if(ae)throw ae;a(G=>G.filter(ye=>ye.id!==B.id))}catch(ae){c(ae instanceof Error?ae.message:"Unable to delete the entry.")}}};return s.jsxs("section",{className:"vision-board",children:[s.jsxs("header",{className:"vision-board__header",children:[s.jsxs("div",{children:[s.jsx("h2",{children:"Vision board"}),s.jsx("p",{children:"Collect the imagery that inspires your next milestone. Upload photos, set a caption, and revisit the gallery whenever you need a boost."})]}),s.jsxs("div",{className:"vision-board__controls",children:[s.jsxs("div",{className:"vision-board__sort",children:[s.jsx("label",{htmlFor:"vision-board-sort",children:"Sort by"}),s.jsxs("select",{id:"vision-board-sort",value:v,onChange:B=>x(B.target.value),children:[s.jsx("option",{value:"newest",children:"Newest first"}),s.jsx("option",{value:"oldest",children:"Oldest first"}),s.jsx("option",{value:"caption",children:"Caption (A–Z)"})]})]}),s.jsxs("div",{className:"vision-board__layout",children:[s.jsx("label",{htmlFor:"vision-board-layout",children:"Grid layout"}),s.jsxs("select",{id:"vision-board-layout",value:S,onChange:B=>A(B.target.value),children:[s.jsx("option",{value:"2-column",children:"2 Columns"}),s.jsx("option",{value:"3-column",children:"3 Columns"}),s.jsx("option",{value:"masonry",children:"Masonry"})]})]})]})]}),n?s.jsx("p",{className:"vision-board__status vision-board__status--info",children:"Vision board uploads are stored locally while you explore the demo workspace. Connect Supabase storage to keep a cloud-synced gallery."}):t?null:s.jsx("p",{className:"vision-board__status vision-board__status--warning",children:"Add your Supabase credentials and storage bucket to enable uploads and syncing for the vision board. Until then you can sketch ideas offline."}),l&&s.jsx("p",{className:"vision-board__status vision-board__status--error",children:l}),s.jsxs("div",{className:"vision-board__add-edit",children:[s.jsxs("button",{type:"button",className:"vision-board__add-edit-toggle",onClick:()=>R(!P),"aria-expanded":P,children:[s.jsx("span",{className:"vision-board__add-edit-icon",children:P?"−":"+"}),"Add/Edit"]}),P&&s.jsxs("form",{className:"vision-board__form",onSubmit:fe,children:[s.jsxs("div",{className:"vision-board__field",children:[s.jsx("label",{children:"Upload method"}),s.jsxs("div",{style:{display:"flex",gap:"1rem",marginBottom:"0.5rem"},children:[s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx("input",{type:"radio",name:"upload-mode",value:"file",checked:m==="file",onChange:B=>h(B.target.value),disabled:!t&&!n||u}),s.jsx("span",{children:"File upload"})]}),s.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[s.jsx("input",{type:"radio",name:"upload-mode",value:"url",checked:m==="url",onChange:B=>h(B.target.value),disabled:!t&&!n||u}),s.jsx("span",{children:"Image URL"})]})]})]}),m==="file"?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`vision-board__drop-zone ${oe?"vision-board__drop-zone--active":""}`,onDragOver:K,onDragLeave:ue,onDrop:de,children:[s.jsxs("div",{className:"vision-board__drop-zone-content",children:[s.jsx("p",{className:"vision-board__drop-zone-text",children:oe?"📥 Drop image here":"📁 Drag & drop an image here"}),s.jsx("p",{className:"vision-board__drop-zone-divider",children:"or"}),s.jsx("label",{htmlFor:"vision-board-file",className:"vision-board__file-button",children:"Choose File"}),s.jsx("input",{id:"vision-board-file",type:"file",accept:"image/png, image/jpeg, image/webp, image/gif",onChange:L,disabled:!t&&!n||u,style:{display:"none"},required:!0})]}),b&&s.jsxs("p",{className:"vision-board__file-selected",children:["Selected: ",b.name," (",(b.size/1024).toFixed(1)," KB)"]})]}),s.jsx("span",{className:"vision-board__hint",children:"PNG, JPG, WEBP, or GIF up to 5MB. Images will be converted to WebP format for optimal performance."})]}):s.jsxs("div",{className:"vision-board__field",children:[s.jsx("label",{htmlFor:"vision-board-url",children:"Image URL"}),s.jsx("input",{id:"vision-board-url",type:"url",value:g,onChange:B=>De(B.target.value),placeholder:"https://example.com/image.jpg",disabled:!t&&!n||u,required:!0}),s.jsx("span",{className:"vision-board__hint",children:"Enter a direct link to an image."})]}),s.jsxs("div",{className:"vision-board__field",children:[s.jsx("label",{htmlFor:"vision-board-caption",children:"Caption"}),s.jsx("input",{id:"vision-board-caption",type:"text",value:p,onChange:B=>_(B.target.value),placeholder:"Describe why this image matters",disabled:!t&&!n||u})]}),q&&s.jsxs("div",{className:"vision-board__preview",children:[s.jsx("label",{children:"Preview"}),s.jsx("img",{src:q,alt:"Upload preview",className:"vision-board__preview-image"})]}),s.jsx("button",{type:"submit",className:"vision-board__submit",disabled:u||ne||!t&&!n,children:ne?"Converting to WebP…":u?"Uploading…":"Add to board"})]})]}),s.jsx("div",{className:`vision-board__grid vision-board__grid--${S}`,role:"list",children:!t&&!n?s.jsx("p",{className:"vision-board__empty",children:"Connect Supabase to sync your gallery."}):i&&!j?s.jsx("p",{className:"vision-board__empty",children:"Loading your inspiration…"}):C.length===0?s.jsx("p",{className:"vision-board__empty",children:"No images yet—upload your first motivator to get started."}):C.map(B=>s.jsxs("article",{className:"vision-board__card",role:"listitem",children:[s.jsxs("div",{className:"vision-board__card-image-container",children:[B.publicUrl?s.jsx("img",{src:B.publicUrl,alt:B.caption??"Vision board entry",loading:"lazy"}):s.jsx("div",{className:"vision-board__placeholder","aria-hidden":!0,children:s.jsx("span",{children:"No preview"})}),B.caption&&s.jsx("div",{className:"vision-board__card-overlay",children:s.jsx("p",{children:B.caption})})]}),s.jsx("div",{className:"vision-board__card-actions",children:s.jsx("button",{type:"button",onClick:()=>H(B),className:"vision-board__delete",disabled:!t&&!n,title:"Remove image",children:"Remove"})})]},B.id))})]})}const vi=[{key:"profiles",label:"Profiles",table:"profiles",column:"user_id",optional:!0},{key:"goals",label:"Goals",table:"goals",column:"id"},{key:"goal_reflections",label:"Goal reflections",table:"goal_reflections",column:"id"},{key:"habits",label:"Habits (legacy)",table:"habits",column:"id",optional:!0},{key:"habit_logs",label:"Habit logs (legacy)",table:"habit_logs",column:"id",optional:!0},{key:"vision_images",label:"Vision images",table:"vision_images",column:"id"},{key:"checkins",label:"Life wheel check-ins",table:"checkins",column:"id"},{key:"notification_preferences",label:"Notification preferences",table:"notification_preferences",column:"user_id"},{key:"workspace_profiles",label:"Workspace profiles",table:"workspace_profiles",column:"user_id"},{key:"life_goal_steps",label:"Life goal steps",table:"life_goal_steps",column:"id"},{key:"life_goal_substeps",label:"Life goal substeps",table:"life_goal_substeps",column:"id"},{key:"life_goal_alerts",label:"Life goal alerts",table:"life_goal_alerts",column:"id"},{key:"habits_v2",label:"Habits v2",table:"habits_v2",column:"id",optional:!0},{key:"habit_logs_v2",label:"Habit logs v2",table:"habit_logs_v2",column:"id",optional:!0},{key:"habit_reminders",label:"Habit reminders",table:"habit_reminders",column:"id",optional:!0},{key:"habit_challenges",label:"Habit challenges",table:"habit_challenges",column:"id"},{key:"habit_challenge_members",label:"Challenge members",table:"habit_challenge_members",column:"id"},{key:"vb_boards",label:"Vision boards",table:"vb_boards",column:"id"},{key:"vb_sections",label:"Vision board sections",table:"vb_sections",column:"id"},{key:"vb_cards",label:"Vision board cards",table:"vb_cards",column:"id"},{key:"vb_shares",label:"Vision board shares",table:"vb_shares",column:"id"},{key:"vb_checkins",label:"Vision check-ins",table:"vb_checkins",column:"id"},{key:"push_subscriptions",label:"Push subscriptions",table:"push_subscriptions",column:"endpoint"},{key:"journal_entries",label:"Journal entries",table:"journal_entries",column:"id"}];new Map(vi.map(e=>[e.key,e]));class $t extends Error{}function ba(e){const t=Math.random().toString(36).slice(2,10);return`${e}-${t}`}function Fr(e=0){return new Date(Date.UTC(2099,0,1+e)).toISOString().slice(0,10)}function tb(e){if(e&&typeof e=="object"&&"message"in e){const t=e;return{code:t.code,message:t.message}}return{message:e instanceof Error?e.message:String(e)}}function nb(e){return!!(e&&typeof e=="object"&&"code"in e&&e.code==="42P01")}const rN={profiles:{skipReason:"Profiles are synced automatically during onboarding. Writing test data could override your display name."},goals:{async run(e){const{data:t,error:n}=await e.client.from("goals").insert({user_id:e.userId,title:"Supabase diagnostics goal",description:"Temporary goal inserted by the connection test."}).select("id").single();if(n)throw n;e.goalId=t.id,e.cleanup.push(async()=>{await e.client.from("goals").delete().eq("id",t.id)})}},goal_reflections:{async run(e){if(!e.goalId)throw new $t("Goal write test failed, so reflections cannot be inserted.");const t=Fr(2),{data:n,error:r}=await e.client.from("goal_reflections").insert({goal_id:e.goalId,user_id:e.userId,entry_date:t,confidence:7,highlight:"Connection test highlight",challenge:"Connection test challenge"}).select("id").single();if(r)throw r;e.cleanup.push(async()=>{await e.client.from("goal_reflections").delete().eq("id",n.id)})}},habits:{optional:!0,async run(e){if(!e.goalId)throw new $t("Goal write test failed, so legacy habits cannot be inserted.");const t={mode:"daily"},{data:n,error:r}=await e.client.from("habits").insert({goal_id:e.goalId,name:"Diagnostics habit",frequency:"daily",schedule:t}).select("id").single();if(r)throw r;e.habitId=n.id,e.cleanup.push(async()=>{await e.client.from("habits").delete().eq("id",n.id)})}},habit_logs:{optional:!0,async run(e){if(!e.habitId)throw new $t("Legacy habit insert failed, so legacy habit logs cannot be tested.");const{data:t,error:n}=await e.client.from("habit_logs").insert({habit_id:e.habitId,date:Fr(3),completed:!0}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("habit_logs").delete().eq("id",t.id)})}},vision_images:{async run(e){const{data:t,error:n}=await e.client.from("vision_images").insert({user_id:e.userId,image_source:"url",image_url:`https://example.com/${ba("vision")}.png`,caption:"Connection test image"}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("vision_images").delete().eq("id",t.id)})}},checkins:{async run(e){const{data:t,error:n}=await e.client.from("checkins").insert({user_id:e.userId,date:Fr(4),scores:{energy:6,mood:7}}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("checkins").delete().eq("id",t.id)})}},notification_preferences:{skipReason:"Notification preferences are singletons per user; skipping to avoid overwriting your current settings."},workspace_profiles:{skipReason:"Workspace profile write tests are skipped to avoid clobbering your workspace name."},life_goal_steps:{async run(e){if(!e.goalId)throw new $t("Goal write test failed, so life goal steps cannot be inserted.");const{data:t,error:n}=await e.client.from("life_goal_steps").insert({goal_id:e.goalId,step_order:1,title:"Diagnostics goal step",description:"Added by Supabase diagnostics.",due_date:Fr(5)}).select("id").single();if(n)throw n;e.lifeGoalStepId=t.id,e.cleanup.push(async()=>{await e.client.from("life_goal_steps").delete().eq("id",t.id)})}},life_goal_substeps:{async run(e){if(!e.lifeGoalStepId)throw new $t("Life goal step insert failed, so substeps cannot be tested.");const{data:t,error:n}=await e.client.from("life_goal_substeps").insert({step_id:e.lifeGoalStepId,substep_order:1,title:"Diagnostics substep"}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("life_goal_substeps").delete().eq("id",t.id)})}},life_goal_alerts:{async run(e){if(!e.goalId)throw new $t("Goal write test failed, so alerts cannot be inserted.");const{data:t,error:n}=await e.client.from("life_goal_alerts").insert({goal_id:e.goalId,user_id:e.userId,alert_type:"reminder",alert_time:new Date(Date.now()+5*60*1e3).toISOString(),title:"Diagnostics reminder",message:"Temporary alert created by Supabase diagnostics."}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("life_goal_alerts").delete().eq("id",t.id)})}},habits_v2:{optional:!0,async run(e){const t={mode:"daily"},{data:n,error:r}=await e.client.from("habits_v2").insert({user_id:e.userId,title:"Diagnostics habit v2",emoji:"🧪",schedule:t,allow_skip:!0}).select("id").single();if(r)throw r;e.habitV2Id=n.id,e.cleanup.push(async()=>{await e.client.from("habits_v2").delete().eq("id",n.id)})}},habit_logs_v2:{optional:!0,async run(e){if(!e.habitV2Id)throw new $t("Habits v2 insert failed, so habit logs v2 cannot be tested.");const{data:t,error:n}=await e.client.from("habit_logs_v2").insert({habit_id:e.habitV2Id,user_id:e.userId,ts:new Date().toISOString(),done:!0,value:1,note:"Connection test log"}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("habit_logs_v2").delete().eq("id",t.id)})}},habit_reminders:{optional:!0,async run(e){if(!e.habitV2Id)throw new $t("Habits v2 insert failed, so habit reminders cannot be inserted.");const{data:t,error:n}=await e.client.from("habit_reminders").insert({habit_id:e.habitV2Id,local_time:"07:30:00",days:[1,3,5]}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("habit_reminders").delete().eq("id",t.id)})}},habit_challenges:{async run(e){const{data:t,error:n}=await e.client.from("habit_challenges").insert({owner_id:e.userId,title:"Diagnostics challenge",description:"Temporary challenge inserted by diagnostics.",start_date:Fr(0),end_date:Fr(7),scoring:"count"}).select("id").single();if(n)throw n;e.challengeId=t.id,e.cleanup.push(async()=>{await e.client.from("habit_challenges").delete().eq("id",t.id)})}},habit_challenge_members:{async run(e){if(!e.challengeId)throw new $t("Challenge insert failed, so members cannot be tested.");if(!e.habitV2Id)throw new $t("Habits v2 insert failed, so challenge membership cannot be linked to a habit.");const{data:t,error:n}=await e.client.from("habit_challenge_members").insert({challenge_id:e.challengeId,user_id:e.userId,habit_id:e.habitV2Id}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("habit_challenge_members").delete().eq("id",t.id)})}},vb_boards:{async run(e){const{data:t,error:n}=await e.client.from("vb_boards").insert({user_id:e.userId,title:"Diagnostics board",board_type:"vision",theme:{palette:"calm"}}).select("id").single();if(n)throw n;e.boardId=t.id,e.cleanup.push(async()=>{await e.client.from("vb_boards").delete().eq("id",t.id)})}},vb_sections:{async run(e){if(!e.boardId)throw new $t("Vision board insert failed, so sections cannot be inserted.");const{data:t,error:n}=await e.client.from("vb_sections").insert({board_id:e.boardId,title:"Diagnostics section",sort_index:1}).select("id").single();if(n)throw n;e.sectionId=t.id,e.cleanup.push(async()=>{await e.client.from("vb_sections").delete().eq("id",t.id)})}},vb_cards:{async run(e){if(!e.boardId||!e.sectionId)throw new $t("Vision board or section insert failed, so cards cannot be tested.");const{data:t,error:n}=await e.client.from("vb_cards").insert({board_id:e.boardId,section_id:e.sectionId,user_id:e.userId,kind:"text",title:"Diagnostics card",affirm:"Connection test affirmation",size:"M",tags:["diagnostics"]}).select("id").single();if(n)throw n;e.cardId=t.id,e.cleanup.push(async()=>{await e.client.from("vb_cards").delete().eq("id",t.id)})}},vb_shares:{async run(e){if(!e.boardId)throw new $t("Vision board insert failed, so shares cannot be tested.");const t=ba("share"),{data:n,error:r}=await e.client.from("vb_shares").insert({board_id:e.boardId,owner_id:e.userId,slug:t,is_active:!1}).select("id").single();if(r)throw r;e.cleanup.push(async()=>{await e.client.from("vb_shares").delete().eq("id",n.id)})}},vb_checkins:{async run(e){if(!e.boardId)throw new $t("Vision board insert failed, so check-ins cannot be tested.");const{data:t,error:n}=await e.client.from("vb_checkins").insert({user_id:e.userId,board_id:e.boardId,the_date:Fr(6),mood:4,gratitude:"Diagnostics gratitude note"}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("vb_checkins").delete().eq("id",t.id)})}},push_subscriptions:{async run(e){const t=`https://example.com/${ba("endpoint")}`,{error:n}=await e.client.from("push_subscriptions").insert({user_id:e.userId,endpoint:t,p256dh:ba("p256dh"),auth:ba("auth")});if(n)throw n;e.cleanup.push(async()=>{await e.client.from("push_subscriptions").delete().eq("endpoint",t)})}},journal_entries:{async run(e){const{data:t,error:n}=await e.client.from("journal_entries").insert({user_id:e.userId,entry_date:new Date().toISOString().slice(0,10),content:"SUPABASE_DIAGNOSTICS_TEST_ENTRY",is_private:!0}).select("id").single();if(n)throw n;e.cleanup.push(async()=>{await e.client.from("journal_entries").delete().eq("id",t.id)})}}};async function sN(e){const t=new Map,n=[];for(const i of vi)try{const{error:o}=await e.from(i.table).select(i.column).limit(1);if(o)throw o;t.set(i.key,{status:"success"})}catch(o){if(nb(o)&&i.optional)t.set(i.key,{status:"skipped",detail:"Table not found in this project."});else{const{message:l,code:c}=tb(o),u=`[${c??"error"}] ${l}`;t.set(i.key,{status:"error",detail:u}),n.push(`${i.label}: ${u}`)}}const r=["habits","habits_v2"].some(i=>{var o;return((o=t.get(i))==null?void 0:o.status)==="success"}),a=["habit_logs","habit_logs_v2"].some(i=>{var o;return((o=t.get(i))==null?void 0:o.status)==="success"});return r||n.push("Neither the legacy nor the v2 habits table is accessible. Run the latest migrations before testing again."),a||n.push("Neither the legacy nor the v2 habit logs table is accessible. Run the latest migrations before testing again."),{results:t,errors:n,habitsOk:r,habitLogsOk:a}}async function aN(e,t){const n={client:e,userId:t,cleanup:[]},r=new Map,a=[];try{for(const i of vi){const o=rN[i.key];if(!o){r.set(i.key,{status:"skipped",detail:"No write harness configured yet."});continue}if(o.skipReason){r.set(i.key,{status:"skipped",detail:o.skipReason});continue}if(!o.run){r.set(i.key,{status:"skipped",detail:"No write harness configured yet."});continue}try{await o.run(n),r.set(i.key,{status:"success"})}catch(l){if(l instanceof $t)r.set(i.key,{status:"skipped",detail:l.message});else if(nb(l)&&(o.optional||i.optional))r.set(i.key,{status:"skipped",detail:"Table not found in this project."});else{const{message:c,code:u}=tb(l),d=`[${u??"error"}] ${c}`;r.set(i.key,{status:"error",detail:d}),a.push(`${i.label}: ${d}`)}}}}finally{for(const i of n.cleanup.reverse())try{await i()}catch(o){console.warn("Supabase diagnostics cleanup failed:",o)}}return{results:r,errors:a}}function iN(e,t){return vi.map(n=>{const r=e.get(n.key)??{status:"error",detail:"Test not run."},a=t.get(n.key)??{status:"skipped",detail:"No write harness configured yet."};return{key:n.key,label:n.label,read:r.status,readDetail:r.detail,write:a.status,writeDetail:a.detail}})}function oN({session:e,isDemoExperience:t}){const[n,r]=f.useState("idle"),[a,i]=f.useState(null),[o,l]=f.useState(null),[c,u]=f.useState(!1),{session:d,mode:m,isAuthenticated:h,signInWithPassword:b,signOut:y}=Pn(),[g,w]=f.useState(""),[p,_]=f.useState(""),[v,x]=f.useState(null),[j,k]=f.useState(null),[S,A]=f.useState(!1),[P,R]=f.useState("idle"),[q,O]=f.useState(null),[oe,z]=f.useState(null),ne=m==="supabase",Z=f.useMemo(()=>d||(Cu()?e:null),[d,e]),I=async H=>{if(H.preventDefault(),!ne)return;const we=g.trim(),B=p.trim();if(x(null),k(null),!we){k("Enter the email address tied to your Supabase account.");return}if(!B){k("Enter your Supabase password to continue.");return}A(!0);try{await b({email:we,password:B}),x("Signed in to Supabase successfully."),_("")}catch(D){k(D instanceof Error?D.message:"Unable to sign in right now.")}finally{A(!1)}},C=async()=>{if(ne){x(null),k(null),A(!0);try{await y(),x("Signed out of Supabase. Run the diagnostics again after signing back in.")}catch(H){k(H instanceof Error?H.message:"Unable to sign out right now.")}finally{A(!1)}}},L=async()=>{if(!ne||!Z){z("Sign in with Supabase to run sample queries."),O(null);return}R("loading"),O(null),z(null);try{const H=ce(),{data:we,error:B}=await H.from("goals").select("id,title,created_at").eq("user_id",Z.user.id).order("created_at",{ascending:!1}).limit(1);if(B)throw B;if(!we||we.length===0)O("Connected successfully, but no goals exist for this account yet.");else{const D=we[0],ae=D.title||D.id,G=D.created_at?new Date(D.created_at).toLocaleString():"unknown";O(`Fetched goal “${ae}” (${D.id}). Created on ${G}.`)}}catch(H){z(H instanceof Error?H.message:"Unable to run the sample query.")}finally{R("idle")}},K=async()=>{r("testing"),i(null);const H={credentialsConfigured:oi(),sessionActive:Cu(),databaseConnected:!1,tableStatuses:[],testTimestamp:new Date().toISOString()};try{if(!H.credentialsConfigured){H.errorMessage="Supabase credentials not configured. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY.",r("error"),i(H);return}if(!H.sessionActive){H.errorMessage="No active Supabase session. Please sign in to test database connectivity.",r("error"),i(H);return}const we=ce();if(!Z){H.errorMessage="No Supabase session is available for diagnostics. Please sign in again.",r("error"),i(H);return}const B=await sN(we),D=await aN(we,Z.user.id),ae=iN(B.results,D.results);H.tableStatuses=ae;const G=vi.filter(Se=>!Se.optional).filter(Se=>{var Te;return((Te=B.results.get(Se.key))==null?void 0:Te.status)!=="success"});H.databaseConnected=G.length===0&&B.habitsOk&&B.habitLogsOk;const ye=[...B.errors,...D.errors];ye.length>0?(H.errorMessage=ye.join(`
`),r("error")):r("success"),i(H)}catch(we){H.errorMessage=we instanceof Error?we.message:"Unknown error occurred",r("error"),i(H)}},ue=()=>{const H=Wj();l({goals:H.goals.length,habits:H.habits.length,habitLogs:H.habitLogs.length,visionImages:H.visionImages.length,checkins:H.checkins.length,goalReflections:H.goalReflections.length,hasNotificationPreferences:H.notificationPreferences!==null}),u(!0)},de=()=>{confirm("Are you sure you want to clear all demo data? This action cannot be undone.")&&(Vj(),l(null),u(!1),alert("Demo data has been cleared. Refresh the page to load fresh demo data."))},De=(H,we,B)=>H==="success"?`✓ ${we}`:H==="error"?B?`✗ ${B}`:`✗ ${we} failed`:B?`— ${B}`:`— ${we} skipped`,fe=H=>H==="success"?"status-success":H==="error"?"status-error":"status-muted";return s.jsxs("section",{className:"account-panel__card","aria-labelledby":"connection-test",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Developer tools"}),s.jsx("h3",{id:"connection-test",children:"Supabase connection test"}),s.jsx("p",{className:"account-panel__hint",children:"Verify your Supabase configuration and database connectivity. Use this to diagnose SQL issues and RLS policies."}),s.jsxs("div",{className:"connection-test",children:[s.jsx("button",{type:"button",className:"btn btn--primary",onClick:K,disabled:n==="testing",children:n==="testing"?"Testing connection...":"Run connection test"}),a&&s.jsxs("div",{className:`connection-test__result connection-test__result--${n}`,children:[s.jsx("h4",{children:"Test Results"}),s.jsxs("dl",{className:"account-panel__details",children:[s.jsxs("div",{children:[s.jsx("dt",{children:"Credentials configured"}),s.jsx("dd",{className:a.credentialsConfigured?"status-success":"status-error",children:a.credentialsConfigured?"✓ Yes":"✗ No"})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Session active"}),s.jsx("dd",{className:a.sessionActive?"status-success":"status-error",children:a.sessionActive?"✓ Yes":"✗ No"})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Database connected"}),s.jsx("dd",{className:a.databaseConnected?"status-success":"status-error",children:a.databaseConnected?"✓ Yes":"✗ No"})]})]}),a.tableStatuses.length>0&&s.jsxs(s.Fragment,{children:[s.jsx("h5",{children:"Table access & write coverage"}),s.jsxs("table",{className:"connection-test__matrix",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{scope:"col",children:"Table"}),s.jsx("th",{scope:"col",children:"Read test"}),s.jsx("th",{scope:"col",children:"Write test"})]})}),s.jsx("tbody",{children:a.tableStatuses.map(H=>s.jsxs("tr",{children:[s.jsx("td",{children:H.label}),s.jsx("td",{className:fe(H.read),children:De(H.read,"Read",H.readDetail)}),s.jsx("td",{className:fe(H.write),children:De(H.write,"Write",H.writeDetail)})]},H.key))})]})]}),a.errorMessage&&s.jsxs("div",{className:"connection-test__error",children:[s.jsx("h5",{children:"Error Details"}),s.jsx("pre",{children:a.errorMessage})]}),s.jsxs("p",{className:"connection-test__timestamp",children:["Last tested: ",a.testTimestamp?new Date(a.testTimestamp).toLocaleString():"Never"]})]}),s.jsxs("div",{className:"connection-test__auth",children:[s.jsxs("div",{children:[s.jsx("h4",{children:"Supabase auth & session"}),s.jsx("p",{className:"account-panel__hint",children:"Sign in directly within the diagnostics panel to test Supabase authentication and run lightweight data pings."})]}),ne?s.jsxs(s.Fragment,{children:[v&&s.jsx("p",{className:"connection-test__status connection-test__status--success",children:v}),j&&s.jsx("p",{className:"connection-test__status connection-test__status--error",children:j}),h&&Z?s.jsxs("div",{className:"connection-test__session",children:[s.jsxs("dl",{className:"account-panel__details",children:[s.jsxs("div",{children:[s.jsx("dt",{children:"Email"}),s.jsx("dd",{children:Z.user.email??"Unknown"})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"User ID"}),s.jsx("dd",{className:"account-panel__code",children:Z.user.id})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Last sign-in"}),s.jsx("dd",{children:Z.user.last_sign_in_at?new Date(Z.user.last_sign_in_at).toLocaleString():"Not available"})]})]}),s.jsxs("div",{className:"connection-test__session-actions",children:[s.jsx("button",{type:"button",className:"btn btn--secondary",onClick:L,disabled:P==="loading",children:P==="loading"?"Running query…":"Run sample query"}),s.jsx("button",{type:"button",className:"btn",onClick:C,disabled:S,children:S?"Signing out…":"Sign out"})]})]}):s.jsxs("form",{className:"connection-test__auth-form supabase-auth__form",onSubmit:I,children:[s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Email"}),s.jsx("input",{type:"email",value:g,onChange:H=>w(H.target.value),placeholder:"you@example.com",autoComplete:"email",required:!0})]}),s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Password"}),s.jsx("input",{type:"password",value:p,onChange:H=>_(H.target.value),placeholder:"••••••••",autoComplete:"current-password",required:!0})]}),s.jsx("div",{className:"connection-test__auth-actions",children:s.jsx("button",{type:"submit",className:"btn btn--primary",disabled:S,children:S?"Signing in…":"Sign in &amp; enable testing"})})]}),q&&s.jsx("p",{className:"connection-test__status connection-test__status--success",children:q}),oe&&s.jsx("p",{className:"connection-test__status connection-test__status--error",children:oe})]}):s.jsx("p",{className:"connection-test__status connection-test__status--error",children:"Supabase credentials not configured. Set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY to enable sign-in."})]})]}),t&&s.jsxs("div",{className:"demo-data-controls",children:[s.jsx("h4",{children:"Demo Data Management"}),s.jsx("p",{className:"account-panel__hint",children:"View and manage the demo data stored locally. This helps you understand what would be synced to Supabase."}),s.jsxs("div",{className:"demo-data-controls__actions",children:[s.jsx("button",{type:"button",className:"btn btn--secondary",onClick:ue,children:c?"Refresh demo data summary":"View demo data summary"}),s.jsx("button",{type:"button",className:"btn btn--danger",onClick:de,children:"Clear demo data"})]}),c&&o&&s.jsxs("div",{className:"demo-data-summary",children:[s.jsx("h5",{children:"Current Demo Data"}),s.jsxs("dl",{className:"account-panel__details",children:[s.jsxs("div",{children:[s.jsx("dt",{children:"Goals"}),s.jsxs("dd",{children:[o.goals," records"]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Habits"}),s.jsxs("dd",{children:[o.habits," records"]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Habit logs"}),s.jsxs("dd",{children:[o.habitLogs," records"]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Vision images"}),s.jsxs("dd",{children:[o.visionImages," records"]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Check-ins"}),s.jsxs("dd",{children:[o.checkins," records"]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Goal reflections"}),s.jsxs("dd",{children:[o.goalReflections," records"]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Notification preferences"}),s.jsx("dd",{children:o.hasNotificationPreferences?"Configured":"Not configured"})]})]}),s.jsx("p",{className:"connection-test__note",children:"💡 This data is stored in localStorage and does not sync to Supabase in demo mode."})]})]})]})}const lN=s.jsxs("span",{className:"theme-icon-stack",children:[s.jsx("img",{src:u_,alt:"",className:"theme-icon-image"}),s.jsx("img",{src:d_,alt:"",className:"theme-icon-image"})]}),rb=f.createContext(void 0),cN="lifegoal-theme",wm="lifegoal-theme-mode",xm="lifegoal-light-theme",jm="lifegoal-dark-theme",Zs=[{id:"bright-sky",name:"Bright Sky",icon:"☀️",description:"Light and airy with soft blue gradients",metaColor:"#e0f2fe",category:"light"},{id:"ocean-breeze",name:"Ocean Breeze",icon:"🌊",description:"Calm teal and aquamarine tones",metaColor:"#0d9488",category:"light"},{id:"forest-green",name:"Forest Green",icon:"🌲",description:"Natural green with earthy accents",metaColor:"#059669",category:"light"},{id:"sunset-glow",name:"Sunset Glow",icon:"🌅",description:"Warm oranges and pinks like a sunset",metaColor:"#f97316",category:"light"},{id:"cherry-blossom",name:"Cherry Blossom",icon:"🌸",description:"Soft pink with gentle warmth",metaColor:"#f472b6",category:"light"},{id:"desert-sand",name:"Desert Sand",icon:"🏜️",description:"Warm beige and sandy tones",metaColor:"#d97706",category:"light"},{id:"arctic-frost",name:"Arctic Frost",icon:"❄️",description:"Cool whites and icy blues",metaColor:"#60a5fa",category:"light"},{id:"autumn-harvest",name:"Autumn Harvest",icon:"🍂",description:"Warm browns and golden yellows",metaColor:"#ea580c",category:"light"},{id:"lavender-dream",name:"Lavender Dream",icon:"💜",description:"Soft purple with dreamy gradients",metaColor:"#c084fc",category:"light"},{id:"flow-day",name:"Flow Day",icon:"🌀",description:"Neumorphic glass with airy silver gradients and soft glow",metaColor:"#f2f4fb",category:"light"},{id:"bio-day",name:"Bio Day",icon:lN,description:"Organic greens inspired by nature",metaColor:"#16a34a",category:"light"}],is=[{id:"dark-glass",name:"Dark Glass",icon:"🌙",description:"Premium dark glassmorphism with rich colors",metaColor:"#0f172a",category:"dark"},{id:"midnight-purple",name:"Midnight Purple",icon:"🔮",description:"Deep purple with mystical vibes",metaColor:"#7c3aed",category:"dark"},{id:"flow-night",name:"Flow Night",icon:"🌊",description:"Deep focus mode with cool blue tones",metaColor:"#0c1222",category:"dark"},{id:"bio-night",name:"Bio Night",icon:"🌲",description:"Dark forest greens for natural calm",metaColor:"#0a1e0a",category:"dark"}],Uu=[...Zs,...is];function uN(e){return is.some(t=>t.id===e)}function dN(e){return uN(e)?"dark":"light"}const fc=e=>{if(typeof window>"u"||!window.localStorage)return null;try{return window.localStorage.getItem(e)||null}catch(t){return console.warn(`Unable to access ${e} from storage.`,t),null}},Xi=(e,t)=>{if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(e,t)}catch(n){console.warn(`Unable to persist ${e}.`,n)}};function hN(){return typeof window>"u"||!window.matchMedia?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function fN({children:e}){const[t,n]=f.useState(()=>fc(wm)||"system"),[r,a]=f.useState(()=>{const p=fc(xm);return p&&Zs.some(_=>_.id===p)?p:"bright-sky"}),[i,o]=f.useState(()=>{const p=fc(jm);return p&&is.some(_=>_.id===p)?p:"dark-glass"}),[l,c]=f.useState(hN);f.useEffect(()=>{if(typeof window>"u"||!window.matchMedia)return;const p=window.matchMedia("(prefers-color-scheme: dark)"),_=v=>{c(v.matches?"dark":"light")};return p.addEventListener("change",_),()=>p.removeEventListener("change",_)},[]);const u=t==="system"?l:t,d=u==="dark"?i:r;f.useEffect(()=>{document.documentElement.setAttribute("data-theme",d),Xi(cN,d),Xi(wm,t),Xi(xm,r),Xi(jm,i);const p=document.querySelector('meta[name="theme-color"]');if(p){const _=Uu.find(v=>v.id===d);p.setAttribute("content",(_==null?void 0:_.metaColor)||"#e0f2fe")}},[d,t,r,i]);const m=p=>{dN(p)==="dark"?o(p):a(p)},h=p=>{n(p)},b=p=>{Zs.some(_=>_.id===p)&&a(p)},y=p=>{is.some(_=>_.id===p)&&o(p)},g=()=>{n(p=>p==="light"?"dark":"light")},w=()=>{n(p=>p==="light"?"dark":p==="dark"?"system":"light")};return s.jsx(rb.Provider,{value:{theme:d,themeMode:t,effectiveCategory:u,lightTheme:r,darkTheme:i,setTheme:m,setThemeMode:h,setLightTheme:b,setDarkTheme:y,toggleTheme:g,cycleThemeMode:w},children:e})}function kl(){const e=f.useContext(rb);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e}const mN=[{mode:"light",icon:"☀️",label:"Light"},{mode:"dark",icon:"🌙",label:"Dark"},{mode:"system",icon:"💻",label:"System"}];function pN(){const{themeMode:e,lightTheme:t,darkTheme:n,setThemeMode:r,setLightTheme:a,setDarkTheme:i,cycleThemeMode:o}=kl();return s.jsxs("div",{className:"theme-selector",children:[s.jsx("h3",{className:"theme-selector__title",children:"Choose Your Theme"}),s.jsx("p",{className:"theme-selector__description",children:"Select a theme that matches your style and preferences."}),s.jsxs("div",{className:"theme-mode-toggle",children:[s.jsx("span",{className:"theme-mode-toggle__label",children:"Theme Mode:"}),s.jsx("div",{className:"theme-mode-toggle__buttons",children:mN.map(l=>{const c=e===l.mode;return s.jsxs("button",{type:"button",className:`theme-mode-toggle__btn ${c?"theme-mode-toggle__btn--active":""}`,onClick:()=>r(l.mode),"aria-pressed":c,"aria-label":`Set theme mode to ${l.label}`,children:[s.jsx("span",{className:"theme-mode-toggle__icon","aria-hidden":"true",children:l.icon}),s.jsx("span",{className:"theme-mode-toggle__text",children:l.label})]},l.mode)})}),s.jsx("button",{type:"button",className:"theme-mode-toggle__cycle",onClick:o,"aria-label":"Cycle through theme modes",title:"Click to cycle: Light → Dark → System",children:"🔄 Cycle Mode"})]}),s.jsxs("div",{className:"theme-selector__section",children:[s.jsxs("h4",{className:"theme-selector__section-title",children:[s.jsx("span",{"aria-hidden":"true",children:"☀️"})," Light Themes"]}),s.jsx("p",{className:"theme-selector__section-hint",children:"Choose your preferred light theme for bright environments."}),s.jsx("div",{className:"theme-selector__grid",children:Zs.map(l=>{const c=t===l.id;return s.jsxs("button",{type:"button",className:`theme-selector__card ${c?"theme-selector__card--active":""}`,onClick:()=>a(l.id),"aria-pressed":c,"aria-label":`Select ${l.name} as light theme`,children:[s.jsx("span",{className:"theme-selector__icon","aria-hidden":"true",children:l.icon}),s.jsx("span",{className:"theme-selector__name",children:l.name}),s.jsx("span",{className:"theme-selector__hint",children:l.description}),c&&s.jsx("span",{className:"theme-selector__badge","aria-label":"Currently active",children:"✓"})]},l.id)})})]}),s.jsxs("div",{className:"theme-selector__section",children:[s.jsxs("h4",{className:"theme-selector__section-title",children:[s.jsx("span",{"aria-hidden":"true",children:"🌙"})," Dark Themes"]}),s.jsx("p",{className:"theme-selector__section-hint",children:"Choose your preferred dark theme for low-light environments."}),s.jsx("div",{className:"theme-selector__grid",children:is.map(l=>{const c=n===l.id;return s.jsxs("button",{type:"button",className:`theme-selector__card ${c?"theme-selector__card--active":""}`,onClick:()=>i(l.id),"aria-pressed":c,"aria-label":`Select ${l.name} as dark theme`,children:[s.jsx("span",{className:"theme-selector__icon","aria-hidden":"true",children:l.icon}),s.jsx("span",{className:"theme-selector__name",children:l.name}),s.jsx("span",{className:"theme-selector__hint",children:l.description}),c&&s.jsx("span",{className:"theme-selector__badge","aria-label":"Currently active",children:"✓"})]},l.id)})})]})]})}function km(e){return e||null}async function gN(e){return Ce()?ce().from("notification_preferences").select("*").eq("user_id",e).maybeSingle():{data:Pj(e||We),error:null}}async function _N(e,t){if(!Ce()){const a={user_id:e||We,habit_reminders_enabled:t.habitRemindersEnabled,habit_reminder_time:t.reminderTime,checkin_nudges_enabled:t.checkinNudgesEnabled,timezone:t.timezone,subscription:km(t.subscription)};return{data:Rj(e||We,a),error:null}}const n=ce(),r={user_id:e,habit_reminders_enabled:t.habitRemindersEnabled,habit_reminder_time:t.reminderTime,checkin_nudges_enabled:t.checkinNudgesEnabled,timezone:t.timezone,subscription:km(t.subscription)};return n.from("notification_preferences").upsert(r,{onConflict:"user_id"}).select().single()}async function yN(e){if(!Ce())return{data:Oj(e||We),error:null};const t=ce(),n={habit_reminders_enabled:!1,checkin_nudges_enabled:!1,habit_reminder_time:null,subscription:null};return t.from("notification_preferences").update(n).eq("user_id",e).select().maybeSingle()}function th(){return typeof window<"u"&&"Notification"in window&&typeof navigator<"u"&&"serviceWorker"in navigator&&"PushManager"in window}async function sb(){if(typeof navigator>"u"||!("serviceWorker"in navigator))return null;try{return await navigator.serviceWorker.ready}catch(e){return console.error("Failed to resolve service worker registration.",e),null}}async function ui(){const e=await sb();if(!e)return null;try{return await e.pushManager.getSubscription()}catch(t){return console.error("Failed to fetch current push subscription.",t),null}}async function bN(e){throw new Error("VITE_VAPID_PUBLIC_KEY is not configured.")}async function ab(){if(!th())throw new Error("Push messaging is not supported in this browser.");if((Notification.permission==="default"?await Notification.requestPermission():Notification.permission)!=="granted")throw new Error("Enable notifications to subscribe to reminders.");const t=await sb();if(!t)throw new Error("Service worker registration is not ready.");const n=await t.pushManager.getSubscription();return n||bN()}async function vN(){const e=await ui();if(!e)return!1;try{return await e.unsubscribe()}catch(t){return console.error("Failed to unsubscribe from push notifications.",t),!1}}async function wN(e,t,n){const r=e.toJSON();if(!r.endpoint||!r.keys)throw new Error("Invalid push subscription: missing endpoint or keys");const a=await fetch(`${t}/functions/v1/send-reminders/subscribe`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({endpoint:r.endpoint,keys:{p256dh:r.keys.p256dh,auth:r.keys.auth}})});if(!a.ok){const i=await a.json().catch(()=>({error:"Unknown error"}));throw new Error(i.error||`Failed to register subscription: ${a.status}`)}return a.json()}const Fu="08:00";function xN(e,t){return e?{state:{habitRemindersEnabled:e.habit_reminders_enabled,checkinNudgesEnabled:e.checkin_nudges_enabled,reminderTime:e.habit_reminder_time??Fu,timezone:e.timezone??t},subscription:e.subscription??null}:{state:{habitRemindersEnabled:!0,checkinNudgesEnabled:!0,reminderTime:Fu,timezone:t},subscription:null}}function jN({session:e}){const t=un(e),n=f.useMemo(()=>typeof Intl<"u"&&typeof Intl.DateTimeFormat=="function"?Intl.DateTimeFormat().resolvedOptions().timeZone??"UTC":"UTC",[]),[r,a]=f.useState(!1),[i,o]=f.useState(!1),[l,c]=f.useState(!0),[u,d]=f.useState(!1),[m,h]=f.useState({habitRemindersEnabled:!0,checkinNudgesEnabled:!0,reminderTime:Fu,timezone:n}),[b,y]=f.useState(null),[g,w]=f.useState(null),[p,_]=f.useState("default"),[v,x]=f.useState(n);f.useEffect(()=>{const O=th();a(O),o(!0),_(O&&typeof Notification<"u"?Notification.permission:"denied")},[]),f.useEffect(()=>{let O=!0;return c(!0),gN(e.user.id).then(async({data:oe,error:z})=>{if(!O)return;if(z){console.error("Failed to load notification preferences:",z),w({kind:"error",message:"Unable to load your notification preferences right now."});const I=await ui();if(!O)return;y(I?I.toJSON():null);return}const{state:ne,subscription:Z}=xN(oe,n);if(h(ne),x(ne.timezone),Z)y(Z);else{const I=await ui();if(!O)return;y(I?I.toJSON():null)}}).finally(()=>{O&&c(!1)}),()=>{O=!1}},[e.user.id,n]),f.useEffect(()=>{if(!("serviceWorker"in navigator))return;const O=oe=>{var z;((z=oe.data)==null?void 0:z.type)==="PUSH_SUBSCRIPTION_EXPIRED"&&(y(null),w({kind:"error",message:"Push subscription expired. Enable notifications again to resume reminders."}))};return navigator.serviceWorker.addEventListener("message",O),()=>{navigator.serviceWorker.removeEventListener("message",O)}},[]),f.useEffect(()=>{x(m.timezone)},[m.timezone]);const j=p==="granted"&&!!b,k=async(O,oe,z="Notification preferences updated.")=>{d(!0),w(null);const ne=m,Z=b;h(O),y(oe);try{const{error:I}=await _N(e.user.id,{habitRemindersEnabled:O.habitRemindersEnabled,checkinNudgesEnabled:O.checkinNudgesEnabled,reminderTime:O.reminderTime||null,timezone:O.timezone,subscription:oe});if(I)throw I;return w({kind:"success",message:z}),!0}catch(I){return h(ne),y(Z),w({kind:"error",message:I instanceof Error?I.message:"Unable to save notification preferences."}),!1}finally{d(!1)}},S=async()=>{if(!r){w({kind:"error",message:"Push notifications are not supported in this browser."});return}d(!0),w(null);try{const O=await ab();_("granted");const oe=O.toJSON(),z={...m,habitRemindersEnabled:!0,checkinNudgesEnabled:!0};await k(z,oe,"Notifications enabled for habit reminders and check-ins.")}catch(O){const oe=O instanceof Error?O.message:"Unable to enable notifications.";w({kind:"error",message:oe}),typeof Notification<"u"&&_(Notification.permission)}finally{d(!1)}},A=async()=>{d(!0),w(null);try{await vN();const{error:O}=await yN(e.user.id);if(O)throw O;y(null),h(oe=>({...oe,habitRemindersEnabled:!1,checkinNudgesEnabled:!1})),w({kind:"success",message:"Push notifications disabled."}),typeof Notification<"u"&&_(Notification.permission)}catch(O){w({kind:"error",message:O instanceof Error?O.message:"Unable to disable notifications."})}finally{d(!1)}},P=async(O,oe)=>{if(m[O]===oe)return;const z={...m,[O]:oe};await k(z,b)},R=async O=>{if(O===m.reminderTime)return;const oe={...m,reminderTime:O};await k(oe,b)},q=async()=>{const O=v.trim()||n;if(O===m.timezone)return;const oe={...m,timezone:O};await k(oe,b)};return s.jsxs("section",{className:"account-panel__card","aria-labelledby":"account-notifications",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Notifications"}),s.jsx("h3",{id:"account-notifications",children:"Habit & Check-in Notifications"}),s.jsx("p",{className:"account-panel__hint",children:"Configure push reminders so LifeGoalApp can nudge you when it's time to complete habits or capture a life wheel check-in."}),t&&s.jsx("p",{className:"notification-preferences__message notification-preferences__message--info",children:"Demo mode stores notification preferences locally. Connect Supabase and configure web push credentials to deliver reminders across your devices."}),!i||l?s.jsx("p",{className:"notification-preferences__loading",children:"Checking notification settings…"}):r?s.jsxs("div",{className:"notification-preferences__card",children:[s.jsxs("div",{className:"notification-preferences__status-row",children:[s.jsx("span",{className:"notification-preferences__label",children:"Permission"}),s.jsx("span",{className:`notification-preferences__permission notification-preferences__permission--${p}`,children:p})]}),g&&s.jsx("p",{className:`notification-preferences__message notification-preferences__message--${g.kind}`,role:g.kind==="error"?"alert":"status",children:g.message}),j?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"notification-preferences__control",children:[s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:m.habitRemindersEnabled,onChange:O=>P("habitRemindersEnabled",O.target.checked),disabled:u}),"Habit reminders"]}),s.jsx("p",{children:"Receive a nudge when a habit is due on today's checklist."})]}),s.jsxs("div",{className:"notification-preferences__control",children:[s.jsxs("label",{children:[s.jsx("input",{type:"checkbox",checked:m.checkinNudgesEnabled,onChange:O=>P("checkinNudgesEnabled",O.target.checked),disabled:u}),"Life wheel check-in nudges"]}),s.jsx("p",{children:"Get prompted to log a new check-in so your radar chart stays fresh."})]}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["Reminder time",s.jsx("input",{type:"time",value:m.reminderTime,onChange:O=>R(O.target.value),disabled:u})]}),s.jsx("p",{children:"We'll queue reminders around this local time."})]}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["Time zone",s.jsx("input",{type:"text",value:v,onChange:O=>x(O.target.value),onBlur:q,placeholder:"America/New_York",disabled:u})]}),s.jsx("p",{children:"Detected from your device. Adjust if you prefer reminders in another time zone."})]}),s.jsx("button",{type:"button",className:"notification-preferences__action notification-preferences__action--secondary",onClick:A,disabled:u,children:u?"Disabling…":"Disable notifications"})]}):s.jsx("button",{type:"button",className:"notification-preferences__action",onClick:S,disabled:u,children:u?"Enabling…":"Enable notifications"})]}):s.jsx("p",{className:"notification-preferences__unsupported",children:"Push notifications are not supported in this browser. Try using a Chromium-based or Safari browser on desktop or mobile."})]})}const Sm="/icons/icon-192x192.svg";function kN({session:e}){var g,w,p,_,v;const[t,n]=f.useState(null),[r,a]=f.useState(!1),[i,o]=f.useState(null),[l,c]=f.useState(null),u=()=>{const x=th();n({kind:x?"success":"error",message:x?"Push notifications are supported in this browser.":"Push notifications are NOT supported in this browser."})},d=async()=>{a(!0),n(null);try{const x=await ui();x?(o(x.toJSON()),n({kind:"success",message:"Found existing push subscription."})):(o(null),n({kind:"info",message:"No existing push subscription found. Subscribe to enable push notifications."}))}catch(x){n({kind:"error",message:x instanceof Error?x.message:"Failed to check subscription."})}finally{a(!1)}},m=async()=>{a(!0),n(null);try{const x=await ab();o(x.toJSON()),n({kind:"success",message:"Successfully created push subscription. Now register it with the server."})}catch(x){n({kind:"error",message:x instanceof Error?x.message:"Failed to create subscription."})}finally{a(!1)}},h=async()=>{a(!0),n(null);try{if(!oi())throw new Error("Supabase credentials not configured.");const x=await ui();if(!x)throw new Error("No push subscription found. Create one first.");const j=Hf(),k=e.access_token;if(!j||!k)throw new Error("Missing Supabase URL or access token.");await wN(x,j,k),n({kind:"success",message:"Push subscription registered with server successfully!"})}catch(x){n({kind:"error",message:x instanceof Error?x.message:"Failed to register with server."})}finally{a(!1)}},b=async()=>{a(!0),c(null);try{if(!oi())throw new Error("Supabase credentials not configured.");const x=Hf();if(!x)throw new Error("Supabase URL not configured.");(await(await fetch(`${x}/functions/v1/send-reminders/health`)).json()).ok?c("✓ Edge Function is healthy"):c("✗ Edge Function responded but not healthy")}catch(x){c(`✗ ${x instanceof Error?x.message:"Health check failed"}`)}finally{a(!1)}},y=async()=>{a(!0),n(null);try{if(!("serviceWorker"in navigator))throw new Error("Service workers not supported.");await(await navigator.serviceWorker.ready).showNotification("Test Notification",{body:"This is a test notification from LifeGoal App.",icon:Sm,badge:Sm,tag:"test-notification",data:{url:"/#habits"}}),n({kind:"success",message:"Test notification sent! Check your notification panel."})}catch(x){n({kind:"error",message:x instanceof Error?x.message:"Failed to send test notification."})}finally{a(!1)}};return s.jsxs("section",{className:"account-panel__card","aria-labelledby":"push-test-panel",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Developer tools"}),s.jsx("h3",{id:"push-test-panel",children:"Push Notification Test Panel"}),s.jsx("p",{className:"account-panel__hint",children:"Test and debug Web Push notifications. Use these tools to verify the push notification pipeline from browser to Edge Function."}),s.jsxs("div",{className:"push-test-panel",children:[t&&s.jsx("p",{className:`notification-preferences__message notification-preferences__message--${t.kind}`,role:t.kind==="error"?"alert":"status",children:t.message}),s.jsxs("div",{className:"push-test-panel__section",children:[s.jsx("h4",{children:"1. Browser Support"}),s.jsx("p",{className:"account-panel__hint",children:"Check if this browser supports push notifications."}),s.jsx("button",{type:"button",className:"btn btn--secondary",onClick:u,disabled:r,children:"Check Push Support"})]}),s.jsxs("div",{className:"push-test-panel__section",children:[s.jsx("h4",{children:"2. Push Subscription"}),s.jsx("p",{className:"account-panel__hint",children:"Manage the browser's push subscription."}),s.jsxs("div",{className:"push-test-panel__actions",children:[s.jsx("button",{type:"button",className:"btn btn--secondary",onClick:d,disabled:r,children:r?"Checking...":"Check Existing"}),s.jsx("button",{type:"button",className:"btn btn--secondary",onClick:m,disabled:r,children:r?"Creating...":"Create Subscription"})]}),i&&s.jsxs("div",{className:"push-test-panel__subscription-info",children:[s.jsx("h5",{children:"Subscription Details"}),s.jsxs("dl",{className:"account-panel__details",children:[s.jsxs("div",{children:[s.jsx("dt",{children:"Endpoint"}),s.jsxs("dd",{className:"account-panel__code",style:{wordBreak:"break-all"},children:[(g=i.endpoint)==null?void 0:g.substring(0,60),"..."]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"p256dh Key"}),s.jsxs("dd",{className:"account-panel__code",children:[(p=(w=i.keys)==null?void 0:w.p256dh)==null?void 0:p.substring(0,20),"..."]})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Auth Key"}),s.jsxs("dd",{className:"account-panel__code",children:[(v=(_=i.keys)==null?void 0:_.auth)==null?void 0:v.substring(0,10),"..."]})]})]})]})]}),s.jsxs("div",{className:"push-test-panel__section",children:[s.jsx("h4",{children:"3. Edge Function"}),s.jsx("p",{className:"account-panel__hint",children:"Test the send-reminders Edge Function."}),s.jsxs("div",{className:"push-test-panel__actions",children:[s.jsx("button",{type:"button",className:"btn btn--secondary",onClick:b,disabled:r,children:r?"Checking...":"Check Health"}),s.jsx("button",{type:"button",className:"btn btn--secondary",onClick:h,disabled:r||!i,children:r?"Registering...":"Register with Server"})]}),l&&s.jsx("p",{className:`push-test-panel__health ${l.startsWith("✓")?"push-test-panel__health--success":"push-test-panel__health--error"}`,children:l})]}),s.jsxs("div",{className:"push-test-panel__section",children:[s.jsx("h4",{children:"4. Test Notification"}),s.jsx("p",{className:"account-panel__hint",children:"Send a local test notification to verify the service worker."}),s.jsx("button",{type:"button",className:"btn btn--primary",onClick:y,disabled:r,children:r?"Sending...":"Send Test Notification"})]})]})]})}const ib={timezone:"UTC",window_start:"08:00:00",window_end:"10:00:00",quiet_hours_start:null,quiet_hours_end:null,skip_weekends:!1,created_at:null,updated_at:null},ob="demo_reminder_prefs";function lb(e){try{const t=localStorage.getItem(ob);if(t){const n=JSON.parse(t);if(n.user_id===e)return n}}catch{}return{user_id:e,...ib}}function SN(e){try{localStorage.setItem(ob,JSON.stringify(e))}catch{}}async function NN(e){if(!Ce())return{data:lb(e),error:null};const t=ce(),{data:n,error:r}=await t.from("user_reminder_prefs").select("*").eq("user_id",e).maybeSingle();return r?{data:null,error:r}:{data:n||{user_id:e,...ib},error:null}}async function EN(e,t){if(!Ce()){const o=lb(e),l={...o,timezone:t.timezone??o.timezone,window_start:t.windowStart?lr(t.windowStart):o.window_start,window_end:t.windowEnd?lr(t.windowEnd):o.window_end,quiet_hours_start:t.quietHoursStart!==void 0?t.quietHoursStart?lr(t.quietHoursStart):null:o.quiet_hours_start,quiet_hours_end:t.quietHoursEnd!==void 0?t.quietHoursEnd?lr(t.quietHoursEnd):null:o.quiet_hours_end,skip_weekends:t.skipWeekends!==void 0?t.skipWeekends:o.skip_weekends,updated_at:new Date().toISOString()};return SN(l),{data:l,error:null}}const n=ce(),r={user_id:e};t.timezone!==void 0&&(r.timezone=t.timezone),t.windowStart!==void 0&&(r.window_start=lr(t.windowStart)),t.windowEnd!==void 0&&(r.window_end=lr(t.windowEnd)),t.quietHoursStart!==void 0&&(r.quiet_hours_start=t.quietHoursStart?lr(t.quietHoursStart):null),t.quietHoursEnd!==void 0&&(r.quiet_hours_end=t.quietHoursEnd?lr(t.quietHoursEnd):null),t.skipWeekends!==void 0&&(r.skip_weekends=t.skipWeekends);const{data:a,error:i}=await n.from("user_reminder_prefs").upsert(r,{onConflict:"user_id"}).select().single();return{data:a,error:i}}function lr(e){return/^\d{2}:\d{2}:\d{2}$/.test(e)?e:/^\d{2}:\d{2}$/.test(e)?`${e}:00`:/^\d:\d{2}$/.test(e)?`0${e}:00`:/^\d:\d{2}:\d{2}$/.test(e)?`0${e}`:e}function Zi(e){if(!e)return"08:00";const t=e.match(/^(\d{2}):(\d{2})/);return t?`${t[1]}:${t[2]}`:"08:00"}function CN(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch{return"UTC"}}function TN(e){try{return Intl.DateTimeFormat(void 0,{timeZone:e}),!0}catch{return!1}}const Nm=[{value:"UTC",label:"UTC"},{value:"America/New_York",label:"Eastern Time (US)"},{value:"America/Chicago",label:"Central Time (US)"},{value:"America/Denver",label:"Mountain Time (US)"},{value:"America/Los_Angeles",label:"Pacific Time (US)"},{value:"America/Anchorage",label:"Alaska Time"},{value:"Pacific/Honolulu",label:"Hawaii Time"},{value:"Europe/London",label:"London"},{value:"Europe/Paris",label:"Paris"},{value:"Europe/Berlin",label:"Berlin"},{value:"Europe/Moscow",label:"Moscow"},{value:"Asia/Dubai",label:"Dubai"},{value:"Asia/Kolkata",label:"India"},{value:"Asia/Singapore",label:"Singapore"},{value:"Asia/Tokyo",label:"Tokyo"},{value:"Asia/Shanghai",label:"Shanghai"},{value:"Australia/Sydney",label:"Sydney"},{value:"Australia/Perth",label:"Perth"},{value:"Pacific/Auckland",label:"Auckland"}];function DN(e,t){const n=e&&e.trim()!=="",r=t&&t.trim()!=="";return n!==r?{valid:!1,error:"Both quiet hours start and end must be set, or both must be empty."}:{valid:!0}}function AN({session:e}){const t=un(e),n=f.useMemo(()=>CN(),[]),[r,a]=f.useState(!0),[i,o]=f.useState(!1),[l,c]=f.useState(null),[u,d]=f.useState(null),[m,h]=f.useState(n),[b,y]=f.useState("08:00"),[g,w]=f.useState("10:00"),[p,_]=f.useState(""),[v,x]=f.useState(""),[j,k]=f.useState(!1);f.useEffect(()=>{let R=!0;return a(!0),NN(e.user.id).then(({data:q,error:O})=>{if(R){if(O){console.error("Failed to load reminder preferences:",O),d({kind:"error",message:"Unable to load reminder preferences."});return}q&&(c(q),h(q.timezone||n),y(Zi(q.window_start)),w(Zi(q.window_end)),_(q.quiet_hours_start?Zi(q.quiet_hours_start):""),x(q.quiet_hours_end?Zi(q.quiet_hours_end):""),k(q.skip_weekends??!1))}}).finally(()=>{R&&a(!1)}),()=>{R=!1}},[e.user.id,n]);const S=async()=>{if(!TN(m)){d({kind:"error",message:"Invalid timezone. Please select a valid timezone."});return}if(!b||!g){d({kind:"error",message:"Please specify both start and end times."});return}const R=DN(p,v);if(!R.valid){d({kind:"error",message:R.error});return}o(!0),d(null);const{data:q,error:O}=await EN(e.user.id,{timezone:m,windowStart:b,windowEnd:g,quietHoursStart:p.trim()||null,quietHoursEnd:v.trim()||null,skipWeekends:j});if(o(!1),O){d({kind:"error",message:"Failed to save preferences. Please try again."});return}q&&c(q),d({kind:"success",message:"Daily reminder preferences saved!"})},A=R=>{h(R),d(null)},P=()=>{h(n),d(null)};return r?s.jsxs("section",{className:"account-panel__card","aria-labelledby":"daily-reminder-prefs",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Daily Reminders"}),s.jsx("h3",{id:"daily-reminder-prefs",children:"Daily Reminder Window"}),s.jsx("p",{className:"notification-preferences__loading",children:"Loading preferences…"})]}):s.jsxs("section",{className:"account-panel__card","aria-labelledby":"daily-reminder-prefs",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Daily Reminders"}),s.jsx("h3",{id:"daily-reminder-prefs",children:"Daily Reminder Window"}),s.jsx("p",{className:"account-panel__hint",children:"Set your preferred time window for receiving daily habit reminders. Reminders will be sent once per habit within this window, respecting your local timezone."}),t&&s.jsx("p",{className:"notification-preferences__message notification-preferences__message--info",children:"Demo mode stores preferences locally. Connect to Supabase for persistent settings across devices."}),u&&s.jsx("p",{className:`notification-preferences__message notification-preferences__message--${u.kind}`,role:u.kind==="error"?"alert":"status",children:u.message}),s.jsxs("div",{className:"notification-preferences__card",children:[s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["Timezone",s.jsxs("select",{value:m,onChange:R=>A(R.target.value),disabled:i,className:"notification-preferences__select",children:[Nm.map(R=>s.jsx("option",{value:R.value,children:R.label},R.value)),!Nm.some(R=>R.value===m)&&s.jsx("option",{value:m,children:m})]})]}),s.jsx("button",{type:"button",className:"notification-preferences__detect-btn",onClick:P,disabled:i,title:"Detect timezone from browser",children:"Detect"}),s.jsx("p",{children:"Your current timezone. Reminders will be scheduled based on your local time."})]}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["Window Start",s.jsx("input",{type:"time",value:b,onChange:R=>{y(R.target.value),d(null)},disabled:i})]}),s.jsx("p",{children:"Earliest time to receive daily reminders."})]}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["Window End",s.jsx("input",{type:"time",value:g,onChange:R=>{w(R.target.value),d(null)},disabled:i})]}),s.jsx("p",{children:"Latest time to receive daily reminders."})]}),s.jsx("hr",{className:"notification-preferences__divider"}),s.jsxs("p",{className:"account-panel__hint",children:[s.jsx("strong",{children:"Quiet Hours & Weekend Skip"}),": Reminders are sent only within your window and outside quiet hours. Overnight quiet hours (e.g., 22:00–06:00) are supported."]}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["Quiet Hours Start",s.jsx("input",{type:"time",value:p,onChange:R=>{_(R.target.value),d(null)},disabled:i,"aria-describedby":"quiet-hours-start-desc"})]}),s.jsx("p",{id:"quiet-hours-start-desc",children:"Start of quiet period when no reminders are sent (optional)."})]}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["Quiet Hours End",s.jsx("input",{type:"time",value:v,onChange:R=>{x(R.target.value),d(null)},disabled:i,"aria-describedby":"quiet-hours-end-desc"})]}),s.jsx("p",{id:"quiet-hours-end-desc",children:"End of quiet period when no reminders are sent (optional)."})]}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline notification-preferences__checkbox-label",children:[s.jsx("input",{type:"checkbox",checked:j,onChange:R=>{k(R.target.checked),d(null)},disabled:i}),"Skip weekends"]}),s.jsx("p",{children:"When enabled, reminders will not be sent on Saturday or Sunday."})]}),s.jsx("button",{type:"button",className:"notification-preferences__action",onClick:S,disabled:i,children:i?"Saving…":"Save Preferences"})]})]})}function IN({session:e}){const t=un(e),[n,r]=f.useState(!0),[a,i]=f.useState([]),[o,l]=f.useState(null),[c,u]=f.useState(new Set);f.useEffect(()=>{let h=!0;return r(!0),Gy().then(({data:b,error:y})=>{if(h){if(y){console.error("Failed to load habit reminder preferences:",y),l({kind:"error",message:"Unable to load habit reminder preferences."});return}b&&i(b)}}).finally(()=>{h&&r(!1)}),()=>{h=!1}},[e.user.id]);const d=async(h,b)=>{const y=!b;u(w=>new Set(w).add(h)),l(null);const{error:g}=await tl(h,{enabled:y});if(u(w=>{const p=new Set(w);return p.delete(h),p}),g){l({kind:"error",message:"Failed to update preference. Please try again."});return}i(w=>w.map(p=>p.habit_id===h?{...p,enabled:y}:p)),l({kind:"success",message:"Preference updated!"})},m=async(h,b)=>{const y=b===""?null:b;u(w=>new Set(w).add(h)),l(null);const{error:g}=await tl(h,{preferred_time:y});if(u(w=>{const p=new Set(w);return p.delete(h),p}),g){l({kind:"error",message:"Failed to update preferred time. Please try again."});return}i(w=>w.map(p=>p.habit_id===h?{...p,preferred_time:y}:p)),l({kind:"success",message:"Preferred time updated!"})};return n?s.jsxs("section",{className:"account-panel__card","aria-labelledby":"per-habit-reminder-prefs",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Per-Habit Reminders"}),s.jsx("h3",{id:"per-habit-reminder-prefs",children:"Individual Habit Reminder Settings"}),s.jsx("p",{className:"notification-preferences__loading",children:"Loading habits…"})]}):s.jsxs("section",{className:"account-panel__card","aria-labelledby":"per-habit-reminder-prefs",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Per-Habit Reminders"}),s.jsx("h3",{id:"per-habit-reminder-prefs",children:"Individual Habit Reminder Settings"}),s.jsx("p",{className:"account-panel__hint",children:"Enable or disable reminders for individual habits, and optionally set a preferred time for each habit's reminder within your daily window."}),t&&s.jsx("p",{className:"notification-preferences__message notification-preferences__message--info",children:"Demo mode stores preferences locally. Connect to Supabase for persistent settings across devices."}),o&&s.jsx("p",{className:`notification-preferences__message notification-preferences__message--${o.kind}`,role:o.kind==="error"?"alert":"status",children:o.message}),a.length===0?s.jsx("p",{className:"notification-preferences__message notification-preferences__message--info",children:"No habits found. Create habits to configure their reminder settings."}):s.jsx("div",{className:"notification-preferences__card",children:s.jsx("ul",{className:"per-habit-prefs__list",children:a.map(h=>{const b=c.has(h.habit_id);return s.jsxs("li",{className:"per-habit-prefs__item",children:[s.jsxs("div",{className:"per-habit-prefs__habit-info",children:[s.jsx("span",{className:"per-habit-prefs__emoji",children:h.emoji||"📋"}),s.jsx("span",{className:"per-habit-prefs__title",children:h.title})]}),s.jsxs("div",{className:"per-habit-prefs__controls",children:[s.jsxs("label",{className:"per-habit-prefs__toggle-label",children:[s.jsx("input",{type:"checkbox",checked:h.enabled,onChange:()=>d(h.habit_id,h.enabled),disabled:b,className:"per-habit-prefs__toggle"}),s.jsx("span",{className:"per-habit-prefs__toggle-text",children:h.enabled?"Enabled":"Disabled"})]}),s.jsxs("label",{className:"per-habit-prefs__time-label",children:[s.jsx("span",{className:"per-habit-prefs__time-text",children:"Preferred time:"}),s.jsx("input",{type:"time",value:vo(h.preferred_time),onChange:y=>m(h.habit_id,y.target.value),disabled:b||!h.enabled,className:"per-habit-prefs__time-input",placeholder:"Any"})]})]})]},h.habit_id)})})})]})}function PN(e){if(!e)return"Unknown";try{const t=new Date(e);return new Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"short"}).format(t)}catch{return e}}function RN({session:e}){const t=un(e),[n,r]=f.useState(!0),[a,i]=f.useState([]),[o,l]=f.useState(null),[c,u]=f.useState(!1);f.useEffect(()=>{if(!c)return;let m=!0;return r(!0),sm(50).then(({data:h,error:b})=>{if(m){if(b){console.error("Failed to load reminder action logs:",b),l({kind:"error",message:"Unable to load action logs."});return}h&&i(h)}}).finally(()=>{m&&r(!1)}),()=>{m=!1}},[e.user.id,c]);const d=async()=>{r(!0),l(null);const{data:m,error:h}=await sm(50);if(r(!1),h){l({kind:"error",message:"Failed to refresh logs."});return}m&&(i(m),l({kind:"success",message:"Logs refreshed!"}))};return s.jsxs("section",{className:"account-panel__card","aria-labelledby":"reminder-action-debug",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Debugging"}),s.jsx("h3",{id:"reminder-action-debug",children:"Reminder Action Logs"}),s.jsx("p",{className:"account-panel__hint",children:"View recent notification actions (Done/Snooze/Dismiss) for debugging purposes."}),s.jsx("button",{type:"button",className:"notification-preferences__action notification-preferences__action--secondary",onClick:()=>u(!c),"aria-expanded":c,children:c?"Hide Action Logs":"Show Action Logs"}),c&&s.jsxs("div",{className:"notification-preferences__card reminder-action-debug__panel",children:[t&&s.jsx("p",{className:"notification-preferences__message notification-preferences__message--info",children:"Demo mode - no real action logs available."}),o&&s.jsx("p",{className:`notification-preferences__message notification-preferences__message--${o.kind}`,role:o.kind==="error"?"alert":"status",children:o.message}),s.jsxs("div",{className:"reminder-action-debug__header",children:[s.jsxs("span",{className:"reminder-action-debug__count",children:[a.length," recent action",a.length!==1?"s":""]}),s.jsx("button",{type:"button",className:"notification-preferences__action notification-preferences__action--small",onClick:d,disabled:n,children:n?"Loading…":"Refresh"})]}),n&&a.length===0?s.jsx("p",{className:"notification-preferences__loading",children:"Loading logs…"}):a.length===0?s.jsx("p",{className:"notification-preferences__message notification-preferences__message--info",children:"No action logs found. Actions will appear here when you interact with notification buttons."}):s.jsx("ul",{className:"reminder-action-debug__list",children:a.map(m=>{var h,b;return s.jsxs("li",{className:"reminder-action-debug__item",children:[s.jsxs("div",{className:"reminder-action-debug__habit",children:[s.jsx("span",{className:"reminder-action-debug__emoji",children:((h=m.habits_v2)==null?void 0:h.emoji)||"📋"}),s.jsx("span",{className:"reminder-action-debug__title",children:((b=m.habits_v2)==null?void 0:b.title)||"Unknown Habit"})]}),s.jsxs("div",{className:"reminder-action-debug__details",children:[s.jsx("span",{className:`reminder-action-debug__action reminder-action-debug__action--${m.action}`,children:Qk(m.action)}),s.jsx("span",{className:"reminder-action-debug__time",children:PN(m.created_at)})]})]},m.id)})})]})]})}function ON(e){return{rangeDays:e,sends:0,actions:{done:0,snooze:0,dismiss:0},actionRatePct:0,doneRatePct:0,habitsWithPrefs:0,habitsEnabledPct:0}}function LN(e){const t=[],n=new Date;for(let r=e;r>=0;r--){const a=new Date;a.setDate(n.getDate()-r),t.push({day:a.toISOString().split("T")[0],sends:0,done:0,snooze:0,dismiss:0})}return t}async function Em(e=30){if(!Ce())return{data:ON(e),error:null};const t=ce(),{data:{session:n},error:r}=await t.auth.getSession();if(r||!n)return{data:null,error:r||new Error("No session")};try{const a=await fetch(`undefined/functions/v1/send-reminders/analytics/summary?range=${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`}});if(!a.ok){const o=await a.json().catch(()=>({}));return{data:null,error:new Error(o.error||"Failed to fetch analytics summary")}}return{data:await a.json(),error:null}}catch(a){return{data:null,error:a instanceof Error?a:new Error(String(a))}}}async function Cm(e=30){if(!Ce())return{data:LN(e),error:null};const t=ce(),{data:{session:n},error:r}=await t.auth.getSession();if(r||!n)return{data:null,error:r||new Error("No session")};try{const a=await fetch(`undefined/functions/v1/send-reminders/analytics/daily?range=${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n.access_token}`}});if(!a.ok){const o=await a.json().catch(()=>({}));return{data:null,error:new Error(o.error||"Failed to fetch daily analytics")}}return{data:await a.json(),error:null}}catch(a){return{data:null,error:a instanceof Error?a:new Error(String(a))}}}function va(e){return`${e.toFixed(1)}%`}function eo(e){const t=new Date(e);return new Intl.DateTimeFormat(void 0,{month:"short",day:"numeric"}).format(t)}function $N({session:e}){const t=un(e),[n,r]=f.useState(!0),[a,i]=f.useState(null),[o,l]=f.useState([]),[c,u]=f.useState(null),[d,m]=f.useState(!1),[h,b]=f.useState(30);f.useEffect(()=>{if(!d)return;let v=!0;return r(!0),u(null),Promise.all([Em(h),Cm(h)]).then(([x,j])=>{v&&(x.error?(console.error("Failed to load analytics summary:",x.error),u({kind:"error",message:"Unable to load analytics summary."})):x.data&&i(x.data),j.error?console.error("Failed to load daily analytics:",j.error):j.data&&l(j.data))}).finally(()=>{v&&r(!1)}),()=>{v=!1}},[e.user.id,d,h]);const y=async()=>{r(!0),u(null);const[v,x]=await Promise.all([Em(h),Cm(h)]);if(r(!1),v.error){u({kind:"error",message:"Failed to refresh analytics."});return}v.data&&i(v.data),x.data&&l(x.data),u({kind:"success",message:"Analytics refreshed!"})},g=v=>{v!==h&&b(v)},w=120,p=Math.max(1,...o.map(v=>v.done+v.snooze+v.dismiss)),_=a&&(a.sends>0||a.actions.done+a.actions.snooze+a.actions.dismiss>0);return s.jsxs("section",{className:"account-panel__card","aria-labelledby":"reminder-analytics",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Analytics"}),s.jsx("h3",{id:"reminder-analytics",children:"Reminder Analytics"}),s.jsx("p",{className:"account-panel__hint",children:"Track reminder effectiveness: sends, actions (done/snooze/dismiss), and opt-in rates."}),s.jsx("button",{type:"button",className:"notification-preferences__action notification-preferences__action--secondary",onClick:()=>m(!d),"aria-expanded":d,children:d?"Hide Analytics":"Show Analytics"}),d&&s.jsxs("div",{className:"notification-preferences__card reminder-analytics__panel",children:[t&&s.jsx("p",{className:"notification-preferences__message notification-preferences__message--info",children:"Demo mode - analytics data is simulated. Connect Supabase to see real data."}),c&&s.jsx("p",{className:`notification-preferences__message notification-preferences__message--${c.kind}`,role:c.kind==="error"?"alert":"status",children:c.message}),s.jsxs("div",{className:"reminder-analytics__header",children:[s.jsxs("div",{className:"reminder-analytics__range-selector",children:[s.jsx("button",{type:"button",className:`reminder-analytics__range-btn ${h===7?"reminder-analytics__range-btn--active":""}`,onClick:()=>g(7),disabled:n,children:"7 days"}),s.jsx("button",{type:"button",className:`reminder-analytics__range-btn ${h===30?"reminder-analytics__range-btn--active":""}`,onClick:()=>g(30),disabled:n,children:"30 days"})]}),s.jsx("button",{type:"button",className:"notification-preferences__action notification-preferences__action--small",onClick:y,disabled:n,children:n?"Loading…":"Refresh"})]}),n&&!a?s.jsx("p",{className:"notification-preferences__loading",children:"Loading analytics…"}):_?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"reminder-analytics__kpis",children:[s.jsxs("div",{className:"reminder-analytics__kpi",children:[s.jsx("span",{className:"reminder-analytics__kpi-value",children:(a==null?void 0:a.sends)??0}),s.jsx("span",{className:"reminder-analytics__kpi-label",children:"Sends"})]}),s.jsxs("div",{className:"reminder-analytics__kpi",children:[s.jsx("span",{className:"reminder-analytics__kpi-value",children:((a==null?void 0:a.actions.done)??0)+((a==null?void 0:a.actions.snooze)??0)+((a==null?void 0:a.actions.dismiss)??0)}),s.jsx("span",{className:"reminder-analytics__kpi-label",children:"Actions"})]}),s.jsxs("div",{className:"reminder-analytics__kpi",children:[s.jsx("span",{className:"reminder-analytics__kpi-value reminder-analytics__kpi-value--done",children:va((a==null?void 0:a.doneRatePct)??0)}),s.jsx("span",{className:"reminder-analytics__kpi-label",children:"Done %"})]}),s.jsxs("div",{className:"reminder-analytics__kpi",children:[s.jsx("span",{className:"reminder-analytics__kpi-value reminder-analytics__kpi-value--snooze",children:va(a&&a.actions.done+a.actions.snooze+a.actions.dismiss>0?a.actions.snooze/(a.actions.done+a.actions.snooze+a.actions.dismiss)*100:0)}),s.jsx("span",{className:"reminder-analytics__kpi-label",children:"Snooze %"})]}),s.jsxs("div",{className:"reminder-analytics__kpi",children:[s.jsx("span",{className:"reminder-analytics__kpi-value reminder-analytics__kpi-value--dismiss",children:va(a&&a.actions.done+a.actions.snooze+a.actions.dismiss>0?a.actions.dismiss/(a.actions.done+a.actions.snooze+a.actions.dismiss)*100:0)}),s.jsx("span",{className:"reminder-analytics__kpi-label",children:"Dismiss %"})]}),s.jsxs("div",{className:"reminder-analytics__kpi",children:[s.jsx("span",{className:"reminder-analytics__kpi-value",children:va((a==null?void 0:a.habitsEnabledPct)??0)}),s.jsx("span",{className:"reminder-analytics__kpi-label",children:"Enabled %"})]})]}),o.length>0&&s.jsxs("div",{className:"reminder-analytics__chart",children:[s.jsx("h4",{className:"reminder-analytics__chart-title",children:"Daily Actions"}),s.jsx("div",{className:"reminder-analytics__chart-container",children:s.jsx("svg",{className:"reminder-analytics__chart-svg",viewBox:`0 0 ${o.length*24} ${w}`,preserveAspectRatio:"none","aria-label":`Daily actions chart for last ${h} days`,children:o.map((v,x)=>{const j=v.done+v.snooze+v.dismiss,k=x*24+2,S=20,A=p>0?v.done/p*(w-20):0,P=p>0?v.snooze/p*(w-20):0,R=p>0?v.dismiss/p*(w-20):0,q=w-20;return s.jsxs("g",{children:[A>0&&s.jsx("rect",{x:k,y:q-A,width:S,height:A,className:"reminder-analytics__chart-bar--done",rx:"2",children:s.jsx("title",{children:`${eo(v.day)}: ${v.done} done`})}),P>0&&s.jsx("rect",{x:k,y:q-A-P,width:S,height:P,className:"reminder-analytics__chart-bar--snooze",rx:"2",children:s.jsx("title",{children:`${eo(v.day)}: ${v.snooze} snoozed`})}),R>0&&s.jsx("rect",{x:k,y:q-A-P-R,width:S,height:R,className:"reminder-analytics__chart-bar--dismiss",rx:"2",children:s.jsx("title",{children:`${eo(v.day)}: ${v.dismiss} dismissed`})}),j===0&&s.jsx("rect",{x:k,y:q-4,width:S,height:4,className:"reminder-analytics__chart-bar--empty",rx:"2",children:s.jsx("title",{children:`${eo(v.day)}: No actions`})})]},v.day)})})}),s.jsxs("div",{className:"reminder-analytics__chart-legend",children:[s.jsxs("span",{className:"reminder-analytics__legend-item reminder-analytics__legend-item--done",children:[s.jsx("span",{className:"reminder-analytics__legend-color"}),"Done"]}),s.jsxs("span",{className:"reminder-analytics__legend-item reminder-analytics__legend-item--snooze",children:[s.jsx("span",{className:"reminder-analytics__legend-color"}),"Snooze"]}),s.jsxs("span",{className:"reminder-analytics__legend-item reminder-analytics__legend-item--dismiss",children:[s.jsx("span",{className:"reminder-analytics__legend-color"}),"Dismiss"]})]})]}),s.jsxs("div",{className:"reminder-analytics__stats",children:[s.jsxs("div",{className:"reminder-analytics__stat",children:[s.jsx("span",{className:"reminder-analytics__stat-label",children:"Habits with preferences:"}),s.jsx("span",{className:"reminder-analytics__stat-value",children:(a==null?void 0:a.habitsWithPrefs)??0})]}),s.jsxs("div",{className:"reminder-analytics__stat",children:[s.jsx("span",{className:"reminder-analytics__stat-label",children:"Action rate:"}),s.jsx("span",{className:"reminder-analytics__stat-value",children:va((a==null?void 0:a.actionRatePct)??0)})]})]})]}):s.jsx("div",{className:"reminder-analytics__empty",children:s.jsxs("p",{className:"notification-preferences__message notification-preferences__message--info",children:["No reminder data found for the last ",h," days. Data will appear here after you receive and interact with reminders."]})})]})]})}async function MN(e){try{const t=ce(),{data:n,error:r}=await t.from("ai_settings").select("user_id, provider, api_key, model").eq("user_id",e).eq("provider","openai").single();if(r){if(r.code==="PGRST116")return{data:null,error:null};throw r}return{data:n,error:null}}catch(t){return console.error("Failed to fetch AI settings:",t),{data:null,error:t instanceof Error?t:new Error("Unknown error fetching AI settings")}}}async function UN(e,t){try{const n=ce(),{data:r,error:a}=await n.from("ai_settings").upsert({user_id:e,provider:"openai",model:t},{onConflict:"user_id"}).select("user_id, provider, api_key, model").single();if(a)throw a;return{data:r,error:null}}catch(n){return console.error("Failed to upsert AI model:",n),{data:null,error:n instanceof Error?n:new Error("Unknown error upserting AI model")}}}const mc=[{value:"gpt-5-nano",label:"GPT‑5 nano (fastest, cheapest)",description:"Best for quick suggestions with minimal cost"},{value:"gpt-5-mini",label:"GPT‑5 mini (better quality, still affordable)",description:"Balanced quality and performance"},{value:"gpt-5-pro",label:"GPT‑5 pro (highest quality, most expensive)",description:"Premium suggestions with the best quality"}],FN="gpt-5-nano";function zN({session:e}){var h;const[t,n]=f.useState(FN),[r,a]=f.useState(!0),[i,o]=f.useState(!1),[l,c]=f.useState(null),[u,d]=f.useState(null);f.useEffect(()=>{let b=!0;return a(!0),MN(e.user.id).then(({data:y,error:g})=>{if(b){if(g){console.error("Failed to load AI settings:",g),c("Unable to load AI settings. Using default model.");return}y!=null&&y.model&&mc.some(p=>p.value===y.model)&&n(y.model)}}).finally(()=>{b&&a(!1)}),()=>{b=!1}},[e.user.id]);const m=async b=>{const y=b.target.value;if(y===t)return;o(!0),c(null),d(null);const g=t;n(y);try{const{error:w}=await UN(e.user.id,y);if(w)throw w;d("AI model preference saved successfully."),setTimeout(()=>d(null),3e3)}catch(w){n(g);const p=w instanceof Error?w.message:"Failed to save AI model preference.";c(p),console.error("Error saving AI model:",w)}finally{o(!1)}};return s.jsxs("section",{className:"account-panel__card","aria-labelledby":"account-ai-settings",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"AI Settings"}),s.jsx("h3",{id:"account-ai-settings",children:"AI Model for Goal Suggestions"}),s.jsx("p",{className:"account-panel__hint",children:"Choose which OpenAI model to use when generating AI-powered goal suggestions. Higher-tier models provide better quality but cost more."}),l&&s.jsx("p",{className:"notification-preferences__message notification-preferences__message--error",role:"alert",children:l}),u&&s.jsx("p",{className:"notification-preferences__message notification-preferences__message--success",role:"status",children:u}),s.jsxs("div",{className:"notification-preferences__control notification-preferences__control--inline",children:[s.jsxs("label",{className:"notification-preferences__inline",children:["AI model",s.jsx("select",{value:t,onChange:m,disabled:r||i,style:{minWidth:"300px"},children:mc.map(b=>s.jsx("option",{value:b.value,children:b.label},b.value))})]}),s.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.875rem",color:"var(--text-muted)"},children:(h=mc.find(b=>b.value===t))==null?void 0:h.description})]}),s.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px"},children:[s.jsx("p",{style:{fontSize:"0.875rem",margin:0},children:s.jsx("strong",{children:"Cost comparison:"})}),s.jsxs("ul",{style:{fontSize:"0.875rem",marginTop:"0.5rem",marginBottom:0,paddingLeft:"1.5rem"},children:[s.jsxs("li",{children:[s.jsx("strong",{children:"nano:"})," Fastest and cheapest option, good for basic suggestions"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"mini:"})," Balanced quality and cost, recommended for most users"]}),s.jsxs("li",{children:[s.jsx("strong",{children:"pro:"})," Premium quality with highest cost, best for detailed planning"]})]})]})]})}function Tm({title:e,description:t,icon:n,onClick:r,itemCount:a}){return s.jsxs("button",{type:"button",className:"settings-folder-button",onClick:r,"aria-label":`Open ${e} folder with ${a} settings`,children:[s.jsx("div",{className:"settings-folder-button__icon","aria-hidden":"true",children:n}),s.jsxs("div",{className:"settings-folder-button__content",children:[s.jsx("h3",{className:"settings-folder-button__title",children:e}),s.jsx("p",{className:"settings-folder-button__description",children:t}),s.jsxs("p",{className:"settings-folder-button__count",children:[a," settings"]})]}),s.jsx("div",{className:"settings-folder-button__arrow","aria-hidden":"true",children:"→"})]})}function Dm({isOpen:e,onClose:t,title:n,children:r}){const a=f.useRef(null);return f.useEffect(()=>{const i=a.current;i&&(e?i.showModal():i.close())},[e]),f.useEffect(()=>{const i=a.current;if(!i)return;const o=c=>{c.preventDefault(),t()},l=()=>{t()};return i.addEventListener("cancel",o),i.addEventListener("close",l),()=>{i.removeEventListener("cancel",o),i.removeEventListener("close",l)}},[t]),e?s.jsxs("dialog",{ref:a,className:"settings-folder-popup","aria-labelledby":"popup-title",children:[s.jsxs("div",{className:"settings-folder-popup__header",children:[s.jsx("h2",{id:"popup-title",className:"settings-folder-popup__title",children:n}),s.jsx("button",{type:"button",className:"settings-folder-popup__close",onClick:t,"aria-label":"Close settings folder",children:"✕"})]}),s.jsx("div",{className:"settings-folder-popup__content",children:r})]}):null}async function BN(e){if(!Ce())return{data:null,error:null};const t=ce(),{data:n,error:r}=await t.from("workspace_profiles").select("*").eq("user_id",e).maybeSingle();return{data:n,error:r}}async function nh(e){if(!Ce())throw new Error("Supabase is not connected.");const t=ce(),{data:n,error:r}=await t.from("workspace_profiles").upsert(e,{onConflict:"user_id"}).select().single();return{data:n,error:r}}function di(e){if(!e)return"";const t=e.trim();if(!t)return"";const n=t.split(/\s+/).filter(i=>i.length>0);if(n.length===0)return"";const r=n[0].charAt(0).toUpperCase();let a="";return n.length>1?a=n[1].charAt(0).toUpperCase():n[0].length>1&&(a=n[0].charAt(1).toUpperCase()),r+a}function pc(e,t){if(!e)return"Not available";const n=new Date(e);return Number.isNaN(n.getTime())?e:new Intl.DateTimeFormat(void 0,t).format(n)}function qN({session:e,isDemoExperience:t,isAuthenticated:n,onSignOut:r,onEditProfile:a,profile:i,stats:o,profileLoading:l,onProfileUpdate:c}){var z,ne,Z,I,C;const[u,d]=f.useState(!1),[m,h]=f.useState(!1),[b,y]=f.useState(!1),g=e.user,w=(i==null?void 0:i.full_name)||((z=g.user_metadata)==null?void 0:z.full_name)||g.email||"Workspace member",p=g.email||"No email on file",_=w.trim().charAt(0).toUpperCase()||"U",v=(i==null?void 0:i.workspace_name)||"Personal rituals workspace",x=(i==null?void 0:i.initials)||di((i==null?void 0:i.full_name)||""),j=((ne=g.user_metadata)==null?void 0:ne.subscription_plan)||(t?"Demo preview":"LifeGoal workspace"),k=((Z=g.user_metadata)==null?void 0:Z.subscription_status)||(t?"Preview mode":"Active"),S=pc(((I=g.user_metadata)==null?void 0:I.subscription_renews_on)??null,{dateStyle:"medium"}),A=!!((C=g.user_metadata)!=null&&C.onboarding_complete),P=pc(g.created_at,{dateStyle:"medium"}),R=pc(g.last_sign_in_at,{dateStyle:"medium",timeStyle:"short"}),q=t?"Demo (local device only)":"Connected to Supabase",O=t,oe=async L=>{if(!(!i||t)){y(!0);try{const{data:K,error:ue}=await nh({...i,show_initials_in_menu:L});if(ue){console.error("Failed to update initials preference:",ue);return}K&&c&&c(K)}catch(K){console.error("Failed to update initials preference:",K)}finally{y(!1)}}};return s.jsxs("div",{className:"account-panel",children:[O?s.jsx("p",{className:"account-panel__notice",children:"You’re exploring demo data. Sign in to sync with your Supabase project."}):null,s.jsxs("section",{className:"account-panel__card account-panel__profile","aria-labelledby":"account-profile",children:[s.jsx("div",{className:"account-panel__avatar","aria-hidden":"true",children:_}),s.jsxs("div",{className:"account-panel__profile-text",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Profile"}),s.jsx("h2",{id:"account-profile",children:"My account"}),s.jsx("p",{className:"account-panel__lead",children:"Review your identity details and workspace access."}),s.jsxs("dl",{className:"account-panel__details",children:[s.jsxs("div",{children:[s.jsx("dt",{children:"Name"}),s.jsx("dd",{children:w})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Initials"}),s.jsx("dd",{children:x||"Not set"})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Email"}),s.jsx("dd",{children:p})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Workspace name"}),s.jsx("dd",{children:v})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Workspace mode"}),s.jsx("dd",{children:q})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Onboarding"}),s.jsx("dd",{children:A?"Complete":"In progress"})]})]}),s.jsx("div",{className:"account-panel__actions-row",children:s.jsx("button",{type:"button",className:"btn",onClick:a,disabled:l,children:l?"Loading…":"Edit account details"})})]})]}),s.jsxs("section",{className:"account-panel__card","aria-labelledby":"account-subscription",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Subscription"}),s.jsx("h3",{id:"account-subscription",children:"Plan overview"}),s.jsx("p",{className:"account-panel__hint",children:"Manage billing from your Supabase dashboard. Updates sync instantly to this workspace."}),s.jsxs("dl",{className:"account-panel__details",children:[s.jsxs("div",{children:[s.jsx("dt",{children:"Plan"}),s.jsx("dd",{children:j})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Status"}),s.jsx("dd",{children:k})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Renews"}),s.jsx("dd",{children:S})]})]})]}),s.jsxs("section",{className:"account-panel__card","aria-labelledby":"account-theme",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Appearance"}),s.jsx(pN,{})]}),s.jsxs("section",{className:"account-panel__card","aria-labelledby":"account-menu-icon",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Menu Icon"}),s.jsx("h3",{id:"account-menu-icon",children:"Display Preferences"}),s.jsx("p",{className:"account-panel__hint",children:"Choose whether to display your initials or the default icon in the main menu when signed in."}),s.jsxs("div",{className:"account-panel__toggle-row",children:[s.jsxs("label",{className:"account-panel__toggle-label",children:[s.jsx("input",{type:"checkbox",checked:(i==null?void 0:i.show_initials_in_menu)??!1,onChange:L=>oe(L.target.checked),disabled:b||!(i!=null&&i.full_name)||t,className:"account-panel__toggle-input"}),s.jsxs("span",{className:"account-panel__toggle-text",children:["Show my initials (",x||"--",") in main menu"]})]}),b&&s.jsx("span",{className:"account-panel__saving-indicator",children:"Saving..."})]}),!(i!=null&&i.full_name)&&!t&&s.jsx("p",{className:"account-panel__hint",style:{marginTop:"0.5rem",color:"var(--color-text-muted)"},children:"Set your name in the account details to enable this feature."})]}),s.jsx(zN,{session:e}),s.jsx("section",{className:"account-panel__card",children:s.jsx(Tm,{title:"Developer & Analytics Tools",description:"Advanced settings for workspace data, analytics, debugging, and testing",icon:"🔧",itemCount:5,onClick:()=>d(!0)})}),s.jsx("section",{className:"account-panel__card",children:s.jsx(Tm,{title:"Notification Settings",description:"Configure habit notifications, daily reminders, and per-habit reminder preferences",icon:"🔔",itemCount:3,onClick:()=>h(!0)})}),s.jsxs(Dm,{isOpen:u,onClose:()=>d(!1),title:"Developer & Analytics Tools",children:[s.jsxs("section",{className:"account-panel__card","aria-labelledby":"account-data",children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Data & security"}),s.jsx("h3",{id:"account-data",children:"Workspace data"}),s.jsx("p",{className:"account-panel__hint",children:"View high-level metadata about your profile. Detailed exports are available through Supabase."}),s.jsxs("dl",{className:"account-panel__details",children:[s.jsxs("div",{children:[s.jsx("dt",{children:"Member since"}),s.jsx("dd",{children:P})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Last sign-in"}),s.jsx("dd",{children:R})]}),s.jsxs("div",{children:[s.jsx("dt",{children:"Account ID"}),s.jsx("dd",{className:"account-panel__code",children:g.id})]})]})]}),s.jsx($N,{session:e}),s.jsx(kN,{session:e}),s.jsx(RN,{session:e}),s.jsx(oN,{session:e,isDemoExperience:t})]}),s.jsxs(Dm,{isOpen:m,onClose:()=>h(!1),title:"Notification Settings",children:[s.jsx(jN,{session:e}),s.jsx(AN,{session:e}),s.jsx(IN,{session:e})]}),s.jsxs("div",{className:"account-panel__actions",children:[s.jsxs("div",{children:[s.jsx("p",{className:"account-panel__eyebrow",children:"Session"}),s.jsx("p",{className:"account-panel__hint",children:n?"Sign out to switch to a different Supabase project.":"Sign in with Supabase to sync your personal rituals."})]}),n?s.jsx("button",{type:"button",className:"btn btn--primary",onClick:()=>r(),children:"Sign out"}):null]})]})}function HN({isOpen:e,session:t,profile:n,onClose:r,onSaved:a}){const{client:i}=Pn(),[o,l]=f.useState(""),[c,u]=f.useState(""),[d,m]=f.useState(null),[h,b]=f.useState(null),[y,g]=f.useState(!1),w=f.useMemo(()=>di(o),[o]);if(f.useEffect(()=>{if(!n){l(""),u("");return}l(n.full_name??""),u(n.workspace_name??"")},[n]),f.useEffect(()=>{e||(m(null),b(null))},[e]),!e||!t)return null;const p=async _=>{_.preventDefault();const v=o.trim();if(!v){m("Add your name to personalize the workspace.");return}g(!0),m(null),b(null);try{const{data:x,error:j}=await nh({user_id:t.user.id,full_name:v,workspace_name:c.trim()||null,initials:di(v)});if(j||!x)throw j??new Error("Unable to save profile.");const k=i??ce(),{error:S}=await k.auth.updateUser({data:{full_name:v}});if(S)throw S;b("Profile updated!"),a(x)}catch(x){m(x instanceof Error?x.message:"Unable to save profile.")}finally{g(!1)}};return s.jsxs("div",{className:"workspace-setup",role:"dialog","aria-modal":"true","aria-label":"Workspace setup",children:[s.jsx("div",{className:"workspace-setup__backdrop",onClick:r,role:"presentation"}),s.jsxs("div",{className:"workspace-setup__card",children:[s.jsxs("button",{type:"button",className:"workspace-setup__close",onClick:r,children:[s.jsx("span",{"aria-hidden":"true",children:"×"}),s.jsx("span",{className:"sr-only",children:"Close workspace setup"})]}),s.jsxs("div",{className:"workspace-setup__header",children:[s.jsx("p",{className:"workspace-setup__eyebrow",children:"Complete your account"}),s.jsx("h2",{children:"Save your account details"}),s.jsx("p",{children:"Share your name and workspace title so your account looks personalized every time you sign in. We’ll sync these details to Supabase."})]}),s.jsxs("form",{className:"workspace-setup__form",onSubmit:p,children:[s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Your name"}),s.jsx("input",{type:"text",value:o,onChange:_=>l(_.target.value),placeholder:t.user.email??"you@example.com",required:!0})]}),s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Initials (auto-generated)"}),s.jsx("input",{type:"text",value:w,placeholder:"--",disabled:!0,readOnly:!0,style:{backgroundColor:"var(--color-bg-subtle, #f5f5f5)",cursor:"not-allowed"}})]}),s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Workspace name"}),s.jsx("input",{type:"text",value:c,onChange:_=>u(_.target.value),placeholder:"My rituals HQ"})]}),h?s.jsx("p",{className:"supabase-auth__status supabase-auth__status--success",children:h}):null,d?s.jsx("p",{className:"supabase-auth__status supabase-auth__status--error",children:d}):null,s.jsxs("div",{className:"workspace-setup__actions",children:[s.jsx("button",{type:"submit",className:"supabase-auth__action auth-card__primary",disabled:y,children:y?"Saving…":"Save my account"}),s.jsx("button",{type:"button",className:"supabase-auth__action",onClick:r,disabled:y,children:"Skip for now"})]})]})]})]})}const WN=[{title:"Pause all goal pushes",detail:"Temporarily park goals in reflection-only mode so you can regroup without feeling behind."},{title:"Snooze habit streaks",detail:"Habits stay visible but stop the streak counter, signalling this is a reset window not a failure."},{title:"Choose one micro-habit",detail:"Design a single, friendly action that rebuilds confidence (ex: 5 minute walk, inbox zero, gratitude)."},{title:"Restart with a win",detail:"After three consecutive days with the micro-habit, re-activate the rest of your system."}],VN=[{id:"momentum-reset",title:"Momentum Reset",emoji:"🧭",description:"Use when life happens and you fall off the track. Pauses goals and rituals, then relaunches with a gentle daily win.",highlights:["Pauses all goals","Pauses all habits","Creates one simple anchor habit"]},{id:"vacation-mode",title:"Vacation Mode",emoji:"🏖️",description:"Tell the assistant about upcoming travel or life events. It softens expectations, schedules a return buffer, and sets an intention.",highlights:["Flexible schedule","Re-entry checklist","Automatic grace period"]},{id:"goal-drafting",title:"Goal Draft Partner",emoji:"✍️",description:"Guided prompts to fill out goal or habit fields. The assistant asks “why”, “how will it feel”, and “what is the next tiny action?”.",highlights:["Clarify motivations","Spot missing success metrics","Suggest habit ideas"]},{id:"future-forecast",title:"Future Scenario Forecast",emoji:"🔮",description:"Projects likely outcomes based on your track record. Shows best, probable, and minimum wins so you can adjust expectations.",highlights:["Evidence-based coaching","What-if comparisons","Keeps hopes grounded"]}],Am={weekend:{label:"Long weekend (3-4 days)",prep:'wrap up critical tasks and mark "vacation" on shared calendars',returnBuffer:"1 day of inbox triage + light planning"},week:{label:"Full week (5-7 days)",prep:"share auto-replies and switch recurring tasks to standby mode",returnBuffer:"2 transition days with gentle routines"},sabbatical:{label:"Extended reset (8+ days)",prep:"close loops, communicate expectations, log core habits to revisit later",returnBuffer:"3 days of soft launch with limited commitments"}},GN={rested:"Lean into ambitious goals, you are coming back with enthusiasm.",steady:"Protect your mornings, let afternoons ramp slowly.",depleted:"Focus on hydration, sleep, and 1 micro-habit before tackling anything big."},KN={foundations:{microHabit:"10-minute grounding walk + hydration check-in",reminder:"Foundational energy makes every other habit easier."},creative:{microHabit:"5-minute idea dump or sketch before checking messages",reminder:"Creative momentum thrives on tiny daily sparks."},relationships:{microHabit:"Send one thoughtful message or voice note each day",reminder:"Re-connection removes guilt and boosts motivation fast."}},JN=[{id:"steady-progress",title:"Steady 80% weeks",timeframe:"Next 12 weeks",focus:"Complete 4 habits per week and a weekly review",payoff:"Expect 2 milestone wins and measurable habit streaks."},{id:"momentum-surge",title:"Momentum Surge",timeframe:"Next 30 days",focus:"Use the anchor habit daily plus two flexible habits on weekdays.",payoff:"Confidence spikes and you prime yourself for bigger pushes."},{id:"compassion-mode",title:"Compassion Mode",timeframe:"Next 14 days",focus:"Log what derails you, celebrate any completion, skip judgment.",payoff:"You learn how to prevent repeat dips and keep the lights on."}],YN=["When do you notice the earliest signs that a derailment is coming?","What routines are most fragile during travel, illness, or busy seasons?","Who can you notify (or ask for help) before the dip happens?","What permission do you need to give yourself so resets feel intentional?"];function QN({session:e}){var h,b,y;const[t,n]=f.useState("weekend"),[r,a]=f.useState("steady"),[i,o]=f.useState("foundations"),[l,c]=f.useState(""),u=((y=(b=(h=e==null?void 0:e.user)==null?void 0:h.user_metadata)==null?void 0:b.full_name)==null?void 0:y.split(" ")[0])??"friend",d=f.useMemo(()=>{const g=Am[t],w=KN[i],p=GN[r];return{prep:g.prep,during:`${g.label} • Keep only the anchor habit + daily reflection photo.`,returnBuffer:g.returnBuffer,anchorHabit:w.microHabit,reminder:`${p} ${w.reminder}`}},[t,i,r]),m=f.useMemo(()=>{const g=l.trim().toLowerCase();return g?g.includes("travel")||g.includes("vacation")?"Consider activating Vacation Mode 48 hours before departure so the pause feels proactive.":g.includes("sick")||g.includes("ill")||g.includes("health")?"Health setbacks crave extra sleep + hydration. Keep only the micro-habit until your energy score is back.":g.includes("work")||g.includes("deadline")?"High-pressure work cycles respond well to “companion habits” like inbox triage + 5 deep breaths before meetings.":"Notice what triggered the drop and capture the first signal you can act on sooner next time.":"Describe a derailment (ex: vacation, illness, busy launch). The assistant will surface pattern notes."},[l]);return s.jsxs("section",{className:"ai-assistant",children:[s.jsxs("div",{className:"ai-assistant__hero",children:[s.jsx("p",{className:"ai-assistant__eyebrow",children:"AI strategy beta"}),s.jsx("h2",{children:"Adaptive assistant for real-life detours"}),s.jsxs("p",{children:["Hi ",u,"! This tab contains pre-built coaching sequences the assistant can pull depending on what life throws at you. Use it to pause, reset, or imagine what success looks like before you start typing in your goals and habits."]})]}),s.jsx("div",{className:"ai-assistant__grid",children:VN.map(g=>s.jsxs("article",{className:"ai-assistant__card",children:[s.jsxs("header",{className:"ai-assistant__card-header",children:[s.jsx("span",{className:"ai-assistant__card-emoji","aria-hidden":"true",children:g.emoji}),s.jsxs("div",{children:[s.jsx("h3",{children:g.title}),s.jsx("p",{children:g.description})]})]}),s.jsx("ul",{children:g.highlights.map(w=>s.jsx("li",{children:w},w))})]},g.id))}),s.jsxs("section",{className:"ai-assistant__panel",children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Momentum reset playbook"}),s.jsx("p",{children:"Use the four-step sequence the moment you fall off the track."})]}),s.jsx("ol",{className:"ai-assistant__sequence",children:WN.map(g=>s.jsxs("li",{children:[s.jsx("strong",{children:g.title}),s.jsx("span",{children:g.detail})]},g.title))})]}),s.jsxs("section",{className:"ai-assistant__panel",children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Vacation mode planner"}),s.jsx("p",{children:"Tell the assistant how long you will unplug, how you expect to feel, and where you want an easy win. It designs the buffer and daily anchor."})]}),s.jsxs("div",{className:"ai-assistant__planner",children:[s.jsxs("label",{children:["Trip length",s.jsx("select",{value:t,onChange:g=>n(g.target.value),children:Object.entries(Am).map(([g,w])=>s.jsx("option",{value:g,children:w.label},g))})]}),s.jsxs("label",{children:["Energy on return",s.jsxs("select",{value:r,onChange:g=>a(g.target.value),children:[s.jsx("option",{value:"rested",children:"Rested and excited"}),s.jsx("option",{value:"steady",children:"Calm but realistic"}),s.jsx("option",{value:"depleted",children:"Tired or jet-lagged"})]})]}),s.jsxs("label",{children:["Anchor focus",s.jsxs("select",{value:i,onChange:g=>o(g.target.value),children:[s.jsx("option",{value:"foundations",children:"Energy foundations"}),s.jsx("option",{value:"creative",children:"Creative confidence"}),s.jsx("option",{value:"relationships",children:"Relationships"})]})]})]}),s.jsxs("div",{className:"ai-assistant__plan",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Prep:"})," ",d.prep]}),s.jsxs("p",{children:[s.jsx("strong",{children:"During:"})," ",d.during]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Return buffer:"})," ",d.returnBuffer]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Anchor habit:"})," ",d.anchorHabit]}),s.jsx("p",{children:d.reminder})]})]}),s.jsxs("section",{className:"ai-assistant__panel",children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Reflection log"}),s.jsx("p",{children:"Capture what tends to make you slip so the assistant can spot the next pattern."})]}),s.jsx("textarea",{placeholder:"Example: Whenever I travel I lose my morning routine and then dread restarting.",value:l,onChange:g=>c(g.target.value)}),s.jsx("p",{className:"ai-assistant__insight",children:m}),s.jsx("ul",{className:"ai-assistant__prompts",children:YN.map(g=>s.jsx("li",{children:g},g))})]}),s.jsxs("section",{className:"ai-assistant__panel",children:[s.jsxs("div",{children:[s.jsx("h3",{children:"Future scenario preview"}),s.jsx("p",{children:"Quick glimpses of what the next stretch might feel like depending on the strategy."})]}),s.jsx("div",{className:"ai-assistant__scenarios",children:JN.map(g=>s.jsxs("article",{children:[s.jsx("h4",{children:g.title}),s.jsx("p",{className:"ai-assistant__scenario-meta",children:g.timeframe}),s.jsx("p",{children:g.focus}),s.jsx("p",{className:"ai-assistant__scenario-payoff",children:g.payoff})]},g.id))})]})]})}const XN=[{id:"motivation",icon:"💪",title:"Motivation Boost",description:"Get inspired to tackle your goals",prompt:"I need some motivation to stay on track with my goals."},{id:"goal-setting",icon:"🎯",title:"Goal Setting",description:"Refine and structure your goals",prompt:"Help me set better goals and create an action plan."},{id:"progress-review",icon:"📊",title:"Progress Review",description:"Reflect on your journey so far",prompt:"Let's review my progress and identify areas for improvement."},{id:"mindfulness",icon:"🧘",title:"Mindfulness",description:"Find balance and reduce stress",prompt:"I need help with mindfulness and stress management."},{id:"habit-building",icon:"📆",title:"Habit Building",description:"Create sustainable daily routines",prompt:"How can I build better habits that stick?"},{id:"overcome-obstacles",icon:"🚧",title:"Overcome Obstacles",description:"Navigate challenges and setbacks",prompt:"I'm facing challenges with my goals. Can you help me strategize?"}],gc=[{id:"welcome-1",role:"assistant",content:"Hi there! 👋 I'm your AI Life Coach.",timestamp:new Date},{id:"welcome-2",role:"assistant",content:"I'm here to help you with motivation, goal setting, habit building, and navigating life's challenges. What would you like to work on today?",timestamp:new Date}];function cb({session:e,onClose:t}){var x,j;const[n,r]=f.useState(gc),[a,i]=f.useState(""),[o,l]=f.useState(!1),[c,u]=f.useState(!0),d=f.useRef(null),m=f.useRef(null),h=(j=(x=e.user)==null?void 0:x.user_metadata)==null?void 0:j.full_name,b=(typeof h=="string"?h.split(" ")[0]:null)||"there";f.useEffect(()=>{y()},[n]),f.useEffect(()=>{var k;(k=m.current)==null||k.focus()},[]);const y=()=>{var k;(k=d.current)==null||k.scrollIntoView({behavior:"smooth"})},g=async k=>{await new Promise(A=>setTimeout(A,1500));const S=k.toLowerCase();return S.includes("motivat")?`Great to hear you're seeking motivation, ${b}! Remember, every small step forward is progress. Your goals are within reach, and I believe in your ability to achieve them. What specific goal are you working on right now?`:S.includes("goal")||S.includes("plan")?"Setting effective goals is crucial for success! I recommend using the SMART framework: Specific, Measurable, Achievable, Relevant, and Time-bound. Would you like help breaking down a specific goal into actionable steps?":S.includes("habit")?"Building lasting habits is all about consistency and starting small! Research shows it takes an average of 66 days to form a new habit. What habit would you like to develop? I can help you create a sustainable routine.":S.includes("stress")||S.includes("anxiety")||S.includes("overwhelm")?"I understand that stress can be challenging. Let's work on some strategies together. Have you tried the 5-4-3-2-1 grounding technique? It helps bring you back to the present moment. Would you like me to guide you through it?":S.includes("challenge")||S.includes("difficult")||S.includes("struggle")?`Challenges are opportunities for growth, ${b}. Let's break this down together. Can you tell me more about the specific obstacle you're facing? Once we identify it clearly, we can develop a strategy to overcome it.`:S.includes("progress")||S.includes("review")?"Reflecting on your progress is wonderful! Let's celebrate your wins, no matter how small. What have you accomplished recently that you're proud of? And what areas do you feel could use more attention?":`That's an interesting point, ${b}. I'm here to support you on your journey. Could you tell me more about what you're hoping to achieve? The more details you share, the better I can help you create a personalized action plan.`},w=k=>{u(!1),p(k.prompt)},p=async k=>{const S=k||a.trim();if(!S)return;const A={id:`user-${Date.now()}`,role:"user",content:S,timestamp:new Date};r(P=>[...P,A]),i(""),l(!0);try{const P=await g(S),R={id:`ai-${Date.now()}`,role:"assistant",content:P,timestamp:new Date};r(q=>[...q,R])}catch(P){console.error("Error generating AI response:",P);const R={id:`error-${Date.now()}`,role:"assistant",content:"I apologize, but I encountered an error. Please try again.",timestamp:new Date};r(q=>[...q,R])}finally{l(!1)}},_=k=>{k.preventDefault(),p()},v=()=>{var k;r(gc),u(!0),i(""),(k=m.current)==null||k.focus()};return s.jsxs("div",{className:"ai-coach-modal",children:[s.jsx("div",{className:"ai-coach-modal__backdrop",onClick:t,role:"presentation"}),s.jsxs("div",{className:"ai-coach-modal__container",children:[s.jsxs("div",{className:"ai-coach-modal__header",children:[s.jsxs("div",{className:"ai-coach-modal__header-content",children:[s.jsx("div",{className:"ai-coach-modal__avatar",children:s.jsxs("div",{className:"ai-coach-modal__robot",children:[s.jsx("span",{className:"ai-coach-modal__robot-face",children:"🤖"}),s.jsx("div",{className:"ai-coach-modal__robot-glow"})]})}),s.jsxs("div",{className:"ai-coach-modal__header-text",children:[s.jsx("h2",{className:"ai-coach-modal__title",children:"AI Life Coach"}),s.jsx("p",{className:"ai-coach-modal__subtitle",children:"Your personal guide to achieving your goals"})]})]}),s.jsxs("div",{className:"ai-coach-modal__header-actions",children:[s.jsx("button",{type:"button",className:"ai-coach-modal__reset-btn",onClick:v,"aria-label":"Reset conversation",title:"Start new conversation",children:"🔄"}),s.jsx("button",{type:"button",className:"ai-coach-modal__close-btn",onClick:t,"aria-label":"Close AI Coach",children:"×"})]})]}),s.jsxs("div",{className:"ai-coach-modal__body",children:[s.jsxs("div",{className:"ai-coach-modal__messages",children:[n.map(k=>s.jsxs("div",{className:`ai-coach-modal__message ai-coach-modal__message--${k.role}`,children:[s.jsx("div",{className:"ai-coach-modal__message-content",children:k.content}),s.jsx("div",{className:"ai-coach-modal__message-time",children:k.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},k.id)),o&&s.jsx("div",{className:"ai-coach-modal__message ai-coach-modal__message--assistant",children:s.jsx("div",{className:"ai-coach-modal__message-content",children:s.jsxs("div",{className:"ai-coach-modal__typing",children:[s.jsx("span",{}),s.jsx("span",{}),s.jsx("span",{})]})})}),c&&n.length===gc.length&&s.jsxs("div",{className:"ai-coach-modal__topics",children:[s.jsx("p",{className:"ai-coach-modal__topics-title",children:"Quick start with a topic:"}),s.jsx("div",{className:"ai-coach-modal__topics-grid",children:XN.map(k=>s.jsxs("button",{type:"button",className:"ai-coach-modal__topic-card",onClick:()=>w(k),children:[s.jsx("span",{className:"ai-coach-modal__topic-icon","aria-hidden":"true",children:k.icon}),s.jsx("span",{className:"ai-coach-modal__topic-title",children:k.title}),s.jsx("span",{className:"ai-coach-modal__topic-desc",children:k.description})]},k.id))})]}),s.jsx("div",{ref:d})]}),s.jsxs("form",{className:"ai-coach-modal__input-form",onSubmit:_,children:[s.jsx("input",{ref:m,type:"text",className:"ai-coach-modal__input",placeholder:"Type your message here...",value:a,onChange:k=>i(k.target.value),disabled:o}),s.jsx("button",{type:"submit",className:"ai-coach-modal__send-btn",disabled:!a.trim()||o,"aria-label":"Send message",children:s.jsx("span",{"aria-hidden":"true",children:"➤"})})]})]}),s.jsx("div",{className:"ai-coach-modal__footer",children:s.jsx("p",{className:"ai-coach-modal__disclaimer",children:"💡 This is a simulated AI coach for demonstration purposes. Responses are generated based on common coaching principles."})})]})]})}function ZN(e){switch(e){case"happy":return"#10b981";case"excited":return"#f59e0b";case"neutral":return"#6b7280";case"sad":return"#3b82f6";case"stressed":return"#ef4444";default:return"var(--color-primary, #0ea5e9)"}}function eE(e){switch(e){case"quick":return"#22c55e";case"deep":return"#8b5cf6";case"brain_dump":return"#f97316";case"life_wheel":return"#06b6d4";case"secret":return"#ec4899";case"goal":return"#eab308";case"time_capsule":return"#14b8a6";default:return"var(--color-primary, #0ea5e9)"}}function _c(e){return e.toISOString().split("T")[0]}function tE(e,t){const n=new Date(e,t,1),a=new Date(e,t+1,0).getDate(),i=n.getDay(),o=[];let l=[];for(let c=0;c<i;c++)l.push(null);for(let c=1;c<=a;c++)l.push(new Date(e,t,c)),l.length===7&&(o.push(l),l=[]);if(l.length>0){for(;l.length<7;)l.push(null);o.push(l)}return o}const nE=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Im=["January","February","March","April","May","June","July","August","September","October","November","December"];function rE({entries:e,selectedDate:t,onSelectDate:n,disabled:r=!1}){const a=new Date,[i,o]=f.useState(a.getFullYear()),[l,c]=f.useState(a.getMonth()),u=f.useMemo(()=>{const g={};return e.forEach(w=>{const p=w.entry_date;g[p]||(g[p]=[]),g[p].push(w)}),g},[e]),d=f.useMemo(()=>tE(i,l),[i,l]),m=()=>{l===0?(c(11),o(i-1)):c(l-1)},h=()=>{l===11?(c(0),o(i+1)):c(l+1)},b=()=>{o(a.getFullYear()),c(a.getMonth()),n(_c(a))},y=_c(a);return s.jsxs("div",{className:"journal-calendar",children:[s.jsxs("div",{className:"journal-calendar__header",children:[s.jsx("button",{type:"button",className:"journal-calendar__nav-btn",onClick:m,disabled:r,"aria-label":"Previous month",children:"←"}),s.jsxs("div",{className:"journal-calendar__title",children:[s.jsx("span",{className:"journal-calendar__month",children:Im[l]}),s.jsx("span",{className:"journal-calendar__year",children:i})]}),s.jsx("button",{type:"button",className:"journal-calendar__nav-btn",onClick:h,disabled:r,"aria-label":"Next month",children:"→"})]}),s.jsx("button",{type:"button",className:"journal-calendar__today-btn",onClick:b,disabled:r,children:"Today"}),s.jsxs("table",{className:"journal-calendar__grid",role:"grid",children:[s.jsx("thead",{children:s.jsx("tr",{children:nE.map(g=>s.jsx("th",{scope:"col",className:"journal-calendar__weekday",children:g},g))})}),s.jsx("tbody",{children:d.map((g,w)=>s.jsx("tr",{children:g.map((p,_)=>{if(!p)return s.jsx("td",{className:"journal-calendar__cell journal-calendar__cell--empty"},_);const v=_c(p),x=u[v]||[],j=x.length>0,k=v===y,S=v===t;return s.jsx("td",{className:"journal-calendar__cell",children:s.jsxs("button",{type:"button",className:`journal-calendar__day ${k?"journal-calendar__day--today":""} ${S?"journal-calendar__day--selected":""} ${j?"journal-calendar__day--has-entries":""}`,onClick:()=>n(v),disabled:r,"aria-label":`${p.getDate()} ${Im[l]} ${i}${j?`, ${x.length} journal entr${x.length===1?"y":"ies"}`:""}`,"aria-pressed":S,children:[s.jsx("span",{className:"journal-calendar__day-number",children:p.getDate()}),j&&s.jsxs("div",{className:"journal-calendar__dots",children:[x.slice(0,4).map((A,P)=>s.jsx("span",{className:"journal-calendar__dot",style:{backgroundColor:A.mood?ZN(A.mood):eE(A.type)},title:`${A.type||"standard"}${A.mood?` - ${A.mood}`:""}`},A.id)),x.length>4&&s.jsxs("span",{className:"journal-calendar__dot-more",children:["+",x.length-4]})]})]})},_)})},w))})]}),s.jsxs("div",{className:"journal-calendar__legend",children:[s.jsx("span",{className:"journal-calendar__legend-title",children:"Journal types:"}),s.jsxs("div",{className:"journal-calendar__legend-items",children:[s.jsxs("span",{className:"journal-calendar__legend-item",children:[s.jsx("span",{className:"journal-calendar__legend-dot",style:{backgroundColor:"#22c55e"}}),"Quick"]}),s.jsxs("span",{className:"journal-calendar__legend-item",children:[s.jsx("span",{className:"journal-calendar__legend-dot",style:{backgroundColor:"#8b5cf6"}}),"Deep"]}),s.jsxs("span",{className:"journal-calendar__legend-item",children:[s.jsx("span",{className:"journal-calendar__legend-dot",style:{backgroundColor:"var(--color-primary, #0ea5e9)"}}),"Standard"]})]})]})]})}const sE=new Intl.DateTimeFormat(void 0,{day:"numeric",month:"short",year:"numeric"}),aE=new Intl.DateTimeFormat(void 0,{day:"numeric",month:"long",year:"numeric"}),zu=new Intl.DateTimeFormat(void 0,{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric"});function Pm(e){return e.type!=="time_capsule"||!e.unlock_date?!1:new Date(e.unlock_date)>new Date}function iE(e){return e==null?null:e<=3?"sad":e<=5?"stressed":e<=7?"neutral":e<=9?"happy":"excited"}const oE={quick:"Today's thoughts (aim for ~3 sentences)",goal:"Reflection on this goal",time_capsule:"Message to your future self",life_wheel:"Reflect on this area of your life",brain_dump:"Brain dump your thoughts",secret:"Secret thoughts (not saved)",deep:"Full entry",standard:"Content"},lE={quick:"Quick capture of your day...",goal:"Reflect on your progress, challenges, and insights related to this goal...",time_capsule:"Write a message to your future self. What do you want to remember? What are you hoping for?",life_wheel:"Write about how this area has felt recently...",brain_dump:"Write freely without stopping. Let your thoughts flow...",secret:"Write anything you need to get off your chest. It will disappear...",deep:"Write deeply and thoughtfully. Take your time to explore your thoughts...",standard:"Capture what unfolded, how you felt, and any momentum you want to carry forward."},cE={quick:"Quick",deep:"Deep",brain_dump:"Brain Dump",life_wheel:"Life Wheel",secret:"Secret",goal:"Goal",time_capsule:"Time Capsule",standard:"Standard"};function uE(e){return cE[e??"standard"]??"Standard"}function dE(e){return oE[e??"standard"]??"Content"}function hE(e){return lE[e??"standard"]??"Enter your content..."}function fE(e){const[t,n,r]=e.split("-").map(Number);return new Date(t,n-1,r)}function Rm(e,t=140){const n=e.replace(/\s+/g," ").trim();return n.length<=t?n:`${n.slice(0,t)}…`}function mE({entries:e,filteredEntries:t,selectedEntryId:n,searchQuery:r,onSearchChange:a,selectedTag:i,onSelectTag:o,availableTags:l,loading:c,disabled:u=!1,isCollapsed:d=!1,emptyStateMessage:m,getMoodMeta:h,onSelectEntry:b,isEntryLocked:y}){const[g,w]=f.useState("calendar"),[p,_]=f.useState(null),v=p?t.filter(j=>j.entry_date===p):[],x=j=>{_(j);const k=t.filter(S=>S.entry_date===j);k.length>0&&b(k[0].id)};return s.jsxs("aside",{className:`journal-list ${d?"journal-list--collapsed":""}`,children:[s.jsxs("div",{className:"journal-list__view-toggle",children:[s.jsx("button",{type:"button",className:`journal-list__view-btn ${g==="calendar"?"journal-list__view-btn--active":""}`,onClick:()=>w("calendar"),"aria-pressed":g==="calendar",disabled:u,children:"📅 Calendar"}),s.jsx("button",{type:"button",className:`journal-list__view-btn ${g==="list"?"journal-list__view-btn--active":""}`,onClick:()=>w("list"),"aria-pressed":g==="list",disabled:u,children:"📋 List"})]}),s.jsxs("div",{className:"journal-list__filters",children:[s.jsxs("label",{className:"journal-list__filter",children:[s.jsx("span",{className:"sr-only",children:"Search entries"}),s.jsx("input",{type:"search",placeholder:"Search your journal…",value:r,onChange:j=>a(j.target.value),disabled:u})]}),s.jsxs("label",{className:"journal-list__filter",children:[s.jsx("span",{className:"sr-only",children:"Filter by tag"}),s.jsxs("select",{value:i??"",onChange:j=>o(j.target.value?j.target.value:null),disabled:u||l.length===0,children:[s.jsx("option",{value:"",children:"All tags"}),l.map(j=>s.jsxs("option",{value:j,children:["#",j]},j))]})]})]}),g==="calendar"?s.jsxs("div",{className:"journal-list__calendar-view",children:[s.jsx(rE,{entries:t,selectedDate:p,onSelectDate:x,disabled:u}),p&&s.jsxs("div",{className:"journal-list__date-entries",children:[s.jsxs("h4",{className:"journal-list__date-heading",children:[fE(p).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"}),v.length>0&&s.jsxs("span",{className:"journal-list__date-count",children:[v.length," entr",v.length===1?"y":"ies"]})]}),v.length===0?s.jsx("p",{className:"journal-list__date-empty",children:"No entries on this date"}):s.jsx("ul",{className:"journal-list__date-items",children:v.map(j=>{var P;const k=j.id===n,S=h(j.mood),A=y(j);return s.jsx("li",{children:s.jsxs("button",{type:"button",className:`journal-list__item ${k?"journal-list__item--active":""}`,onClick:()=>b(j.id),disabled:u,children:[s.jsxs("div",{className:"journal-list__item-meta",children:[S?s.jsx("span",{className:"journal-list__item-mood",children:S.icon}):null,j.type&&j.type!=="standard"&&s.jsx("span",{className:"journal-list__item-type",children:j.type})]}),s.jsx("strong",{children:((P=j.title)==null?void 0:P.trim())||"Untitled"}),A&&j.unlock_date?s.jsxs("p",{children:["🔒 Locked until ",zu.format(new Date(j.unlock_date))]}):s.jsx("p",{children:Rm(j.content)})]})},j.id)})})]})]}):s.jsxs("div",{className:"journal-list__body",children:[c?s.jsx("p",{className:"journal-list__status",children:"Loading entries…"}):null,!c&&t.length===0?s.jsx("p",{className:"journal-list__status",children:m}):null,s.jsx("ul",{className:"journal-list__items",children:t.map(j=>{var P;const k=j.id===n,S=h(j.mood),A=y(j);return s.jsx("li",{children:s.jsxs("button",{type:"button",className:`journal-list__item ${k?"journal-list__item--active":""}`,onClick:()=>b(j.id),disabled:u,children:[s.jsxs("div",{className:"journal-list__item-meta",children:[s.jsx("span",{children:sE.format(new Date(j.entry_date))}),S?s.jsx("span",{className:"journal-list__item-mood",children:S.icon}):null]}),s.jsx("strong",{children:((P=j.title)==null?void 0:P.trim())||"Untitled"}),A&&j.unlock_date?s.jsxs("p",{children:["🔒 Locked until ",zu.format(new Date(j.unlock_date))]}):s.jsx("p",{children:Rm(j.content)})]})},j.id)})})]}),s.jsx("footer",{className:"journal-list__footer",children:s.jsxs("small",{children:["Showing ",t.length," of ",e.length," entr",e.length===1?"y":"ies"]})})]})}function pE({entry:e,getMoodMeta:t,goalMap:n,habitMap:r,onEdit:a,onDelete:i,showBackButton:o=!1,onBack:l,onNavigateToGoal:c,onNavigateToHabit:u,disabled:d=!1,unavailableMessage:m,isLocked:h}){var k,S;if(!e)return s.jsx("section",{className:"journal-detail",children:s.jsxs("div",{className:"journal-detail__empty",children:[m?s.jsx("p",{children:m}):null,s.jsx("p",{children:"Select an entry from the left, or create a new one to start journaling."})]})});const b=t(e.mood),y=((k=e.tags)==null?void 0:k.filter(Boolean))??[],g=e.linked_goal_ids??[],w=e.linked_habit_ids??[],p=e.type==="goal",_=e.type==="life_wheel",v=e.goal_id??null,x=(v&&n[v])??null,j=e.content.split(/\n+/).map(A=>A.trim()).filter(Boolean);return s.jsxs("section",{className:"journal-detail",children:[o?s.jsx("button",{type:"button",className:"journal-detail__back",onClick:()=>l==null?void 0:l(),children:"← Back to entries"}):null,s.jsxs("header",{className:"journal-detail__header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"journal-detail__date",children:aE.format(new Date(e.entry_date))}),s.jsx("h2",{children:((S=e.title)==null?void 0:S.trim())||"Untitled entry"}),b?s.jsxs("span",{className:"journal-detail__mood",children:[b.icon," ",b.label]}):null]}),s.jsxs("div",{className:"journal-detail__actions",children:[s.jsx("button",{type:"button",onClick:a,disabled:d,children:"Edit"}),s.jsx("button",{type:"button",className:"journal-detail__delete",onClick:i,disabled:d,children:"Delete"})]})]}),_&&e.category?s.jsxs("div",{className:"journal-detail__metadata",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Life area:"})," ",e.category]}),e.mood_score!==null&&e.mood_score!==void 0?s.jsxs("p",{children:[s.jsx("strong",{children:"Satisfaction:"})," ",e.mood_score,"/10"]}):null]}):null,y.length?s.jsx("ul",{className:"journal-detail__tags",children:y.map(A=>s.jsxs("li",{children:["#",A]},A))}):null,h&&e.unlock_date?s.jsxs("div",{className:"journal-detail__locked",children:[s.jsx("h3",{children:"🔒 Time capsule locked"}),s.jsxs("p",{children:["This time capsule will unlock on ",zu.format(new Date(e.unlock_date)),"."]}),s.jsx("p",{children:"Come back then to read your message to your future self."})]}):s.jsx("article",{className:"journal-detail__content",children:j.length?j.map((A,P)=>s.jsx("p",{children:A},`${e.id}-p-${P}`)):s.jsx("p",{className:"journal-detail__placeholder",children:"This entry is waiting for words."})}),p&&x&&v?s.jsxs("div",{className:"journal-detail__links",children:[s.jsx("h3",{children:"Primary goal"}),s.jsx("div",{className:"journal-detail__chips",children:s.jsx("button",{type:"button",onClick:()=>c==null?void 0:c(v),disabled:d,children:x.title})})]}):null,g.length?s.jsxs("div",{className:"journal-detail__links",children:[s.jsx("h3",{children:"Linked goals"}),s.jsx("div",{className:"journal-detail__chips",children:g.map(A=>{var P;return s.jsx("button",{type:"button",onClick:()=>c==null?void 0:c(A),disabled:d,children:((P=n[A])==null?void 0:P.title)??"View goal"},A)})})]}):null,w.length?s.jsxs("div",{className:"journal-detail__links",children:[s.jsx("h3",{children:"Linked habits"}),s.jsx("div",{className:"journal-detail__chips",children:w.map(A=>{var P;return s.jsx("button",{type:"button",onClick:()=>u==null?void 0:u(A),disabled:d,children:((P=r[A])==null?void 0:P.title)??"View habit"},A)})})]}):null]})}const Bu=60,gE=10,_E="Sorry, unable to generate reflection at this time. Please try again.",to=30,yE=()=>new Date().toISOString().slice(0,10),Om=["What's one thing you're grateful for today?","What made you smile today?","What challenged you today, and how did you handle it?","What's something you learned today?","What's one thing you're looking forward to tomorrow?","Describe your energy level today and what influenced it.","What's one small win you had today?","What's on your mind right now?"],bE=["Career & Mission","Health & Vitality","Relationships & Community","Personal Growth","Fun & Adventure","Mindset & Clarity","Finances & Wealth","Environment & Surroundings"],no=5;function vE(){return Om[Math.floor(Math.random()*Om.length)]}function wE(e){return Math.max((Bu-e)/gE,0)}function Lm(e,t){return{id:e==null?void 0:e.id,entryDate:(e==null?void 0:e.entry_date)??yE(),title:(e==null?void 0:e.title)??"",content:(e==null?void 0:e.content)??"",mood:(e==null?void 0:e.mood)??null,tags:e!=null&&e.tags?[...e.tags]:[],linkedGoalIds:e!=null&&e.linked_goal_ids?[...e.linked_goal_ids]:[],linkedHabitIds:e!=null&&e.linked_habit_ids?[...e.linked_habit_ids]:[],type:(e==null?void 0:e.type)??t??es,moodScore:(e==null?void 0:e.mood_score)??null,category:(e==null?void 0:e.category)??null,unlockDate:(e==null?void 0:e.unlock_date)??null,goalId:(e==null?void 0:e.goal_id)??null}}async function xE(e){return e.trim()?"AI reflection placeholder: this is where insights about your brain dump would appear.":"No content to analyze yet."}function jE({open:e,mode:t,entry:n,goals:r,habits:a,moodOptions:i,saving:o,error:l,journalType:c,onClose:u,onSave:d}){const m=f.useId(),[h,b]=f.useState(Lm(n,c)),[y,g]=f.useState(""),[w,p]=f.useState(Bu),[_,v]=f.useState(!1),[x,j]=f.useState(null),[k,S]=f.useState(""),[A,P]=f.useState(to),[R,q]=f.useState(!1),O=f.useRef(null),[oe,z]=f.useState(!1);f.useEffect(()=>{e&&(b(Lm(n,c)),g(""),p(Bu),v(!1),j(null),c==="secret"&&(S(""),P(to),q(!1)))},[n,e,c]),f.useEffect(()=>{if(!e||h.type!=="brain_dump"||_)return;const W=setInterval(()=>{p(_e=>_e<=1?(v(!0),0):_e-1)},1e3);return()=>clearInterval(W)},[e,h.type,_]),f.useEffect(()=>{if(!e||h.type!=="secret"||A<=0)return;const W=setInterval(()=>{P(_e=>_e<=1?0:_e-1)},1e3);return()=>clearInterval(W)},[e,h.type,A]),f.useEffect(()=>{if(!e||h.type!=="secret"||A!==0)return;q(!0);const W=setTimeout(()=>{S(""),q(!1),P(to)},500);return()=>clearTimeout(W)},[e,h.type,A]);const ne=h.mood??"",Z=f.useMemo(()=>[...r].sort((W,_e)=>W.title.localeCompare(_e.title)),[r]),I=f.useMemo(()=>[...a].sort((W,_e)=>W.title.localeCompare(_e.title)),[a]),C=W=>{W.split(",").map(_e=>_e.trim()).filter(Boolean).forEach(_e=>{b($e=>$e.tags.includes(_e)?$e:{...$e,tags:[...$e.tags,_e]})})},L=W=>{const _e=W.target.value;if(_e.includes(",")){C(_e);const $e=_e.split(",");g($e[$e.length-1].trimStart());return}g(_e)},K=W=>{W.key==="Enter"||W.key==="Tab"?y.trim()&&(W.preventDefault(),C(y),g("")):W.key==="Backspace"&&!y&&b(_e=>({..._e,tags:_e.tags.slice(0,-1)}))},ue=()=>{y.trim()&&(C(y),g(""))},de=W=>{b(_e=>({..._e,tags:_e.tags.filter($e=>$e!==W)}))},De=W=>{if(W.preventDefault(),M){u();return}d(h)},fe=(W,_e)=>{b($e=>({...$e,[W]:_e}))},H=W=>{const _e=Array.from(W.target.selectedOptions).map($e=>$e.value);b($e=>({...$e,linkedGoalIds:_e}))},we=W=>{const _e=Array.from(W.target.selectedOptions).map($e=>$e.value);b($e=>({...$e,linkedHabitIds:_e}))},B=W=>{b(_e=>({..._e,moodScore:W,mood:iE(W)}))},D=W=>{b(_e=>({..._e,moodScore:W}))},ae=()=>{const _e=`${vE()}
`;b($e=>({...$e,content:$e.content?`${$e.content}

${_e}`:_e}))},G=W=>{const _e=W.target.value;b($e=>({...$e,goalId:_e||null}))},ye=async()=>{try{const W=await xE(h.content);j(W)}catch{j(_E)}},Se=()=>{O.current&&clearTimeout(O.current),q(!0),O.current=setTimeout(()=>{S(""),q(!1),P(to),O.current=null},500)},Te=W=>{S(W.target.value)},E=h.type==="quick",T=h.type==="goal",U=h.type==="time_capsule",J=h.type==="life_wheel",le=h.type==="brain_dump",M=h.type==="secret",re=h.type==="deep",me=f.useMemo(()=>le?wE(w):0,[le,w]),Pe=()=>M?s.jsx("div",{className:"journal-secret__notice",children:s.jsxs("p",{className:"journal-secret__notice-text",children:["🔒 ",s.jsx("strong",{children:"Secret mode:"})," Nothing you write here is saved. It will self-destruct."]})}):null,Ue=()=>M?s.jsxs("div",{className:"journal-secret__timer",children:[s.jsxs("span",{className:"journal-secret__timer-label","aria-live":"polite",children:["Self-destruct in: ",A,"s"]}),s.jsx("button",{type:"button",className:"journal-secret__destroy-button",onClick:Se,"aria-label":"Destroy secret text now",children:"🔥 Destroy now"})]}):null,Ae=()=>E?s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Mood score (1-10)"}),s.jsx("input",{type:"range",min:"1",max:"10",value:h.moodScore??no,onChange:W=>B(Number(W.target.value)),className:"journal-editor__mood-slider"}),s.jsxs("div",{className:"journal-editor__mood-value",children:[h.moodScore??no," / 10",h.mood&&(()=>{const W=i.find(_e=>_e.value===h.mood);return W?` (${W.icon} ${W.label})`:""})()]})]}):null,Re=()=>E?s.jsx("div",{className:"journal-editor__quick-actions",children:s.jsx("button",{type:"button",className:"journal-editor__prompt-button",onClick:ae,children:"✨ Use a prompt"})}):null,pt=()=>re?s.jsx("div",{className:"journal-deep-mode__actions",children:s.jsx("button",{type:"button",className:"journal-deep-mode__focus-button",onClick:()=>z(!oe),"aria-label":oe?"Exit focus mode":"Enter focus mode",children:oe?"Exit focus mode":"Enter focus mode"})}):null,Et=()=>le?s.jsxs("div",{className:"journal-brain-dump__timer",children:[s.jsxs("span",{className:"journal-brain-dump__timer-label","aria-live":"polite",children:["Time left: ",w,"s"]}),_&&s.jsx("span",{className:"journal-brain-dump__timer-complete",children:"Time's up! ✅"})]}):null,Ar=()=>le&&_?s.jsx("div",{className:"journal-brain-dump__reflect",children:x?s.jsxs("div",{className:"journal-brain-dump__analysis",children:[s.jsx("h4",{className:"journal-brain-dump__analysis-title",children:"AI Reflection"}),s.jsx("p",{className:"journal-brain-dump__analysis-content",children:x})]}):s.jsx("button",{type:"button",className:"journal-brain-dump__reflect-button",onClick:ye,"aria-label":"Reflect on my brain dump",children:"🧠 Reflect on my brain dump"})}):null,qe=()=>J?s.jsxs(s.Fragment,{children:[s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Life area"}),s.jsxs("select",{value:h.category??"",onChange:W=>b(_e=>({..._e,category:W.target.value})),required:!0,children:[s.jsx("option",{value:"",children:"Select a life area…"}),bE.map(W=>s.jsx("option",{value:W,children:W},W))]})]}),s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Satisfaction level (1-10)"}),s.jsx("input",{type:"range",min:"1",max:"10",value:h.moodScore??no,onChange:W=>D(Number(W.target.value)),className:"journal-editor__mood-slider"}),s.jsxs("div",{className:"journal-editor__mood-value",children:[h.moodScore??no," / 10"]})]})]}):null,dn=()=>T?s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Link to goal"}),s.jsxs("select",{value:h.goalId??"",onChange:G,"aria-label":"Select a goal to reflect on",children:[s.jsx("option",{value:"",children:"Select a goal…"}),Z.map(W=>s.jsx("option",{value:W.id,children:W.title},W.id))]})]}):null,bn=()=>U?s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Unlock date"}),s.jsx("input",{type:"datetime-local",value:h.unlockDate??"",onChange:W=>b(_e=>({..._e,unlockDate:W.target.value})),required:!0})]}):null;return e?s.jsxs("div",{className:`journal-editor ${oe?"journal-editor--fullscreen":""}`,role:"dialog","aria-modal":"true","aria-labelledby":m,children:[s.jsx("div",{className:"journal-editor__backdrop",onClick:u}),s.jsxs("div",{className:"journal-editor__panel",role:"document",onClick:W=>W.stopPropagation(),children:[s.jsxs("header",{className:"journal-editor__header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"journal-editor__eyebrow",children:"Private journal"}),s.jsx("h2",{id:m,children:t==="create"?"New entry":"Edit entry"}),h.type&&s.jsxs("p",{className:"journal-editor__mode-label",children:["Mode: ",uE(h.type)]})]}),s.jsx("button",{type:"button",className:"journal-editor__close",onClick:oe?()=>z(!1):u,children:oe?"← Exit focus":"Close"})]}),s.jsxs("form",{className:"journal-editor__form",onSubmit:De,children:[Pe(),Ue(),!M&&s.jsxs("div",{className:"journal-editor__grid",children:[s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Entry date"}),s.jsx("input",{type:"date",value:h.entryDate,onChange:W=>fe("entryDate",W.target.value),required:!0})]}),bn(),Ae(),!U&&!E&&s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Mood"}),s.jsxs("select",{value:ne,onChange:W=>fe("mood",W.target.value),children:[s.jsx("option",{value:"",children:"No mood selected"}),i.map(W=>s.jsxs("option",{value:W.value,children:[W.icon," ",W.label]},W.value))]})]})]}),dn(),qe(),!M&&!E&&!T&&!U&&!J&&!le&&s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Title"}),s.jsx("input",{type:"text",value:h.title,onChange:W=>fe("title",W.target.value),placeholder:"Optional headline"})]}),Et(),pt(),s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:dE(h.type)}),s.jsx("textarea",{value:M?k:h.content,onChange:M?Te:W=>fe("content",W.target.value),rows:E?4:re?14:8,required:!M,placeholder:hE(h.type),readOnly:le&&_,className:M&&R?"journal-secret__textarea--fading":void 0,style:le?{filter:`blur(${me}px)`,transition:"filter 0.3s"}:void 0})]}),Ar(),Re(),!M&&!E&&!U&&!J&&!le&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"journal-editor__field",children:[s.jsx("span",{children:"Tags"}),s.jsx("input",{type:"text",value:y,onChange:L,onKeyDown:K,onBlur:ue,placeholder:"Add tags separated by commas"}),h.tags.length>0?s.jsx("ul",{className:"journal-editor__tags",children:h.tags.map(W=>s.jsxs("li",{children:[s.jsx("span",{children:W}),s.jsx("button",{type:"button",onClick:()=>de(W),"aria-label":`Remove tag ${W}`,children:"×"})]},W))}):s.jsx("p",{className:"journal-editor__hint",children:"Use tags like mood, project, or ritual to organize entries."})]}),!T&&s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Linked goals"}),s.jsx("select",{multiple:!0,value:h.linkedGoalIds,onChange:H,children:Z.map(W=>s.jsx("option",{value:W.id,children:W.title},W.id))}),s.jsx("p",{className:"journal-editor__hint",children:"Hold Cmd/Ctrl to select multiple goals."})]}),s.jsxs("label",{className:"journal-editor__field",children:[s.jsx("span",{children:"Linked habits"}),s.jsx("select",{multiple:!0,value:h.linkedHabitIds,onChange:we,children:I.map(W=>s.jsx("option",{value:W.id,children:W.title},W.id))})]})]}),l?s.jsx("p",{className:"journal-editor__status journal-editor__status--error",children:l}):null,s.jsxs("div",{className:"journal-editor__actions",children:[s.jsx("button",{type:"button",className:"journal-editor__cancel",onClick:u,children:"Cancel"}),s.jsx("button",{type:"submit",className:"journal-editor__save",disabled:o,children:M?"Done":o?"Saving…":"Save entry"})]})]})]})]}):null}const kE=[{value:"standard",label:"Standard"},{value:"quick",label:"Quick"},{value:"deep",label:"Deep"},{value:"brain_dump",label:"Brain Dump"},{value:"life_wheel",label:"Life Wheel"},{value:"secret",label:"Secret"},{value:"goal",label:"Goal"},{value:"time_capsule",label:"Time Capsule"}];function SE({journalType:e,onChange:t}){const n=f.useId();return s.jsx("div",{className:"journal-mode-selector",role:"radiogroup","aria-label":"Journal mode",children:kE.map(r=>{const a=`${n}-${r.value}`;return s.jsxs("label",{htmlFor:a,className:"journal-mode-selector__option",children:[s.jsx("input",{type:"radio",id:a,name:"journal-mode",value:r.value,checked:e===r.value,onChange:i=>t(i.target.value),className:"journal-mode-selector__radio","aria-labelledby":a}),s.jsx("span",{id:a,className:"journal-mode-selector__label",children:r.label})]},r.value)})})}const $m=[{value:"happy",label:"Happy",icon:"🙂"},{value:"neutral",label:"Neutral",icon:"😐"},{value:"sad",label:"Sad",icon:"🙁"},{value:"stressed",label:"Stressed",icon:"😰"},{value:"excited",label:"Excited",icon:"🤩"}];function ro(e){return[...e].sort((t,n)=>{const r=n.entry_date.localeCompare(t.entry_date);if(r!==0)return r;const a=t.created_at??"";return(n.created_at??"").localeCompare(a)})}function NE({session:e,onNavigateToGoals:t,onNavigateToHabits:n}){const{isConfigured:r}=Pn(),a=un(e),i=!r&&!a,o=Qd("(max-width: 960px)"),[l,c]=f.useState(es),[u,d]=f.useState([]),[m,h]=f.useState(null),[b,y]=f.useState(""),[g,w]=f.useState(null),[p,_]=f.useState(!1),[v,x]=f.useState(null),[j,k]=f.useState(null),[S,A]=f.useState(!1),[P,R]=f.useState("create"),[q,O]=f.useState(null),[oe,z]=f.useState(!1),[ne,Z]=f.useState(null),[I,C]=f.useState(!1),[L,K]=f.useState([]),[ue,de]=f.useState([]),[De,fe]=f.useState(!o);f.useEffect(()=>{fe(!o)},[o]),f.useEffect(()=>{if(!j)return;const M=window.setTimeout(()=>k(null),4e3);return()=>window.clearTimeout(M)},[j]);const H=f.useCallback(async()=>{if(!e||i){d([]),h(null);return}_(!0),x(null);try{const{data:M,error:re}=await sS({limit:250});if(re)throw new Error(re.message);const me=ro(M??[]);d(me),h(Pe=>{var Ue;return Pe&&me.some(Ae=>Ae.id===Pe)?Pe:((Ue=me[0])==null?void 0:Ue.id)??null}),me.length===0&&o&&fe(!1)}catch(M){x(M instanceof Error?M.message:"Unable to load your journal entries right now.")}finally{_(!1)}},[e,i,o]);f.useEffect(()=>{H()},[H]),f.useEffect(()=>{if(!e||i){K([]);return}xl().then(({data:M})=>{K(M??[])})},[e,i]),f.useEffect(()=>{if(!e||i){de([]);return}bi().then(({data:M})=>{de(M??[])})},[e,i]);const we=f.useMemo(()=>{const M=new Set;return u.forEach(re=>{var me;(me=re.tags)==null||me.forEach(Pe=>{Pe&&M.add(Pe)})}),Array.from(M).sort((re,me)=>re.localeCompare(me))},[u]),B=f.useMemo(()=>{const M=b.trim().toLowerCase();return u.filter(re=>{var me;return!(g&&!((me=re.tags)!=null&&me.includes(g))||M&&!`${re.title??""} ${re.content}`.toLowerCase().includes(M))})},[u,b,g]);f.useEffect(()=>{if(!B.length){h(null),o&&fe(!1);return}h(M=>M&&B.some(re=>re.id===M)?M:B[0].id)},[B,o]);const D=B.find(M=>M.id===m)??null,ae=f.useMemo(()=>{const M={};return L.forEach(re=>{M[re.id]=re}),M},[L]),G=f.useMemo(()=>{const M={};return ue.forEach(re=>{M[re.id]=re}),M},[ue]),ye=f.useCallback(M=>$m.find(re=>re.value===M),[]),Se=M=>{h(M),o&&fe(!0)},Te=(M,re)=>{R(M),Z(re),O(null),A(!0)},E=async M=>{if(!M.content.trim()){O("Write a few lines before saving.");return}z(!0),O(null);try{const re={entry_date:M.entryDate,title:M.title.trim()?M.title.trim():null,content:M.content.trim(),mood:M.mood??null,tags:M.tags.length?M.tags:null,linked_goal_ids:M.linkedGoalIds.length?M.linkedGoalIds:null,linked_habit_ids:M.linkedHabitIds.length?M.linkedHabitIds:null,is_private:!0,type:M.type??es,mood_score:M.moodScore??null,category:M.category??null,unlock_date:M.unlockDate??null,goal_id:M.goalId??null};let me=null;if(P==="create"){const Pe={...re,user_id:e.user.id},{data:Ue,error:Ae}=await Ru(Pe);if(Ae||!Ue)throw new Error((Ae==null?void 0:Ae.message)??"Unable to save the entry.");me=Ue,d(Re=>ro([Ue,...Re]))}else if(ne){const Pe=re,{data:Ue,error:Ae}=await aS(ne.id,Pe);if(Ae||!Ue)throw new Error((Ae==null?void 0:Ae.message)??"Unable to update the entry.");me=Ue,d(Re=>ro(Re.map(pt=>pt.id===Ue.id?Ue:pt)))}me&&(h(me.id),k({kind:"success",message:P==="create"?"Entry saved.":"Entry updated."}),A(!1),o&&fe(!0))}catch(re){O(re instanceof Error?re.message:"Unable to save your entry right now.")}finally{z(!1)}},T=async()=>{if(!(!D||!window.confirm("Delete this journal entry? This action cannot be undone."))){C(!0),k(null);try{const{error:re}=await iS(D.id);if(re)throw new Error(re.message);let me=[];d(Pe=>{const Ue=ro(Pe.filter(Ae=>Ae.id!==D.id));return me=Ue,Ue}),h(Pe=>{var Ue;return Pe===D.id?((Ue=me[0])==null?void 0:Ue.id)??null:Pe}),o&&me.length===0&&fe(!1),k({kind:"success",message:"Entry deleted."})}catch(re){k({kind:"error",message:re instanceof Error?re.message:"Unable to delete the entry."})}finally{C(!1)}}},U=M=>{var re,me;(me=(re=window.__LifeGoalAppDebugger)==null?void 0:re.log)==null||me.call(re,"journal-goal-link",{goalId:M}),t==null||t()},J=M=>{var re,me;(me=(re=window.__LifeGoalAppDebugger)==null?void 0:re.log)==null||me.call(re,"journal-habit-link",{habitId:M}),n==null||n()},le=i?"Connect Supabase or open the demo workspace to unlock your private journal.":u.length===0&&!b&&!g?"No entries yet. Create your first reflection to begin.":"No entries match your filters right now.";return s.jsxs("section",{className:"journal",children:[s.jsxs("header",{className:"journal__header",children:[s.jsxs("div",{children:[s.jsx("p",{className:"journal__eyebrow",children:"Daily reflections"}),s.jsx("h1",{children:"Journal"})]}),s.jsxs("div",{className:"journal__header-actions",children:[s.jsx(SE,{journalType:l,onChange:c}),s.jsx("button",{type:"button",className:"journal__new",onClick:()=>Te("create",null),disabled:i,children:"+ New entry"})]})]}),i?s.jsx("p",{className:"journal__banner",children:"Add your Supabase credentials or launch the demo workspace to save private journal entries."}):null,j?s.jsx("p",{className:`journal__status journal__status--${j.kind}`,children:j.message}):null,v?s.jsx("p",{className:"journal__status journal__status--error",children:v}):null,s.jsxs("div",{className:"journal__layout",children:[s.jsx("div",{className:`journal__column journal__column--list ${o&&De?"journal__column--hidden":""}`,children:s.jsx(mE,{entries:u,filteredEntries:B,selectedEntryId:m,searchQuery:b,onSearchChange:y,selectedTag:g,onSelectTag:w,availableTags:we,loading:p,disabled:i,isCollapsed:o&&De,emptyStateMessage:le,getMoodMeta:ye,onSelectEntry:Se,isEntryLocked:Pm})}),s.jsx("div",{className:`journal__column journal__column--detail ${o&&!De?"journal__column--hidden":""}`,children:s.jsx(pE,{entry:D,getMoodMeta:ye,goalMap:ae,habitMap:G,onEdit:()=>Te("edit",D),onDelete:T,showBackButton:o,onBack:()=>fe(!1),onNavigateToGoal:U,onNavigateToHabit:J,disabled:i||I,unavailableMessage:i?le:null,isLocked:D?Pm(D):!1})})]}),s.jsx(jE,{open:S,mode:P,entry:P==="edit"?ne:null,goals:L,habits:ue,moodOptions:$m,saving:oe,error:q,journalType:l,onClose:()=>A(!1),onSave:E})]})}f.createContext(null);function EE({isOpen:e,onClose:t,sessionTitle:n,durationSeconds:r,onComplete:a}){const[i,o]=f.useState(r),[l,c]=f.useState(!1),[u,d]=f.useState("inhale");if(f.useEffect(()=>{e||(o(r),c(!1),d("inhale"))},[e,r]),f.useEffect(()=>{if(!l||i<=0)return;const _=setInterval(()=>{o(v=>v<=1?(c(!1),a(),0):v-1)},1e3);return()=>clearInterval(_)},[l,i,a]),f.useEffect(()=>{if(!l)return;const _=setInterval(()=>{d(v=>v==="inhale"?"hold":v==="hold"?"exhale":"inhale")},u==="inhale"?4e3:u==="hold"?2e3:6e3);return()=>clearInterval(_)},[l,u]),!e)return null;const m=Math.floor(i/60),h=i%60,b=(r-i)/r*100,y=()=>{c(!0)},g=()=>{c(!1)},w=()=>{c(!1),t()},p={inhale:"Breathe In",hold:"Hold",exhale:"Breathe Out"};return s.jsx("div",{className:"meditation-modal-overlay",onClick:w,children:s.jsxs("div",{className:"meditation-modal",onClick:_=>_.stopPropagation(),children:[s.jsx("button",{className:"meditation-modal__close",onClick:w,"aria-label":"Close",children:"×"}),s.jsxs("div",{className:"meditation-modal__content",children:[s.jsx("h2",{className:"meditation-modal__title",children:n}),s.jsx("div",{className:"meditation-breathing-circle",children:s.jsx("div",{className:`meditation-breathing-circle__inner meditation-breathing-circle__inner--${u}`,"aria-live":"polite","aria-atomic":"true",children:s.jsx("span",{className:"meditation-breathing-circle__text",children:p[u]})})}),s.jsxs("div",{className:"meditation-timer",children:[s.jsxs("div",{className:"meditation-timer__display",children:[String(m).padStart(2,"0"),":",String(h).padStart(2,"0")]}),s.jsx("div",{className:"meditation-timer__progress",children:s.jsx("div",{className:"meditation-timer__progress-bar",style:{width:`${b}%`}})})]}),s.jsxs("div",{className:"meditation-controls",children:[!l&&i>0&&s.jsx("button",{className:"btn btn--primary meditation-controls__button",onClick:y,children:i===r?"Start":"Resume"}),l&&s.jsx("button",{className:"btn btn--secondary meditation-controls__button",onClick:g,children:"Pause"}),i===0&&s.jsx("button",{className:"btn btn--primary meditation-controls__button",onClick:w,children:"Complete"})]})]})]})})}const Ct=[];for(let e=0;e<256;++e)Ct.push((e+256).toString(16).slice(1));function CE(e,t=0){return(Ct[e[t+0]]+Ct[e[t+1]]+Ct[e[t+2]]+Ct[e[t+3]]+"-"+Ct[e[t+4]]+Ct[e[t+5]]+"-"+Ct[e[t+6]]+Ct[e[t+7]]+"-"+Ct[e[t+8]]+Ct[e[t+9]]+"-"+Ct[e[t+10]]+Ct[e[t+11]]+Ct[e[t+12]]+Ct[e[t+13]]+Ct[e[t+14]]+Ct[e[t+15]]).toLowerCase()}let yc;const TE=new Uint8Array(16);function DE(){if(!yc){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");yc=crypto.getRandomValues.bind(crypto)}return yc(TE)}const AE=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Mm={randomUUID:AE};function IE(e,t,n){var a;e=e||{};const r=e.random??((a=e.rng)==null?void 0:a.call(e))??DE();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,CE(r)}function rl(e,t,n){return Mm.randomUUID&&!e?Mm.randomUUID():IE(e)}const Sl=new Map;function rh(e){return Sl.get(e)??null}function PE(e,t){Sl.set(e,t)}function RE(e){Sl.delete(e)}async function OE(e){if(!Ce()){const r=rh(e);return{data:r?[r]:[],error:null}}const n=await ce().from("meditation_reminders").select("*").eq("user_id",e).returns();return{data:n.data??null,error:n.error}}async function LE(e){if(!Ce()){const r=e.user_id;if(!r)return{data:null,error:new Error("user_id is required")};const a=rh(r),i={id:(a==null?void 0:a.id)??e.id??rl(),user_id:r,enabled:e.enabled??(a==null?void 0:a.enabled)??!0,time_of_day:e.time_of_day??(a==null?void 0:a.time_of_day)??"08:00",timezone:e.timezone??(a==null?void 0:a.timezone)??null,created_at:(a==null?void 0:a.created_at)??new Date().toISOString(),updated_at:new Date().toISOString()};return PE(r,i),{data:i,error:null}}const n=await ce().from("meditation_reminders").upsert(e,{onConflict:"user_id"}).select().returns().single();return{data:n.data??null,error:n.error}}async function $E(e){if(!Ce()){let r=null;for(const[a,i]of Sl.entries())if(i.id===e){r=a;break}if(r){const a=rh(r);return RE(r),{data:a,error:null}}return{data:null,error:new Error("Reminder not found")}}const n=await ce().from("meditation_reminders").delete().eq("id",e).select().returns().single();return{data:n.data??null,error:n.error}}const bc="08:00";function ME({userId:e}){const[t,n]=f.useState(!1),[r,a]=f.useState(bc),[i,o]=f.useState(null),[l,c]=f.useState(!0),[u,d]=f.useState(!1);f.useEffect(()=>{m()},[e]);const m=async()=>{c(!0);try{const y=await OE(e);if(y.error)console.error("Failed to load reminder:",y.error);else if(y.data&&y.data.length>0){const g=y.data[0];o(g.id),n(g.enabled),a(g.time_of_day)}}catch(y){console.error("Failed to load reminder:",y)}finally{c(!1)}},h=async()=>{d(!0);try{const g=await LE({user_id:e,enabled:t,time_of_day:r});g.error?(console.error("Failed to save reminder:",g.error),alert("Failed to save reminder. Please try again.")):g.data&&(o(g.data.id),alert("Reminder saved successfully!"))}catch(y){console.error("Failed to save reminder:",y),alert("Failed to save reminder. Please try again.")}finally{d(!1)}},b=async()=>{if(!i){n(!1),a(bc);return}d(!0);try{const y=await $E(i);y.error?(console.error("Failed to delete reminder:",y.error),alert("Failed to clear reminder. Please try again.")):(o(null),n(!1),a(bc),alert("Reminder cleared successfully!"))}catch(y){console.error("Failed to delete reminder:",y),alert("Failed to clear reminder. Please try again.")}finally{d(!1)}};return l?s.jsxs("div",{className:"reminder-card",children:[s.jsxs("div",{className:"reminder-card__header",children:[s.jsx("span",{className:"reminder-card__icon",children:"⏰"}),s.jsx("h3",{className:"reminder-card__title",children:"Daily Reminder"})]}),s.jsx("p",{className:"reminder-card__loading",children:"Loading..."}),s.jsx("style",{children:Um})]}):s.jsxs("div",{className:"reminder-card",children:[s.jsxs("div",{className:"reminder-card__header",children:[s.jsx("span",{className:"reminder-card__icon",children:"⏰"}),s.jsx("h3",{className:"reminder-card__title",children:"Daily Reminder"})]}),s.jsx("p",{className:"reminder-card__description",children:"Get a daily reminder to practice breathing exercises."}),s.jsxs("div",{className:"reminder-card__form",children:[s.jsx("div",{className:"reminder-card__field",children:s.jsxs("label",{className:"reminder-card__label",children:[s.jsx("input",{type:"checkbox",checked:t,onChange:y=>n(y.target.checked),className:"reminder-card__checkbox"}),"Enable daily reminder"]})}),t&&s.jsx("div",{className:"reminder-card__field",children:s.jsxs("label",{className:"reminder-card__label",children:["Reminder time",s.jsx("input",{type:"time",value:r,onChange:y=>a(y.target.value),className:"reminder-card__time-input"})]})}),s.jsxs("div",{className:"reminder-card__actions",children:[s.jsx("button",{className:"btn btn--primary reminder-card__save-button",onClick:h,disabled:u,children:u?"Saving...":"Save"}),i&&s.jsx("button",{className:"btn btn--secondary reminder-card__clear-button",onClick:b,disabled:u,children:"Clear"})]})]}),s.jsx("style",{children:Um})]})}const Um=`
  .reminder-card {
    background: var(--color-bg-elevated, #fff);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .reminder-card__header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .reminder-card__icon {
    font-size: 1.5rem;
  }

  .reminder-card__title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text-primary, #000);
  }

  .reminder-card__description {
    margin: 0 0 1.5rem 0;
    color: var(--color-text-secondary, #666);
    font-size: 0.875rem;
  }

  .reminder-card__loading {
    text-align: center;
    color: var(--color-text-secondary, #666);
    padding: 1rem;
  }

  .reminder-card__form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .reminder-card__field {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .reminder-card__label {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: var(--color-text-primary, #000);
    font-weight: 500;
  }

  .reminder-card__checkbox {
    margin-right: 0.5rem;
  }

  .reminder-card__time-input {
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
    font-family: inherit;
  }

  .reminder-card__time-input:focus {
    outline: none;
    border-color: var(--color-primary, #667eea);
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .reminder-card__actions {
    display: flex;
    gap: 0.75rem;
    margin-top: 0.5rem;
  }

  .reminder-card__save-button,
  .reminder-card__clear-button {
    flex: 1;
    padding: 0.75rem;
    font-size: 0.875rem;
  }

  .reminder-card__save-button:disabled,
  .reminder-card__clear-button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
`,wo=new Map;function ub(e){if(!wo.has(e)){new Date().toISOString().split("T")[0];const t=new Date(Date.now()-864e5).toISOString().split("T")[0];wo.set(e,[{id:rl(),user_id:e,created_at:new Date(Date.now()-864e5).toISOString(),session_date:t,session_type:"breathing",duration_seconds:180,completed:!0,notes:null},{id:rl(),user_id:e,created_at:new Date(Date.now()-1728e5).toISOString(),session_date:new Date(Date.now()-1728e5).toISOString().split("T")[0],session_type:"breathing",duration_seconds:180,completed:!0,notes:null}])}return wo.get(e)??[]}function UE(e,t){const n=ub(e);n.push(t),wo.set(e,n)}async function FE(e){if(!Ce()){const r={id:rl(),user_id:e.user_id,created_at:e.created_at??new Date().toISOString(),session_date:e.session_date??new Date().toISOString().split("T")[0],session_type:e.session_type??"breathing",duration_seconds:e.duration_seconds,completed:e.completed??!0,notes:e.notes??null};return UE(e.user_id,r),{data:r,error:null}}const n=await ce().from("meditation_sessions").insert(e).select().returns().single();return{data:n.data??null,error:n.error}}function Fm(e){let t=0;const n=new Date().toISOString().split("T")[0];let r=new Date;for(const a of e){const i=a.session_date,o=r.toISOString().split("T")[0];if(i===o||t===0&&i===n)t++,r=new Date(r.getTime()-864e5);else if(t===0&&i===new Date(Date.now()-864e5).toISOString().split("T")[0])t++,r=new Date(r.getTime()-1728e5);else break}return t}async function zE(e){if(!Ce()){const r=ub(e).filter(c=>c.completed),a=Math.round(r.reduce((c,u)=>c+u.duration_seconds,0)/60),i=r.length,o=[...r].sort((c,u)=>u.session_date.localeCompare(c.session_date)),l=Fm(o);return{data:{totalMinutes:a,totalSessions:i,currentStreak:l},error:null}}const t=ce();try{const{data:n,error:r}=await t.from("meditation_sessions").select("session_date, duration_seconds, completed").eq("user_id",e).eq("completed",!0).order("session_date",{ascending:!1});if(r)return{data:null,error:r};const a=Math.round((n??[]).reduce((l,c)=>l+c.duration_seconds,0)/60),i=(n==null?void 0:n.length)??0,o=Fm(n??[]);return{data:{totalMinutes:a,totalSessions:i,currentStreak:o},error:null}}catch(n){return{data:null,error:n instanceof Error?n:new Error("Failed to fetch meditation stats")}}}const BE=[{id:"quick-breathing",title:"3-Minute Breathing",description:"A quick breathing exercise to center yourself",duration:180,type:"breathing",icon:"🌬️"},{id:"focused-breathing",title:"5-Minute Focus",description:"Build focus with mindful breathing",duration:300,type:"breathing",icon:"🎯"},{id:"deep-relaxation",title:"10-Minute Deep Relaxation",description:"Deeply relax your mind and body",duration:600,type:"breathing",icon:"🧘"}];function qE({session:e}){const[t,n]=f.useState({totalMinutes:0,totalSessions:0,currentStreak:0}),[r,a]=f.useState(!0),[i,o]=f.useState(null),[l,c]=f.useState(!1),[u,d]=f.useState(null),[m,h]=f.useState(!1);f.useEffect(()=>{b();const p=_=>{const v=_;v.detail&&(d({title:v.detail.title,duration:v.detail.duration}),c(!0))};return window.addEventListener("breathing:open",p),()=>{window.removeEventListener("breathing:open",p)}},[e.user.id]);const b=async()=>{a(!0),o(null);try{const p=await zE(e.user.id);p.error?(o("Failed to load meditation stats"),console.error("Failed to load stats:",p.error)):p.data&&n(p.data)}catch(p){o("Failed to load meditation stats"),console.error("Failed to load stats:",p)}finally{a(!1)}},y=(p,_)=>{d({title:p,duration:_}),c(!0)},g=async()=>{if(u){h(!0);try{const p=await FE({user_id:e.user.id,duration_seconds:u.duration,session_type:"breathing",completed:!0});p.error?console.error("Failed to save session:",p.error):await b()}catch(p){console.error("Failed to save session:",p)}finally{h(!1),c(!1),d(null)}}},w=()=>{c(!1),d(null)};return s.jsxs("div",{className:"breathing-space",children:[s.jsxs("div",{className:"breathing-space__left-column",children:[s.jsxs("div",{className:"breathing-space__card breathing-space__quick-start",children:[s.jsxs("div",{className:"breathing-space__card-header",children:[s.jsx("span",{className:"breathing-space__card-icon",children:"🌬️"}),s.jsx("h3",{className:"breathing-space__card-title",children:"Quick Start"})]}),s.jsx("p",{className:"breathing-space__card-description",children:"Take a moment to center yourself with a quick breathing exercise."}),s.jsx("button",{className:"btn btn--primary breathing-space__start-button",onClick:()=>y("3-Minute Breathing",180),children:"Start 3-minute breathing"})]}),s.jsx(ME,{userId:e.user.id})]}),s.jsxs("div",{className:"breathing-space__right-column",children:[s.jsxs("div",{className:"breathing-space__card breathing-space__progress",children:[s.jsxs("div",{className:"breathing-space__card-header",children:[s.jsx("span",{className:"breathing-space__card-icon",children:"📊"}),s.jsx("h3",{className:"breathing-space__card-title",children:"Your Progress"})]}),r?s.jsx("p",{className:"breathing-space__loading",children:"Loading stats..."}):i?s.jsx("p",{className:"breathing-space__error",children:i}):s.jsxs("div",{className:"breathing-space__stats",children:[s.jsxs("div",{className:"breathing-space__stat",children:[s.jsx("div",{className:"breathing-space__stat-value",children:t.totalMinutes}),s.jsx("div",{className:"breathing-space__stat-label",children:"Total Minutes"})]}),s.jsxs("div",{className:"breathing-space__stat",children:[s.jsx("div",{className:"breathing-space__stat-value",children:t.totalSessions}),s.jsx("div",{className:"breathing-space__stat-label",children:"Sessions"})]}),s.jsxs("div",{className:"breathing-space__stat",children:[s.jsx("div",{className:"breathing-space__stat-value",children:t.currentStreak}),s.jsx("div",{className:"breathing-space__stat-label",children:"Day Streak"})]})]})]}),s.jsxs("div",{className:"breathing-space__library",children:[s.jsx("h3",{className:"breathing-space__library-title",children:"Meditation Library"}),s.jsx("div",{className:"breathing-space__library-grid",children:BE.map(p=>s.jsxs("div",{className:"breathing-space__library-card",children:[s.jsx("div",{className:"breathing-space__library-card-icon",children:p.icon}),s.jsx("h4",{className:"breathing-space__library-card-title",children:p.title}),s.jsx("p",{className:"breathing-space__library-card-description",children:p.description}),s.jsxs("div",{className:"breathing-space__library-card-duration",children:[Math.floor(p.duration/60)," minutes"]}),s.jsx("button",{className:"btn btn--secondary breathing-space__library-card-button",onClick:()=>y(p.title,p.duration),children:"Start"})]},p.id))})]})]}),u&&s.jsx(EE,{isOpen:l,onClose:w,sessionTitle:u.title,durationSeconds:u.duration,onComplete:g})]})}function zm({className:e}){const{theme:t,toggleTheme:n}=kl(),r=t==="bright-sky"?"Dark Glass":"Bright Sky",a=t==="bright-sky"?"Dark mode":"Light mode",i=t==="bright-sky"?"🌙":"☀️";return s.jsxs("button",{type:"button",className:["theme-toggle",e].filter(Boolean).join(" "),onClick:n,"aria-label":`Switch to the ${r} theme`,title:`Switch to the ${r} theme`,"aria-pressed":t!=="bright-sky",children:[s.jsx("span",{className:"theme-toggle__icon","aria-hidden":"true",children:i}),s.jsx("span",{className:"theme-toggle__label",children:a})]})}function Bm({items:e,activeId:t,onSelect:n,onOpenMenu:r}){return s.jsx("nav",{className:"mobile-footer-nav","aria-label":"Primary navigation",children:s.jsxs("div",{className:"mobile-footer-nav__surface",children:[s.jsx("ul",{className:"mobile-footer-nav__list",children:e.map(a=>{const i=a.id===t;return s.jsx("li",{className:"mobile-footer-nav__item",children:s.jsxs("button",{type:"button",className:`mobile-footer-nav__button ${i?"mobile-footer-nav__button--active":""}`,onClick:()=>n(a.id),"aria-label":a.ariaLabel??a.label,"aria-pressed":i,children:[s.jsx("span",{"aria-hidden":"true",className:"mobile-footer-nav__icon",children:a.icon}),s.jsx("span",{className:"mobile-footer-nav__label",children:a.label})]})},a.id)})}),r?s.jsx("div",{className:"mobile-footer-nav__menu",children:s.jsxs("button",{type:"button",className:"mobile-footer-nav__menu-button",onClick:r,children:[s.jsx("span",{"aria-hidden":"true",className:"mobile-footer-nav__menu-icon",children:"☰"}),s.jsx("span",{className:"mobile-footer-nav__menu-label",children:"Menu"}),s.jsx("span",{className:"sr-only",children:"Open full navigation"})]})}):null]})})}const HE=[{mode:"light",icon:"☀️",label:"Light"},{mode:"dark",icon:"🌙",label:"Dark"},{mode:"system",icon:"💻",label:"System"}];function WE({onClose:e}){const{themeMode:t,lightTheme:n,darkTheme:r,setThemeMode:a,setLightTheme:i,setDarkTheme:o}=kl(),l=(u,d)=>{if(d==="light"){const m=Zs.find(h=>h.id===u);m&&i(m.id)}else{const m=is.find(h=>h.id===u);m&&o(m.id)}},c=[...Zs,...is];return s.jsxs("div",{className:"mobile-theme-selector",children:[s.jsxs("div",{className:"mobile-theme-selector__header",children:[s.jsx("h3",{className:"mobile-theme-selector__title",children:"Choose Theme"}),s.jsx("button",{type:"button",className:"mobile-theme-selector__close",onClick:e,"aria-label":"Close theme selector",children:"×"})]}),s.jsxs("div",{className:"mobile-theme-mode-toggle",children:[s.jsx("span",{className:"mobile-theme-mode-toggle__label",children:"Mode:"}),s.jsx("div",{className:"mobile-theme-mode-toggle__buttons",children:HE.map(u=>{const d=t===u.mode;return s.jsxs("button",{type:"button",className:`mobile-theme-mode-toggle__btn ${d?"mobile-theme-mode-toggle__btn--active":""}`,onClick:()=>a(u.mode),"aria-pressed":d,"aria-label":`Set theme mode to ${u.label}`,children:[s.jsx("span",{className:"mobile-theme-mode-toggle__icon","aria-hidden":"true",children:u.icon}),s.jsx("span",{className:"mobile-theme-mode-toggle__text",children:u.label})]},u.mode)})})]}),s.jsx("div",{className:"mobile-theme-selector__grid",children:c.map(u=>{const d=u.category==="light"&&n===u.id,m=u.category==="dark"&&r===u.id,h=d||m;return s.jsxs("button",{type:"button",className:`mobile-theme-selector__card ${h?"mobile-theme-selector__card--active":""}`,onClick:()=>l(u.id,u.category),"aria-pressed":h,"aria-label":`Select ${u.name}`,children:[s.jsx("span",{className:"mobile-theme-selector__icon","aria-hidden":"true",children:u.icon}),s.jsx("span",{className:"mobile-theme-selector__name",children:u.name}),h&&s.jsx("span",{className:"mobile-theme-selector__badge","aria-label":"Currently active",children:"✓"})]},u.id)})})]})}const VE=[{type:"quick",icon:"⚡",label:"Quick"},{type:"standard",icon:"📝",label:"Standard"},{type:"deep",icon:"🔮",label:"Deep"},{type:"brain_dump",icon:"🧠",label:"Brain Dump"},{type:"life_wheel",icon:"🎯",label:"Life Wheel"},{type:"goal",icon:"🎪",label:"Goal"}];function GE({session:e,onCheckHabit:t,onJournalNow:n,onOpenLifeCoach:r}){const[a,i]=f.useState(!1),[o,l]=f.useState(!1),[c,u]=f.useState(!1),[d,m]=f.useState(!1),[h,b]=f.useState([]),[y,g]=f.useState({}),[w,p]=f.useState(!1),[_,v]=f.useState(null),x=f.useRef(null);f.useEffect(()=>{const z=ne=>{x.current&&!x.current.contains(ne.target)&&(i(!1),l(!1),m(!1))};return a&&document.addEventListener("mousedown",z),()=>{document.removeEventListener("mousedown",z)}},[a]);const j=()=>{i(!a),a&&(l(!1),m(!1))},k=f.useCallback(async()=>{p(!0);try{const z=new Date().toISOString().split("T")[0],{data:ne,error:Z}=await Fy(e.user.id);if(Z)throw Z;const I=ne??[];if(b(I),I.length===0){g({});return}const C=I.map(de=>de.id),{data:L,error:K}=await qy(C,z,z);if(K)throw K;const ue={};C.forEach(de=>{ue[de]={logId:null,completed:!1}}),(L??[]).forEach(de=>{de.date===z&&(ue[de.habit_id]={logId:de.id,completed:!!de.completed})}),g(ue)}catch(z){console.error("Failed to load habits:",z)}finally{p(!1)}},[e.user.id]),S=async()=>{const z=!d;m(z),z&&h.length===0&&!w&&await k()},A=()=>{l(!o),m(!1)},P=z=>{n==null||n(z),i(!1),l(!1)},R=()=>{u(!0),i(!1)},q=()=>{u(!1)},O=async z=>{v(z);try{const ne=new Date().toISOString().split("T")[0],Z=y[z];if((Z==null?void 0:Z.completed)??!1){const{error:C}=await By(z,ne);if(C)throw C;g(L=>({...L,[z]:{logId:null,completed:!1}}))}else{const{data:C,error:L}=await zy({habit_id:z,date:ne,completed:!0});if(L)throw L;g(K=>({...K,[z]:{logId:(C==null?void 0:C.id)??null,completed:!0}}))}}catch(ne){console.error("Failed to toggle habit:",ne)}finally{v(null)}},oe=[{id:"check-habit",icon:"✅",label:"Check off habit",color:"#10b981",onClick:S},{id:"journal",icon:"📔",label:"Journal Now",color:"#8b5cf6",onClick:A},{id:"life-coach",icon:"🤖",label:"Life Coach AI",color:"#0ea5e9",onClick:R}];return s.jsxs(s.Fragment,{children:[s.jsxs("div",{ref:x,className:`quick-actions-fab ${a?"quick-actions-fab--open":""}`,children:[s.jsx("div",{className:"quick-actions-fab__actions",children:oe.map((z,ne)=>s.jsxs("div",{className:`quick-actions-fab__action ${a?"quick-actions-fab__action--visible":""}`,style:{"--action-index":ne,"--action-color":z.color},children:[s.jsx("button",{type:"button",className:"quick-actions-fab__action-btn",onClick:z.onClick,"aria-label":z.label,title:z.label,children:s.jsx("span",{className:"quick-actions-fab__action-icon","aria-hidden":"true",children:z.icon})}),s.jsx("span",{className:"quick-actions-fab__action-label",children:z.label}),z.id==="journal"&&o&&s.jsxs("div",{className:"quick-actions-fab__submenu",children:[s.jsx("div",{className:"quick-actions-fab__submenu-title",children:"Choose journal type:"}),s.jsx("div",{className:"quick-actions-fab__submenu-items",children:VE.map(Z=>s.jsxs("button",{type:"button",className:"quick-actions-fab__submenu-item",onClick:()=>P(Z.type),children:[s.jsx("span",{"aria-hidden":"true",children:Z.icon}),Z.label]},Z.type))})]}),z.id==="check-habit"&&d&&s.jsxs("div",{className:"quick-actions-fab__submenu quick-actions-fab__submenu--habits",children:[s.jsx("div",{className:"quick-actions-fab__submenu-title",children:w?"Loading habits...":"Today's habits:"}),w?s.jsx("div",{className:"quick-actions-fab__submenu-loading",children:s.jsx("span",{children:"⏳"})}):h.length===0?s.jsxs("div",{className:"quick-actions-fab__submenu-empty",children:[s.jsx("p",{children:"No habits scheduled for today."}),s.jsx("p",{children:"Add habits to your goals to track them here."})]}):s.jsx("div",{className:"quick-actions-fab__submenu-habits",children:h.map(Z=>{var L;const I=((L=y[Z.id])==null?void 0:L.completed)??!1,C=_===Z.id;return s.jsxs("button",{type:"button",className:`quick-actions-fab__habit-item ${I?"quick-actions-fab__habit-item--completed":""}`,onClick:()=>!C&&O(Z.id),disabled:C,"aria-label":`${I?"Uncheck":"Check"} ${Z.name}`,children:[s.jsx("span",{className:"quick-actions-fab__habit-checkbox","aria-hidden":"true",children:C?"⏳":I?"✅":"☐"}),s.jsx("span",{className:"quick-actions-fab__habit-name",children:Z.name})]},Z.id)})})]})]},z.id))}),s.jsx("button",{type:"button",className:`quick-actions-fab__main ${a?"quick-actions-fab__main--open":""}`,onClick:j,"aria-label":a?"Close quick actions":"Open quick actions","aria-expanded":a,children:s.jsx("span",{className:"quick-actions-fab__main-icon","aria-hidden":"true",children:"✨"})})]}),c&&s.jsx(cb,{session:e,onClose:q})]})}async function KE(e){if(!Ce())return{data:null,error:null};const t=ce(),n=await t.from("goals").select("id",{count:"exact"}).eq("user_id",e);if(n.error)return{data:null,error:n.error};(n.data??[]).map(o=>o.id);const r=await t.from("habits_v2").select("id",{count:"exact",head:!0}).eq("user_id",e);if(r.error)return{data:null,error:r.error};const a=r.count??0,i=await t.from("checkins").select("id",{count:"exact",head:!0}).eq("user_id",e);return i.error?{data:null,error:i.error}:{data:{goalCount:n.count??0,habitCount:a,checkinCount:i.count??0},error:null}}const JE=(e,t)=>Object.is(e,t);function YE({value:e,save:t,enabled:n=!0,debounceMs:r=1500,resetKey:a,isEqual:i=JE}){const[o,l]=f.useState(!1),[c,u]=f.useState(null),[d,m]=f.useState(!1),h=f.useRef(null),b=f.useRef(null),y=f.useRef(null),g=f.useRef(!1),w=f.useRef(a),p=f.useCallback(()=>{h.current&&(clearTimeout(h.current),h.current=null)},[]),_=f.useCallback(async x=>{if(n){p(),b.current=null,l(!0),u(null);try{await t(x),y.current=x,m(!1)}catch(j){const k=j instanceof Error?j.message:"Unable to save your changes automatically.";throw u(k),j}finally{l(!1)}}},[p,n,t]),v=f.useCallback(async()=>{if(!n)return;const x=b.current;if(x==null){p();return}await _(x)},[p,n,_]);return f.useEffect(()=>{if(!n){p(),b.current=null,m(!1);return}(!g.current||w.current!==a)&&(g.current=!0,w.current=a,y.current=e,b.current=null,m(!1),p())},[n,a,e,p]),f.useEffect(()=>{if(n){if(y.current!==null&&i(e,y.current)){b.current=null,m(!1),p();return}return b.current=e,m(!0),p(),h.current=setTimeout(()=>{b.current!=null&&_(b.current)},r),()=>{p()}}},[e,n,r,i,p,_]),f.useEffect(()=>()=>{p()},[p]),{isSaving:o,hasPendingChanges:d,error:c,flush:v}}const qm=[{id:"goals",label:"Dashboard",summary:"Review upcoming milestones and daily focus from a unified dashboard.",icon:"📊",shortLabel:"HOME"},{id:"planning",label:"Today's Habits & Routines",summary:"Check in on the rituals that keep today on track.",icon:"✅",shortLabel:"TODAY"},{id:"habits",label:"Habits & Routines",summary:"Keep your weekly rhythms aligned with the goals you care about most.",icon:"📆",shortLabel:"ROUTINES"},{id:"rituals",label:"Wellbeing Wheel Check-in",summary:"Reflect on your wellbeing balance with a quick wheel check-in.",icon:"🧭",shortLabel:"CHECK-IN"},{id:"journal",label:"Journal",summary:"Capture private reflections, moods, and links to your goals.",icon:"📔",shortLabel:"JOURNAL"},{id:"breathing-space",label:"Breathing Space",summary:"Practice mindful breathing and meditation to center yourself.",icon:"🌬️",shortLabel:"BREATHE"},{id:"insights",label:"Vision Board",summary:"Stay inspired with highlights from your evolving vision board.",icon:"🖼️",shortLabel:"VISION"},{id:"support",label:"Life Goals",summary:"Review your long-term goals and celebrate progress milestones.",icon:"🎯",shortLabel:"GOALS"},{id:"assistant",label:"AI Strategy Assistant",summary:"Tap into momentum resets, vacation modes, and scenario planning.",icon:"🤖",shortLabel:"AI"},{id:"ai-coach",label:"AI Life Coach",summary:"Chat with your personal AI coach for motivation, advice, and guidance.",icon:"💬",shortLabel:"COACH"}],QE=["planning","habits","support","assistant","ai-coach","journal","breathing-space","insights","rituals","account"];function XE(){var Xt,Xe,zn,Or,ca,wi;const[e,t]=f.useState(null),{session:n,initializing:r,isConfigured:a,isAuthenticated:i,mode:o,client:l,signInWithPassword:c,signUpWithPassword:u,signInWithGoogle:d,signOut:m}=Pn(),{theme:h,themeMode:b}=kl(),[y,g]=f.useState(""),[w,p]=f.useState(""),[_,v]=f.useState(""),[x,j]=f.useState("password"),[k,S]=f.useState(null),[A,P]=f.useState(!1),[R,q]=f.useState(null),[O,oe]=f.useState(!1),[z,ne]=f.useState("login"),[Z,I]=f.useState(!1),[C,L]=f.useState(""),[K,ue]=f.useState("goals"),[de]=f.useState(()=>typeof window<"u"?window.location.search:""),[De,fe]=f.useState(!1),H=Qd("(max-width: 720px)"),[we,B]=f.useState(!1),[D,ae]=f.useState(null),[G,ye]=f.useState(null),[Se,Te]=f.useState(!1),[E,T]=f.useState(!1),[U,J]=f.useState(!1),[le,M]=f.useState(!1),[re,me]=f.useState(!1),[Pe,Ue]=f.useState(!1),Ae=f.useMemo(()=>{if(h==="bio-day"){const Q=Ne=>s.jsx("img",{src:Ne,alt:"",className:"workspace-sidebar__nav-image"});return qm.map(Ne=>Ne.id==="goals"?{...Ne,icon:Q(u_)}:Ne.id==="planning"?{...Ne,icon:Q(d_)}:Ne)}return qm},[h]),Re=f.useMemo(()=>{const Q=Ne=>Ae.find(Ye=>Ye.id===Ne);return QE.map(Ne=>{const Ye=Q(Ne),Lt=(Ye==null?void 0:Ye.shortLabel)??(Ye==null?void 0:Ye.label)??Ne,Zt=Lt.length>0?`${Lt.charAt(0)}${Lt.slice(1).toLowerCase()}`:Lt;return Ne==="account"?{id:Ne,label:"Account",ariaLabel:"Account and profile",icon:"👤",summary:"Manage your profile, workspace, and sign-in preferences."}:{id:Ne,label:Zt,ariaLabel:(Ye==null?void 0:Ye.label)??Zt,icon:(Ye==null?void 0:Ye.icon)??"•",summary:(Ye==null?void 0:Ye.summary)??"Open this section."}})},[Ae]),pt=f.useMemo(()=>Re.slice(0,4),[Re]),Et=we?"planning":K,Ar=o==="demo",qe=f.useMemo(()=>n||Na(),[n]);f.useEffect(()=>{var Q,Ne;if(!n){L(((Q=qe.user.user_metadata)==null?void 0:Q.full_name)??""),I(!1);return}L((D==null?void 0:D.full_name)||((Ne=n.user.user_metadata)==null?void 0:Ne.full_name)||"")},[n,qe,D]),f.useEffect(()=>{if(!n||!a){ae(null),ye(null),Te(!1),T(!1),J(!1);return}let Q=!0;return Te(!0),BN(n.user.id).then(({data:Ne})=>{Q&&ae(Ne)}).finally(()=>{Q&&Te(!1)}),KE(n.user.id).then(({data:Ne})=>{Q&&ye(Ne)}),()=>{Q=!1}},[n,a,U]),f.useEffect(()=>{var Q;(Q=n==null?void 0:n.user)!=null&&Q.id||J(!1)},[(Xt=n==null?void 0:n.user)==null?void 0:Xt.id]),f.useEffect(()=>{typeof window>"u"||(window.location.pathname==="/journal"?ue("journal"):window.location.pathname==="/breathing-space"&&ue("breathing-space"))},[]),f.useEffect(()=>{if(typeof window>"u")return;const Q=de??"";let Ne="/";K==="journal"?Ne="/journal":K==="breathing-space"&&(Ne="/breathing-space");const Ye=`${Ne}${Q}`;window.location.pathname!==Ne&&window.history.replaceState({},"",Ye)},[K,de]),f.useEffect(()=>{const Q=Ne=>{Ne.preventDefault(),t(Ne)};return window.addEventListener("beforeinstallprompt",Q),()=>{window.removeEventListener("beforeinstallprompt",Q)}},[]),f.useEffect(()=>{if(!H){B(!1);return}B(Q=>Q||!0)},[H]),f.useEffect(()=>{if(!k){P(!1);return}P(!0);const Q=window.setTimeout(()=>P(!1),1500),Ne=window.setTimeout(()=>S(null),2100);return()=>{window.clearTimeout(Q),window.clearTimeout(Ne)}},[k]),f.useEffect(()=>{j(z==="signup"?"signup":"password")},[z]);const dn=f.useMemo(()=>{var Q;return!!((Q=qe.user.user_metadata)!=null&&Q.onboarding_complete)},[qe]),bn=async Q=>{var sr,wt,ua;Q.preventDefault(),S(null),q(null);const Ne=new FormData(Q.currentTarget),Ye=((sr=Ne.get("email"))==null?void 0:sr.trim())||"",Lt=((wt=Ne.get("password"))==null?void 0:wt.trim())||"",Zt=((ua=Ne.get("fullName"))==null?void 0:ua.trim())||"";if(g(Ye),p(Lt),v(Zt),!Ye){q("Enter an email address to continue.");return}oe(!0);try{if(x==="password"){if(!Lt){q("Enter a password to continue.");return}await c({email:Ye,password:Lt}),S("Signed in successfully."),fe(!1),ue("planning"),H&&B(!0)}else if(x==="signup"){if(!Lt){q("Create a password to finish signing up.");return}if(!Zt){q("Share your name so we can personalize your workspace.");return}await u({email:Ye,password:Lt,options:{data:{full_name:Zt,onboarding_complete:!1}}}),S("Check your email to confirm your account, then sign in to continue.")}}catch(sh){q(sh instanceof Error?sh.message:"Unable to complete the request.")}finally{oe(!1)}},W=(Q="login")=>{ne(Q),fe(!0)},_e=()=>{if(i){ue("account"),fe(!1);return}W("login")},$e=()=>{if(!i){_e();return}J(!1),T(!0)},er=async()=>{S(null),q(null),oe(!0);try{await c({email:vy,password:"demo-password"}),S("Signed in to the demo workspace."),fe(!1),ue("planning"),H&&B(!0)}catch(Q){q(Q instanceof Error?Q.message:"Unable to sign in right now.")}finally{oe(!1)}},tr=async()=>{S(null),q(null),oe(!0);try{await d(),S("Redirecting to Google…")}catch(Q){q(Q instanceof Error?Q.message:"Unable to open Google sign-in.")}finally{oe(!1)}},vn=async()=>{q(null),S(null);try{await Y().catch(Q=>{console.warn("Unable to flush profile autosave before signing out.",Q)}),await m(),S("Signed out."),g(""),p(""),v("")}catch(Q){q(Q instanceof Error?Q.message:"Unable to sign out.")}},wn=async()=>{e&&(e.prompt(),await e.userChoice,t(null))},Fn=()=>{ue("planning"),B(!0)},nr=Q=>{if(M(!1),Q==="account"&&!i){_e();return}if(Q==="ai-coach"){Ue(!0);return}if(Q==="planning"&&H){Fn();return}ue(Q),B(!1)},Ir=f.useCallback(Q=>{ue(Q),B(!1)},[]),us=f.useCallback(()=>{ue("planning"),B(!1)},[]),oa=f.useCallback(Q=>{ue("journal"),B(!1)},[]),la=f.useCallback(()=>{},[]),Pr=s.jsxs(s.Fragment,{children:[k&&s.jsx("p",{className:`supabase-auth__status supabase-auth__status--success ${A?"":"supabase-auth__status--hidden"}`,children:k}),R&&s.jsx("p",{className:"supabase-auth__status supabase-auth__status--error",children:R})]}),rr=()=>{const Q=[{id:"login",label:"Log in"},{id:"signup",label:"Sign up"},{id:"demo",label:"Demo Account"}],Ne={login:{title:"Welcome back",subtitle:"Log in to sync your rituals, goals, and check-ins across devices."},signup:{title:"Create your LifeGoal account",subtitle:"Sign up with email or Google to unlock the full workspace."},demo:{title:"Take the demo for a spin",subtitle:`Instantly browse the workspace as ${Tu}.`}},Ye=()=>s.jsxs("div",{className:"auth-tab-panel",role:"tabpanel",id:"auth-panel-login","aria-labelledby":"auth-tab-login",children:[s.jsxs("form",{className:"supabase-auth__form",onSubmit:bn,children:[s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Email"}),s.jsx("input",{type:"email",name:"email",value:y,onChange:wt=>g(wt.target.value),placeholder:"you@example.com",autoComplete:"email",required:!0})]}),s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Password"}),s.jsx("input",{type:"password",name:"password",value:w,onChange:wt=>p(wt.target.value),placeholder:"••••••••",autoComplete:"current-password",required:!0})]}),s.jsx("div",{className:"supabase-auth__actions",children:s.jsx("button",{type:"submit",className:"supabase-auth__action auth-card__primary",disabled:O,children:O?"Signing in…":"Log in"})})]}),s.jsx("div",{className:"auth-card__providers",children:s.jsx("button",{type:"button",className:"auth-provider auth-provider--google",onClick:tr,disabled:O||!a,children:"Continue with Google"})})]}),Lt=()=>s.jsxs("div",{className:"auth-tab-panel",role:"tabpanel",id:"auth-panel-signup","aria-labelledby":"auth-tab-signup",children:[s.jsxs("form",{className:"supabase-auth__form",onSubmit:bn,children:[s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Your name"}),s.jsx("input",{type:"text",name:"fullName",value:_,onChange:wt=>v(wt.target.value),placeholder:"Jordan Goalsetter",autoComplete:"name",required:!0})]}),s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Email"}),s.jsx("input",{type:"email",name:"email",value:y,onChange:wt=>g(wt.target.value),placeholder:"you@example.com",autoComplete:"email",required:!0})]}),s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Password"}),s.jsx("input",{type:"password",name:"password",value:w,onChange:wt=>p(wt.target.value),placeholder:"Create a secure password",autoComplete:"new-password",required:!0})]}),s.jsx("div",{className:"supabase-auth__actions",children:s.jsx("button",{type:"submit",className:"supabase-auth__action auth-card__primary",disabled:O,children:O?"Creating account…":"Sign up with email"})})]}),s.jsx("div",{className:"auth-card__providers",children:s.jsx("button",{type:"button",className:"auth-provider auth-provider--google",onClick:tr,disabled:O||!a,children:"Sign up with Google"})})]}),Zt=()=>s.jsxs("div",{className:"auth-tab-panel",role:"tabpanel",id:"auth-panel-demo","aria-labelledby":"auth-tab-demo",children:[s.jsx("p",{className:"auth-card__hint",children:"Launch the fully-populated demo workspace to explore rituals, goal planning boards, and daily trackers without creating an account."}),s.jsxs("ul",{className:"auth-demo-list",children:[s.jsx("li",{children:"Preview Today's Habits and goal dashboards."}),s.jsx("li",{children:"Make changes locally without affecting production data."}),s.jsx("li",{children:"Decide later if you want to connect your own Supabase project."})]}),s.jsx("button",{type:"button",className:"supabase-auth__action auth-card__primary",onClick:er,disabled:O,children:"Enter the demo workspace"})]}),sr=()=>r?s.jsx("p",{className:"supabase-auth__status supabase-auth__status--info",children:"Loading session…"}):z==="login"?Ye():z==="signup"?Lt():Zt();return s.jsxs("div",{className:"auth-card",children:[s.jsxs("header",{className:"auth-card__header",children:[s.jsx("h2",{children:Ne[z].title}),s.jsx("p",{children:Ne[z].subtitle})]}),s.jsx("div",{className:"auth-card__tabs",role:"tablist","aria-label":"Choose how to access LifeGoal",children:Q.map(wt=>{const ua=z===wt.id;return s.jsx("button",{type:"button",role:"tab",id:`auth-tab-${wt.id}`,"aria-controls":`auth-panel-${wt.id}`,"aria-selected":ua,className:`auth-tab ${ua?"auth-tab--active":""}`,onClick:()=>ne(wt.id),children:wt.label},wt.id)})}),s.jsxs("div",{className:"auth-card__body",children:[sr(),a?null:s.jsx("p",{className:"supabase-auth__status supabase-auth__status--error",children:"Supabase credentials are not configured. Update your environment variables to enable live authentication."}),Pr]})]})},Rr=C||((Xe=qe.user.user_metadata)==null?void 0:Xe.full_name)||qe.user.email,N=(Rr||"").trim().charAt(0).toUpperCase()||"U",ee=(D==null?void 0:D.initials)||di((D==null?void 0:D.full_name)||""),pe=i&&(D==null?void 0:D.show_initials_in_menu)&&ee?ee:"🌿",be=Ae.find(Q=>Q.id===K)??Ae[Ae.length-1],je=un(qe),He=C.trim()||(D==null?void 0:D.full_name)||(((zn=n==null?void 0:n.user.user_metadata)==null?void 0:zn.full_name)??"")||"",tt=n?`${n.user.id}:${(D==null?void 0:D.full_name)||(((Or=n.user.user_metadata)==null?void 0:Or.full_name)??"")||""}`:"demo",$=f.useCallback(async Q=>{if(!n)return;const Ne=Q.trim();if(!Ne)return;const Ye=l??ce(),[Lt,Zt]=await Promise.all([Ye.auth.updateUser({data:{full_name:Ne,onboarding_complete:!0}}),nh({...D,user_id:n.user.id,full_name:Ne,initials:di(Ne)})]);if(Lt.error)throw Lt.error;if(Zt.error)throw Zt.error;Zt.data?ae(Zt.data):ae(sr=>sr&&{...sr,full_name:Ne})},[l,n,D==null?void 0:D.workspace_name]),{isSaving:se,flush:Y,error:F}=YE({value:He,enabled:!!(n&&l),resetKey:tt,save:$,debounceMs:1800}),ie=Z||se,ke=!je,lt=!ke||dn,ct=!je&&!i&&!Ar;f.useEffect(()=>{F&&q(F)},[F]);const Ie=E&&!ct&&a&&!!n,Ke=()=>{T(!1),J(!0)};if(ct&&H)return s.jsxs("div",{className:"app app--auth-gate",children:[s.jsxs("header",{className:"auth-gate__masthead",children:[s.jsx("a",{className:"auth-gate__brand",href:"/","aria-label":"LifeGoalApp home",children:"LifeGoalApp"}),s.jsx(zm,{className:"auth-gate__theme-toggle"})]}),s.jsxs("main",{className:"auth-layout auth-gate__layout",children:[s.jsxs("section",{className:"auth-hero",children:[s.jsx("span",{className:"auth-hero__badge",children:"Secure workspace"}),s.jsx("h1",{children:"Sign in to keep your rituals in sync"}),s.jsx("p",{className:"auth-hero__lead",children:"Access your personalized habit checklist and goal planning tools from any device."}),s.jsxs("ul",{className:"auth-hero__list",children:[s.jsxs("li",{children:[s.jsx("h3",{children:"Daily rituals, anywhere"}),s.jsx("p",{children:"Review Today's Habits once you're signed in to your workspace."})]}),s.jsxs("li",{children:[s.jsx("h3",{children:"Private progress"}),s.jsx("p",{children:"Your life wheel check-ins and reflections stay linked to your secure account."})]})]})]}),s.jsx("div",{className:"auth-panel auth-gate__panel",children:rr()})]})]});const Fe=ct&&!H,ze=Fe||De,it=ze,Je=()=>{if(K==="goals")return s.jsxs(s.Fragment,{children:[ke&&!dn&&s.jsx(ZE,{session:qe,displayName:C,setDisplayName:L,profileSaving:ie,setProfileSaving:I,setAuthMessage:S,setAuthError:q,isOnboardingComplete:dn}),lt?s.jsxs("div",{className:"workspace-content",children:[s.jsx(WS,{session:qe,stats:G}),s.jsx(Gf,{session:qe})]}):s.jsx("p",{className:"workspace-onboarding-hint",children:"Finish onboarding to unlock the goal workspace and habit trackers."})]});if(K==="account")return s.jsx("div",{className:"workspace-content",children:s.jsx(qN,{session:qe,isDemoExperience:je,isAuthenticated:i,onSignOut:vn,onEditProfile:$e,profile:D,stats:G,profileLoading:Se,onProfileUpdate:ae})});if(!lt&&!(K==="assistant"))return s.jsx("p",{className:"workspace-onboarding-hint",children:"Finish onboarding to unlock this area."});switch(K){case"planning":return s.jsxs("div",{className:"workspace-content",children:[H?s.jsxs("div",{className:"workspace-link-callout",children:[s.jsx("p",{className:"workspace-link-callout__text",children:"Prefer the simplified Today home?"}),s.jsx("button",{type:"button",className:"workspace-link-callout__button",onClick:Fn,children:"Open Today screen"})]}):null,s.jsx(Lu,{session:qe})]});case"rituals":return s.jsx("div",{className:"workspace-content",children:s.jsx(Ek,{session:qe})});case"habits":return s.jsxs("div",{className:"workspace-content",children:[s.jsx(Lu,{session:qe}),s.jsx(US,{session:qe})]});case"journal":return s.jsx("div",{className:"workspace-content",children:s.jsx(NE,{session:qe,onNavigateToGoals:()=>Ir("support"),onNavigateToHabits:()=>Ir("planning")})});case"breathing-space":return s.jsx("div",{className:"workspace-content",children:s.jsx(qE,{session:qe})});case"insights":return s.jsx("div",{className:"workspace-content",children:s.jsx(nN,{session:qe})});case"support":return s.jsxs("div",{className:"workspace-content",children:[s.jsx(Ik,{session:qe}),s.jsx(Gf,{session:qe}),s.jsx(xk,{session:qe})]});case"assistant":return s.jsx("div",{className:"workspace-content",children:s.jsx(QN,{session:qe})});default:return s.jsx("div",{className:"workspace-stage__placeholder",children:s.jsxs("div",{className:"workspace-stage__placeholder-content",children:[s.jsx("h2",{children:be.label}),s.jsx("p",{children:be.summary}),s.jsx("p",{className:"workspace-stage__placeholder-hint",children:'Select "Goals & Habits" to access the full workspace preview.'})]})})}},vt=H&&le?s.jsxs("div",{className:"mobile-menu-overlay",role:"dialog","aria-modal":"true","aria-label":"Open full LifeGoalApp menu",children:[s.jsx("div",{className:"mobile-menu-overlay__backdrop",onClick:()=>{M(!1),me(!1)},role:"presentation"}),s.jsx("div",{className:"mobile-menu-overlay__panel",children:re?s.jsx(WE,{onClose:()=>me(!1)}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"mobile-menu-overlay__header",children:[s.jsx("h2",{className:"mobile-menu-overlay__title",children:"Quick menu"}),s.jsx("button",{type:"button",className:"mobile-menu-overlay__close","aria-label":"Close menu",onClick:()=>M(!1),children:"×"})]}),s.jsx("div",{className:"mobile-menu-overlay__content",children:s.jsx("ul",{className:"mobile-menu-overlay__list",children:Re.filter(Q=>Q.id!=="account").map(Q=>s.jsx("li",{className:"mobile-menu-overlay__item",children:s.jsxs("button",{type:"button",onClick:()=>nr(Q.id),"aria-label":Q.ariaLabel,children:[s.jsx("span",{"aria-hidden":"true",className:"mobile-menu-overlay__icon",children:Q.icon}),s.jsxs("span",{className:"mobile-menu-overlay__texts",children:[s.jsx("span",{className:"mobile-menu-overlay__label",children:Q.label}),s.jsx("span",{className:"mobile-menu-overlay__summary",children:Q.summary})]})]})},Q.id))})}),s.jsxs("div",{className:"mobile-menu-overlay__settings",children:[s.jsx("h3",{className:"mobile-menu-overlay__settings-title",children:"Settings"}),s.jsxs("button",{type:"button",className:"mobile-menu-overlay__theme-selector-button",onClick:()=>me(!0),"aria-label":"Open theme selector",children:[s.jsxs("span",{className:"mobile-menu-overlay__theme-selector-label",children:[s.jsx("span",{className:"mobile-menu-overlay__theme-selector-title",children:"Theme"}),s.jsxs("span",{className:"mobile-menu-overlay__theme-selector-current",children:[((ca=Uu.find(Q=>Q.id===h))==null?void 0:ca.name)||"Theme"," • ",b==="system"?"💻 System":b==="dark"?"🌙 Dark":"☀️ Light"]})]}),s.jsx("span",{className:"mobile-menu-overlay__theme-selector-icon","aria-hidden":"true",children:((wi=Uu.find(Q=>Q.id===h))==null?void 0:wi.icon)||"🎨"})]}),s.jsxs("button",{type:"button",className:"mobile-menu-overlay__account-button",onClick:()=>nr("account"),"aria-label":"Open account settings",children:[s.jsx("span",{className:"mobile-menu-overlay__account-icon","aria-hidden":"true",children:"👤"}),s.jsx("span",{children:"My Account"})]})]})]})})]}):null;if(H&&we)return s.jsxs(s.Fragment,{children:[s.jsx(FS,{session:qe}),s.jsx(Bm,{items:pt,activeId:null,onSelect:nr,onOpenMenu:()=>M(!0)}),vt]});const Oe=`app app--workspace ${it?"app--auth-overlay":""}`,Be=`workspace-shell ${it?"workspace-shell--blurred":""}`,Wt=ze&&!Fe;return s.jsxs("div",{className:Oe,children:[s.jsxs("div",{className:Be,children:[!H&&s.jsxs("aside",{className:"workspace-sidebar","aria-label":"Workspace navigation",children:[s.jsxs("div",{className:"workspace-sidebar__masthead",children:[s.jsxs("a",{className:"workspace-sidebar__brand",href:"/","aria-label":"LifeGoalApp home",children:[s.jsx("span",{"aria-hidden":"true",children:pe}),s.jsx("span",{className:"sr-only",children:"LifeGoalApp"})]}),s.jsxs("div",{className:"workspace-sidebar__masthead-actions",children:[s.jsx(zm,{className:"btn btn--ghost workspace-sidebar__masthead-toggle"}),i?s.jsx("button",{type:"button",className:"btn btn--primary workspace-sidebar__masthead-button",onClick:vn,children:"Sign out"}):s.jsx("button",{type:"button",className:"btn btn--primary workspace-sidebar__masthead-button",onClick:()=>De?fe(!1):W("login"),children:De?"Hide sign-in":"Sign in"})]})]}),s.jsxs("div",{className:"workspace-sidebar__profile",children:[s.jsx("div",{className:"workspace-avatar","aria-hidden":"true",children:N}),s.jsxs("div",{className:"workspace-sidebar__profile-text",children:[s.jsx("span",{className:"workspace-sidebar__welcome",children:je?"Demo creator":"Welcome back"}),s.jsx("span",{className:"workspace-sidebar__name",children:Rr})]})]}),s.jsx("nav",{className:"workspace-sidebar__nav",children:s.jsx("div",{className:"workspace-sidebar__nav-list",children:Ae.map(Q=>{const Ne=K===Q.id,Ye=()=>{if(Q.id==="account"&&!i){_e();return}if(Q.id==="ai-coach"){Ue(!0);return}ue(Q.id)};return s.jsxs("button",{type:"button",className:`workspace-sidebar__nav-button ${Ne?"workspace-sidebar__nav-button--active":""}`,onClick:Ye,"aria-pressed":Ne,"aria-label":Q.label,title:`${Q.label} • ${Q.summary}`,children:[s.jsx("span",{className:"workspace-sidebar__nav-icon","aria-hidden":"true",children:Q.icon}),s.jsx("span",{className:"workspace-sidebar__nav-text","aria-hidden":"true",children:Q.shortLabel}),s.jsx("span",{className:"sr-only workspace-sidebar__nav-label",children:Q.label}),s.jsx("span",{className:"sr-only workspace-sidebar__nav-summary",children:Q.summary})]},Q.id)})})}),s.jsxs("div",{className:"workspace-sidebar__actions",children:[e&&s.jsx("button",{type:"button",className:"workspace-sidebar__install",onClick:wn,children:"Install app"}),s.jsx("div",{className:"workspace-sidebar__actions-divider",role:"presentation"}),s.jsxs("button",{type:"button",className:`workspace-sidebar__account-button ${i&&K==="account"?"workspace-sidebar__account-button--active":""}`,onClick:_e,"aria-pressed":i&&K==="account","aria-label":i?"Open my account":"Sign in to your account",title:i?"Open my account":"Sign in to your account",children:[s.jsx("span",{"aria-hidden":"true",className:"workspace-sidebar__nav-icon",children:"👤"}),s.jsx("span",{className:"sr-only",children:i?"Open my account settings":"Open the sign-in dialog"})]})]})]}),s.jsxs("main",{className:"workspace-main",children:[(k||R)&&s.jsx("div",{className:"workspace-status",children:Pr}),H?s.jsx("button",{type:"button",className:"workspace-main__mobile-cta",onClick:Fn,children:"Back to daily checklist"}):null,s.jsxs("section",{className:`workspace-stage ${K==="goals"?"workspace-stage--detail":"workspace-stage--placeholder"}`,"aria-live":"polite",children:[s.jsxs("header",{className:"workspace-stage__header",children:[s.jsx("h1",{children:be.label}),s.jsx("p",{children:be.summary})]}),s.jsx("div",{className:"workspace-stage__body",children:Je()})]})]})]}),H?s.jsx(Bm,{items:pt,activeId:Et,onSelect:nr,onOpenMenu:()=>M(!0)}):null,vt,ze?s.jsxs("div",{className:"auth-overlay",role:"dialog","aria-modal":"true","aria-label":"Authenticate with LifeGoalApp",children:[s.jsx("div",{className:"auth-overlay__backdrop",onClick:()=>Wt?fe(!1):null,role:"presentation"}),s.jsxs("div",{className:"auth-overlay__dialog",children:[Wt?s.jsxs("button",{type:"button",className:"auth-overlay__close",onClick:()=>fe(!1),children:[s.jsx("span",{"aria-hidden":"true",children:"×"}),s.jsx("span",{className:"sr-only",children:"Close sign-in dialog"})]}):null,rr()]})]}):null,Ie?s.jsx(HN,{isOpen:Ie,session:n,profile:D,onClose:Ke,onSaved:Q=>{ae(Q),L(Q.full_name??C),T(!1),J(!1),S("Profile saved!")}}):null,Pe&&s.jsx(cb,{session:qe,onClose:()=>Ue(!1)}),!ct&&s.jsx(GE,{session:qe,onCheckHabit:us,onJournalNow:oa,onOpenLifeCoach:la})]})}function ZE({session:e,displayName:t,setDisplayName:n,profileSaving:r,setProfileSaving:a,setAuthMessage:i,setAuthError:o,isOnboardingComplete:l}){const{client:c}=Pn(),u=async d=>{if(d.preventDefault(),!c){o("Supabase client is not ready.");return}a(!0),i(null),o(null);try{const m=t.trim(),{error:h}=await c.auth.updateUser({data:{full_name:m||null,onboarding_complete:!0}});if(h)throw h;i("Profile saved! Let’s capture your first goal next.")}catch(m){o(m instanceof Error?m.message:"Unable to save your profile.")}finally{a(!1)}};return s.jsxs("div",{className:"supabase-onboarding",children:[s.jsxs("header",{className:"supabase-onboarding__header",children:[s.jsx("h3",{children:l?"You’re all set 🎉":"Finish onboarding"}),s.jsx("p",{children:l?"Jump into the goals workspace to start charting your milestones.":"Add a display name so teammates know who is shaping these goals. We will mark onboarding as complete for you."})]}),s.jsxs("form",{className:"supabase-onboarding__form",onSubmit:u,children:[s.jsxs("label",{className:"supabase-auth__field",children:[s.jsx("span",{children:"Display name"}),s.jsx("input",{type:"text",value:t,onChange:d=>n(d.target.value),placeholder:e.user.email??"you@example.com"})]}),s.jsx("button",{type:"submit",className:"supabase-auth__action",disabled:r,children:r?"Saving…":l?"Update name":"Save & complete onboarding"})]})]})}async function eC(){var e,t,n;if(!("serviceWorker"in navigator)){console.warn("Service workers are not supported in this browser."),typeof window<"u"&&((e=window.__LifeGoalAppDebugger)==null||e.warn("Service workers are not supported in this browser."));return}try{const r=await navigator.serviceWorker.register("/sw.js",{scope:"/",type:"classic"});typeof window<"u"&&((t=window.__LifeGoalAppDebugger)==null||t.log("Service worker registered.",{scope:r.scope})),r.onupdatefound=()=>{const a=r.installing;a&&(a.onstatechange=()=>{var i;a.state==="installed"&&navigator.serviceWorker.controller&&(console.info("New content is available; please refresh."),typeof window<"u"&&((i=window.__LifeGoalAppDebugger)==null||i.log("Service worker installed an update.")))})}}catch(r){console.error("Failed to register service worker:",r),typeof window<"u"&&((n=window.__LifeGoalAppDebugger)==null||n.error("Failed to register service worker.",{message:r instanceof Error?r.message:String(r),stack:r instanceof Error?r.stack:void 0}))}}var Hm;typeof window<"u"&&((Hm=window.__LifeGoalAppDebugger)==null||Hm.log("Initializing React root.",{mode:"production"}));xc.createRoot(document.getElementById("root")).render(s.jsx(Ob.StrictMode,{children:s.jsx(fN,{children:s.jsx(Gj,{children:s.jsx(XE,{})})})}));var Wm;typeof window<"u"&&((Wm=window.__LifeGoalAppDebugger)==null||Wm.log("React root rendered successfully.",{strictMode:!0}));eC();const tC=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));
